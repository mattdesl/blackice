!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var f;"undefined"!=typeof window?f=window:"undefined"!=typeof global?f=global:"undefined"!=typeof self&&(f=self),f.blackice=e()}}(function(){var define,module,exports;return function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s}({1:[function(require,module,exports){(function(global){require("raf.js");var THREE=typeof window!=="undefined"?window.THREE:typeof global!=="undefined"?global.THREE:null;var Renderer=require("./lib/renderer");var createFont=require("./lib/create-font");var xtend=require("xtend");var getContext=require("webgl-context");var noop=function(){};module.exports=function(opt){opt=opt||{};var app=require("canvas-app")(render,xtend({context:"webgl",contextAttributes:{antialias:false,alpha:false},retina:true,onResize:handleResize},opt));var renderer;app.load=function(cb){cb=cb||noop;var gl=app.context;createFont(gl,function(err,font){renderer=Renderer({gl:gl,width:app.width,height:app.height,font:font});cb(err)})};return app;function render(gl,width,height,dt){if(renderer)renderer.draw(dt)}function handleResize(width,height){if(renderer)renderer.resize(width,height)}function setupSmoothTex(gl,t){t.minFilter=gl.LINEAR_MIPMAP_LINEAR;t.magFilter=gl.LINEAR;var ext=gl.getExtension("EXT_texture_filter_anisotropic")||gl.getExtension("MOZ_EXT_texture_filter_anisotropic");if(ext){var maxAnistrophy=gl.getParameter(ext.MAX_TEXTURE_MAX_ANISOTROPY_EXT);gl.texParameterf(gl.TEXTURE_2D,ext.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(16,maxAnistrophy))}t.generateMipmap()}function setupNearestTex(gl,t){t.minFilter=t.magFilter=gl.NEAREST}};module.exports.setup=function(cb){cb=cb||noop;var gl=getContext();if(!gl){fallback();cb(new Error("no WebGL supported"))}else{cb(null)}};function fallback(){var img=new Image;img.onload=function(){document.body.appendChild(img);var parent=document.createElement("div");parent.style.width="100%";parent.style.height="100%";parent.style.position="absolute";parent.style.top=parent.style.left="0";parent.style["text-align"]="center";var text=document.createElement("div");text.textContent="Sorry, your browser does not support WebGL";text.style.color="white";text.style["margin-top"]="25%";text.style["font-family"]="Helvetica, sans-serif";text.style["font-size"]="26px";parent.appendChild(text);document.body.appendChild(parent)};img.src="img/no-webgl.jpg";img.style.width="100%";img.style.opacity="0.5";center(img)}function center(el){el.style.position="absolute";el.style.top="0";el.style.left="0";el.style.left="0";el.style.bottom="0";el.style.margin="auto"}}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"./lib/create-font":6,"./lib/renderer":9,"canvas-app":24,"raf.js":76,"webgl-context":97,xtend:100}],2:[function(require,module,exports){module.exports={pages:["Exo2SemiBold.png"],chars:[{id:32,x:0,y:0,width:0,height:0,xoffset:0,yoffset:33,xadvance:7,page:0,chnl:0},{id:41,x:0,y:0,width:20,height:41,xoffset:-4,yoffset:3,xadvance:12,page:0,chnl:0},{id:40,x:20,y:0,width:19,height:41,xoffset:-3,yoffset:3,xadvance:12,page:0,chnl:0},{id:166,x:39,y:0,width:13,height:40,xoffset:-2,yoffset:3,xadvance:8,page:0,chnl:0},{id:124,x:52,y:0,width:13,height:40,xoffset:-2,yoffset:3,xadvance:8,page:0,chnl:0},{id:125,x:65,y:0,width:18,height:40,xoffset:-3,yoffset:4,xadvance:11,page:0,chnl:0},{id:123,x:83,y:0,width:18,height:40,xoffset:-3,yoffset:4,xadvance:11,page:0,chnl:0},{id:36,x:101,y:0,width:25,height:39,xoffset:-3,yoffset:3,xadvance:18,page:0,chnl:0},{id:93,x:126,y:0,width:17,height:39,xoffset:-3,yoffset:4,xadvance:11,page:0,chnl:0},{id:91,x:143,y:0,width:17,height:39,xoffset:-2,yoffset:4,xadvance:11,page:0,chnl:0},{id:81,x:160,y:0,width:28,height:39,xoffset:-3,yoffset:6,xadvance:22,page:0,chnl:0},{id:182,x:188,y:0,width:25,height:38,xoffset:-3,yoffset:6,xadvance:19,page:0,chnl:0},{id:167,x:213,y:0,width:24,height:38,xoffset:-3,yoffset:6,xadvance:18,page:0,chnl:0},{id:106,x:237,y:0,width:16,height:38,xoffset:-4,yoffset:6,xadvance:9,page:0,chnl:0},{id:92,x:253,y:0,width:26,height:34,xoffset:-4,yoffset:6,xadvance:17,page:0,chnl:0},{id:47,x:279,y:0,width:26,height:34,xoffset:-4,yoffset:6,xadvance:17,page:0,chnl:0},{id:102,x:305,y:0,width:23,height:33,xoffset:-4,yoffset:5,xadvance:13,page:0,chnl:0},{id:169,x:328,y:0,width:33,height:32,xoffset:-3,yoffset:6,xadvance:26,page:0,chnl:0},{id:165,x:361,y:0,width:29,height:32,xoffset:-4,yoffset:6,xadvance:20,page:0,chnl:0},{id:163,x:390,y:0,width:25,height:32,xoffset:-3,yoffset:6,xadvance:18,page:0,chnl:0},{id:162,x:415,y:0,width:23,height:32,xoffset:-3,yoffset:6,xadvance:16,page:0,chnl:0},{id:161,x:438,y:0,width:14,height:32,xoffset:-2,yoffset:12,xadvance:9,page:0,chnl:0},{id:38,x:452,y:0,width:32,height:32,xoffset:-3,yoffset:6,xadvance:25,page:0,chnl:0},{id:35,x:0,y:41,width:30,height:32,xoffset:-3,yoffset:6,xadvance:22,page:0,chnl:0},{id:37,x:30,y:41,width:36,height:32,xoffset:-3,yoffset:6,xadvance:29,page:0,chnl:0},{id:63,x:66,y:41,width:24,height:32,xoffset:-3,yoffset:6,xadvance:16,page:0,chnl:0},{id:33,x:90,y:41,width:14,height:32,xoffset:-2,yoffset:6,xadvance:9,page:0,chnl:0},{id:48,x:104,y:41,width:26,height:32,xoffset:-3,yoffset:6,xadvance:20,page:0,chnl:0},{id:57,x:130,y:41,width:25,height:32,xoffset:-3,yoffset:6,xadvance:19,page:0,chnl:0},{id:56,x:155,y:41,width:26,height:32,xoffset:-3,yoffset:6,xadvance:20,page:0,chnl:0},{id:55,x:181,y:41,width:24,height:32,xoffset:-3,yoffset:6,xadvance:17,page:0,chnl:0},{id:54,x:205,y:41,width:26,height:32,xoffset:-3,yoffset:6,xadvance:19,page:0,chnl:0},{id:53,x:231,y:41,width:24,height:32,xoffset:-3,yoffset:6,xadvance:17,page:0,chnl:0},{id:52,x:255,y:41,width:27,height:32,xoffset:-3,yoffset:6,xadvance:20,page:0,chnl:0},{id:51,x:282,y:41,width:25,height:32,xoffset:-3,yoffset:6,xadvance:18,page:0,chnl:0},{id:50,x:307,y:41,width:25,height:32,xoffset:-3,yoffset:6,xadvance:18,page:0,chnl:0},{id:49,x:332,y:41,width:19,height:32,xoffset:-4,yoffset:6,xadvance:13,page:0,chnl:0},{id:121,x:351,y:41,width:27,height:32,xoffset:-4,yoffset:12,xadvance:17,page:0,chnl:0},{id:113,x:378,y:41,width:25,height:32,xoffset:-3,yoffset:12,xadvance:19,page:0,chnl:0},{id:112,x:403,y:41,width:25,height:32,xoffset:-2,yoffset:12,xadvance:19,page:0,chnl:0},{id:108,x:428,y:41,width:17,height:32,xoffset:-2,yoffset:6,xadvance:10,page:0,chnl:0},{id:107,x:445,y:41,width:24,height:32,xoffset:-2,yoffset:6,xadvance:17,page:0,chnl:0},{id:105,x:469,y:41,width:14,height:32,xoffset:-2,yoffset:6,xadvance:8,page:0,chnl:0},{id:104,x:483,y:41,width:24,height:32,xoffset:-2,yoffset:6,xadvance:19,page:0,chnl:0},{id:103,x:0,y:73,width:27,height:32,xoffset:-4,yoffset:12,xadvance:18,page:0,chnl:0},{id:100,x:27,y:73,width:25,height:32,xoffset:-3,yoffset:6,xadvance:19,page:0,chnl:0},{id:98,x:52,y:73,width:25,height:32,xoffset:-2,yoffset:6,xadvance:19,page:0,chnl:0},{id:90,x:77,y:73,width:25,height:32,xoffset:-3,yoffset:6,xadvance:18,page:0,chnl:0},{id:89,x:102,y:73,width:28,height:32,xoffset:-4,yoffset:6,xadvance:19,page:0,chnl:0},{id:88,x:130,y:73,width:29,height:32,xoffset:-4,yoffset:6,xadvance:20,page:0,chnl:0},{id:87,x:159,y:73,width:39,height:32,xoffset:-4,yoffset:6,xadvance:31,page:0,chnl:0},{id:86,x:198,y:73,width:29,height:32,xoffset:-4,yoffset:6,xadvance:20,page:0,chnl:0},{id:85,x:227,y:73,width:27,height:32,xoffset:-2,yoffset:6,xadvance:21,page:0,chnl:0},{id:84,x:254,y:73,width:28,height:32,xoffset:-4,yoffset:6,xadvance:19,page:0,chnl:0},{id:83,x:282,y:73,width:25,height:32,xoffset:-3,yoffset:6,xadvance:18,page:0,chnl:0},{id:82,x:307,y:73,width:26,height:32,xoffset:-2,yoffset:6,xadvance:20,page:0,chnl:0},{id:80,x:333,y:73,width:26,height:32,xoffset:-2,yoffset:6,xadvance:19,page:0,chnl:0},{id:79,x:359,y:73,width:28,height:32,xoffset:-3,yoffset:6,xadvance:22,page:0,chnl:0},{id:78,x:387,y:73,width:28,height:32,xoffset:-2,yoffset:6,xadvance:23,page:0,chnl:0},{id:77,x:415,y:73,width:34,height:32,xoffset:-2,yoffset:6,xadvance:29,page:0,chnl:0},{id:76,x:449,y:73,width:24,height:32,xoffset:-2,yoffset:6,xadvance:17,page:0,chnl:0},{id:75,x:473,y:73,width:27,height:32,xoffset:-2,yoffset:6,xadvance:20,page:0,chnl:0},{id:74,x:0,y:105,width:18,height:32,xoffset:-4,yoffset:6,xadvance:11,page:0,chnl:0},{id:73,x:18,y:105,width:14,height:32,xoffset:-2,yoffset:6,xadvance:9,page:0,chnl:0},{id:72,x:32,y:105,width:27,height:32,xoffset:-2,yoffset:6,xadvance:22,page:0,chnl:0},{id:71,x:59,y:105,width:27,height:32,xoffset:-3,yoffset:6,xadvance:20,page:0,chnl:0},{id:70,x:86,y:105,width:24,height:32,xoffset:-2,yoffset:6,xadvance:17,page:0,chnl:0},{id:69,x:110,y:105,width:24,height:32,xoffset:-2,yoffset:6,xadvance:18,page:0,chnl:0},{id:68,x:134,y:105,width:27,height:32,xoffset:-2,yoffset:6,xadvance:21,page:0,chnl:0},{id:67,x:161,y:105,width:26,height:32,xoffset:-3,yoffset:6,xadvance:19,page:0,chnl:0},{id:66,x:187,y:105,width:26,height:32,xoffset:-2,yoffset:6,xadvance:20,page:0,chnl:0},{id:65,x:213,y:105,width:30,height:32,xoffset:-4,yoffset:6,xadvance:20,page:0,chnl:0},{id:64,x:243,y:105,width:29,height:31,xoffset:-2,yoffset:9,xadvance:24,page:0,chnl:0},{id:116,x:272,y:105,width:22,height:30,xoffset:-4,yoffset:8,xadvance:13,page:0,chnl:0},{id:59,x:294,y:105,width:14,height:29,xoffset:-2,yoffset:14,xadvance:8,page:0,chnl:0},{id:164,x:308,y:105,width:25,height:26,xoffset:-3,yoffset:9,xadvance:19,page:0,chnl:0},{id:122,x:333,y:105,width:24,height:26,xoffset:-3,yoffset:12,xadvance:17,page:0,chnl:0},{id:120,x:357,y:105,width:26,height:26,xoffset:-4,yoffset:12,xadvance:17,page:0,chnl:0},{id:119,x:383,y:105,width:36,height:26,xoffset:-4,yoffset:12,xadvance:27,page:0,chnl:0},{id:118,x:419,y:105,width:27,height:26,xoffset:-4,yoffset:12,xadvance:17,page:0,chnl:0},{id:117,x:446,y:105,width:24,height:26,xoffset:-2,yoffset:12,xadvance:19,page:0,chnl:0},{id:115,x:470,y:105,width:24,height:26,xoffset:-3,yoffset:12,xadvance:17,page:0,chnl:0},{id:114,x:0,y:137,width:20,height:26,xoffset:-2,yoffset:12,xadvance:13,page:0,chnl:0},{id:111,x:20,y:137,width:25,height:26,xoffset:-3,yoffset:12,xadvance:18,page:0,chnl:0},{id:110,x:45,y:137,width:24,height:26,xoffset:-2,yoffset:12,xadvance:19,page:0,chnl:0},{id:109,x:69,y:137,width:33,height:26,xoffset:-2,yoffset:12,xadvance:28,page:0,chnl:0},{id:101,x:102,y:137,width:25,height:26,xoffset:-3,yoffset:12,xadvance:18,page:0,chnl:0},{id:99,x:127,y:137,width:23,height:26,xoffset:-3,yoffset:12,xadvance:16,page:0,chnl:0},{id:97,x:150,y:137,width:24,height:26,xoffset:-3,yoffset:12,xadvance:18,page:0,chnl:0},{id:177,x:174,y:137,width:24,height:25,xoffset:-2,yoffset:11,xadvance:19,page:0,chnl:0},{id:178,x:198,y:137,width:21,height:24,xoffset:-3,yoffset:3,xadvance:14,page:0,chnl:0},{id:43,x:219,y:137,width:24,height:24,xoffset:-3,yoffset:11,xadvance:17,page:0,chnl:0},{id:62,x:243,y:137,width:23,height:24,xoffset:-2,yoffset:12,xadvance:17,page:0,chnl:0},{id:60,x:266,y:137,width:23,height:24,xoffset:-3,yoffset:12,xadvance:17,page:0,chnl:0},{id:58,x:289,y:137,width:14,height:24,xoffset:-3,yoffset:14,xadvance:8,page:0,chnl:0},{id:187,x:303,y:137,width:23,height:23,xoffset:-3,yoffset:14,xadvance:16,page:0,chnl:0},{id:185,x:326,y:137,width:17,height:23,xoffset:-4,yoffset:4,xadvance:10,page:0,chnl:0},{id:179,x:343,y:137,width:20,height:23,xoffset:-3,yoffset:4,xadvance:13,page:0,chnl:0},{id:174,x:363,y:137,width:24,height:23,xoffset:-3,yoffset:6,xadvance:17,page:0,chnl:0},{id:171,x:387,y:137,width:23,height:23,xoffset:-3,yoffset:14,xadvance:16,page:0,chnl:0},{id:186,x:410,y:137,width:21,height:21,xoffset:-3,yoffset:9,xadvance:14,page:0,chnl:0},{id:199,x:431,y:137,width:26,height:40,xoffset:-3,yoffset:6,xadvance:19,page:0,chnl:0},{id:253,x:457,y:137,width:27,height:39,xoffset:-4,yoffset:5,xadvance:17,page:0,chnl:0},{id:221,x:0,y:177,width:28,height:39,xoffset:-4,yoffset:-1,xadvance:19,page:0,chnl:0},{id:219,x:28,y:177,width:27,height:39,xoffset:-2,yoffset:-1,xadvance:21,page:0,chnl:0},{id:218,x:55,y:177,width:27,height:39,xoffset:-2,yoffset:-1,xadvance:21,page:0,chnl:0},{id:217,x:82,y:177,width:27,height:39,xoffset:-2,yoffset:-1,xadvance:21,page:0,chnl:0},{id:213,x:109,y:177,width:28,height:39,xoffset:-3,yoffset:-1,xadvance:22,page:0,chnl:0},{id:212,x:137,y:177,width:28,height:39,xoffset:-3,yoffset:-1,xadvance:22,page:0,chnl:0},{id:206,x:165,y:177,width:24,height:39,xoffset:-6,yoffset:-1,xadvance:9,page:0,chnl:0},{id:205,x:189,y:177,width:18,height:39,xoffset:-2,yoffset:-1,xadvance:9,page:0,chnl:0},{id:204,x:207,y:177,width:19,height:39,xoffset:-6,yoffset:-1,xadvance:9,page:0,chnl:0},{id:202,x:226,y:177,width:24,height:39,xoffset:-2,yoffset:-1,xadvance:18,page:0,chnl:0},{id:201,x:250,y:177,width:24,height:39,xoffset:-2,yoffset:-1,xadvance:18,page:0,chnl:0},{id:200,x:274,y:177,width:24,height:39,xoffset:-2,yoffset:-1,xadvance:18,page:0,chnl:0},{id:197,x:298,y:177,width:30,height:39,xoffset:-4,yoffset:-1,xadvance:20,page:0,chnl:0},{id:193,x:328,y:177,width:30,height:39,xoffset:-4,yoffset:-1,xadvance:20,page:0,chnl:0},{id:192,x:358,y:177,width:30,height:39,xoffset:-4,yoffset:-1,xadvance:20,page:0,chnl:0},{id:255,x:388,y:177,width:27,height:38,xoffset:-4,yoffset:6,xadvance:17,page:0,chnl:0},{id:254,x:415,y:177,width:25,height:38,xoffset:-2,yoffset:6,xadvance:19,page:0,chnl:0},{id:220,x:440,y:177,width:27,height:38,xoffset:-2,yoffset:0,xadvance:21,page:0,chnl:0},{id:214,x:467,y:177,width:28,height:38,xoffset:-3,yoffset:0,xadvance:22,page:0,chnl:0},{id:211,x:0,y:216,width:28,height:38,xoffset:-3,yoffset:0,xadvance:22,page:0,chnl:0},{id:210,x:28,y:216,width:28,height:38,xoffset:-3,yoffset:0,xadvance:22,page:0,chnl:0},{id:209,x:56,y:216,width:28,height:38,xoffset:-2,yoffset:0,xadvance:23,page:0,chnl:0},{id:207,x:84,y:216,width:18,height:38,xoffset:-4,yoffset:0,xadvance:9,page:0,chnl:0},{id:203,x:102,y:216,width:24,height:38,xoffset:-2,yoffset:0,xadvance:18,page:0,chnl:0},{id:196,x:126,y:216,width:30,height:38,xoffset:-4,yoffset:0,xadvance:20,page:0,chnl:0},{id:195,x:156,y:216,width:30,height:38,xoffset:-4,yoffset:0,xadvance:20,page:0,chnl:0},{id:194,x:186,y:216,width:30,height:38,xoffset:-4,yoffset:0,xadvance:20,page:0,chnl:0},{id:216,x:216,y:216,width:28,height:35,xoffset:-3,yoffset:5,xadvance:22,page:0,chnl:0},{id:251,x:244,y:216,width:24,height:34,xoffset:-2,yoffset:4,xadvance:19,page:0,chnl:0},{id:250,x:268,y:216,width:24,height:34,xoffset:-2,yoffset:4,xadvance:19,page:0,chnl:0},{id:249,x:292,y:216,width:24,height:34,xoffset:-2,yoffset:4,xadvance:19,page:0,chnl:0},{id:237,x:316,y:216,width:18,height:34,xoffset:-3,yoffset:4,xadvance:9,page:0,chnl:0},{id:236,x:334,y:216,width:19,height:34,xoffset:-6,yoffset:4,xadvance:9,page:0,chnl:0},{id:231,x:353,y:216,width:23,height:34,xoffset:-3,yoffset:12,xadvance:16,page:0,chnl:0},{id:229,x:376,y:216,width:24,height:34,xoffset:-3,yoffset:4,xadvance:18,page:0,chnl:0},{id:244,x:400,y:216,width:25,height:33,xoffset:-3,yoffset:5,xadvance:18,page:0,chnl:0},{id:243,x:425,y:216,width:25,height:33,xoffset:-3,yoffset:5,xadvance:18,page:0,chnl:0},{id:242,x:450,y:216,width:25,height:33,xoffset:-3,yoffset:5,xadvance:18,page:0,chnl:0},{id:238,x:475,y:216,width:22,height:33,xoffset:-6,yoffset:5,xadvance:9,page:0,chnl:0},{id:234,x:0,y:254,width:25,height:33,xoffset:-3,yoffset:5,xadvance:18,page:0,chnl:0},{id:233,x:25,y:254,width:25,height:33,xoffset:-3,yoffset:5,xadvance:18,page:0,chnl:0},{id:232,x:50,y:254,width:25,height:33,xoffset:-3,yoffset:5,xadvance:18,page:0,chnl:0},{id:226,x:75,y:254,width:24,height:33,xoffset:-3,yoffset:5,xadvance:18,page:0,chnl:0},{id:225,x:99,y:254,width:24,height:33,xoffset:-3,yoffset:5,xadvance:18,page:0,chnl:0},{id:224,x:123,y:254,width:24,height:33,xoffset:-3,yoffset:5,xadvance:18,page:0,chnl:0},{id:223,x:147,y:254,width:31,height:33,xoffset:-4,yoffset:5,xadvance:22,page:0,chnl:0},{id:252,x:178,y:254,width:24,height:32,xoffset:-2,yoffset:6,xadvance:19,page:0,chnl:0},{id:246,x:202,y:254,width:25,height:32,xoffset:-3,yoffset:6,xadvance:18,page:0,chnl:0},{id:245,x:227,y:254,width:25,height:32,xoffset:-3,yoffset:6,xadvance:18,page:0,chnl:0},{id:241,x:252,y:254,width:24,height:32,xoffset:-2,yoffset:6,xadvance:19,page:0,chnl:0},{id:240,x:276,y:254,width:25,height:32,xoffset:-3,yoffset:6,xadvance:18,page:0,chnl:0},{id:239,x:301,y:254,width:19,height:32,xoffset:-5,yoffset:6,xadvance:9,page:0,chnl:0},{id:235,x:320,y:254,width:25,height:32,xoffset:-3,yoffset:6,xadvance:18,page:0,chnl:0},{id:228,x:345,y:254,width:24,height:32,xoffset:-3,yoffset:6,xadvance:18,page:0,chnl:0},{id:227,x:369,y:254,width:24,height:32,xoffset:-3,yoffset:6,xadvance:18,page:0,chnl:0},{id:222,x:393,y:254,width:25,height:32,xoffset:-2,yoffset:6,xadvance:19,page:0,chnl:0},{id:208,x:418,y:254,width:29,height:32,xoffset:-4,yoffset:6,xadvance:22,page:0,chnl:0},{id:198,x:447,y:254,width:39,height:32,xoffset:-5,yoffset:6,xadvance:29,page:0,chnl:0},{id:191,x:486,y:254,width:24,height:32,xoffset:-3,yoffset:12,xadvance:16,page:0,chnl:0},{id:190,x:0,y:287,width:38,height:32,xoffset:-3,yoffset:6,xadvance:31,page:0,chnl:0},{id:189,x:38,y:287,width:37,height:32,xoffset:-4,yoffset:6,xadvance:29,page:0,chnl:0},{id:188,x:75,y:287,width:37,height:32,xoffset:-4,yoffset:6,xadvance:28,page:0,chnl:0},{id:248,x:112,y:287,width:25,height:31,xoffset:-3,yoffset:10,xadvance:18,page:0,chnl:0},{id:247,x:137,y:287,width:25,height:26,xoffset:-3,yoffset:10,xadvance:18,page:0,chnl:0},{id:230,x:162,y:287,width:35,height:26,xoffset:-3,yoffset:12,xadvance:28,page:0,chnl:0},{id:215,x:197,y:287,width:23,height:22,xoffset:-3,yoffset:13,xadvance:16,page:0,chnl:0},{id:170,x:220,y:287,width:21,height:21,xoffset:-3,yoffset:8,xadvance:14,page:0,chnl:0},{id:42,x:241,y:287,width:21,height:21,xoffset:-3,yoffset:6,xadvance:14,page:0,chnl:0},{id:61,x:262,y:287,width:24,height:20,xoffset:-2,yoffset:13,xadvance:19,page:0,chnl:0},{id:94,x:286,y:287,width:23,height:19,xoffset:-4,yoffset:8,xadvance:14,page:0,chnl:0},{id:44,x:309,y:287,width:14,height:19,xoffset:-3,yoffset:24,xadvance:8,page:0,chnl:0},{id:176,x:323,y:287,width:18,height:18,xoffset:-3,yoffset:7,xadvance:11,page:0,chnl:0},{id:180,x:341,y:287,width:18,height:17,xoffset:-3,yoffset:5,xadvance:11,page:0,chnl:0},{id:172,x:359,y:287,width:24,height:17,xoffset:-2,yoffset:17,xadvance:19,page:0,chnl:0},{id:39,x:383,y:287,width:13,height:17,xoffset:-3,yoffset:6,xadvance:7,page:0,chnl:0},{id:96,x:396,y:287,width:18,height:17,xoffset:-4,yoffset:5,xadvance:11,page:0,chnl:0},{id:34,x:414,y:287,width:18,height:17,xoffset:-3,yoffset:6,xadvance:12,page:0,chnl:0},{id:184,x:432,y:287,width:16,height:16,xoffset:-4,yoffset:30,xadvance:8,page:0,chnl:0},{id:183,x:448,y:287,width:13,height:14,xoffset:-2,yoffset:18,xadvance:8,page:0,chnl:0},{id:175,x:461,y:287,width:20,height:14,xoffset:-3,yoffset:6,xadvance:13,page:0,chnl:0},{id:168,x:481,y:287,width:19,height:14,xoffset:-2,yoffset:6,xadvance:13,page:0,chnl:0},{id:126,x:0,y:319,width:22,height:14,xoffset:-2,yoffset:17,xadvance:17,page:0,chnl:0},{id:46,x:22,y:319,width:14,height:14,xoffset:-3,yoffset:24,xadvance:8,page:0,chnl:0},{id:173,x:36,y:319,width:19,height:13,xoffset:-2,yoffset:18,xadvance:14,page:0,chnl:0},{id:95,x:55,y:319,width:24,height:13,xoffset:-2,yoffset:28,xadvance:18,page:0,chnl:0},{id:45,x:79,y:319,width:19,height:13,xoffset:-2,yoffset:18,xadvance:14,page:0,chnl:0}],kernings:[],info:{face:"Exo 2 Semi Bold",size:32,bold:0,italic:0,charset:"",unicode:0,stretchH:100,smooth:1,aa:1,padding:[4,4,4,4],spacing:[-8,-8]},common:{lineHeight:40,base:33,scaleW:512,scaleH:512,pages:1,packed:0}}},{}],3:[function(require,module,exports){(function(global){var THREE=typeof window!=="undefined"?window.THREE:typeof global!=="undefined"?global.THREE:null;var inherits=require("inherits");var mixes=require("mixes");var Base=THREE.Scene;var YOFF=2.5;function RigScene(opt){if(!(this instanceof RigScene))return new RigScene(opt);Base.call(this);this.fog=new THREE.FogExp2(722198,15e-5);this.time=0;this.cubeMap=null;this.updateMaterial();var loader=new THREE.OBJMTLLoader;loader.load("model/PrirazlomnayaUnwrappedFinal.obj","model/PrirazlomnayaUnwrappedFinal.mtl",function(object,materials){var s=.325;console.log(object,materials);object.scale.set(s,s,s);object.position.y-=YOFF;this.mesh=object;this.mesh.traverse(function(obj){if(obj instanceof THREE.Mesh){obj.castShadow=true;obj.receiveShadow=true;obj.material.shininess=1;obj.material.emissive=new THREE.Color("rgb(130,130,130)");if(obj.material.map){obj.material.transparent=true}}});this.add(object)}.bind(this));this.lights=[[new THREE.Vector3(-10,20,-20),1],[new THREE.Vector3(15,10,15),.5]].map(function(args,i){var light=new THREE.DirectionalLight(14546173,args[1]);light.position.copy(args[0]);light.castShadow=true;light.shadowMapWidth=1024;light.shadowMapHeight=1024;light.shadowCameraNear=1;light.shadowCameraFar=100;this.add(light);return light},this)}inherits(RigScene,Base);mixes(RigScene,{updateMaterial:function(){this.material=new THREE.MeshLambertMaterial({color:11184810,reflectivity:.4,envMap:this.cubeMap})},update:function(dt){this.time+=Math.min(dt,30)/1e3;var m=this.mesh;if(!m)return;var anim=Math.sin(this.time)}});module.exports=RigScene}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{inherits:64,mixes:66}],4:[function(require,module,exports){(function(global){var THREE=typeof window!=="undefined"?window.THREE:typeof global!=="undefined"?global.THREE:null;var EffectComposer=require("three-effectcomposer")(THREE);var inherits=require("inherits");var Base=EffectComposer.RenderPass;var plucker=require("plucker");var number=require("as-number");var TextElement=require("three-sdf-text")(THREE);var xtend=require("xtend");var UNIT_SCALE=.1;var SCALE=[UNIT_SCALE,UNIT_SCALE,UNIT_SCALE];var mat4={scale:require("gl-mat4/scale"),identity:require("gl-mat4/identity"),multiply:require("gl-mat4/multiply"),translate:require("gl-mat4/translate")};var setVec3=require("gl-vec3/set");var tmpVec3=[0,0,0];var pluckPanels=plucker("panels");var glslify=require("glslify");var createSDFShader=require("glslify/adapter.js")("\n#define GLSLIFY 1\n\nattribute vec4 position;\nattribute vec4 color;\nattribute vec2 texcoord0;\nuniform mat4 projection;\nuniform mat4 view;\nuniform mat4 model;\nvarying vec4 v_col;\nvarying vec2 v_tex0;\nvarying float animOffset;\nvoid main() {\n  gl_Position = projection * view * model * position;\n  v_col = color;\n  v_tex0 = texcoord0;\n  gl_PointSize = 1.0;\n  animOffset = position.x / 100.0;\n}","\n#define GLSLIFY 1\n\n#ifdef GL_ES\n\nprecision mediump float;\n#endif\n\nvarying vec4 v_col;\nvarying vec2 v_tex0;\nvarying float animOffset;\nuniform sampler2D texture0;\nuniform sampler2D texture1;\nuniform float smoothing;\nuniform float fade;\nconst vec2 shadowOffset = vec2(-1.0 / 512.0);\nconst vec4 glowColor = vec4(vec3(0.1), 1.0);\nconst float glowMin = 0.4;\nconst float glowMax = 0.8;\nvoid main() {\n  float anim = fade * animOffset;\n  anim = clamp(mix(anim, 1.0, fade * fade), 0.0, 1.0);\n  vec4 smoothColor = vec4(0.0);\n  vec4 texColor = texture2D(texture0, v_tex0);\n  float dst = texColor.a;\n  float smoothAmt = mix(1.5, smoothing, anim);\n  float alpha = smoothstep(0.5 - smoothAmt, 0.5 + smoothAmt, dst);\n  vec4 base = v_col * vec4(alpha);\n  float glowDst = texture2D(texture0, v_tex0 + shadowOffset).a;\n  vec4 glow = glowColor * smoothstep(glowMin, glowMax, glowDst);\n  float mask = 1.0 - alpha;\n  gl_FragColor = mix(vec4(0.0), base, anim);\n  if(gl_FragColor.a < 0.1)\n    discard;\n  \n}",[{name:"projection",type:"mat4"},{name:"view",type:"mat4"},{name:"model",type:"mat4"},{name:"texture0",type:"sampler2D"},{name:"texture1",type:"sampler2D"},{name:"smoothing",type:"float"},{name:"fade",type:"float"}],[{name:"position",type:"vec4"},{name:"color",type:"vec4"},{name:"texcoord0",type:"vec2"}]);var sdfShader;function TextPass(opt){if(!(this instanceof TextPass))return new TextPass(opt);opt=opt||{};var renderer=opt.renderer;var camera=opt.camera;var scene=opt.scene;Base.call(this,scene,camera);var font=opt.font;if(!sdfShader)sdfShader=createSDFShader(renderer.getContext());this.groups=(opt.groups||[]).map(createGroups(renderer,font));window.groups=this.groups}function createGroups(renderer,font){return function(group,groupIndex){group.elements=group.panels.map(function(panel,index){var side=index===0?1:-1;return panel.labels.map(function(label){return createElement(label,side,renderer,font)})}).reduce(function(prev,b){return prev.concat(b)},[]);group._opacity=1;group.fade=1;group.showing=true;group.animatingOut=false;Object.defineProperty(group,"opacity",{get:function(){return group._opacity},set:function(val){group._opacity=val;group.elements.forEach(function(e){e.text.opacity=val});group.panels.forEach(function(p){p.container.visible=val>.01;p.shapes.forEach(function(shape){shape.material.opacity=val;shape.visible=val>.01})})}});return group}}function createElement(label,side,renderer,font){var textOpt=xtend(label,{font:font,textures:font.textures,shader:sdfShader});var textEl=TextElement(renderer,textOpt);return xtend(label,{text:textEl,side:side})}function renderElement(camera,e,fade){e.object3d.updateMatrixWorld(true);var transform=e.text.transform;mat4.identity(transform);mat4.scale(transform,transform,SCALE);setVec3(tmpVec3,e.translation[0],e.translation[1],e.translation[2]);mat4.translate(transform,transform,tmpVec3);setVec3(tmpVec3,e.size,e.size,e.size);mat4.scale(transform,transform,tmpVec3);e.text.shader.bind();e.text.shader.uniforms.fade=fade;e.text.draw(camera,e.object3d)}inherits(TextPass,Base);TextPass.prototype.render=function(renderer,writeBuffer,readBuffer,delta){Base.prototype.render.call(this,renderer,writeBuffer,readBuffer,delta);var camera=this.camera;this.groups.forEach(function(g){g.elements.forEach(function(e){if(!g.showing)return;renderElement(camera,e,g.fade)})});renderer.resetGLState()};module.exports=TextPass}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"as-number":19,"gl-mat4/identity":33,"gl-mat4/multiply":34,"gl-mat4/scale":35,"gl-mat4/translate":36,"gl-vec3/set":59,glslify:61,"glslify/adapter.js":60,inherits:64,plucker:75,"three-effectcomposer":79,"three-sdf-text":87,xtend:100}],5:[function(require,module,exports){(function(global){var TweenMax=typeof window!=="undefined"?window.TweenMax:typeof global!=="undefined"?global.TweenMax:null;var clamp=require("clamp");var smoothstep=require("smoothstep");var lastIndex=-1;module.exports=function(controller,labels){var closeIndex=closest(controller,labels);labels.forEach(function(label,i){var visible=i===closeIndex;if(visible&&!label.showing){animateInFeature(label)}else if(!visible&&label.showing){animateOutFeature(label)}})};module.exports.hideAll=function(features){features.forEach(function(f){setShowing(f,false)})};function distance(controller,label){var x=-label.theta,y=controller.theta;var abdist=Math.abs(x-y);return Math.min(2*Math.PI-abdist,abdist)}function closest(controller,labels){var minDist=Number.MAX_VALUE;var ret=-1;labels.forEach(function(label,index){var dist=distance(controller,label);if(dist<minDist){minDist=dist;ret=index}});return ret}function setShowing(feature,showing){feature.showing=showing}function animateInFeature(feature){feature.showing=true;feature.fade=0;TweenMax.killTweensOf(feature);TweenMax.to(feature,.5,{fade:1,ease:"easeOutQuad"})}function animateOutFeature(feature){if(feature.animatingOut)return;feature.animatingOut=true;TweenMax.to(feature,.5,{fade:0,ease:"easeOutQuad",onComplete:hideFeature.bind(null,feature)})}function hideFeature(feature){feature.animatingOut=false;feature.showing=false}}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{clamp:30,smoothstep:78}],6:[function(require,module,exports){var Font=require("../fonts/Exo2SemiBold.json");var fontImage="fonts/Exo2SemiBold.png";var img=require("img");var createTexture=require("gl-texture2d");module.exports=function(gl,cb){img(fontImage,function(err,res){if(err){cb(err);return}Font.textures=[res].map(function(i){var t=createTexture(gl,i);t.minFilter=gl.LINEAR_MIPMAP_LINEAR;t.magFilter=gl.LINEAR;var ext=gl.getExtension("EXT_texture_filter_anisotropic")||gl.getExtension("MOZ_EXT_texture_filter_anisotropic");if(ext){var maxAnistrophy=gl.getParameter(ext.MAX_TEXTURE_MAX_ANISOTROPY_EXT);gl.texParameterf(gl.TEXTURE_2D,ext.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(16,maxAnistrophy))}t.generateMipmap();return t});cb(null,Font)})}},{"../fonts/Exo2SemiBold.json":2,"gl-texture2d":58,img:63}],7:[function(require,module,exports){(function(global){var TextPass=require("./TextPass");var THREE=typeof window!=="undefined"?window.THREE:typeof global!=="undefined"?global.THREE:null;var xtend=require("xtend");var Complex=require("three-simplicial-complex")(THREE);var mobile=require("./is-mobile");var UNIT_SCALE=.1;var data=require("./text-data");module.exports=function(opt){var groups=createGroups();groups.forEach(function(group){group.panels.forEach(function(panel){opt.scene.add(panel.container)})});return TextPass(xtend(opt,{groups:groups}))};function createGroups(){return data.map(function(group,i,list){var theta=i/(list.length+1)*Math.PI*2;group=xtend(group,{panels:group.panels.map(function(panel,index){return createPanel(panel,index,theta)}),theta:theta});return group})}function createPanel(data,index,rotation){var container=new THREE.Object3D;var mirror=index===1;var radius=mobile?18:20;if(mirror){rotation+=Math.PI*2;radius*=-1}container.position.set(Math.cos(rotation)*radius,15,Math.sin(rotation)*radius);var pos=container.position;var dir=pos.clone().sub(new THREE.Vector3(0,pos.y,0)).normalize();var rotOff=0;var dx=pos.x,dz=pos.z,theta=-Math.atan2(dz,dx)-rotOff;container.rotation.y=theta;container.rotation.x=0;if(mirror){container.scale.x*=-1}var labels=data.labels.map(function(label){var obj=new THREE.Object3D;container.add(obj);if(mirror)obj.position.x=-data.width||0;return xtend({size:1,translation:[0,0,0]},label,{object3d:obj})});var shapes=[];return{labels:labels,shapes:shapes,container:container}}}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"./TextPass":4,"./is-mobile":8,"./text-data":17,"three-simplicial-complex":92,xtend:100}],8:[function(require,module,exports){var deviceType=require("ua-device-type");module.exports=/(phone)|(tablet)/i.test(deviceType(navigator.userAgent))},{"ua-device-type":95}],9:[function(require,module,exports){(function(global){var THREE=typeof window!=="undefined"?window.THREE:typeof global!=="undefined"?global.THREE:null;var RigScene=require("./RigScene");var OrbitController=require("./three-orbit-camera")(THREE);var Effects=require("./setup-effects");var TweenMax=typeof window!=="undefined"?window.TweenMax:typeof global!=="undefined"?global.TweenMax:null;var animateLabels=require("./animate-labels");var hideLabels=animateLabels.hideAll;var clamp=require("clamp");var pluck=require("plucker");var number=require("as-number");var smoothstep=require("smoothstep");var lerp=require("lerp");var unlerp=require("unlerp");var mobile=require("./is-mobile");module.exports=function(opt){opt=opt||{};var Font=opt.font;if(!Font||!Font.textures)throw new Error("must specify font with textures");var renderer,scene,textPass,camera,controller,features,water,effects,labels=[],time=0;if(!opt.gl)throw new Error("must specify GL context");setup(opt.gl,opt.width||0,opt.height||0);function draw(dt){time+=Math.min(dt,30)/1e3;renderer.resetGLState();water.material.uniforms.time.value=time*.1;water.render();controller.update();scene.update(dt);
if(effects)effects.render(dt);else{textPass.render(renderer)}animateLabels(controller,labels);var t=unlerp(.6,1.4,controller.phi);t=smoothstep(1.5,.95,t);var range=clamp(t,0,1);water.alpha=range||0}function setup(gl,width,height){renderer=new THREE.WebGLRenderer({canvas:gl.canvas,antialias:false,alpha:false});renderer.setClearColor(16777215,0);renderer.shadowMapType=THREE.BasicShadowMap;opt.fov=number(opt.fov,50);camera=new THREE.PerspectiveCamera(opt.fov,width/height,.5,2e4);camera.position.fromArray(mobile?[-80,38,-80]:[-60,38,-40]);camera.lookAt(new THREE.Vector3);controller=new OrbitController(camera);controller.userPan=false;controller.userPanSpeed=0;controller.zoomSpeed=.1;controller.rotateSpeed=.2;controller.minDistance=30;controller.maxDistance=200;controller.maxPolarAngle=90*Math.PI/180;controller.minPolarAngle=40*Math.PI/180;controller.center.set(0,5,0);scene=RigScene();require("./setup-floor")(scene);water=require("./setup-water")(renderer,camera,scene);scene.cubeMap=water.cubeMap;scene.updateMaterial();var pass=require("./create-text-pass")({renderer:renderer,scene:scene,camera:camera,font:Font});textPass=pass;labels=pass.groups;effects=Effects({renderer:renderer,scene:scene,camera:camera,width:width,blur:false,height:height,renderPass:pass});hideLabels(labels)}function handleResize(width,height){renderer.setSize(width,height);camera.aspect=width/height;camera.updateProjectionMatrix();if(effects)effects.resize(width,height)}return{draw:draw,resize:handleResize}}}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"./RigScene":3,"./animate-labels":5,"./create-text-pass":7,"./is-mobile":8,"./setup-effects":10,"./setup-floor":11,"./setup-water":12,"./three-orbit-camera":18,"as-number":19,clamp:30,lerp:65,plucker:75,smoothstep:78,unlerp:96}],10:[function(require,module,exports){(function(global){var THREE=typeof window!=="undefined"?window.THREE:typeof global!=="undefined"?global.THREE:null;var EffectComposer=require("three-effectcomposer")(THREE);var createFXAA=require("three-shader-fxaa")(THREE);var createBlur=require("./shaders/blur");var createLens=require("./shaders/lens");var createEmpty=require("./shaders/pass");module.exports=Effects;function Effects(opt){if(!(this instanceof Effects))return new Effects(opt);opt=opt||{};var parameters={minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBFormat,stencilBuffer:false};var width=opt.width;var height=opt.height;var renderTarget=new THREE.WebGLRenderTarget(width,height,parameters);this.composer=new EffectComposer(opt.renderer,renderTarget);this.composer.addPass(opt.renderPass);this.shaders=[];this.noiseDelay=33;this.noiseTime=0;var fxaaShader=new EffectComposer.ShaderPass(createFXAA());this.shaders.push(fxaaShader);if(opt.blur!==false){var blur=createBlur();var iterations=1;for(var i=0;i<iterations;i++){var r=(i+1)*2;var horiz=new EffectComposer.ShaderPass(blur);horiz.uniforms.radius.value=r;horiz.uniforms.strength.value=1;horiz.uniforms.dir.value.set(1,0);var vert=new EffectComposer.ShaderPass(blur);vert.uniforms.radius.value=r;vert.uniforms.strength.value=1;vert.uniforms.dir.value.set(0,1);this.shaders.push(horiz,vert)}}var lensPass=new EffectComposer.ShaderPass(createLens());this.shaders.push(lensPass);lensPass.uniforms.overlayResolution.value.set(1,1);lensPass.uniforms.tLookup.value=loadTexture("img/lookup.png",{generateMipmaps:false,filter:THREE.LinearFilter});lensPass.uniforms.tOverlay.value=loadTexture("img/dust.jpg",{generateMipmaps:false,filter:THREE.LinearFilter},function(err,tex){lensPass.uniforms.overlayResolution.value.set(tex.image.width,tex.image.height)});this.shaders.forEach(function(pass,i,self){this.composer.addPass(pass);if(i===self.length-1)pass.renderToScreen=true},this);if(opt.width&&opt.height)this.resize(opt.width,opt.height)}function loadTexture(path,opt,cb){if(typeof opt==="function"){cb=opt;opt={}}return THREE.ImageUtils.loadTexture(path,undefined,function(tex){if(opt.filter)tex.minFilter=tex.magFilter=opt.filter;if(opt.wrap)tex.wrapS=tex.wrapT=opt.wrap;tex.generateMipmaps=opt.generateMipmaps;if(typeof cb==="function")cb(null,tex)})}require("mixes")(Effects,{render:function(dt){this.noiseTime+=dt;if(this.noiseTime>this.noiseDelay){this.noiseTime=0;this.shaders.forEach(function(pass){if(pass.uniforms.tick)pass.uniforms.tick.value+=.005})}this.composer.render()},resize:function(width,height){width*=2;height*=2;this.composer.setSize(width,height);this.shaders.forEach(function(pass){var dpr=1;if(pass.uniforms.resolution)pass.uniforms.resolution.value.set(width*dpr,height*dpr)})}})}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"./shaders/blur":13,"./shaders/lens":15,"./shaders/pass":16,mixes:66,"three-effectcomposer":79,"three-shader-fxaa":91}],11:[function(require,module,exports){(function(global){var random=require("randf");var THREE=typeof window!=="undefined"?window.THREE:typeof global!=="undefined"?global.THREE:null;var smoothstep=require("smoothstep");var lerp=require("lerp");module.exports=function(scene){var geo=new THREE.PlaneGeometry(100,100,40,40);var vec2=new THREE.Vector2;geo.vertices.forEach(function(v){var len=vec2.set(v.x,v.y).length()/50;var slen=smoothstep(.4,1,len);v.z=random(10,40)*slen;slen=smoothstep(.7,1,len);var base=smoothstep(.2,0,len)*.5;slen+=base;v.z+=random(-10,5)*base;var L=slen;var color=new THREE.Color(L,L,L);geo.colors.push(color)});geo.faces.forEach(function(face){face.vertexColors[0]=geo.colors[face.a];face.vertexColors[1]=geo.colors[face.b];face.vertexColors[2]=geo.colors[face.c]});var tex=THREE.ImageUtils.loadTexture("img/snow.jpg");tex.repeat.set(1,1);tex.wrapS=tex.wrapT=THREE.RepeatWrapping;var mat=new THREE.MeshBasicMaterial({map:tex,vertexColors:THREE.VertexColors});var mesh=new THREE.Mesh(geo,mat);mesh.rotation.x=-Math.PI/2;mesh.position.y=-30;var stretch=10;mesh.scale.x=mesh.scale.y=stretch;scene.add(mesh);window.floor=mesh}}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{lerp:65,randf:77,smoothstep:78}],12:[function(require,module,exports){var cubeShader={uniforms:THREE.UniformsUtils.merge([{tCube:{type:"t",value:null},tFlip:{type:"f",value:-1}},THREE.UniformsLib["fog"]]),vertexShader:["varying vec3 vWorldPosition;",THREE.ShaderChunk["logdepthbuf_pars_vertex"],"void main() {","   vec4 worldPosition = modelMatrix * vec4( position, 1.0 );","   vWorldPosition = worldPosition.xyz;","   gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );",THREE.ShaderChunk["logdepthbuf_vertex"],"}"].join("\n"),fragmentShader:["uniform samplerCube tCube;","uniform float tFlip;","varying vec3 vWorldPosition;",THREE.ShaderChunk["logdepthbuf_pars_fragment"],THREE.ShaderChunk["fog_pars_fragment"],"void main() {","   gl_FragColor = textureCube( tCube, vec3( tFlip * vWorldPosition.x, vWorldPosition.yz ) );",THREE.ShaderChunk["logdepthbuf_fragment"],THREE.ShaderChunk["fog_fragment"],"}"].join("\n")};module.exports=function(renderer,camera,scene){var light=new THREE.HemisphereLight(12315135,526368,1);light.position.set(-1,1,-1);scene.add(light);var waterNormals=new THREE.ImageUtils.loadTexture("img/waternormals5.jpg");waterNormals.wrapS=waterNormals.wrapT=THREE.RepeatWrapping;var water=new THREE.Water(renderer,camera,scene,{textureWidth:512,textureHeight:512,waterNormals:waterNormals,alpha:.9,sunDirection:light.position.clone().normalize(),sunColor:16777215,waterColor:134421,distortionScale:80});var mirrorMesh=new THREE.Mesh(new THREE.PlaneBufferGeometry(5e3,5e3),water.material);mirrorMesh.add(water);mirrorMesh.rotation.x=-Math.PI*.5;scene.add(mirrorMesh);var cubeMap=new THREE.CubeTexture([]);cubeMap.format=THREE.RGBFormat;cubeMap.flipY=false;var loader=new THREE.ImageLoader;loader.load("img/cloudy_night2.jpg",function(image){var getSide=function(x,y){var size=1024;var canvas=document.createElement("canvas");canvas.width=size;canvas.height=size;var context=canvas.getContext("2d");context.drawImage(image,-x*size,-y*size);return canvas};cubeMap.images[0]=getSide(2,1);cubeMap.images[1]=getSide(0,1);cubeMap.images[2]=getSide(1,0);cubeMap.images[3]=getSide(1,2);cubeMap.images[4]=getSide(1,1);cubeMap.images[5]=getSide(3,1);cubeMap.needsUpdate=true});cubeShader.uniforms.tCube.value=cubeMap;var skyBoxMaterial=new THREE.ShaderMaterial({fragmentShader:cubeShader.fragmentShader,vertexShader:cubeShader.vertexShader,uniforms:cubeShader.uniforms,side:THREE.BackSide,fog:true});var skyBox=new THREE.Mesh(new THREE.BoxGeometry(5e3,5e3,5e3),skyBoxMaterial);water.cubeMap=cubeMap;scene.add(skyBox);return water}},{}],13:[function(require,module,exports){var glslify=require("glslify");var source=require("glslify/simple-adapter.js")("\n#define GLSLIFY 1\n\nvarying vec2 vUv;\nvoid main() {\n  vUv = uv;\n  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}","\n#define GLSLIFY 1\n\nuniform vec2 resolution;\nuniform float radius;\nuniform vec2 dir;\nuniform float strength;\nuniform sampler2D tDiffuse;\nvarying vec2 vUv;\nvec4 a_x_blur(sampler2D tex, vec2 uv, vec2 blur, vec2 direction) {\n  vec4 sum = vec4(0.0);\n  sum += texture2D(tex, vec2(uv.x - 4.0 * blur.x * direction.x, uv.y - 4.0 * blur.y * direction.y)) * 0.0162162162;\n  sum += texture2D(tex, vec2(uv.x - 3.0 * blur.x * direction.x, uv.y - 3.0 * blur.y * direction.y)) * 0.0540540541;\n  sum += texture2D(tex, vec2(uv.x - 2.0 * blur.x * direction.x, uv.y - 2.0 * blur.y * direction.y)) * 0.1216216216;\n  sum += texture2D(tex, vec2(uv.x - 1.0 * blur.x * direction.x, uv.y - 1.0 * blur.y * direction.y)) * 0.1945945946;\n  sum += texture2D(tex, vec2(uv.x, uv.y)) * 0.2270270270;\n  sum += texture2D(tex, vec2(uv.x + 1.0 * blur.x * direction.x, uv.y + 1.0 * blur.y * direction.y)) * 0.1945945946;\n  sum += texture2D(tex, vec2(uv.x + 2.0 * blur.x * direction.x, uv.y + 2.0 * blur.y * direction.y)) * 0.1216216216;\n  sum += texture2D(tex, vec2(uv.x + 3.0 * blur.x * direction.x, uv.y + 3.0 * blur.y * direction.y)) * 0.0540540541;\n  sum += texture2D(tex, vec2(uv.x + 4.0 * blur.x * direction.x, uv.y + 4.0 * blur.y * direction.y)) * 0.0162162162;\n  return sum;\n}\nvoid main() {\n  vec2 blurAmt = vec2(radius) / resolution;\n  vec4 sum = a_x_blur(tDiffuse, vUv, blurAmt, dir);\n  vec2 p = (gl_FragCoord.xy / resolution.xy - 0.5);\n  p.x *= resolution.x / resolution.y;\n  float len = smoothstep(0.5, 1.2, length(p));\n  vec3 orig = texture2D(tDiffuse, vUv).rgb;\n  gl_FragColor.rgb = mix(orig, sum.rgb, len + 0.1);\n  gl_FragColor.a = 1.0;\n}",[{name:"resolution",type:"vec2"},{name:"radius",type:"float"},{name:"dir",type:"vec2"},{name:"strength",type:"float"},{name:"tDiffuse",type:"sampler2D"}],[]);module.exports=require("./create")(source)},{"./create":14,glslify:61,"glslify/simple-adapter.js":62}],14:[function(require,module,exports){(function(global){var THREE=typeof window!=="undefined"?window.THREE:typeof global!=="undefined"?global.THREE:null;var threeify=require("three-glslify")(THREE);var xtend=require("xtend");module.exports=function(source){return function(opt){return xtend(threeify(source),opt)}}}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"three-glslify":85,xtend:100}],15:[function(require,module,exports){var glslify=require("glslify");var source=require("glslify/simple-adapter.js")("\n#define GLSLIFY 1\n\nuniform vec2 overlayResolution;\nuniform vec2 resolution;\nvarying vec2 vUv;\nvarying vec2 overlayUV;\nvoid main() {\n  vUv = uv;\n  float aspect = overlayResolution.x / overlayResolution.y;\n  float ratio = resolution.x / resolution.y;\n  overlayUV = uv;\n  float tAspect = overlayResolution.x / overlayResolution.y;\n  float pAspect = resolution.x / resolution.y;\n  overlayUV = uv;\n  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}","\n#define GLSLIFY 1\n\nuniform float tick;\nuniform sampler2D tDiffuse;\nuniform sampler2D tLookup;\nuniform sampler2D tOverlay;\nvarying vec2 vUv;\nvarying vec2 overlayUV;\nhighp float a_x_random(vec2 co) {\n  highp float a = 12.9898;\n  highp float b = 78.233;\n  highp float c = 43758.5453;\n  highp float dt = dot(co.xy, vec2(a, b));\n  highp float sn = mod(dt, 3.14);\n  return fract(sin(sn) * c);\n}\nvec3 b_x_blendOverlay(vec3 base, vec3 blend) {\n  return vec3(base.r < 0.5 ? (2.0 * base.r * blend.r) : (1.0 - 2.0 * (1.0 - base.r) * (1.0 - blend.r)), base.g < 0.5 ? (2.0 * base.g * blend.g) : (1.0 - 2.0 * (1.0 - base.g) * (1.0 - blend.g)), base.b < 0.5 ? (2.0 * base.b * blend.b) : (1.0 - 2.0 * (1.0 - base.b) * (1.0 - blend.b)));\n}\nfloat c_x_luma(vec3 color) {\n  return dot(color, vec3(0.299, 0.587, 0.114));\n}\nfloat c_x_luma(vec4 color) {\n  return dot(color.rgb, vec3(0.299, 0.587, 0.114));\n}\n#define LUT_FLIP_Y\n\nvec4 e_x_lookup(in vec4 textureColor, in sampler2D lookupTable) {\n  \n  #ifndef LUT_NO_CLAMP\n  textureColor = clamp(textureColor, 0.0, 1.0);\n  #endif\n  mediump float blueColor = textureColor.b * 63.0;\n  mediump vec2 quad1;\n  quad1.y = floor(floor(blueColor) / 8.0);\n  quad1.x = floor(blueColor) - (quad1.y * 8.0);\n  mediump vec2 quad2;\n  quad2.y = floor(ceil(blueColor) / 8.0);\n  quad2.x = ceil(blueColor) - (quad2.y * 8.0);\n  highp vec2 texPos1;\n  texPos1.x = (quad1.x * 0.125) + 0.5 / 512.0 + ((0.125 - 1.0 / 512.0) * textureColor.r);\n  texPos1.y = (quad1.y * 0.125) + 0.5 / 512.0 + ((0.125 - 1.0 / 512.0) * textureColor.g);\n  #ifdef LUT_FLIP_Y\n  texPos1.y = 1.0 - texPos1.y;\n  #endif\n  highp vec2 texPos2;\n  texPos2.x = (quad2.x * 0.125) + 0.5 / 512.0 + ((0.125 - 1.0 / 512.0) * textureColor.r);\n  texPos2.y = (quad2.y * 0.125) + 0.5 / 512.0 + ((0.125 - 1.0 / 512.0) * textureColor.g);\n  #ifdef LUT_FLIP_Y\n  texPos2.y = 1.0 - texPos2.y;\n  #endif\n  lowp vec4 newColor1 = texture2D(lookupTable, texPos1);\n  lowp vec4 newColor2 = texture2D(lookupTable, texPos2);\n  lowp vec4 newColor = mix(newColor1, newColor2, fract(blueColor));\n  return newColor;\n}\nvoid main() {\n  vec3 texColor = texture2D(tDiffuse, vUv).rgb;\n  float luminance = c_x_luma(texColor);\n  float noiseMap = smoothstep(luminance, 0.5, 0.0);\n  vec2 tUv = vUv + tick;\n  vec3 noise = vec3(a_x_random(tUv), a_x_random(tUv * 1.5), a_x_random(tUv * 0.5));\n  vec3 noiseColor = mix(noise, vec3(0.5), noiseMap);\n  vec3 color = mix(texColor, b_x_blendOverlay(texColor, noise), 0.15);\n  vec3 corrected = e_x_lookup(vec4(color, 1.0), tLookup).rgb;\n  color = mix(color, corrected, 0.9);\n  gl_FragColor = vec4(color, 1.0);\n  vec4 scratches = texture2D(tOverlay, overlayUV);\n  vec3 scratchBlend = gl_FragColor.rgb + scratches.rgb;\n  float center = smoothstep(0.0, 0.6, length(vUv - 0.5));\n  float dirtMap = smoothstep(0.1, 0.4, luminance * center);\n  gl_FragColor.rgb = mix(gl_FragColor.rgb, scratchBlend, dirtMap);\n}",[{name:"overlayResolution",type:"vec2"},{name:"resolution",type:"vec2"},{name:"tick",type:"float"},{name:"tDiffuse",type:"sampler2D"},{name:"tLookup",type:"sampler2D"},{name:"tOverlay",type:"sampler2D"}],[]);module.exports=require("./create")(source)},{"./create":14,glslify:61,"glslify/simple-adapter.js":62}],16:[function(require,module,exports){var glslify=require("glslify");var source=require("glslify/simple-adapter.js")("\n#define GLSLIFY 1\n\nvarying vec2 vUv;\nvoid main() {\n  vUv = uv;\n  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}","\n#define GLSLIFY 1\n\nuniform sampler2D tDiffuse;\nvarying vec2 vUv;\nvoid main() {\n  gl_FragColor = texture2D(tDiffuse, vUv);\n}",[{name:"tDiffuse",type:"sampler2D"}],[]);module.exports=require("./create")(source)},{"./create":14,glslify:61,"glslify/simple-adapter.js":62}],17:[function(require,module,exports){(function(global){var THREE=typeof window!=="undefined"?window.THREE:typeof global!=="undefined"?global.THREE:null;var mobile=require("./is-mobile");var lineHeight=22;var big=.7;var small=.5;var panelWidth=20;var mobileScale=mobile?.8:1;big*=mobileScale;small*=mobileScale;panelWidth*=mobileScale;lineHeight*=mobileScale;module.exports=[{name:"tonnes",panels:[{labels:[{text:"5 million tonnes",size:big},{text:"estimated oil spilt in Russia each year",size:small,translation:[-2,-lineHeight,0]}]},{width:panelWidth,labels:[{text:"6 million tonnes",size:big},{text:"expected yearly output of this platform",size:small,translation:[0,-lineHeight,0]}]}]},{name:"top",panels:[{labels:[{text:"Technologically outdated",size:big},{text:"using secondhand components",size:small,translation:[0,-lineHeight,0]}]},{width:panelWidth,labels:[{text:"$3.2 billion over budget",size:big},{text:"18 years to construct",size:small,translation:[0,-lineHeight,0]}]}]},{name:"nature",panels:[{labels:[{text:"50 km from Nature reserve",size:big},{text:"Less than 20hrs for oil to reach",size:small,translation:[0,-lineHeight,0]}]},{width:panelWidth,labels:[{text:"Crucial breeding grounds",size:big},{text:"for walrus, whales & polar bears",size:small,translation:[0,-lineHeight,0]}]}]},{name:"response",panels:[{labels:[{text:"Large scale spill equipment ",size:big},{text:"1000km (3 days sailing) away",size:small,translation:[0,-lineHeight,0]}]},{width:panelWidth*1.5,labels:[{text:"15 buckets and 3 axes",size:big},{text:"included in previous response plan",size:small,translation:[0,-lineHeight,0]}]}]},{name:"spill",panels:[{labels:[{text:"Arctic Oil spills",size:big},{text:"are close to impossible to clean up",size:small,translation:[0,-lineHeight,0]}]},{width:panelWidth,labels:[{text:"Offshore drilling for arctic oil",size:big},{text:"spills are virtually inevitable",size:small,translation:[0,-lineHeight,0]}]}]},{name:"weather",panels:[{labels:[{text:"As cold as -50°c / 122°f",size:big},{text:"two thirds of the year surrounded by ice",size:small,translation:[0,-lineHeight,0]}]},{width:panelWidth,labels:[{text:"Plagued by bad weather",size:big},{text:"waves as high as 12m",size:small,translation:[0,-lineHeight,0]}]}]}]}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"./is-mobile":8}],18:[function(require,module,exports){(function(global){var inherits=require("inherits");var TweenMax=typeof window!=="undefined"?window.TweenMax:typeof global!=="undefined"?global.TweenMax:null;module.exports=function(THREE){if(!THREE.MOUSE)THREE.MOUSE={LEFT:0,MIDDLE:1,RIGHT:2};function OrbitControls(object,domElement){this.object=object;this.domElement=domElement!==undefined?domElement:document;this.enabled=true;this.target=new THREE.Vector3;this.center=this.target;this.noZoom=false;this.zoomSpeed=1;this.minDistance=0;this.maxDistance=Infinity;this.noRotate=false;this.rotateSpeed=1;this.noPan=false;this.keyPanSpeed=7;this.autoRotate=false;this.autoRotateSpeed=2;this.minPolarAngle=0;this.maxPolarAngle=Math.PI;this.noKeys=false;this.phi=0;this.theta=0;this.keys={LEFT:37,UP:38,RIGHT:39,BOTTOM:40};this.constrainDelta={x:0,y:0};var scope=this;var EPS=1e-6;var rotateStart=new THREE.Vector2;var rotateEnd=new THREE.Vector2;var rotateDelta=new THREE.Vector2;var panStart=new THREE.Vector2;var panEnd=new THREE.Vector2;var panDelta=new THREE.Vector2;var panOffset=new THREE.Vector3;var offset=new THREE.Vector3;var dollyStart=new THREE.Vector2;var dollyEnd=new THREE.Vector2;var dollyDelta=new THREE.Vector2;var phiDelta=0;var thetaDelta=0;var scale=1;var pan=new THREE.Vector3;var lastPosition=new THREE.Vector3;var STATE={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_DOLLY:4,TOUCH_PAN:5};var state=STATE.NONE;this.target0=this.target.clone();this.position0=this.object.position.clone();var quat=(new THREE.Quaternion).setFromUnitVectors(object.up,new THREE.Vector3(0,1,0));var quatInverse=quat.clone().inverse();var changeEvent={type:"change"};var startEvent={type:"start"};var endEvent={type:"end"};this.rotateLeft=function(angle){if(angle===undefined){angle=getAutoRotationAngle()}thetaDelta-=angle};this.rotateUp=function(angle){if(angle===undefined){angle=getAutoRotationAngle()}phiDelta-=angle};this.panLeft=function(distance){var te=this.object.matrix.elements;panOffset.set(te[0],te[1],te[2]);panOffset.multiplyScalar(-distance);pan.add(panOffset)};this.panUp=function(distance){var te=this.object.matrix.elements;panOffset.set(te[4],te[5],te[6]);panOffset.multiplyScalar(distance);pan.add(panOffset)};this.pan=function(deltaX,deltaY){var element=scope.domElement===document?scope.domElement.body:scope.domElement;if(scope.object.fov!==undefined){var position=scope.object.position;var offset=position.clone().sub(scope.target);var targetDistance=offset.length();targetDistance*=Math.tan(scope.object.fov/2*Math.PI/180);scope.panLeft(2*deltaX*targetDistance/element.clientHeight);scope.panUp(2*deltaY*targetDistance/element.clientHeight)}else if(scope.object.top!==undefined){scope.panLeft(deltaX*(scope.object.right-scope.object.left)/element.clientWidth);scope.panUp(deltaY*(scope.object.top-scope.object.bottom)/element.clientHeight)}else{console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled.")}};this.dollyIn=function(dollyScale){if(dollyScale===undefined){dollyScale=getZoomScale()}scale/=dollyScale};this.dollyOut=function(dollyScale){if(dollyScale===undefined){dollyScale=getZoomScale()}scale*=dollyScale};this.update=function(){var position=this.object.position;scope.rotateLeft(2*Math.PI*scope.constrainDelta.x/window.innerWidth*scope.rotateSpeed);scope.rotateUp(2*Math.PI*scope.constrainDelta.y/window.innerHeight*scope.rotateSpeed);offset.copy(position).sub(this.target);offset.applyQuaternion(quat);var theta=Math.atan2(offset.x,offset.z);var phi=Math.atan2(Math.sqrt(offset.x*offset.x+offset.z*offset.z),offset.y);if(this.autoRotate){this.rotateLeft(getAutoRotationAngle())}theta+=thetaDelta;phi+=phiDelta;phi=Math.max(this.minPolarAngle,Math.min(this.maxPolarAngle,phi));phi=Math.max(EPS,Math.min(Math.PI-EPS,phi));var radius=offset.length()*scale;radius=Math.max(this.minDistance,Math.min(this.maxDistance,radius));this.target.add(pan);scope.phi=phi;scope.theta=theta;offset.x=radius*Math.sin(phi)*Math.sin(theta);offset.y=radius*Math.cos(phi);offset.z=radius*Math.sin(phi)*Math.cos(theta);offset.applyQuaternion(quatInverse);position.copy(this.target).add(offset);this.object.lookAt(this.target);thetaDelta=0;phiDelta=0;scale=1;pan.set(0,0,0);if(lastPosition.distanceToSquared(this.object.position)>EPS){this.dispatchEvent(changeEvent);lastPosition.copy(this.object.position)}};this.reset=function(){state=STATE.NONE;this.target.copy(this.target0);this.object.position.copy(this.position0);this.update()};function getAutoRotationAngle(){return 2*Math.PI/60/60*scope.autoRotateSpeed}function getZoomScale(){return Math.pow(.95,scope.zoomSpeed)}function onMouseDown(event){if(scope.enabled===false)return;event.preventDefault();if(event.button===0){if(scope.noRotate===true)return;state=STATE.ROTATE;rotateStart.set(event.clientX,event.clientY)}else if(event.button===1){if(scope.noZoom===true)return;state=STATE.DOLLY;dollyStart.set(event.clientX,event.clientY)}else if(event.button===2){if(scope.noPan===true)return;state=STATE.PAN;panStart.set(event.clientX,event.clientY)}scope.domElement.addEventListener("mousemove",onMouseMove,false);scope.domElement.addEventListener("mouseup",onMouseUp,false);scope.dispatchEvent(startEvent)}function onMouseMove(event){if(scope.enabled===false)return;event.preventDefault();var element=scope.domElement===document?scope.domElement.body:scope.domElement;if(state===STATE.ROTATE){if(scope.noRotate===true)return;rotateEnd.set(event.clientX,event.clientY);rotateDelta.subVectors(rotateEnd,rotateStart);scope.constrainDelta.x=rotateDelta.x;scope.constrainDelta.y=rotateDelta.y;TweenMax.killTweensOf(scope.constrainDelta);TweenMax.to(scope.constrainDelta,.5,{x:0,y:0,ease:"easeOutQuad",delay:0});rotateStart.copy(rotateEnd)}else if(state===STATE.DOLLY){if(scope.noZoom===true)return;dollyEnd.set(event.clientX,event.clientY);dollyDelta.subVectors(dollyEnd,dollyStart);if(dollyDelta.y>0){scope.dollyIn()}else{scope.dollyOut()}dollyStart.copy(dollyEnd)}else if(state===STATE.PAN){if(scope.noPan===true)return;panEnd.set(event.clientX,event.clientY);panDelta.subVectors(panEnd,panStart);scope.pan(panDelta.x,panDelta.y);panStart.copy(panEnd)}scope.update()}function onMouseUp(){if(scope.enabled===false)return;scope.domElement.removeEventListener("mousemove",onMouseMove,false);scope.domElement.removeEventListener("mouseup",onMouseUp,false);scope.dispatchEvent(endEvent);state=STATE.NONE}function onMouseWheel(event){if(scope.enabled===false||scope.noZoom===true)return;event.preventDefault();event.stopPropagation();var delta=0;if(event.wheelDelta!==undefined){delta=event.wheelDelta}else if(event.detail!==undefined){delta=-event.detail}if(delta>0){scope.dollyOut()}else{scope.dollyIn()}scope.update();scope.dispatchEvent(startEvent);scope.dispatchEvent(endEvent)}function onKeyDown(event){if(scope.enabled===false||scope.noKeys===true||scope.noPan===true)return;switch(event.keyCode){case scope.keys.UP:scope.pan(0,scope.keyPanSpeed);scope.update();break;case scope.keys.BOTTOM:scope.pan(0,-scope.keyPanSpeed);scope.update();break;case scope.keys.LEFT:scope.pan(scope.keyPanSpeed,0);scope.update();break;case scope.keys.RIGHT:scope.pan(-scope.keyPanSpeed,0);scope.update();break}}function touchstart(event){if(scope.enabled===false)return;switch(event.touches.length){case 1:if(scope.noRotate===true)return;state=STATE.TOUCH_ROTATE;rotateStart.set(event.touches[0].pageX,event.touches[0].pageY);break;case 2:if(scope.noZoom===true)return;state=STATE.TOUCH_DOLLY;var dx=event.touches[0].pageX-event.touches[1].pageX;var dy=event.touches[0].pageY-event.touches[1].pageY;var distance=Math.sqrt(dx*dx+dy*dy);dollyStart.set(0,distance);break;case 3:if(scope.noPan===true)return;state=STATE.TOUCH_PAN;panStart.set(event.touches[0].pageX,event.touches[0].pageY);break;default:state=STATE.NONE}scope.dispatchEvent(startEvent)}function touchmove(event){if(scope.enabled===false)return;event.preventDefault();event.stopPropagation();var element=scope.domElement===document?scope.domElement.body:scope.domElement;switch(event.touches.length){case 1:if(scope.noRotate===true)return;if(state!==STATE.TOUCH_ROTATE)return;rotateEnd.set(event.touches[0].pageX,event.touches[0].pageY);rotateDelta.subVectors(rotateEnd,rotateStart);scope.constrainDelta.x=rotateDelta.x;scope.constrainDelta.y=rotateDelta.y;TweenMax.killTweensOf(scope.constrainDelta);TweenMax.to(scope.constrainDelta,.45,{x:0,y:0,ease:"easeOutQuad",delay:0});rotateStart.copy(rotateEnd);scope.update();break;case 2:if(scope.noZoom===true)return;if(state!==STATE.TOUCH_DOLLY)return;var dx=event.touches[0].pageX-event.touches[1].pageX;var dy=event.touches[0].pageY-event.touches[1].pageY;var distance=Math.sqrt(dx*dx+dy*dy);dollyEnd.set(0,distance);dollyDelta.subVectors(dollyEnd,dollyStart);if(dollyDelta.y>0){scope.dollyOut()}else{scope.dollyIn()}dollyStart.copy(dollyEnd);scope.update();break;case 3:if(scope.noPan===true)return;if(state!==STATE.TOUCH_PAN)return;panEnd.set(event.touches[0].pageX,event.touches[0].pageY);panDelta.subVectors(panEnd,panStart);scope.pan(panDelta.x,panDelta.y);panStart.copy(panEnd);scope.update();break;default:state=STATE.NONE}}function touchend(){if(scope.enabled===false)return;scope.dispatchEvent(endEvent);state=STATE.NONE}this.domElement.addEventListener("contextmenu",function(event){event.preventDefault()},false);this.domElement.addEventListener("mousedown",onMouseDown,false);this.domElement.addEventListener("mousewheel",onMouseWheel,false);this.domElement.addEventListener("DOMMouseScroll",onMouseWheel,false);this.domElement.addEventListener("touchstart",touchstart,false);this.domElement.addEventListener("touchend",touchend,false);this.domElement.addEventListener("touchmove",touchmove,false);window.addEventListener("keydown",onKeyDown,false);this.update()}inherits(OrbitControls,THREE.EventDispatcher);return OrbitControls}}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{inherits:64}],19:[function(require,module,exports){module.exports=function numtype(num,def){return typeof num==="number"?num:typeof def==="number"?def:0}},{}],20:[function(require,module,exports){var base64=require("base64-js");var ieee754=require("ieee754");var isArray=require("is-array");exports.Buffer=Buffer;exports.SlowBuffer=Buffer;exports.INSPECT_MAX_BYTES=50;Buffer.poolSize=8192;var kMaxLength=1073741823;Buffer.TYPED_ARRAY_SUPPORT=function(){try{var buf=new ArrayBuffer(0);var arr=new Uint8Array(buf);arr.foo=function(){return 42};return 42===arr.foo()&&typeof arr.subarray==="function"&&new Uint8Array(1).subarray(1,1).byteLength===0}catch(e){return false}}();function Buffer(subject,encoding,noZero){if(!(this instanceof Buffer))return new Buffer(subject,encoding,noZero);var type=typeof subject;var length;if(type==="number")length=subject>0?subject>>>0:0;else if(type==="string"){if(encoding==="base64")subject=base64clean(subject);length=Buffer.byteLength(subject,encoding)}else if(type==="object"&&subject!==null){if(subject.type==="Buffer"&&isArray(subject.data))subject=subject.data;length=+subject.length>0?Math.floor(+subject.length):0}else throw new TypeError("must start with number, buffer, array or string");if(this.length>kMaxLength)throw new RangeError("Attempt to allocate Buffer larger than maximum "+"size: 0x"+kMaxLength.toString(16)+" bytes");var buf;if(Buffer.TYPED_ARRAY_SUPPORT){buf=Buffer._augment(new Uint8Array(length))}else{buf=this;buf.length=length;buf._isBuffer=true}var i;if(Buffer.TYPED_ARRAY_SUPPORT&&typeof subject.byteLength==="number"){buf._set(subject)}else if(isArrayish(subject)){if(Buffer.isBuffer(subject)){for(i=0;i<length;i++)buf[i]=subject.readUInt8(i)}else{for(i=0;i<length;i++)buf[i]=(subject[i]%256+256)%256}}else if(type==="string"){buf.write(subject,0,encoding)}else if(type==="number"&&!Buffer.TYPED_ARRAY_SUPPORT&&!noZero){for(i=0;i<length;i++){buf[i]=0}}return buf}Buffer.isBuffer=function(b){return!!(b!=null&&b._isBuffer)};Buffer.compare=function(a,b){if(!Buffer.isBuffer(a)||!Buffer.isBuffer(b))throw new TypeError("Arguments must be Buffers");var x=a.length;var y=b.length;for(var i=0,len=Math.min(x,y);i<len&&a[i]===b[i];i++){}if(i!==len){x=a[i];y=b[i]}if(x<y)return-1;if(y<x)return 1;return 0};Buffer.isEncoding=function(encoding){switch(String(encoding).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"raw":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return true;default:return false}};Buffer.concat=function(list,totalLength){if(!isArray(list))throw new TypeError("Usage: Buffer.concat(list[, length])");if(list.length===0){return new Buffer(0)}else if(list.length===1){return list[0]}var i;if(totalLength===undefined){totalLength=0;for(i=0;i<list.length;i++){totalLength+=list[i].length}}var buf=new Buffer(totalLength);var pos=0;for(i=0;i<list.length;i++){var item=list[i];item.copy(buf,pos);pos+=item.length}return buf};Buffer.byteLength=function(str,encoding){var ret;str=str+"";switch(encoding||"utf8"){case"ascii":case"binary":case"raw":ret=str.length;break;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":ret=str.length*2;break;case"hex":ret=str.length>>>1;break;case"utf8":case"utf-8":ret=utf8ToBytes(str).length;break;case"base64":ret=base64ToBytes(str).length;break;default:ret=str.length}return ret};Buffer.prototype.length=undefined;Buffer.prototype.parent=undefined;Buffer.prototype.toString=function(encoding,start,end){var loweredCase=false;start=start>>>0;end=end===undefined||end===Infinity?this.length:end>>>0;if(!encoding)encoding="utf8";if(start<0)start=0;if(end>this.length)end=this.length;if(end<=start)return"";while(true){switch(encoding){case"hex":return hexSlice(this,start,end);case"utf8":case"utf-8":return utf8Slice(this,start,end);case"ascii":return asciiSlice(this,start,end);case"binary":return binarySlice(this,start,end);case"base64":return base64Slice(this,start,end);
case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return utf16leSlice(this,start,end);default:if(loweredCase)throw new TypeError("Unknown encoding: "+encoding);encoding=(encoding+"").toLowerCase();loweredCase=true}}};Buffer.prototype.equals=function(b){if(!Buffer.isBuffer(b))throw new TypeError("Argument must be a Buffer");return Buffer.compare(this,b)===0};Buffer.prototype.inspect=function(){var str="";var max=exports.INSPECT_MAX_BYTES;if(this.length>0){str=this.toString("hex",0,max).match(/.{2}/g).join(" ");if(this.length>max)str+=" ... "}return"<Buffer "+str+">"};Buffer.prototype.compare=function(b){if(!Buffer.isBuffer(b))throw new TypeError("Argument must be a Buffer");return Buffer.compare(this,b)};Buffer.prototype.get=function(offset){console.log(".get() is deprecated. Access using array indexes instead.");return this.readUInt8(offset)};Buffer.prototype.set=function(v,offset){console.log(".set() is deprecated. Access using array indexes instead.");return this.writeUInt8(v,offset)};function hexWrite(buf,string,offset,length){offset=Number(offset)||0;var remaining=buf.length-offset;if(!length){length=remaining}else{length=Number(length);if(length>remaining){length=remaining}}var strLen=string.length;if(strLen%2!==0)throw new Error("Invalid hex string");if(length>strLen/2){length=strLen/2}for(var i=0;i<length;i++){var byte=parseInt(string.substr(i*2,2),16);if(isNaN(byte))throw new Error("Invalid hex string");buf[offset+i]=byte}return i}function utf8Write(buf,string,offset,length){var charsWritten=blitBuffer(utf8ToBytes(string),buf,offset,length);return charsWritten}function asciiWrite(buf,string,offset,length){var charsWritten=blitBuffer(asciiToBytes(string),buf,offset,length);return charsWritten}function binaryWrite(buf,string,offset,length){return asciiWrite(buf,string,offset,length)}function base64Write(buf,string,offset,length){var charsWritten=blitBuffer(base64ToBytes(string),buf,offset,length);return charsWritten}function utf16leWrite(buf,string,offset,length){var charsWritten=blitBuffer(utf16leToBytes(string),buf,offset,length,2);return charsWritten}Buffer.prototype.write=function(string,offset,length,encoding){if(isFinite(offset)){if(!isFinite(length)){encoding=length;length=undefined}}else{var swap=encoding;encoding=offset;offset=length;length=swap}offset=Number(offset)||0;var remaining=this.length-offset;if(!length){length=remaining}else{length=Number(length);if(length>remaining){length=remaining}}encoding=String(encoding||"utf8").toLowerCase();var ret;switch(encoding){case"hex":ret=hexWrite(this,string,offset,length);break;case"utf8":case"utf-8":ret=utf8Write(this,string,offset,length);break;case"ascii":ret=asciiWrite(this,string,offset,length);break;case"binary":ret=binaryWrite(this,string,offset,length);break;case"base64":ret=base64Write(this,string,offset,length);break;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":ret=utf16leWrite(this,string,offset,length);break;default:throw new TypeError("Unknown encoding: "+encoding)}return ret};Buffer.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function base64Slice(buf,start,end){if(start===0&&end===buf.length){return base64.fromByteArray(buf)}else{return base64.fromByteArray(buf.slice(start,end))}}function utf8Slice(buf,start,end){var res="";var tmp="";end=Math.min(buf.length,end);for(var i=start;i<end;i++){if(buf[i]<=127){res+=decodeUtf8Char(tmp)+String.fromCharCode(buf[i]);tmp=""}else{tmp+="%"+buf[i].toString(16)}}return res+decodeUtf8Char(tmp)}function asciiSlice(buf,start,end){var ret="";end=Math.min(buf.length,end);for(var i=start;i<end;i++){ret+=String.fromCharCode(buf[i])}return ret}function binarySlice(buf,start,end){return asciiSlice(buf,start,end)}function hexSlice(buf,start,end){var len=buf.length;if(!start||start<0)start=0;if(!end||end<0||end>len)end=len;var out="";for(var i=start;i<end;i++){out+=toHex(buf[i])}return out}function utf16leSlice(buf,start,end){var bytes=buf.slice(start,end);var res="";for(var i=0;i<bytes.length;i+=2){res+=String.fromCharCode(bytes[i]+bytes[i+1]*256)}return res}Buffer.prototype.slice=function(start,end){var len=this.length;start=~~start;end=end===undefined?len:~~end;if(start<0){start+=len;if(start<0)start=0}else if(start>len){start=len}if(end<0){end+=len;if(end<0)end=0}else if(end>len){end=len}if(end<start)end=start;if(Buffer.TYPED_ARRAY_SUPPORT){return Buffer._augment(this.subarray(start,end))}else{var sliceLen=end-start;var newBuf=new Buffer(sliceLen,undefined,true);for(var i=0;i<sliceLen;i++){newBuf[i]=this[i+start]}return newBuf}};function checkOffset(offset,ext,length){if(offset%1!==0||offset<0)throw new RangeError("offset is not uint");if(offset+ext>length)throw new RangeError("Trying to access beyond buffer length")}Buffer.prototype.readUInt8=function(offset,noAssert){if(!noAssert)checkOffset(offset,1,this.length);return this[offset]};Buffer.prototype.readUInt16LE=function(offset,noAssert){if(!noAssert)checkOffset(offset,2,this.length);return this[offset]|this[offset+1]<<8};Buffer.prototype.readUInt16BE=function(offset,noAssert){if(!noAssert)checkOffset(offset,2,this.length);return this[offset]<<8|this[offset+1]};Buffer.prototype.readUInt32LE=function(offset,noAssert){if(!noAssert)checkOffset(offset,4,this.length);return(this[offset]|this[offset+1]<<8|this[offset+2]<<16)+this[offset+3]*16777216};Buffer.prototype.readUInt32BE=function(offset,noAssert){if(!noAssert)checkOffset(offset,4,this.length);return this[offset]*16777216+(this[offset+1]<<16|this[offset+2]<<8|this[offset+3])};Buffer.prototype.readInt8=function(offset,noAssert){if(!noAssert)checkOffset(offset,1,this.length);if(!(this[offset]&128))return this[offset];return(255-this[offset]+1)*-1};Buffer.prototype.readInt16LE=function(offset,noAssert){if(!noAssert)checkOffset(offset,2,this.length);var val=this[offset]|this[offset+1]<<8;return val&32768?val|4294901760:val};Buffer.prototype.readInt16BE=function(offset,noAssert){if(!noAssert)checkOffset(offset,2,this.length);var val=this[offset+1]|this[offset]<<8;return val&32768?val|4294901760:val};Buffer.prototype.readInt32LE=function(offset,noAssert){if(!noAssert)checkOffset(offset,4,this.length);return this[offset]|this[offset+1]<<8|this[offset+2]<<16|this[offset+3]<<24};Buffer.prototype.readInt32BE=function(offset,noAssert){if(!noAssert)checkOffset(offset,4,this.length);return this[offset]<<24|this[offset+1]<<16|this[offset+2]<<8|this[offset+3]};Buffer.prototype.readFloatLE=function(offset,noAssert){if(!noAssert)checkOffset(offset,4,this.length);return ieee754.read(this,offset,true,23,4)};Buffer.prototype.readFloatBE=function(offset,noAssert){if(!noAssert)checkOffset(offset,4,this.length);return ieee754.read(this,offset,false,23,4)};Buffer.prototype.readDoubleLE=function(offset,noAssert){if(!noAssert)checkOffset(offset,8,this.length);return ieee754.read(this,offset,true,52,8)};Buffer.prototype.readDoubleBE=function(offset,noAssert){if(!noAssert)checkOffset(offset,8,this.length);return ieee754.read(this,offset,false,52,8)};function checkInt(buf,value,offset,ext,max,min){if(!Buffer.isBuffer(buf))throw new TypeError("buffer must be a Buffer instance");if(value>max||value<min)throw new TypeError("value is out of bounds");if(offset+ext>buf.length)throw new TypeError("index out of range")}Buffer.prototype.writeUInt8=function(value,offset,noAssert){value=+value;offset=offset>>>0;if(!noAssert)checkInt(this,value,offset,1,255,0);if(!Buffer.TYPED_ARRAY_SUPPORT)value=Math.floor(value);this[offset]=value;return offset+1};function objectWriteUInt16(buf,value,offset,littleEndian){if(value<0)value=65535+value+1;for(var i=0,j=Math.min(buf.length-offset,2);i<j;i++){buf[offset+i]=(value&255<<8*(littleEndian?i:1-i))>>>(littleEndian?i:1-i)*8}}Buffer.prototype.writeUInt16LE=function(value,offset,noAssert){value=+value;offset=offset>>>0;if(!noAssert)checkInt(this,value,offset,2,65535,0);if(Buffer.TYPED_ARRAY_SUPPORT){this[offset]=value;this[offset+1]=value>>>8}else objectWriteUInt16(this,value,offset,true);return offset+2};Buffer.prototype.writeUInt16BE=function(value,offset,noAssert){value=+value;offset=offset>>>0;if(!noAssert)checkInt(this,value,offset,2,65535,0);if(Buffer.TYPED_ARRAY_SUPPORT){this[offset]=value>>>8;this[offset+1]=value}else objectWriteUInt16(this,value,offset,false);return offset+2};function objectWriteUInt32(buf,value,offset,littleEndian){if(value<0)value=4294967295+value+1;for(var i=0,j=Math.min(buf.length-offset,4);i<j;i++){buf[offset+i]=value>>>(littleEndian?i:3-i)*8&255}}Buffer.prototype.writeUInt32LE=function(value,offset,noAssert){value=+value;offset=offset>>>0;if(!noAssert)checkInt(this,value,offset,4,4294967295,0);if(Buffer.TYPED_ARRAY_SUPPORT){this[offset+3]=value>>>24;this[offset+2]=value>>>16;this[offset+1]=value>>>8;this[offset]=value}else objectWriteUInt32(this,value,offset,true);return offset+4};Buffer.prototype.writeUInt32BE=function(value,offset,noAssert){value=+value;offset=offset>>>0;if(!noAssert)checkInt(this,value,offset,4,4294967295,0);if(Buffer.TYPED_ARRAY_SUPPORT){this[offset]=value>>>24;this[offset+1]=value>>>16;this[offset+2]=value>>>8;this[offset+3]=value}else objectWriteUInt32(this,value,offset,false);return offset+4};Buffer.prototype.writeInt8=function(value,offset,noAssert){value=+value;offset=offset>>>0;if(!noAssert)checkInt(this,value,offset,1,127,-128);if(!Buffer.TYPED_ARRAY_SUPPORT)value=Math.floor(value);if(value<0)value=255+value+1;this[offset]=value;return offset+1};Buffer.prototype.writeInt16LE=function(value,offset,noAssert){value=+value;offset=offset>>>0;if(!noAssert)checkInt(this,value,offset,2,32767,-32768);if(Buffer.TYPED_ARRAY_SUPPORT){this[offset]=value;this[offset+1]=value>>>8}else objectWriteUInt16(this,value,offset,true);return offset+2};Buffer.prototype.writeInt16BE=function(value,offset,noAssert){value=+value;offset=offset>>>0;if(!noAssert)checkInt(this,value,offset,2,32767,-32768);if(Buffer.TYPED_ARRAY_SUPPORT){this[offset]=value>>>8;this[offset+1]=value}else objectWriteUInt16(this,value,offset,false);return offset+2};Buffer.prototype.writeInt32LE=function(value,offset,noAssert){value=+value;offset=offset>>>0;if(!noAssert)checkInt(this,value,offset,4,2147483647,-2147483648);if(Buffer.TYPED_ARRAY_SUPPORT){this[offset]=value;this[offset+1]=value>>>8;this[offset+2]=value>>>16;this[offset+3]=value>>>24}else objectWriteUInt32(this,value,offset,true);return offset+4};Buffer.prototype.writeInt32BE=function(value,offset,noAssert){value=+value;offset=offset>>>0;if(!noAssert)checkInt(this,value,offset,4,2147483647,-2147483648);if(value<0)value=4294967295+value+1;if(Buffer.TYPED_ARRAY_SUPPORT){this[offset]=value>>>24;this[offset+1]=value>>>16;this[offset+2]=value>>>8;this[offset+3]=value}else objectWriteUInt32(this,value,offset,false);return offset+4};function checkIEEE754(buf,value,offset,ext,max,min){if(value>max||value<min)throw new TypeError("value is out of bounds");if(offset+ext>buf.length)throw new TypeError("index out of range")}function writeFloat(buf,value,offset,littleEndian,noAssert){if(!noAssert)checkIEEE754(buf,value,offset,4,3.4028234663852886e38,-3.4028234663852886e38);ieee754.write(buf,value,offset,littleEndian,23,4);return offset+4}Buffer.prototype.writeFloatLE=function(value,offset,noAssert){return writeFloat(this,value,offset,true,noAssert)};Buffer.prototype.writeFloatBE=function(value,offset,noAssert){return writeFloat(this,value,offset,false,noAssert)};function writeDouble(buf,value,offset,littleEndian,noAssert){if(!noAssert)checkIEEE754(buf,value,offset,8,1.7976931348623157e308,-1.7976931348623157e308);ieee754.write(buf,value,offset,littleEndian,52,8);return offset+8}Buffer.prototype.writeDoubleLE=function(value,offset,noAssert){return writeDouble(this,value,offset,true,noAssert)};Buffer.prototype.writeDoubleBE=function(value,offset,noAssert){return writeDouble(this,value,offset,false,noAssert)};Buffer.prototype.copy=function(target,target_start,start,end){var source=this;if(!start)start=0;if(!end&&end!==0)end=this.length;if(!target_start)target_start=0;if(end===start)return;if(target.length===0||source.length===0)return;if(end<start)throw new TypeError("sourceEnd < sourceStart");if(target_start<0||target_start>=target.length)throw new TypeError("targetStart out of bounds");if(start<0||start>=source.length)throw new TypeError("sourceStart out of bounds");if(end<0||end>source.length)throw new TypeError("sourceEnd out of bounds");if(end>this.length)end=this.length;if(target.length-target_start<end-start)end=target.length-target_start+start;var len=end-start;if(len<1e3||!Buffer.TYPED_ARRAY_SUPPORT){for(var i=0;i<len;i++){target[i+target_start]=this[i+start]}}else{target._set(this.subarray(start,start+len),target_start)}};Buffer.prototype.fill=function(value,start,end){if(!value)value=0;if(!start)start=0;if(!end)end=this.length;if(end<start)throw new TypeError("end < start");if(end===start)return;if(this.length===0)return;if(start<0||start>=this.length)throw new TypeError("start out of bounds");if(end<0||end>this.length)throw new TypeError("end out of bounds");var i;if(typeof value==="number"){for(i=start;i<end;i++){this[i]=value}}else{var bytes=utf8ToBytes(value.toString());var len=bytes.length;for(i=start;i<end;i++){this[i]=bytes[i%len]}}return this};Buffer.prototype.toArrayBuffer=function(){if(typeof Uint8Array!=="undefined"){if(Buffer.TYPED_ARRAY_SUPPORT){return new Buffer(this).buffer}else{var buf=new Uint8Array(this.length);for(var i=0,len=buf.length;i<len;i+=1){buf[i]=this[i]}return buf.buffer}}else{throw new TypeError("Buffer.toArrayBuffer not supported in this browser")}};var BP=Buffer.prototype;Buffer._augment=function(arr){arr.constructor=Buffer;arr._isBuffer=true;arr._get=arr.get;arr._set=arr.set;arr.get=BP.get;arr.set=BP.set;arr.write=BP.write;arr.toString=BP.toString;arr.toLocaleString=BP.toString;arr.toJSON=BP.toJSON;arr.equals=BP.equals;arr.compare=BP.compare;arr.copy=BP.copy;arr.slice=BP.slice;arr.readUInt8=BP.readUInt8;arr.readUInt16LE=BP.readUInt16LE;arr.readUInt16BE=BP.readUInt16BE;arr.readUInt32LE=BP.readUInt32LE;arr.readUInt32BE=BP.readUInt32BE;arr.readInt8=BP.readInt8;arr.readInt16LE=BP.readInt16LE;arr.readInt16BE=BP.readInt16BE;arr.readInt32LE=BP.readInt32LE;arr.readInt32BE=BP.readInt32BE;arr.readFloatLE=BP.readFloatLE;arr.readFloatBE=BP.readFloatBE;arr.readDoubleLE=BP.readDoubleLE;arr.readDoubleBE=BP.readDoubleBE;arr.writeUInt8=BP.writeUInt8;arr.writeUInt16LE=BP.writeUInt16LE;arr.writeUInt16BE=BP.writeUInt16BE;arr.writeUInt32LE=BP.writeUInt32LE;arr.writeUInt32BE=BP.writeUInt32BE;arr.writeInt8=BP.writeInt8;arr.writeInt16LE=BP.writeInt16LE;arr.writeInt16BE=BP.writeInt16BE;arr.writeInt32LE=BP.writeInt32LE;arr.writeInt32BE=BP.writeInt32BE;arr.writeFloatLE=BP.writeFloatLE;arr.writeFloatBE=BP.writeFloatBE;arr.writeDoubleLE=BP.writeDoubleLE;arr.writeDoubleBE=BP.writeDoubleBE;arr.fill=BP.fill;arr.inspect=BP.inspect;arr.toArrayBuffer=BP.toArrayBuffer;return arr};var INVALID_BASE64_RE=/[^+\/0-9A-z]/g;function base64clean(str){str=stringtrim(str).replace(INVALID_BASE64_RE,"");while(str.length%4!==0){str=str+"="}return str}function stringtrim(str){if(str.trim)return str.trim();return str.replace(/^\s+|\s+$/g,"")}function isArrayish(subject){return isArray(subject)||Buffer.isBuffer(subject)||subject&&typeof subject==="object"&&typeof subject.length==="number"}function toHex(n){if(n<16)return"0"+n.toString(16);return n.toString(16)}function utf8ToBytes(str){var byteArray=[];for(var i=0;i<str.length;i++){var b=str.charCodeAt(i);if(b<=127){byteArray.push(b)}else{var start=i;if(b>=55296&&b<=57343)i++;var h=encodeURIComponent(str.slice(start,i+1)).substr(1).split("%");for(var j=0;j<h.length;j++){byteArray.push(parseInt(h[j],16))}}}return byteArray}function asciiToBytes(str){var byteArray=[];for(var i=0;i<str.length;i++){byteArray.push(str.charCodeAt(i)&255)}return byteArray}function utf16leToBytes(str){var c,hi,lo;var byteArray=[];for(var i=0;i<str.length;i++){c=str.charCodeAt(i);hi=c>>8;lo=c%256;byteArray.push(lo);byteArray.push(hi)}return byteArray}function base64ToBytes(str){return base64.toByteArray(str)}function blitBuffer(src,dst,offset,length,unitSize){if(unitSize)length-=length%unitSize;for(var i=0;i<length;i++){if(i+offset>=dst.length||i>=src.length)break;dst[i+offset]=src[i]}return i}function decodeUtf8Char(str){try{return decodeURIComponent(str)}catch(err){return String.fromCharCode(65533)}}},{"base64-js":21,ieee754:22,"is-array":23}],21:[function(require,module,exports){var lookup="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";(function(exports){"use strict";var Arr=typeof Uint8Array!=="undefined"?Uint8Array:Array;var PLUS="+".charCodeAt(0);var SLASH="/".charCodeAt(0);var NUMBER="0".charCodeAt(0);var LOWER="a".charCodeAt(0);var UPPER="A".charCodeAt(0);function decode(elt){var code=elt.charCodeAt(0);if(code===PLUS)return 62;if(code===SLASH)return 63;if(code<NUMBER)return-1;if(code<NUMBER+10)return code-NUMBER+26+26;if(code<UPPER+26)return code-UPPER;if(code<LOWER+26)return code-LOWER+26}function b64ToByteArray(b64){var i,j,l,tmp,placeHolders,arr;if(b64.length%4>0){throw new Error("Invalid string. Length must be a multiple of 4")}var len=b64.length;placeHolders="="===b64.charAt(len-2)?2:"="===b64.charAt(len-1)?1:0;arr=new Arr(b64.length*3/4-placeHolders);l=placeHolders>0?b64.length-4:b64.length;var L=0;function push(v){arr[L++]=v}for(i=0,j=0;i<l;i+=4,j+=3){tmp=decode(b64.charAt(i))<<18|decode(b64.charAt(i+1))<<12|decode(b64.charAt(i+2))<<6|decode(b64.charAt(i+3));push((tmp&16711680)>>16);push((tmp&65280)>>8);push(tmp&255)}if(placeHolders===2){tmp=decode(b64.charAt(i))<<2|decode(b64.charAt(i+1))>>4;push(tmp&255)}else if(placeHolders===1){tmp=decode(b64.charAt(i))<<10|decode(b64.charAt(i+1))<<4|decode(b64.charAt(i+2))>>2;push(tmp>>8&255);push(tmp&255)}return arr}function uint8ToBase64(uint8){var i,extraBytes=uint8.length%3,output="",temp,length;function encode(num){return lookup.charAt(num)}function tripletToBase64(num){return encode(num>>18&63)+encode(num>>12&63)+encode(num>>6&63)+encode(num&63)}for(i=0,length=uint8.length-extraBytes;i<length;i+=3){temp=(uint8[i]<<16)+(uint8[i+1]<<8)+uint8[i+2];output+=tripletToBase64(temp)}switch(extraBytes){case 1:temp=uint8[uint8.length-1];output+=encode(temp>>2);output+=encode(temp<<4&63);output+="==";break;case 2:temp=(uint8[uint8.length-2]<<8)+uint8[uint8.length-1];output+=encode(temp>>10);output+=encode(temp>>4&63);output+=encode(temp<<2&63);output+="=";break}return output}exports.toByteArray=b64ToByteArray;exports.fromByteArray=uint8ToBase64})(typeof exports==="undefined"?this.base64js={}:exports)},{}],22:[function(require,module,exports){exports.read=function(buffer,offset,isLE,mLen,nBytes){var e,m,eLen=nBytes*8-mLen-1,eMax=(1<<eLen)-1,eBias=eMax>>1,nBits=-7,i=isLE?nBytes-1:0,d=isLE?-1:1,s=buffer[offset+i];i+=d;e=s&(1<<-nBits)-1;s>>=-nBits;nBits+=eLen;for(;nBits>0;e=e*256+buffer[offset+i],i+=d,nBits-=8);m=e&(1<<-nBits)-1;e>>=-nBits;nBits+=mLen;for(;nBits>0;m=m*256+buffer[offset+i],i+=d,nBits-=8);if(e===0){e=1-eBias}else if(e===eMax){return m?NaN:(s?-1:1)*Infinity}else{m=m+Math.pow(2,mLen);e=e-eBias}return(s?-1:1)*m*Math.pow(2,e-mLen)};exports.write=function(buffer,value,offset,isLE,mLen,nBytes){var e,m,c,eLen=nBytes*8-mLen-1,eMax=(1<<eLen)-1,eBias=eMax>>1,rt=mLen===23?Math.pow(2,-24)-Math.pow(2,-77):0,i=isLE?0:nBytes-1,d=isLE?1:-1,s=value<0||value===0&&1/value<0?1:0;value=Math.abs(value);if(isNaN(value)||value===Infinity){m=isNaN(value)?1:0;e=eMax}else{e=Math.floor(Math.log(value)/Math.LN2);if(value*(c=Math.pow(2,-e))<1){e--;c*=2}if(e+eBias>=1){value+=rt/c}else{value+=rt*Math.pow(2,1-eBias)}if(value*c>=2){e++;c/=2}if(e+eBias>=eMax){m=0;e=eMax}else if(e+eBias>=1){m=(value*c-1)*Math.pow(2,mLen);e=e+eBias}else{m=value*Math.pow(2,eBias-1)*Math.pow(2,mLen);e=0}}for(;mLen>=8;buffer[offset+i]=m&255,i+=d,m/=256,mLen-=8);e=e<<mLen|m;eLen+=mLen;for(;eLen>0;buffer[offset+i]=e&255,i+=d,e/=256,eLen-=8);buffer[offset+i-d]|=s*128}},{}],23:[function(require,module,exports){var isArray=Array.isArray;var str=Object.prototype.toString;module.exports=isArray||function(val){return!!val&&"[object Array]"==str.call(val)}},{}],24:[function(require,module,exports){var isGL=require("is-webgl-context");var getGL=require("webgl-context");var debounce=require("debounce");var addEvent=require("add-event-listener");function isCanvasContext(obj){var ctx2d=typeof CanvasRenderingContext2D!=="undefined"&&obj instanceof CanvasRenderingContext2D;return obj&&(ctx2d||isGL(obj))}function CanvasApp(render,options){if(!(this instanceof CanvasApp))return new CanvasApp(render,options);if(typeof render==="object"&&render){options=render;render=null}render=typeof render==="function"?render:options.onRender;options=options||{};options.retina=typeof options.retina==="boolean"?options.retina:true;var hasWidth=typeof options.width==="number",hasHeight=typeof options.height==="number";if(hasWidth||hasHeight)options.ignoreResize=true;options.width=hasWidth?options.width:window.innerWidth;options.height=hasHeight?options.height:window.innerHeight;var DPR=options.retina?window.devicePixelRatio||1:1;var canvas,context,attribs=options.contextAttributes||{};this.isWebGL=false;if(isCanvasContext(options.context)){context=options.context;canvas=context.canvas}if(!canvas)canvas=options.canvas||document.createElement("canvas");canvas.width=options.width*DPR;canvas.height=options.height*DPR;if(!context){if(options.context==="webgl"||options.context==="experimental-webgl"){context=getGL({canvas:canvas,attributes:attribs});if(!context){throw"WebGL Context Not Supported -- try enabling it or using a different browser"}}else{context=canvas.getContext(options.context||"2d",attribs)}}this.isWebGL=isGL(context);if(options.retina){canvas.style.width=options.width+"px";canvas.style.height=options.height+"px"}this.running=false;this.width=options.width;this.height=options.height;this.canvas=canvas;this.context=context;this.onResize=options.onResize;this._DPR=DPR;this._retina=options.retina;this._once=options.once;this._ignoreResize=options.ignoreResize;this._lastFrame=null;this._then=Date.now();this.maxDeltaTime=typeof options.maxDeltaTime==="number"?options.maxDeltaTime:1e3/24;this.fps=60;this._frames=0;this._prevTime=this._then;if(!this._ignoreResize){options.resizeDebounce=typeof options.resizeDebounce==="number"?options.resizeDebounce:50;addEvent(window,"resize",debounce(function(){this.resize(window.innerWidth,window.innerHeight)}.bind(this),options.resizeDebounce,false));addEvent(window,"orientationchange",function(){this.resize(window.innerWidth,window.innerHeight)}.bind(this))}if(typeof render==="function"){this.onRender=render.bind(this)}else{this.onRender=function(context,width,height,dt){}}this.renderOnce=function(){var now=Date.now();var dt=Math.min(this.maxDeltaTime,now-this._then);this._frames++;if(now>this._prevTime+1e3){this.fps=Math.round(this._frames*1e3/(now-this._prevTime));this._prevTime=now;this._frames=0}if(!this.isWebGL){this.context.save();this.context.scale(this._DPR,this._DPR)}else{this.context.viewport(0,0,this.width*this._DPR,this.height*this._DPR)}this.onRender(this.context,this.width,this.height,dt);if(!this.isWebGL)this.context.restore();this._then=now};this._renderHandler=function(){if(!this.running)return;if(!this._once){this._lastFrame=requestAnimationFrame(this._renderHandler)}this.renderOnce()}.bind(this);if(typeof options.onReady==="function"){options.onReady.call(this,context,this.width,this.height)}}Object.defineProperty(CanvasApp.prototype,"retinaEnabled",{set:function(v){this._retina=v;this._DPR=this._retina?window.devicePixelRatio||1:1;this.resize(this.width,this.height)},get:function(){return this._retina}});Object.defineProperty(CanvasApp.prototype,"deviceWidth",{get:function(){return this.width*this._DPR}});Object.defineProperty(CanvasApp.prototype,"deviceHeight",{get:function(){return this.height*this._DPR}});CanvasApp.prototype.resetFPS=function(){this._frames=0;this._prevTime=Date.now();this._then=this._prevTime;this.fps=60};CanvasApp.prototype.start=function(){if(this.running)return;if(this._lastFrame)cancelAnimationFrame(this._lastFrame);this.resetFPS();this.running=true;this._lastFrame=requestAnimationFrame(this._renderHandler)};CanvasApp.prototype.stop=function(){if(this._lastFrame){cancelAnimationFrame(this._lastFrame);this._lastFrame=null}this.running=false};CanvasApp.prototype.resize=function(width,height){var canvas=this.canvas;this.width=width;this.height=height;canvas.width=this.width*this._DPR;canvas.height=this.height*this._DPR;if(this._retina){canvas.style.width=this.width+"px";canvas.style.height=this.height+"px"}if(this._once)requestAnimationFrame(this._renderHandler);if(typeof this.onResize==="function")this.onResize(this.width,this.height)};module.exports=CanvasApp},{"add-event-listener":25,debounce:26,"is-webgl-context":28,"webgl-context":29}],25:[function(require,module,exports){addEventListener.removeEventListener=removeEventListener;addEventListener.addEventListener=addEventListener;module.exports=addEventListener;var Events=null;function addEventListener(el,eventName,listener,useCapture){Events=Events||(document.addEventListener?{add:stdAttach,rm:stdDetach}:{add:oldIEAttach,rm:oldIEDetach});return Events.add(el,eventName,listener,useCapture)}function removeEventListener(el,eventName,listener,useCapture){Events=Events||(document.addEventListener?{add:stdAttach,rm:stdDetach}:{add:oldIEAttach,rm:oldIEDetach});return Events.rm(el,eventName,listener,useCapture)}function stdAttach(el,eventName,listener,useCapture){el.addEventListener(eventName,listener,useCapture)}function stdDetach(el,eventName,listener,useCapture){el.removeEventListener(eventName,listener,useCapture)}function oldIEAttach(el,eventName,listener,useCapture){if(useCapture){throw new Error("cannot useCapture in oldIE")}el.attachEvent("on"+eventName,listener)}function oldIEDetach(el,eventName,listener,useCapture){el.detachEvent("on"+eventName,listener)}},{}],26:[function(require,module,exports){var now=require("date-now");module.exports=function debounce(func,wait,immediate){var timeout,args,context,timestamp,result;if(null==wait)wait=100;function later(){var last=now()-timestamp;if(last<wait&&last>0){timeout=setTimeout(later,wait-last)}else{timeout=null;if(!immediate){result=func.apply(context,args);if(!timeout)context=args=null}}}return function debounced(){context=this;args=arguments;timestamp=now();var callNow=immediate&&!timeout;if(!timeout)timeout=setTimeout(later,wait);if(callNow){result=func.apply(context,args);context=args=null}return result}}},{"date-now":27}],27:[function(require,module,exports){module.exports=Date.now||now;function now(){return(new Date).getTime()}},{}],28:[function(require,module,exports){module.exports=function(ctx){if(!ctx)return false;var gl=ctx;if(typeof ctx.rawgl!=="undefined")gl=ctx.rawgl;if(typeof WebGLRenderingContext!=="undefined"&&gl instanceof WebGLRenderingContext)return true;return false}},{}],29:[function(require,module,exports){module.exports=function(opts){opts=opts||{};var canvas=opts.canvas||document.createElement("canvas");if(typeof opts.width==="number")canvas.width=opts.width;if(typeof opts.height==="number")canvas.height=opts.height;var attribs=opts.attributes||opts.attribs||{};try{gl=canvas.getContext("webgl",attribs)||canvas.getContext("experimental-webgl",attribs)}catch(e){gl=null}return gl}},{}],30:[function(require,module,exports){module.exports=clamp;function clamp(value,min,max){return min<max?value<min?min:value>max?max:value:value<max?max:value>min?min:value}},{}],31:[function(require,module,exports){"use strict";function dupe_array(count,value,i){var c=count[i]|0;if(c<=0){return[]}var result=new Array(c),j;if(i===count.length-1){for(j=0;j<c;++j){result[j]=value}}else{for(j=0;j<c;++j){result[j]=dupe_array(count,value,i+1)}}return result}function dupe_number(count,value){var result,i;result=new Array(count);for(i=0;i<count;++i){result[i]=value}return result}function dupe(count,value){if(typeof value==="undefined"){value=0}switch(typeof count){case"number":if(count>0){return dupe_number(count|0,value)}break;case"object":if(typeof count.length==="number"){return dupe_array(count,value,0)}break}return[]}module.exports=dupe},{}],32:[function(require,module,exports){module.exports=create;function create(){var out=new Float32Array(16);out[0]=1;out[1]=0;out[2]=0;out[3]=0;out[4]=0;out[5]=1;out[6]=0;out[7]=0;out[8]=0;out[9]=0;out[10]=1;out[11]=0;out[12]=0;out[13]=0;out[14]=0;out[15]=1;return out}},{}],33:[function(require,module,exports){module.exports=identity;function identity(out){out[0]=1;out[1]=0;out[2]=0;out[3]=0;out[4]=0;out[5]=1;out[6]=0;out[7]=0;out[8]=0;out[9]=0;out[10]=1;out[11]=0;out[12]=0;out[13]=0;out[14]=0;out[15]=1;return out}},{}],34:[function(require,module,exports){module.exports=multiply;function multiply(out,a,b){var a00=a[0],a01=a[1],a02=a[2],a03=a[3],a10=a[4],a11=a[5],a12=a[6],a13=a[7],a20=a[8],a21=a[9],a22=a[10],a23=a[11],a30=a[12],a31=a[13],a32=a[14],a33=a[15];var b0=b[0],b1=b[1],b2=b[2],b3=b[3];out[0]=b0*a00+b1*a10+b2*a20+b3*a30;out[1]=b0*a01+b1*a11+b2*a21+b3*a31;out[2]=b0*a02+b1*a12+b2*a22+b3*a32;out[3]=b0*a03+b1*a13+b2*a23+b3*a33;b0=b[4];b1=b[5];b2=b[6];b3=b[7];out[4]=b0*a00+b1*a10+b2*a20+b3*a30;out[5]=b0*a01+b1*a11+b2*a21+b3*a31;out[6]=b0*a02+b1*a12+b2*a22+b3*a32;out[7]=b0*a03+b1*a13+b2*a23+b3*a33;b0=b[8];b1=b[9];b2=b[10];b3=b[11];out[8]=b0*a00+b1*a10+b2*a20+b3*a30;out[9]=b0*a01+b1*a11+b2*a21+b3*a31;out[10]=b0*a02+b1*a12+b2*a22+b3*a32;out[11]=b0*a03+b1*a13+b2*a23+b3*a33;b0=b[12];b1=b[13];b2=b[14];b3=b[15];out[12]=b0*a00+b1*a10+b2*a20+b3*a30;out[13]=b0*a01+b1*a11+b2*a21+b3*a31;out[14]=b0*a02+b1*a12+b2*a22+b3*a32;out[15]=b0*a03+b1*a13+b2*a23+b3*a33;return out}},{}],35:[function(require,module,exports){module.exports=scale;function scale(out,a,v){var x=v[0],y=v[1],z=v[2];out[0]=a[0]*x;out[1]=a[1]*x;out[2]=a[2]*x;out[3]=a[3]*x;out[4]=a[4]*y;out[5]=a[5]*y;out[6]=a[6]*y;out[7]=a[7]*y;out[8]=a[8]*z;out[9]=a[9]*z;out[10]=a[10]*z;out[11]=a[11]*z;out[12]=a[12];out[13]=a[13];out[14]=a[14];out[15]=a[15];return out}},{}],36:[function(require,module,exports){module.exports=translate;function translate(out,a,v){var x=v[0],y=v[1],z=v[2],a00,a01,a02,a03,a10,a11,a12,a13,a20,a21,a22,a23;if(a===out){out[12]=a[0]*x+a[4]*y+a[8]*z+a[12];out[13]=a[1]*x+a[5]*y+a[9]*z+a[13];out[14]=a[2]*x+a[6]*y+a[10]*z+a[14];out[15]=a[3]*x+a[7]*y+a[11]*z+a[15]}else{a00=a[0];a01=a[1];a02=a[2];a03=a[3];a10=a[4];a11=a[5];a12=a[6];a13=a[7];a20=a[8];a21=a[9];a22=a[10];a23=a[11];out[0]=a00;out[1]=a01;out[2]=a02;out[3]=a03;out[4]=a10;out[5]=a11;out[6]=a12;out[7]=a13;out[8]=a20;out[9]=a21;out[10]=a22;out[11]=a23;out[12]=a00*x+a10*y+a20*z+a[12];out[13]=a01*x+a11*y+a21*z+a[13];out[14]=a02*x+a12*y+a22*z+a[14];out[15]=a03*x+a13*y+a23*z+a[15]}return out}},{}],37:[function(require,module,exports){"use strict";module.exports=createAttributeWrapper;function ShaderAttribute(gl,program,location,dimension,name,constFunc,relink){this._gl=gl;this._program=program;this._location=location;this._dimension=dimension;this._name=name;this._constFunc=constFunc;this._relink=relink}var proto=ShaderAttribute.prototype;proto.pointer=function setAttribPointer(type,normalized,stride,offset){var gl=this._gl;gl.vertexAttribPointer(this._location,this._dimension,type||gl.FLOAT,!!normalized,stride||0,offset||0);this._gl.enableVertexAttribArray(this._location)};Object.defineProperty(proto,"location",{get:function(){return this._location},set:function(v){if(v!==this._location){this._location=v;this._gl.bindAttribLocation(this._program,v,this._name);this._gl.linkProgram(this._program);this._relink()}}});function addVectorAttribute(gl,program,location,dimension,obj,name,doLink){var constFuncArgs=["gl","v"];var varNames=[];for(var i=0;i<dimension;++i){constFuncArgs.push("x"+i);varNames.push("x"+i)}constFuncArgs.push(["if(x0.length===void 0){return gl.vertexAttrib",dimension,"f(v,",varNames.join(),")}else{return gl.vertexAttrib",dimension,"fv(v,x0)}"].join(""));var constFunc=Function.apply(undefined,constFuncArgs);var attr=new ShaderAttribute(gl,program,location,dimension,name,constFunc,doLink);
Object.defineProperty(obj,name,{set:function(x){gl.disableVertexAttribArray(attr._location);constFunc(gl,attr._location,x);return x},get:function(){return attr},enumerable:true})}function createAttributeWrapper(gl,program,attributes,doLink){var obj={};for(var i=0,n=attributes.length;i<n;++i){var a=attributes[i];var name=a.name;var type=a.type;var location=gl.getAttribLocation(program,name);switch(type){case"bool":case"int":case"float":addVectorAttribute(gl,program,location,1,obj,name,doLink);break;default:if(type.indexOf("vec")>=0){var d=type.charCodeAt(type.length-1)-48;if(d<2||d>4){throw new Error("gl-shader: Invalid data type for attribute "+name+": "+type)}addVectorAttribute(gl,program,location,d,obj,name,doLink)}else{throw new Error("gl-shader: Unknown data type for attribute "+name+": "+type)}break}}return obj}},{}],38:[function(require,module,exports){"use strict";var dup=require("dup");var coallesceUniforms=require("./reflect");module.exports=createUniformWrapper;function identity(x){var c=new Function("y","return function(){return y}");return c(x)}function createUniformWrapper(gl,program,uniforms,locations){function makeGetter(index){var proc=new Function("gl","prog","locations","return function(){return gl.getUniform(prog,locations["+index+"])}");return proc(gl,program,locations)}function makePropSetter(path,index,type){switch(type){case"bool":case"int":case"sampler2D":case"samplerCube":return"gl.uniform1i(locations["+index+"],obj"+path+")";case"float":return"gl.uniform1f(locations["+index+"],obj"+path+")";default:var vidx=type.indexOf("vec");if(0<=vidx&&vidx<=1&&type.length===4+vidx){var d=type.charCodeAt(type.length-1)-48;if(d<2||d>4){throw new Error("gl-shader: Invalid data type")}switch(type.charAt(0)){case"b":case"i":return"gl.uniform"+d+"iv(locations["+index+"],obj"+path+")";case"v":return"gl.uniform"+d+"fv(locations["+index+"],obj"+path+")";default:throw new Error("gl-shader: Unrecognized data type for vector "+name+": "+type)}}else if(type.indexOf("mat")===0&&type.length===4){var d=type.charCodeAt(type.length-1)-48;if(d<2||d>4){throw new Error("gl-shader: Invalid uniform dimension type for matrix "+name+": "+type)}return"gl.uniformMatrix"+d+"fv(locations["+index+"],false,obj"+path+")"}else{throw new Error("gl-shader: Unknown uniform data type for "+name+": "+type)}break}}function enumerateIndices(prefix,type){if(typeof type!=="object"){return[[prefix,type]]}var indices=[];for(var id in type){var prop=type[id];var tprefix=prefix;if(parseInt(id)+""===id){tprefix+="["+id+"]"}else{tprefix+="."+id}if(typeof prop==="object"){indices.push.apply(indices,enumerateIndices(tprefix,prop))}else{indices.push([tprefix,prop])}}return indices}function makeSetter(type){var code=["return function updateProperty(obj){"];var indices=enumerateIndices("",type);for(var i=0;i<indices.length;++i){var item=indices[i];var path=item[0];var idx=item[1];if(locations[idx]){code.push(makePropSetter(path,idx,uniforms[idx].type))}}code.push("return obj}");var proc=new Function("gl","prog","locations",code.join("\n"));return proc(gl,program,locations)}function defaultValue(type){switch(type){case"bool":return false;case"int":case"sampler2D":case"samplerCube":return 0;case"float":return 0;default:var vidx=type.indexOf("vec");if(0<=vidx&&vidx<=1&&type.length===4+vidx){var d=type.charCodeAt(type.length-1)-48;if(d<2||d>4){throw new Error("gl-shader: Invalid data type")}if(type.charAt(0)==="b"){return dup(d,false)}return dup(d)}else if(type.indexOf("mat")===0&&type.length===4){var d=type.charCodeAt(type.length-1)-48;if(d<2||d>4){throw new Error("gl-shader: Invalid uniform dimension type for matrix "+name+": "+type)}return dup([d,d])}else{throw new Error("gl-shader: Unknown uniform data type for "+name+": "+type)}break}}function storeProperty(obj,prop,type){if(typeof type==="object"){var child=processObject(type);Object.defineProperty(obj,prop,{get:identity(child),set:makeSetter(type),enumerable:true,configurable:false})}else{if(locations[type]){Object.defineProperty(obj,prop,{get:makeGetter(type),set:makeSetter(type),enumerable:true,configurable:false})}else{obj[prop]=defaultValue(uniforms[type].type)}}}function processObject(obj){var result;if(Array.isArray(obj)){result=new Array(obj.length);for(var i=0;i<obj.length;++i){storeProperty(result,i,obj[i])}}else{result={};for(var id in obj){storeProperty(result,id,obj[id])}}return result}var coallesced=coallesceUniforms(uniforms,true);return{get:identity(processObject(coallesced)),set:makeSetter(coallesced),enumerable:true,configurable:true}}},{"./reflect":39,dup:31}],39:[function(require,module,exports){"use strict";module.exports=makeReflectTypes;function makeReflectTypes(uniforms,useIndex){var obj={};for(var i=0;i<uniforms.length;++i){var n=uniforms[i].name;var parts=n.split(".");var o=obj;for(var j=0;j<parts.length;++j){var x=parts[j].split("[");if(x.length>1){if(!(x[0]in o)){o[x[0]]=[]}o=o[x[0]];for(var k=1;k<x.length;++k){var y=parseInt(x[k]);if(k<x.length-1||j<parts.length-1){if(!(y in o)){if(k<x.length-1){o[y]=[]}else{o[y]={}}}o=o[y]}else{if(useIndex){o[y]=i}else{o[y]=uniforms[i].type}}}}else if(j<parts.length-1){if(!(x[0]in o)){o[x[0]]={}}o=o[x[0]]}else{if(useIndex){o[x[0]]=i}else{o[x[0]]=uniforms[i].type}}}}return obj}},{}],40:[function(require,module,exports){"use strict";var createUniformWrapper=require("./lib/create-uniforms");var createAttributeWrapper=require("./lib/create-attributes");var makeReflect=require("./lib/reflect");function Shader(gl,prog,vertShader,fragShader){this.gl=gl;this.handle=prog;this.attributes=null;this.uniforms=null;this.types=null;this.vertexShader=vertShader;this.fragmentShader=fragShader}Shader.prototype.bind=function(){this.gl.useProgram(this.handle)};Shader.prototype.dispose=function(){var gl=this.gl;gl.deleteShader(this.vertexShader);gl.deleteShader(this.fragmentShader);gl.deleteProgram(this.handle)};Shader.prototype.updateExports=function(uniforms,attributes){var locations=new Array(uniforms.length);var program=this.handle;var gl=this.gl;var doLink=relinkUniforms.bind(void 0,gl,program,locations,uniforms);doLink();this.types={uniforms:makeReflect(uniforms),attributes:makeReflect(attributes)};this.attributes=createAttributeWrapper(gl,program,attributes,doLink);Object.defineProperty(this,"uniforms",createUniformWrapper(gl,program,uniforms,locations))};function relinkUniforms(gl,program,locations,uniforms){for(var i=0;i<uniforms.length;++i){locations[i]=gl.getUniformLocation(program,uniforms[i].name)}}function createShader(gl,vertSource,fragSource,uniforms,attributes){var vertShader=gl.createShader(gl.VERTEX_SHADER);gl.shaderSource(vertShader,vertSource);gl.compileShader(vertShader);if(!gl.getShaderParameter(vertShader,gl.COMPILE_STATUS)){var errLog=gl.getShaderInfoLog(vertShader);console.error("gl-shader: Error compling vertex shader:",errLog);throw new Error("gl-shader: Error compiling vertex shader:"+errLog)}var fragShader=gl.createShader(gl.FRAGMENT_SHADER);gl.shaderSource(fragShader,fragSource);gl.compileShader(fragShader);if(!gl.getShaderParameter(fragShader,gl.COMPILE_STATUS)){var errLog=gl.getShaderInfoLog(fragShader);console.error("gl-shader: Error compiling fragment shader:",errLog);throw new Error("gl-shader: Error compiling fragment shader:"+errLog)}var program=gl.createProgram();gl.attachShader(program,fragShader);gl.attachShader(program,vertShader);attributes.forEach(function(a){if(typeof a.location==="number")gl.bindAttribLocation(program,a.location,a.name)});gl.linkProgram(program);if(!gl.getProgramParameter(program,gl.LINK_STATUS)){var errLog=gl.getProgramInfoLog(program);console.error("gl-shader: Error linking shader program:",errLog);throw new Error("gl-shader: Error linking shader program:"+errLog)}var shader=new Shader(gl,program,vertShader,fragShader);shader.updateExports(uniforms,attributes);return shader}module.exports=createShader},{"./lib/create-attributes":37,"./lib/create-uniforms":38,"./lib/reflect":39}],41:[function(require,module,exports){var Base=require("fontpath-simple-renderer");var inherits=require("inherits");var bmfont2fontpath=require("fontpath-bmfont");var texcoord=require("texcoord");var xtend=require("xtend");var createTexture=require("gl-texture2d");var Batch=require("gl-sprite-batch");var tmpPos=[0,0],tmpShape=[0,0],tmp1=[0,0],tmp2=[0,0];var DEFAULT_TEXCOORD=[0,0,1,1];var maxInitialCapacity=500;function texcoordGlyph(glyph,atlas,out){tmp1[0]=glyph.x;tmp1[1]=glyph.y;tmp2[0]=glyph.width;tmp2[1]=glyph.height;return texcoord(tmp1,tmp2,atlas,out)}function TextRenderer(gl,opt){if(!(this instanceof TextRenderer))return new TextRenderer(gl,opt);opt=opt||{};if(!opt.font)throw new Error("must specify bmfont at creation time");if(!opt.textures&&Array.isArray(opt.font.images)){opt.textures=opt.font.images.map(function(img){return createTexture(gl,img)})}opt.font=bmfont2fontpath(opt.font);Base.call(this,opt);this.textures=opt.textures||[];this.gl=gl;if(!gl)throw new Error("must specify gl context");if(typeof opt.dynamic!=="boolean")opt.dynamic=true;var batch=opt.batch;if(!batch)this.defaultBatch=Batch(gl,opt);this.batch=batch||this.defaultBatch;if(typeof opt.wrapWidth!=="number")this.layout()}inherits(TextRenderer,Base);TextRenderer.prototype.dispose=function(textures){if(this.defaultBatch)this.defaultBatch.dispose();if(textures){this.textures.forEach(function(t){if(typeof t.dispose==="function")t.dispose()})}return this};TextRenderer.prototype.uncache=function(){this._cache=false;this.batch.clear();return this};TextRenderer.prototype.cache=function(x,y,start,end){this._cache=true;this.batch.ensureCapacity(this.text.length);this.batch.clear();this._build(x,y,start,end);return this};TextRenderer.prototype.draw=function(shader,x,y,start,end){var batch=this.batch;batch.bind(shader);if(!this._cache){batch.clear();this._build(x,y,start,end)}batch.draw();batch.unbind();return this};TextRenderer.prototype._build=function(x,y,start,end){var result=this.render(x,y,start,end);var batch=this.batch;var i=0;if(!this._cache){batch.texcoord=DEFAULT_TEXCOORD;batch.texture=null;for(i=0;i<result.underlines.length;i++){var underline=result.underlines[i];batch.position=underline.position;batch.shape=underline.size;batch.push()}}for(i=0;i<result.glyphs.length;i++){var g=result.glyphs[i];this._drawGlyph(batch,g)}};TextRenderer.prototype._drawGlyph=function(batch,data){var glyph=data.glyph;var img=this.textures[glyph.page];tmpPos[0]=data.position[0]+glyph.hbx;tmpPos[1]=data.position[1]+glyph.hby-this.font.descender;tmpShape[0]=glyph.width*data.scale[0];tmpShape[1]=glyph.height*data.scale[1];batch.texture=img;texcoordGlyph(glyph,img&&img.shape,batch.texcoord);batch.position=tmpPos;batch.shape=tmpShape;batch.push()};module.exports=TextRenderer},{"fontpath-bmfont":42,"fontpath-simple-renderer":43,"gl-sprite-batch":49,"gl-texture2d":58,inherits:64,texcoord:57,xtend:100}],42:[function(require,module,exports){function glyph(data){return{page:data.page,hbx:data.xoffset,hby:data.yoffset,width:data.width,height:data.height,xoff:data.xadvance,x:data.x,y:data.y}}function glyphs(chars){var out={};chars.forEach(function(c){out[String.fromCharCode(c.id)]=glyph(c)});return out}module.exports=function(bmfont){return{pages:bmfont.pages,resolution:72,size:bmfont.info.size,units_per_EM:1,bitmap:true,family_name:bmfont.info.face,height:bmfont.common.lineHeight,descender:bmfont.common.base,ascender:bmfont.common.base,glyphs:glyphs(bmfont.chars),kerning:bmfont.kernings.map(function(k){return[String.fromCharCode(k.first),String.fromCharCode(k.second),k.amount]})}}},{}],43:[function(require,module,exports){var Base=require("fontpath-renderer");var inherits=require("inherits");function FontpathRenderer(options){if(!(this instanceof FontpathRenderer))return new FontpathRenderer(options);Base.call(this,options);this.data={glyphs:[],underlines:[]}}inherits(FontpathRenderer,Base);FontpathRenderer.prototype.renderGlyph=function(i,glyph,scale,x,y){this.data.glyphs.push(new Glyph(i,glyph,this.text.charCodeAt(i),[scale,this.font.bitmap?scale:-scale],[x,y]))};FontpathRenderer.prototype.renderUnderline=function(x,y,width,height){this.data.underlines.push(new Underline([x,y],[width,height]))};FontpathRenderer.prototype.render=function(x,y,start,end){this.data.glyphs.length=0;this.data.underlines.length=0;Base.prototype.render.call(this,x,y,start,end);return this.data};function Glyph(index,glyph,charCode,scale,position){this.glyph=glyph;this.index=index;this.charCode=charCode;this.position=position;this.scale=scale}function Underline(position,size){this.position=position;this.size=size}module.exports=FontpathRenderer},{"fontpath-renderer":44,inherits:64}],44:[function(require,module,exports){var GlyphIterator=require("fontpath-glyph-iterator");var WordWrap=require("fontpath-wordwrap");var tmpBounds={x:0,y:0,width:0,height:0,glyphs:0};function TextRenderer(options){if(!(this instanceof TextRenderer))return new TextRenderer(options);options=options||{};this.iterator=new GlyphIterator(options.font,options.fontSize);this.wordwrap=new WordWrap;this.align="left";this.underline=false;this.underlineThickness=undefined;this.underlinePosition=undefined;this._text="";if(typeof options.align==="string")this.align=options.align;if(typeof options.underline==="boolean")this.underline=options.underline;if(typeof options.underlineThickness==="number")this.underlineThickness=options.underlineThickness;if(typeof options.underlinePosition==="number")this.underlinePosition=options.underlinePosition;if(typeof options.text==="string")this.text=options.text;if(typeof options.lineHeight==="number")this.lineHeight=options.lineHeight;if(typeof options.letterSpacing==="number")this.letterSpacing=options.letterSpacing;if(typeof options.wrapMode==="string")this.wordwrap.mode=options.wrapMode;if(typeof options.wrapWidth==="number")this.layout(options.wrapWidth)}var LEFT_ALIGN=0,CENTER_ALIGN=1,RIGHT_ALIGN=2;var ALIGN_ARRAY=["left","center","right"];Object.defineProperties(TextRenderer.prototype,{font:{get:function(){return this.iterator.font},set:function(val){var oldFont=this.iterator.font;this.iterator.font=val;if(oldFont!==this.iterator.font)this.clearLayout()}},fontSize:{get:function(){return this.iterator.fontSize},set:function(val){var oldSize=this.iterator.fontSize;this.iterator.fontSize=val;if(oldSize!==this.iterator.fontSize)this.clearLayout()}},lineHeight:{get:function(){return this.iterator.lineHeight},set:function(val){this.iterator.lineHeight=val}},letterSpacing:{get:function(){return this.iterator.letterSpacing},set:function(val){this.iterator.letterSpacing=val}},text:{get:function(){return this._text},set:function(text){text=text||"";var old=this._text;this._text=text;this.wordwrap.text=this.text;if(this._text!==old)this.clearLayout()}}});TextRenderer.prototype.clearLayout=function(){this.wordwrap.text=this.text;this.wordwrap.empty();if(this.iterator.font)this.wordwrap.clearLayout(this.iterator)};TextRenderer.prototype.layout=function(wrapWidth){this.wordwrap.text=this.text;this.wordwrap.empty();this.wordwrap.layout(this.iterator,wrapWidth)};TextRenderer.prototype.renderGlyph=function(){};TextRenderer.prototype.renderUnderline=function(){};TextRenderer.prototype.getBounds=function(includeUnderline,out){if(!out)out={x:0,y:0,width:0,height:0};var wordwrapper=this.wordwrap;var itr=this.iterator;var firstLineHeight=0;if(wordwrapper.lines.length>0){var firstLine=wordwrapper.lines[0];itr.getBounds(this.text,firstLine.start,firstLine.end,undefined,tmpBounds);firstLineHeight=tmpBounds.height}out.width=wordwrapper.getMaxLineWidth();out.height=Math.max(0,wordwrapper.lines.length-1)*itr.getLineGap()+firstLineHeight;out.x=0;out.y=-out.height;if(includeUnderline){var underlineHeight=this.computeUnderlineHeight();var underlinePosition=this.computeUnderlinePosition();var underlineOff=underlinePosition+underlineHeight/2;out.height+=underlineOff}return out};TextRenderer.prototype.computeUnderlineHeight=function(){var font=this.font;var scale=this.iterator.fontScale;if(this.underlineThickness===0||this.underlineThickness){return this.underlineThickness}else if(font.underline_thickness){return font.underline_thickness*scale}else if(font.bitmap)return font.size/8;else return font.units_per_EM/8*scale};TextRenderer.prototype.computeUnderlinePosition=function(){var font=this.font;var scale=this.iterator.fontScale;if(this.underlinePosition===0||this.underlinePosition){return this.underlinePosition}else if(font.underline_position){return-font.underline_position*scale}else if(font.bitmap){return font.size/4}else{return font.units_per_EM/4*scale}};TextRenderer.prototype.getDescender=function(){return Math.abs(this.iterator.fontScale*this.iterator.font.descender)};TextRenderer.prototype.getAscender=function(){return Math.abs(this.iterator.fontScale*this.iterator.font.ascender)};TextRenderer.prototype.onBegin=function(){};TextRenderer.prototype.onEnd=function(){};TextRenderer.prototype.onBeginLine=function(lineIndex){};TextRenderer.prototype.onEndLine=function(lineIndex){};TextRenderer.prototype.render=function(x,y,start,end){x=x||0;y=y||0;var text=this.text;var wordwrapper=this.wordwrap;if(!text||wordwrapper.lines.length===0)return;start=start||0;end=typeof end==="number"?end:text.length;var itr=this.iterator;var scale=itr.fontScale;var font=itr.font;var underline=this.underline;var maxLineWidth=wordwrapper.getMaxLineWidth();y-=Math.max(0,wordwrapper.lines.length-1)*itr.getLineGap();var alignType=ALIGN_ARRAY.indexOf(this.align||"");if(alignType===-1)alignType=LEFT_ALIGN;var underlineX=0;var underlineStartX=0;var underlineY=0;var underlineWidth=0;var underlineStarted=false;var underlinePos=this.computeUnderlinePosition();var underlineHeight=this.computeUnderlineHeight();this.onBegin();itr.begin(x,y);for(var k=0;k<wordwrapper.lines.length;k++){var line=wordwrapper.lines[k];underlineStarted=false;var lastAdvance=0;var lineX=itr.pen.x;var lineY=itr.pen.y;this.onBeginLine(k);for(var i=line.start;i<line.end;i++){var chr=text.charAt(i);var glyph=itr.step(text,i);if(!glyph)continue;if(i>=start&&i<end){var tx=itr.pen.x;var ty=itr.pen.y;if(alignType===CENTER_ALIGN){tx+=(maxLineWidth-line.width)/2}else if(alignType===RIGHT_ALIGN){tx+=maxLineWidth-line.width}if(!underlineStarted){underlineX=tx;underlineStartX=tx;underlineY=ty+underlinePos;underlineWidth=0;underlineStarted=true}else{underlineWidth=tx-underlineStartX}this.renderGlyph(i,glyph,scale,tx,ty)}var newAdvance=itr.advance(glyph);if(i>=start&&i<end)lastAdvance=newAdvance}this.onEndLine(k);if(underline){underlineWidth+=lastAdvance;this.renderUnderline(underlineX,underlineY-underlineHeight/2,underlineWidth,underlineHeight)}if(k<wordwrapper.lines.length-1){itr.advanceLine()}}itr.end();this.onEnd()};module.exports=TextRenderer},{"fontpath-glyph-iterator":45,"fontpath-wordwrap":47}],45:[function(require,module,exports){var util=require("fontpath-util");var DEFAULT_TAB_WIDTH=4;function GlyphIterator(font,fontSize){this._fontSize=undefined;this._fontScale=undefined;this._font=undefined;this.fontScale=1;this.kerning=true;this.letterSpacing=0;this.lineHeight=undefined;this.fontSize=typeof fontSize==="number"?fontSize:font?font.size:undefined;this.font=font;this.tabWidth=DEFAULT_TAB_WIDTH;this._tabGlyph=null;this.origin={x:0,y:0};this.pen={x:0,y:0}}Object.defineProperty(GlyphIterator.prototype,"font",{get:function(){return this._font},set:function(font){this._font=font;if(font){this.fontScale=util.getPxScale(font,this.fontSize);this.tabWidth=this._tabWidth}}});Object.defineProperty(GlyphIterator.prototype,"tabWidth",{get:function(){return this._tabWidth},set:function(val){this._tabWidth=val===0||val?val:DEFAULT_TAB_WIDTH;this._tabGlyph={};var spaceGlyph=this.font?this.font.glyphs[" "]:null;if(spaceGlyph){this._tabGlyph={};for(var k in spaceGlyph){this._tabGlyph[k]=spaceGlyph[k]}if(this._tabGlyph.xoff)this._tabGlyph.xoff*=this._tabWidth}}});Object.defineProperty(GlyphIterator.prototype,"fontSize",{get:function(){if(typeof this._fontSize!=="number")return this.font.bitmap?this.font.size:util.pointToPixel(this.font.size);return this._fontSize},set:function(val){this._fontSize=val;if(this._font){this.fontScale=util.getPxScale(this._font,this._fontSize)}}});GlyphIterator.prototype.getKerning=function(left,right){var font=this.font;if(!font||!font.kerning)return 0;var table=this.kerningTable;for(var i=0;i<font.kerning.length;i++){var k=font.kerning[i];if(k[0]===left&&k[1]===right)return k[2]}return 0};GlyphIterator.prototype.begin=function(x,y){this.origin.x=x||0;this.origin.y=y||0;this.pen.x=this.origin.x;this.pen.y=this.origin.y};GlyphIterator.prototype.end=function(){};GlyphIterator.prototype.getLineGap=function(){var font=this.font,scale=this.fontScale;var gap=(font.height-font.ascender+Math.abs(font.descender))*scale;var lineHeight=this.lineHeight;lineHeight=lineHeight===0||lineHeight?lineHeight+gap:this.fontSize;return lineHeight};GlyphIterator.prototype.translate=function(x,y){this.origin.x+=x||0;this.origin.y+=y||0;this.pen.x+=x||0;this.pen.y+=y||0};GlyphIterator.prototype.step=function(text,index){var scale=this.fontScale,font=this._font;var chr=text.charAt(index);if(chr==="	"&&this._tabGlyph){return this._tabGlyph}if(!(chr in font.glyphs))return;var glyph=font.glyphs[chr];if(index>0&&this.kerning){var kern=this.getKerning(text.charAt(index-1),chr);this.pen.x+=kern*scale}return glyph};GlyphIterator.prototype.advanceLine=function(){this.pen.y+=this.getLineGap();this.pen.x=this.origin.x};GlyphIterator.prototype.advance=function(glyph){var advance=glyph.xoff*this.fontScale;this.pen.x+=advance+this.letterSpacing;return advance};GlyphIterator.prototype.getBounds=function(text,start,end,availableWidth,out){if(!out)out={x:0,y:0,width:0,height:0,glyphs:0};var checkWidth=availableWidth===0||availableWidth;start=start||0;end=end===0||end?end:text.length;var maxHeight=0;out.x=0;out.y=0;out.glyphs=0;var oldPenX=this.pen.x,oldPenY=this.pen.y,oldOriginX=this.origin.x,oldOriginY=this.origin.y;var font=this.font;this.begin();for(var i=start;i<end;i++){var chr=text.charAt(i);var glyph=this.step(text,i);if(glyph){var height=glyph.height*this.fontScale;out.y=Math.max(out.y,this.fontScale*(glyph.height-glyph.hby));maxHeight=Math.max(maxHeight,height);var lastAdvance=this.advance(glyph);var newWidth=this.pen.x-this.origin.x;if(checkWidth&&newWidth-availableWidth>.001){this.pen.x-=lastAdvance;break}out.glyphs++}}this.end();out.width=this.pen.x-this.origin.x;out.height=maxHeight;this.pen.x=oldPenX;this.pen.y=oldPenY;this.origin.x=oldOriginX;this.origin.y=oldOriginY;return out};module.exports=GlyphIterator},{"fontpath-util":46}],46:[function(require,module,exports){module.exports.pointToPixel=function(fontSize,dpi){dpi=dpi||dpi===0?dpi:96;fontSize=fontSize*dpi/72;return Math.round(fontSize)};module.exports.getPxScale=function(font,fontSize){if(font.bitmap)return 1;fontSize=typeof fontSize==="number"?fontSize:this.pointToPixel(font.size);var sz=font.units_per_EM/64;sz=sz/font.size*fontSize;return font.resolution*1/72*sz/font.units_per_EM};module.exports.getPtScale=function(font,fontSize){fontSize=typeof fontSize==="number"?fontSize:font.size;fontSize=this.pointToPixel(fontSize);return this.getPxScale(font,fontSize)}},{}],47:[function(require,module,exports){var tmpBounds={x:0,y:0,width:0,height:0,glyphs:0};function isWhitespace(chr){return chr===" "||chr==="\n"||chr==="\r"||chr==="	"}function idxOf(text,chr,start,end){var idx=text.indexOf(chr,start);if(idx===-1||idx>end)return end;return idx}function WordWrap(text){this.text=text||"";this.lines=[];this.newline="\n";this.clip=false;this.mode=WordWrap.Mode.NORMAL}WordWrap.Mode={PRE:"pre",NORMAL:"normal",NOWRAP:"nowrap"};WordWrap.prototype.clearLayout=function(iterator){this.lines.length=0;if(this.text.length>0){iterator.getBounds(this.text,0,this.text.length,undefined,tmpBounds);var line=new WordWrap.Line(0,this.text.length,tmpBounds.width);this.lines.push(line)}};WordWrap.prototype.empty=function(){this.lines.length=0};WordWrap.prototype.layout=function(iterator,wrapWidth,start,end){var text=this.text;var lines=this.lines;start=Math.max(0,start||0);end=end===0||end?end:text.length;iterator.begin();wrapWidth=wrapWidth===0||wrapWidth?wrapWidth:Number.MAX_VALUE;if(this.mode===WordWrap.Mode.PRE){var lineStart=start;for(var i=start;i<end;i++){var chr=text.charAt(i);if(chr===this.newline||i===end-1){var availableWidth=this.clip?wrapWidth:undefined;iterator.getBounds(text,lineStart,i+1,availableWidth,tmpBounds);lines.push(new WordWrap.Line(lineStart,lineStart+tmpBounds.glyphs,tmpBounds.width));lineStart=i+1}}}else{var testWidth=wrapWidth;if(this.mode===WordWrap.Mode.NOWRAP){testWidth=Number.MAX_VALUE}while(start<end){var newLine=idxOf(text,this.newline,start,end);while(start<newLine){if(!isWhitespace(text.charAt(start)))break;start++}iterator.getBounds(text,start,newLine,testWidth,tmpBounds);var lineEnd=start+tmpBounds.glyphs;var nextStart=lineEnd+this.newline.length;if(lineEnd<newLine){while(lineEnd>start){if(isWhitespace(text.charAt(lineEnd)))break;lineEnd--}if(lineEnd===start){if(nextStart>start+this.newline.length)nextStart--;lineEnd=nextStart}else{nextStart=lineEnd;while(lineEnd>start){if(!isWhitespace(text.charAt(lineEnd-this.newline.length)))break;lineEnd--}}}if(lineEnd>start){var availableWidth=this.clip?wrapWidth:undefined;iterator.getBounds(text,start,lineEnd,availableWidth,tmpBounds);var lineWidth=tmpBounds.width;var rLineEnd=this.clip?start+tmpBounds.glyphs:lineEnd;lines.push(new WordWrap.Line(start,rLineEnd,lineWidth))}start=nextStart}}iterator.end()};WordWrap.prototype.getMaxLineWidth=function(){var maxWidth=0;for(var i=0;i<this.lines.length;i++){var line=this.lines[i];maxWidth=Math.max(line.width,maxWidth)}return maxWidth};WordWrap.Line=function(start,end,width){this.start=start;this.end=end;this.width=width};module.exports=WordWrap},{}],48:[function(require,module,exports){var createVAO=require("gl-aliased-vao");var createBuffer=require("gl-buffer");module.exports.floatsPerVertex=5;function createIndices(capacity){var numIndices=capacity*6;var indices=new Uint16Array(numIndices);for(var i=0,j=0;i<numIndices;i+=6,j+=4){indices[i+0]=j+0;indices[i+1]=j+1;indices[i+2]=j+2;indices[i+3]=j+0;indices[i+4]=j+2;indices[i+5]=j+3}return indices}module.exports.mixins={create:function create(opt){opt=opt||{};this.clear();if(this.vao)this.dispose();var capacity=typeof opt.capacity==="number"?opt.capacity:100;if(capacity>10922)throw new Error("Can't have more than 10922 quads per batch: "+capacity);this._capacity=capacity;var numVerts=capacity*4*module.exports.floatsPerVertex;this.vertices=new Float32Array(numVerts);this.indices=createIndices(capacity);var gl=this.gl;var usage=opt.dynamic?gl.DYNAMIC_DRAW:gl.STATIC_DRAW;this.vertexBuffer=createBuffer(gl,this.vertices,gl.ARRAY_BUFFER,usage);this.indexBuffer=createBuffer(gl,this.indices,gl.ELEMENT_ARRAY_BUFFER,gl.STATIC_DRAW);var stride=5*4;this.vao=createVAO(gl,[{name:"position",buffer:this.vertexBuffer,size:2,stride:stride},{name:"texcoord0",buffer:this.vertexBuffer,size:2,offset:2*4,stride:stride},{name:"color",buffer:this.vertexBuffer,size:4,stride:stride,offset:4*4,type:gl.UNSIGNED_BYTE,normalized:true}],this.indexBuffer);return this},ensureCapacity:function(capacity){if(this.capacity<capacity)this.create({capacity:capacity});return this}}},{"gl-aliased-vao":50,"gl-buffer":53}],49:[function(require,module,exports){var colorToFloat=require("./pack-rgba-float");var mixes=require("mixes");var premult=require("premultiplied-rgba");var WhiteTex=require("gl-white-texture");var vertNumFloats=require("./common").floatsPerVertex;var position=[0,0],shape=[0,0],texcoord=[0,0,0,0],color=[0,0,0,0];var tmp4=[0,0,0,0],rotOrigin=[0,0],tmp2=[0,0];function SpriteBatch(gl,opt){if(!(this instanceof SpriteBatch))return new SpriteBatch(gl,opt);if(!gl)throw new Error("must specify gl context");this.gl=gl;opt=opt||{};this._bound=false;this.idx=0;this.transform=null;this._defaultTexture=opt.defaultTexture||WhiteTex(gl);this._ownsDefault=!opt.defaultTexture;this._lastTexture=this._defaultTexture;this._texture=this._defaultTexture;this.texture=null;this.mode=typeof opt.mode==="number"?opt.mode:gl.TRIANGLES;this.premultiplied=opt.premultiplied||false;this._dirty=true;this.create(opt);this.defaults()}mixes(SpriteBatch,require("./common").mixins);mixes(SpriteBatch,{capacity:{get:function(){return this._capacity}},texture:{get:function(){return this._texture},set:function(tex){this._texture=tex||this._defaultTexture}},dispose:function(){if(this.vertexBuffer)this.vertexBuffer.dispose();if(this.indexBuffer)this.indexBuffer.dispose();if(this.vao)this.vao.dispose();if(this._ownsDefault)this._defaultTexture.dispose()},clear:function(){this.idx=0;return this},bind:function(shader){shader.bind();this.vao.bind(shader);this._bound=true},unbind:function(){this.vao.unbind();this._bound=false},defaults:function(){this.position=copy2(position,0,0);this.texcoord=copy4(texcoord,0,0,1,1);this.color=copy4(color,1,1,1,1);this.shape=copy2(shape,0,0);return this},push:function(sprite){if(sprite){this.texture=sprite.texture;this.position=sprite.position||copy2(position,0,0);this.texcoord=sprite.texcoord||copy4(texcoord,0,0,1,1);this.color=sprite.color||copy4(color,1,1,1,1);this.shape=sprite.shape||copy2(shape,0,0)}if(this.texture!==this._lastTexture){if(this._bound)this.flush();this._lastTexture=this.texture}else if(this.idx===this.vertices.length){if(!this._bound)return this;this.flush()}this._dirty=true;var colorRGBA=this.premultiplied?premult(this.color,tmp4):this.color;var c=colorToFloat(colorRGBA);var u1=this.texcoord[0],v1=this.texcoord[1],u2=this.texcoord[2],v2=this.texcoord[3];var x=this.position[0],y=this.position[1],width=this.shape[0],height=this.shape[1];this._vert(x,y,u1,v1,c);this._vert(x+width,y,u2,v1,c);this._vert(x+width,y+height,u2,v2,c);this._vert(x,y+height,u1,v2,c);return this},_vert:function(x1,y1,u1,v1,c){var idx=this.idx,verts=this.vertices,transform=this.transform;if(transform){var x=x1,y=y1;x1=transform[0]*x+transform[4]*y+transform[12];y1=transform[1]*x+transform[5]*y+transform[13]}verts[idx++]=x1;verts[idx++]=y1;verts[idx++]=u1;verts[idx++]=v1;verts[idx++]=c;this.idx=idx},flush:function(){this.draw();return this.clear()},draw:function(){if(this.idx===0||!this._bound)return this;var gl=this.gl;if(this._dirty){var view=this.vertices.subarray(0,this.idx);this.vertexBuffer.update(view,0);this._dirty=false}if(this._lastTexture)this._lastTexture.bind();this._lastTexture=this.texture;var sprites=this.idx/(vertNumFloats*4);if(sprites>0)this.vao.draw(this.mode,sprites*6,0);return this}});module.exports=SpriteBatch;function copy2(out,x,y){out[0]=x;out[1]=y;return out}function copy4(out,x,y,z,w){out[0]=x;out[1]=y;out[2]=z;out[3]=w;return out}function copyVec2(out,vec){return copy2(out,vec[0],vec[1])}function transformMat4(out,a,m){var x=a[0],y=a[1];out[0]=m[0]*x+m[4]*y+m[12];out[1]=m[1]*x+m[5]*y+m[13];return out}},{"./common":48,"./pack-rgba-float":56,"gl-white-texture":54,mixes:66,"premultiplied-rgba":55}],50:[function(require,module,exports){var createVAOEmulated=require("./lib/vao-emulated.js");function createVAO(gl,attributes,elements,elementsType){var vao=createVAOEmulated(gl);vao.update(attributes,elements,elementsType);return vao}module.exports=createVAO},{"./lib/vao-emulated.js":52}],51:[function(require,module,exports){function getAttributeLocation(name,shader){if(!name)return null;var attr=shader.attributes;if(attr[name])return attr[name].location;return null}var nattribs=null;var bound=null;function doBind(gl,elements,attributes,shader){if(elements){elements.bind()}else{gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,null)}if(nattribs===null){nattribs=gl.getParameter(gl.MAX_VERTEX_ATTRIBS)|0;bound=new Array(nattribs)}if(attributes){if(attributes.length>nattribs){throw new Error("gl-vao: Too many vertex attributes")}var lastBound=null;for(i=0;i<nattribs;i++)bound[i]=false;for(i=0;i<attributes.length;i++){var attrib=attributes[i];var loc=getAttributeLocation(attrib.name,shader);if(loc===null)continue;bound[loc]=true;
if(attrib.buffer){var buffer=attrib.buffer;var size=attrib.size||4;var type=attrib.type||gl.FLOAT;var normalized=!!attrib.normalized;var stride=attrib.stride||0;var offset=attrib.offset||0;if(lastBound!==buffer){buffer.bind();lastBound=buffer}gl.enableVertexAttribArray(loc);gl.vertexAttribPointer(loc,size,type,normalized,stride,offset)}else{if(typeof attrib==="number"){gl.vertexAttrib1f(loc,attrib)}else if(attrib.length===1){gl.vertexAttrib1f(loc,attrib[0])}else if(attrib.length===2){gl.vertexAttrib2f(loc,attrib[0],attrib[1])}else if(attrib.length===3){gl.vertexAttrib3f(loc,attrib[0],attrib[1],attrib[2])}else if(attrib.length===4){gl.vertexAttrib4f(loc,attrib[0],attrib[1],attrib[2],attrib[3])}else{throw new Error("gl-vao: Invalid vertex attribute")}gl.disableVertexAttribArray(loc)}}for(i=0;i<nattribs;i++){if(!bound[i])gl.disableVertexAttribArray(i)}}else{gl.bindBuffer(gl.ARRAY_BUFFER,null);for(var i=0;i<nattribs;++i){gl.disableVertexAttribArray(i)}}}module.exports=doBind},{}],52:[function(require,module,exports){var bindAttribs=require("./do-bind.js");function VAOEmulated(gl){this.gl=gl;this._elements=null;this._attributes=null;this._elementsType=gl.UNSIGNED_SHORT}VAOEmulated.prototype.bind=function(shader){if(!shader)throw new Error("must associate shader with vertex array");bindAttribs(this.gl,this._elements,this._attributes,shader)};VAOEmulated.prototype.update=function(attributes,elements,elementsType){this._elements=elements;this._attributes=attributes;this._elementsType=elementsType||this.gl.UNSIGNED_SHORT};VAOEmulated.prototype.dispose=function(){};VAOEmulated.prototype.unbind=function(){bindAttribs(this.gl)};VAOEmulated.prototype.draw=function(mode,count,offset){offset=offset||0;var gl=this.gl;if(this._elements){gl.drawElements(mode,count,this._elementsType,offset)}else{gl.drawArrays(mode,offset,count)}};function createVAOEmulated(gl){return new VAOEmulated(gl)}module.exports=createVAOEmulated},{"./do-bind.js":51}],53:[function(require,module,exports){"use strict";var pool=require("typedarray-pool");var ops=require("ndarray-ops");var ndarray=require("ndarray");var webglew=require("webglew");var SUPPORTED_TYPES=["uint8","uint8_clamped","uint16","uint32","int8","int16","int32","float32"];function GLBuffer(gl,type,handle,length,usage){this.gl=gl;this.type=type;this.handle=handle;this.length=length;this.usage=usage}var proto=GLBuffer.prototype;proto.bind=function(){this.gl.bindBuffer(this.type,this.handle)};proto.unbind=function(){this.gl.bindBuffer(this.type,null)};proto.dispose=function(){this.gl.deleteBuffer(this.handle)};function updateTypeArray(gl,type,len,usage,data,offset){var dataLen=data.length*data.BYTES_PER_ELEMENT;if(offset<0){gl.bufferData(type,data,usage);return dataLen}if(dataLen+offset>len){throw new Error("gl-buffer: If resizing buffer, must not specify offset")}gl.bufferSubData(type,offset,data);return len}function makeScratchTypeArray(array,dtype){var res=pool.malloc(array.length,dtype);var n=array.length;for(var i=0;i<n;++i){res[i]=array[i]}return res}function isPacked(shape,stride){var n=1;for(var i=stride.length-1;i>=0;--i){if(stride[i]!==n){return false}n*=shape[i]}return true}proto.update=function(array,offset){if(typeof offset!=="number"){offset=-1}this.bind();if(typeof array==="object"&&typeof array.shape!=="undefined"){var dtype=array.dtype;if(SUPPORTED_TYPES.indexOf(dtype)<0){dtype="float32"}if(this.type===this.gl.ELEMENT_ARRAY_BUFFER){var wgl=webglew(this.gl);var ext=wgl.OES_element_index_uint;if(ext&&dtype!=="uint16"){dtype="uint32"}else{dtype="uint16"}}if(dtype===array.dtype&&isPacked(array.shape,array.stride)){if(array.offset===0&&array.data.length===array.shape[0]){this.length=updateTypeArray(this.gl,this.type,this.length,this.usage,array.data,offset)}else{this.length=updateTypeArray(this.gl,this.type,this.length,this.usage,array.data.subarray(array.offset,array.shape[0]),offset)}}else{var tmp=pool.malloc(array.size,dtype);var ndt=ndarray(tmp,array.shape);ops.assign(ndt,array);if(offset<0){this.length=updateTypeArray(this.gl,this.type,this.length,this.usage,tmp,offset)}else{this.length=updateTypeArray(this.gl,this.type,this.length,this.usage,tmp.subarray(0,array.size),offset)}pool.free(tmp)}}else if(Array.isArray(array)){var t;if(this.type===this.gl.ELEMENT_ARRAY_BUFFER){t=makeScratchTypeArray(array,"uint16")}else{t=makeScratchTypeArray(array,"float32")}if(offset<0){this.length=updateTypeArray(this.gl,this.type,this.length,this.usage,t,offset)}else{this.length=updateTypeArray(this.gl,this.type,this.length,this.usage,t.subarray(0,array.length),offset)}pool.free(t)}else if(typeof array==="object"&&typeof array.length==="number"){this.length=updateTypeArray(this.gl,this.type,this.length,this.usage,array,offset)}else if(typeof array==="number"||array===undefined){if(offset>=0){throw new Error("gl-buffer: Cannot specify offset when resizing buffer")}array=array|0;if(array<=0){array=1}this.gl.bufferData(this.type,array|0,this.usage);this.length=array}else{throw new Error("gl-buffer: Invalid data type")}};function createBuffer(gl,data,type,usage){webglew(gl);type=type||gl.ARRAY_BUFFER;usage=usage||gl.DYNAMIC_DRAW;if(type!==gl.ARRAY_BUFFER&&type!==gl.ELEMENT_ARRAY_BUFFER){throw new Error("gl-buffer: Invalid type for webgl buffer, must be either gl.ARRAY_BUFFER or gl.ELEMENT_ARRAY_BUFFER")}if(usage!==gl.DYNAMIC_DRAW&&usage!==gl.STATIC_DRAW&&usage!==gl.STREAM_DRAW){throw new Error("gl-buffer: Invalid usage for buffer, must be either gl.DYNAMIC_DRAW, gl.STATIC_DRAW or gl.STREAM_DRAW")}var handle=gl.createBuffer();var result=new GLBuffer(gl,type,handle,0,usage);result.update(data);return result}module.exports=createBuffer},{ndarray:72,"ndarray-ops":67,"typedarray-pool":94,webglew:99}],54:[function(require,module,exports){var create=require("gl-texture2d");var ndarray=require("ndarray");module.exports=function(gl){var data=Array.apply(null,new Array(16)).map(Number.prototype.valueOf,255);var array=ndarray(new Uint8Array(data),[2,2,4]);return create(gl,array)}},{"gl-texture2d":58,ndarray:72}],55:[function(require,module,exports){function premultiply(rgba,out){if(!out||typeof out==="number")out=[0,0,0,0];out[0]=rgba[0]*rgba[3];out[1]=rgba[1]*rgba[3];out[2]=rgba[2]*rgba[3];out[3]=rgba[3];return out}module.exports=premultiply},{}],56:[function(require,module,exports){var packColor=require("number-util").colorToFloat;module.exports=function colorToFloat(rgba){return packColor(~~(rgba[0]*255),~~(rgba[1]*255),~~(rgba[2]*255),~~(rgba[3]*255))}},{"number-util":74}],57:[function(require,module,exports){module.exports=function texcoord(position,shape,texShape,out){if(!out)out=[0,0,1,1];position=position||[0,0];shape=shape||[1,1];texShape=texShape||shape;var invWidth=1/texShape[0];var invHeight=1/texShape[1];var x=position[0],y=position[1],w=shape[0],h=shape[1];out[0]=x*invWidth;out[1]=y*invHeight;out[2]=(x+w)*invWidth;out[3]=(y+h)*invHeight;return out}},{}],58:[function(require,module,exports){"use strict";var ndarray=require("ndarray");var ops=require("ndarray-ops");var pool=require("typedarray-pool");var webglew=require("webglew");module.exports=createTexture2D;var linearTypes=null;var filterTypes=null;var wrapTypes=null;function lazyInitLinearTypes(gl){linearTypes=[gl.LINEAR,gl.NEAREST_MIPMAP_LINEAR,gl.LINEAR_MIPMAP_NEAREST,gl.LINEAR_MIPMAP_NEAREST];filterTypes=[gl.NEAREST,gl.LINEAR,gl.NEAREST_MIPMAP_NEAREST,gl.NEAREST_MIPMAP_LINEAR,gl.LINEAR_MIPMAP_NEAREST,gl.LINEAR_MIPMAP_LINEAR];wrapTypes=[gl.REPEAT,gl.CLAMP_TO_EDGE,gl.MIRRORED_REPEAT]}var convertFloatToUint8=function(out,inp){ops.muls(out,inp,255)};function reshapeTexture(tex,w,h){var gl=tex.gl;var maxSize=gl.getParameter(gl.MAX_TEXTURE_SIZE);if(w<0||w>maxSize||h<0||h>maxSize){throw new Error("gl-texture2d: Invalid texture size")}tex._shape=[w,h];tex.bind();gl.texImage2D(gl.TEXTURE_2D,0,tex.format,w,h,0,tex.format,tex.type,null);tex._mipLevels=[0];return tex}function Texture2D(gl,handle,width,height,format,type){this.gl=gl;this.handle=handle;this.format=format;this.type=type;this._shape=[width,height];this._mipLevels=[0];this._magFilter=gl.NEAREST;this._minFilter=gl.NEAREST;this._wrapS=gl.CLAMP_TO_EDGE;this._wrapT=gl.CLAMP_TO_EDGE;this._anisoSamples=1;var parent=this;var wrapVector=[this._wrapS,this._wrapT];Object.defineProperties(wrapVector,[{get:function(){return parent._wrapS},set:function(v){return parent.wrapS=v}},{get:function(){return parent._wrapT},set:function(v){return parent.wrapT=v}}]);this._wrapVector=wrapVector;var shapeVector=[this._shape[0],this._shape[1]];Object.defineProperties(shapeVector,[{get:function(){return parent._shape[0]},set:function(v){return parent.width=v}},{get:function(){return parent._shape[1]},set:function(v){return parent.height=v}}]);this._shapeVector=shapeVector}var proto=Texture2D.prototype;Object.defineProperties(proto,{minFilter:{get:function(){return this._minFilter},set:function(v){this.bind();var gl=this.gl;if(this.type===gl.FLOAT&&linearTypes.indexOf(v)>=0){if(!webglew(gl).texture_float_linear){v=gl.NEAREST}}if(filterTypes.indexOf(v)<0){throw new Error("gl-texture2d: Unknown filter mode "+v)}gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,v);return this._minFilter=v}},magFilter:{get:function(){return this._magFilter},set:function(v){this.bind();var gl=this.gl;if(this.type===gl.FLOAT&&linearTypes.indexOf(v)>=0){if(!webglew(gl).texture_float_linear){v=gl.NEAREST}}if(filterTypes.indexOf(v)<0){throw new Error("gl-texture2d: Unknown filter mode "+v)}gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MAG_FILTER,v);return this._magFilter=v}},mipSamples:{get:function(){return this._anisoSamples},set:function(i){var psamples=this._anisoSamples;this._anisoSamples=Math.max(i,1)|0;if(psamples!==this._anisoSamples){var ext=webglew(this.gl).EXT_texture_filter_anisotropic;if(ext){this.gl.texParameterf(this.gl.TEXTURE_2D,ext.TEXTURE_MAX_ANISOTROPY_EXT,this._anisoSamples)}}return this._anisoSamples}},wrapS:{get:function(){return this._wrapS},set:function(v){this.bind();if(wrapTypes.indexOf(v)<0){throw new Error("gl-texture2d: Unknown wrap mode "+v)}this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_S,v);return this._wrapS=v}},wrapT:{get:function(){return this._wrapT},set:function(v){this.bind();if(wrapTypes.indexOf(v)<0){throw new Error("gl-texture2d: Unknown wrap mode "+v)}this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_T,v);return this._wrapT=v}},wrap:{get:function(){return this._wrapVector},set:function(v){if(!Array.isArray(v)){v=[v,v]}if(v.length!==2){throw new Error("gl-texture2d: Must specify wrap mode for rows and columns")}for(var i=0;i<2;++i){if(wrapTypes.indexOf(v[i])<0){throw new Error("gl-texture2d: Unknown wrap mode "+v)}}this._wrapS=v[0];this._wrapT=v[1];var gl=this.gl;this.bind();gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_S,this._wrapS);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_T,this._wrapT);return v}},shape:{get:function(){return this._shapeVector},set:function(x){if(!Array.isArray(x)){x=[x|0,x|0]}else{if(x.length!==2){throw new Error("gl-texture2d: Invalid texture shape")}}reshapeTexture(this,x[0]|0,x[1]|0);return[x[0]|0,x[1]|0]}},width:{get:function(){return this._shape[0]},set:function(w){w=w|0;reshapeTexture(this,w,this._shape[1]);return w}},height:{get:function(){return this._shape[1]},set:function(h){h=h|0;reshapeTexture(this,this._shape[0],h);return h}}});proto.bind=function(unit){var gl=this.gl;if(unit!==undefined){gl.activeTexture(gl.TEXTURE0+(unit|0))}gl.bindTexture(gl.TEXTURE_2D,this.handle);if(unit!==undefined){return unit|0}return gl.getParameter(gl.ACTIVE_TEXTURE)-gl.TEXTURE0};proto.dispose=function(){this.gl.deleteTexture(this.handle)};proto.generateMipmap=function(){this.bind();this.gl.generateMipmap(this.gl.TEXTURE_2D);var l=Math.min(this._shape[0],this._shape[1]);for(var i=0;l>0;++i,l>>>=1){if(this._mipLevels.indexOf(i)<0){this._mipLevels.push(i)}}};proto.setPixels=function(data,x_off,y_off,mip_level){var gl=this.gl;this.bind();if(Array.isArray(x_off)){mip_level=y_off;y_off=x_off[1]|0;x_off=x_off[0]|0}else{x_off=x_off||0;y_off=y_off||0}mip_level=mip_level||0;if(data instanceof HTMLCanvasElement||data instanceof ImageData||data instanceof HTMLImageElement||data instanceof HTMLVideoElement){var needsMip=this._mipLevels.indexOf(mip_level)<0;if(needsMip){gl.texImage2D(gl.TEXTURE_2D,0,this.format,this.format,this.type,data);this._mipLevels.push(mip_level)}else{gl.texSubImage2D(gl.TEXTURE_2D,mip_level,x_off,y_off,this.format,this.type,data)}}else if(data.shape&&data.stride&&data.data){if(data.shape.length<2||x_off+data.shape[1]>this._shape[1]>>>mip_level||y_off+data.shape[0]>this._shape[0]>>>mip_level||x_off<0||y_off<0){throw new Error("gl-texture2d: Texture dimensions are out of bounds")}texSubImageArray(gl,x_off,y_off,mip_level,this.format,this.type,this._mipLevels,data)}else{throw new Error("gl-texture2d: Unsupported data type")}};function isPacked(shape,stride){if(shape.length===3){return stride[2]===1&&stride[1]===shape[0]*shape[2]&&stride[0]===shape[2]}return stride[0]===1&&stride[1]===shape[0]}function texSubImageArray(gl,x_off,y_off,mip_level,cformat,ctype,mipLevels,array){var dtype=array.dtype;var shape=array.shape.slice();if(shape.length<2||shape.length>3){throw new Error("gl-texture2d: Invalid ndarray, must be 2d or 3d")}var type=0,format=0;var packed=isPacked(shape,array.stride.slice());if(dtype==="float32"){type=gl.FLOAT}else if(dtype==="float64"){type=gl.FLOAT;packed=false;dtype="float32"}else if(dtype==="uint8"){type=gl.UNSIGNED_BYTE}else{type=gl.UNSIGNED_BYTE;packed=false;dtype="uint8"}var channels=1;if(shape.length===2){format=gl.LUMINANCE;shape=[shape[0],shape[1],1];array=ndarray(array.data,shape,[array.stride[0],array.stride[1],1],array.offset)}else if(shape.length===3){if(shape[2]===1){format=gl.ALPHA}else if(shape[2]===2){format=gl.LUMINANCE_ALPHA}else if(shape[2]===3){format=gl.RGB}else if(shape[2]===4){format=gl.RGBA}else{throw new Error("gl-texture2d: Invalid shape for pixel coords")}channels=shape[2]}else{throw new Error("gl-texture2d: Invalid shape for texture")}if((format===gl.LUMINANCE||format===gl.ALPHA)&&(cformat===gl.LUMINANCE||cformat===gl.ALPHA)){format=cformat}if(format!==cformat){throw new Error("gl-texture2d: Incompatible texture format for setPixels")}var size=array.size;var needsMip=mipLevels.indexOf(mip_level)<0;if(needsMip){mipLevels.push(mip_level)}if(type===ctype&&packed){if(array.offset===0&&array.data.length===size){if(needsMip){gl.texImage2D(gl.TEXTURE_2D,mip_level,cformat,shape[0],shape[1],0,cformat,ctype,array.data)}else{gl.texSubImage2D(gl.TEXTURE_2D,mip_level,x_off,y_off,shape[0],shape[1],cformat,ctype,array.data)}}else{if(needsMip){gl.texImage2D(gl.TEXTURE_2D,mip_level,cformat,shape[0],shape[1],0,cformat,ctype,array.data.subarray(array.offset,array.offset+size))}else{gl.texSubImage2D(gl.TEXTURE_2D,mip_level,x_off,y_off,shape[0],shape[1],cformat,ctype,array.data.subarray(array.offset,array.offset+size))}}}else{var pack_buffer;if(ctype===gl.FLOAT){pack_buffer=pool.mallocFloat32(size)}else{pack_buffer=pool.mallocUint8(size)}var pack_view=ndarray(pack_buffer,shape,[shape[2],shape[2]*shape[0],1]);if(type===gl.FLOAT&&ctype===gl.UNSIGNED_BYTE){convertFloatToUint8(pack_view,array)}else{ops.assign(pack_view,array)}if(needsMip){gl.texImage2D(gl.TEXTURE_2D,mip_level,cformat,shape[0],shape[1],0,cformat,ctype,pack_buffer.subarray(0,size))}else{gl.texSubImage2D(gl.TEXTURE_2D,mip_level,x_off,y_off,shape[0],shape[1],cformat,ctype,pack_buffer.subarray(0,size))}if(ctype===gl.FLOAT){pool.freeFloat32(pack_buffer)}else{pool.freeUint8(pack_buffer)}}}function initTexture(gl){var tex=gl.createTexture();gl.bindTexture(gl.TEXTURE_2D,tex);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,gl.NEAREST);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MAG_FILTER,gl.NEAREST);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_S,gl.CLAMP_TO_EDGE);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_T,gl.CLAMP_TO_EDGE);return tex}function createTextureShape(gl,width,height,format,type){var maxTextureSize=gl.getParameter(gl.MAX_TEXTURE_SIZE);if(width<0||width>maxTextureSize||height<0||height>maxTextureSize){throw new Error("gl-texture2d: Invalid texture shape")}if(type===gl.FLOAT&&!webglew(gl).texture_float){throw new Error("gl-texture2d: Floating point textures not supported on this platform")}var tex=initTexture(gl);gl.texImage2D(gl.TEXTURE_2D,0,format,width,height,0,format,type,null);return new Texture2D(gl,tex,width,height,format,type)}function createTextureDOM(gl,element,format,type){var tex=initTexture(gl);gl.texImage2D(gl.TEXTURE_2D,0,format,format,type,element);return new Texture2D(gl,tex,element.width|0,element.height|0,format,type)}function createTextureArray(gl,array){var dtype=array.dtype;var shape=array.shape.slice();var maxSize=gl.getParameter(gl.MAX_TEXTURE_SIZE);if(shape[0]<0||shape[0]>maxSize||shape[1]<0||shape[1]>maxSize){throw new Error("gl-texture2d: Invalid texture size")}var packed=isPacked(shape,array.stride.slice());var type=0;if(dtype==="float32"){type=gl.FLOAT}else if(dtype==="float64"){type=gl.FLOAT;packed=false;dtype="float32"}else if(dtype==="uint8"){type=gl.UNSIGNED_BYTE}else{type=gl.UNSIGNED_BYTE;packed=false;dtype="uint8"}var format=0;if(shape.length===2){format=gl.LUMINANCE;shape=[shape[0],shape[1],1];array=ndarray(array.data,shape,[array.stride[0],array.stride[1],1],array.offset)}else if(shape.length===3){if(shape[2]===1){format=gl.ALPHA}else if(shape[2]===2){format=gl.LUMINANCE_ALPHA}else if(shape[2]===3){format=gl.RGB}else if(shape[2]===4){format=gl.RGBA}else{throw new Error("gl-texture2d: Invalid shape for pixel coords")}}else{throw new Error("gl-texture2d: Invalid shape for texture")}if(type===gl.FLOAT&&!webglew(gl).texture_float){type=gl.UNSIGNED_BYTE;packed=false}var buffer,buf_store;var size=array.size;if(!packed){var stride=[shape[2],shape[2]*shape[0],1];buf_store=pool.malloc(size,dtype);var buf_array=ndarray(buf_store,shape,stride,0);if((dtype==="float32"||dtype==="float64")&&type===gl.UNSIGNED_BYTE){convertFloatToUint8(buf_array,array)}else{ops.assign(buf_array,array)}buffer=buf_store.subarray(0,size)}else if(array.offset===0&&array.data.length===size){buffer=array.data}else{buffer=array.data.subarray(array.offset,array.offset+size)}var tex=initTexture(gl);gl.texImage2D(gl.TEXTURE_2D,0,format,shape[0],shape[1],0,format,type,buffer);if(!packed){pool.free(buf_store)}return new Texture2D(gl,tex,shape[0],shape[1],format,type)}function createTexture2D(gl){if(arguments.length<=1){throw new Error("gl-texture2d: Missing arguments for texture2d constructor")}if(!linearTypes){lazyInitLinearTypes(gl)}if(typeof arguments[1]==="number"){return createTextureShape(gl,arguments[1],arguments[2],arguments[3]||gl.RGBA,arguments[4]||gl.UNSIGNED_BYTE)}if(Array.isArray(arguments[1])){return createTextureShape(gl,arguments[1][0]|0,arguments[1][1]|0,arguments[2]||gl.RGBA,arguments[3]||gl.UNSIGNED_BYTE)}if(typeof arguments[1]==="object"){var obj=arguments[1];if(obj instanceof HTMLCanvasElement||obj instanceof HTMLImageElement||obj instanceof HTMLVideoElement||obj instanceof ImageData){return createTextureDOM(gl,obj,arguments[2]||gl.RGBA,arguments[3]||gl.UNSIGNED_BYTE)}else if(obj.shape&&obj.data&&obj.stride){return createTextureArray(gl,obj)}}throw new Error("gl-texture2d: Invalid arguments for texture2d constructor")}},{ndarray:72,"ndarray-ops":67,"typedarray-pool":94,webglew:99}],59:[function(require,module,exports){module.exports=set;function set(out,x,y,z){out[0]=x;out[1]=y;out[2]=z;return out}},{}],60:[function(require,module,exports){module.exports=programify;var shader=require("gl-shader-core");function programify(vertex,fragment,uniforms,attributes){return function(gl){return shader(gl,vertex,fragment,uniforms,attributes)}}},{"gl-shader-core":40}],61:[function(require,module,exports){module.exports=noop;function noop(){throw new Error("You should bundle your code "+"using `glslify` as a transform.")}},{}],62:[function(require,module,exports){module.exports=programify;function programify(vertex,fragment,uniforms,attributes){return{vertex:vertex,fragment:fragment,uniforms:uniforms,attributes:attributes}}},{}],63:[function(require,module,exports){module.exports=img;function img(src,opt,callback){if(typeof opt==="function"){callback=opt;opt=null}var el=document.createElement("img");var locked;el.onload=function(){if(locked)return;locked=true;callback&&callback(undefined,el)};el.onerror=function(err){if(locked)return;locked=true;callback&&callback(new Error('Unable to load "'+src+'"'),el)};if(opt&&opt.crossOrigin)el.crossOrigin=opt.crossOrigin;el.src=src;return el}},{}],64:[function(require,module,exports){if(typeof Object.create==="function"){module.exports=function inherits(ctor,superCtor){ctor.super_=superCtor;ctor.prototype=Object.create(superCtor.prototype,{constructor:{value:ctor,enumerable:false,writable:true,configurable:true}})}}else{module.exports=function inherits(ctor,superCtor){ctor.super_=superCtor;var TempCtor=function(){};TempCtor.prototype=superCtor.prototype;ctor.prototype=new TempCtor;ctor.prototype.constructor=ctor}}},{}],65:[function(require,module,exports){function lerp(v0,v1,t){return v0*(1-t)+v1*t}module.exports=lerp},{}],66:[function(require,module,exports){var xtend=require("xtend");var defaults={enumerable:true,configurable:true};function mix(obj,entries){for(var k in entries){if(!entries.hasOwnProperty(k))continue;var f=entries[k];if(typeof f==="function"){obj[k]=f}else if(f&&typeof f==="object"){var def=xtend(defaults,f);Object.defineProperty(obj,k,def)}}}module.exports=function mixes(ctor,entries){mix(ctor.prototype,entries)};module.exports.mix=mix},{xtend:100}],67:[function(require,module,exports){"use strict";var compile=require("cwise-compiler");var EmptyProc={body:"",args:[],thisVars:[],localVars:[]};function fixup(x){if(!x){return EmptyProc}for(var i=0;i<x.args.length;++i){var a=x.args[i];if(i===0){x.args[i]={name:a,lvalue:true,rvalue:!!x.rvalue,count:x.count||1}}else{x.args[i]={name:a,lvalue:false,rvalue:true,count:1}}}if(!x.thisVars){x.thisVars=[]}if(!x.localVars){x.localVars=[]}return x}function pcompile(user_args){return compile({args:user_args.args,pre:fixup(user_args.pre),body:fixup(user_args.body),post:fixup(user_args.proc),funcName:user_args.funcName})}function makeOp(user_args){var args=[];for(var i=0;i<user_args.args.length;++i){args.push("a"+i)}var wrapper=new Function("P",["return function ",user_args.funcName,"_ndarrayops(",args.join(","),") {P(",args.join(","),");return a0}"].join(""));return wrapper(pcompile(user_args))}var assign_ops={add:"+",sub:"-",mul:"*",div:"/",mod:"%",band:"&",bor:"|",bxor:"^",lshift:"<<",rshift:">>",rrshift:">>>"};(function(){for(var id in assign_ops){var op=assign_ops[id];exports[id]=makeOp({args:["array","array","array"],body:{args:["a","b","c"],body:"a=b"+op+"c"},funcName:id});exports[id+"eq"]=makeOp({args:["array","array"],body:{args:["a","b"],body:"a"+op+"=b"},rvalue:true,funcName:id+"eq"});exports[id+"s"]=makeOp({args:["array","array","scalar"],body:{args:["a","b","s"],body:"a=b"+op+"s"},funcName:id+"s"});exports[id+"seq"]=makeOp({args:["array","scalar"],body:{args:["a","s"],body:"a"+op+"=s"},rvalue:true,funcName:id+"seq"})}})();var unary_ops={not:"!",bnot:"~",neg:"-",recip:"1.0/"};(function(){for(var id in unary_ops){var op=unary_ops[id];exports[id]=makeOp({args:["array","array"],body:{args:["a","b"],body:"a="+op+"b"},funcName:id});exports[id+"eq"]=makeOp({args:["array"],body:{args:["a"],body:"a="+op+"a"},rvalue:true,count:2,funcName:id+"eq"})}})();var binary_ops={and:"&&",or:"||",eq:"===",neq:"!==",lt:"<",gt:">",leq:"<=",geq:">="};(function(){for(var id in binary_ops){var op=binary_ops[id];exports[id]=makeOp({args:["array","array","array"],body:{args:["a","b","c"],body:"a=b"+op+"c"},funcName:id});exports[id+"s"]=makeOp({args:["array","array","scalar"],body:{args:["a","b","s"],body:"a=b"+op+"s"},funcName:id+"s"});exports[id+"eq"]=makeOp({args:["array","array"],body:{args:["a","b"],body:"a=a"+op+"b"},rvalue:true,count:2,funcName:id+"eq"});exports[id+"seq"]=makeOp({args:["array","scalar"],body:{args:["a","s"],body:"a=a"+op+"s"},rvalue:true,count:2,funcName:id+"seq"})}})();var math_unary=["abs","acos","asin","atan","ceil","cos","exp","floor","log","round","sin","sqrt","tan"];(function(){for(var i=0;i<math_unary.length;++i){var f=math_unary[i];exports[f]=makeOp({args:["array","array"],pre:{args:[],body:"this_f=Math."+f,thisVars:["this_f"]},body:{args:["a","b"],body:"a=this_f(b)",thisVars:["this_f"]},funcName:f});exports[f+"eq"]=makeOp({args:["array"],pre:{args:[],body:"this_f=Math."+f,thisVars:["this_f"]},body:{args:["a"],body:"a=this_f(a)",thisVars:["this_f"]},rvalue:true,count:2,funcName:f+"eq"})}})();var math_comm=["max","min","atan2","pow"];(function(){for(var i=0;i<math_comm.length;++i){var f=math_comm[i];exports[f]=makeOp({args:["array","array","array"],pre:{args:[],body:"this_f=Math."+f,thisVars:["this_f"]},body:{args:["a","b","c"],body:"a=this_f(b,c)",thisVars:["this_f"]},funcName:f});exports[f+"s"]=makeOp({args:["array","array","scalar"],pre:{args:[],body:"this_f=Math."+f,thisVars:["this_f"]},body:{args:["a","b","c"],body:"a=this_f(b,c)",thisVars:["this_f"]},funcName:f+"s"});exports[f+"eq"]=makeOp({args:["array","array"],pre:{args:[],body:"this_f=Math."+f,thisVars:["this_f"]},body:{args:["a","b"],body:"a=this_f(a,b)",thisVars:["this_f"]},rvalue:true,count:2,funcName:f+"eq"});exports[f+"seq"]=makeOp({args:["array","scalar"],pre:{args:[],body:"this_f=Math."+f,thisVars:["this_f"]},body:{args:["a","b"],body:"a=this_f(a,b)",thisVars:["this_f"]},rvalue:true,count:2,funcName:f+"seq"})}})();var math_noncomm=["atan2","pow"];(function(){for(var i=0;i<math_noncomm.length;++i){var f=math_noncomm[i];exports[f+"op"]=makeOp({args:["array","array","array"],pre:{args:[],body:"this_f=Math."+f,thisVars:["this_f"]},body:{args:["a","b","c"],body:"a=this_f(c,b)",thisVars:["this_f"]},funcName:f+"op"});exports[f+"ops"]=makeOp({args:["array","array","scalar"],pre:{args:[],body:"this_f=Math."+f,thisVars:["this_f"]},body:{args:["a","b","c"],body:"a=this_f(c,b)",thisVars:["this_f"]},funcName:f+"ops"});exports[f+"opeq"]=makeOp({args:["array","array"],pre:{args:[],body:"this_f=Math."+f,thisVars:["this_f"]},body:{args:["a","b"],body:"a=this_f(b,a)",thisVars:["this_f"]},rvalue:true,count:2,funcName:f+"opeq"});exports[f+"opseq"]=makeOp({args:["array","scalar"],pre:{args:[],body:"this_f=Math."+f,thisVars:["this_f"]},body:{args:["a","b"],body:"a=this_f(b,a)",thisVars:["this_f"]},rvalue:true,count:2,funcName:f+"opseq"})}})();exports.any=compile({args:["array"],pre:EmptyProc,body:{args:[{name:"a",lvalue:false,rvalue:true,count:1}],body:"if(a){return true}",localVars:[],thisVars:[]},post:{args:[],localVars:[],thisVars:[],body:"return false"},funcName:"any"});exports.all=compile({args:["array"],pre:EmptyProc,body:{args:[{name:"x",lvalue:false,rvalue:true,count:1}],body:"if(!x){return false}",localVars:[],thisVars:[]},post:{args:[],localVars:[],thisVars:[],body:"return true"},funcName:"all"});exports.sum=compile({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=0"},body:{args:[{name:"a",lvalue:false,rvalue:true,count:1}],body:"this_s+=a",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return this_s"},funcName:"sum"});exports.prod=compile({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=1"},body:{args:[{name:"a",lvalue:false,rvalue:true,count:1}],body:"this_s*=a",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return this_s"},funcName:"prod"});exports.norm2squared=compile({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=0"},body:{args:[{name:"a",lvalue:false,rvalue:true,count:2}],body:"this_s+=a*a",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return this_s"},funcName:"norm2squared"});exports.norm2=compile({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=0"},body:{args:[{name:"a",lvalue:false,rvalue:true,count:2}],body:"this_s+=a*a",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return Math.sqrt(this_s)"},funcName:"norm2"});exports.norminf=compile({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=0"},body:{args:[{name:"a",lvalue:false,rvalue:true,count:4}],body:"if(-a>this_s){this_s=-a}else if(a>this_s){this_s=a}",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return this_s"},funcName:"norminf"});exports.norm1=compile({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=0"},body:{args:[{name:"a",lvalue:false,rvalue:true,count:3}],body:"this_s+=a<0?-a:a",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return this_s"},funcName:"norm1"});exports.sup=compile({args:["array"],pre:{body:"this_h=-Infinity",args:[],thisVars:["this_h"],localVars:[]},body:{body:"if(_inline_1_arg0_>this_h)this_h=_inline_1_arg0_",args:[{name:"_inline_1_arg0_",lvalue:false,rvalue:true,count:2}],thisVars:["this_h"],localVars:[]},post:{body:"return this_h",args:[],thisVars:["this_h"],localVars:[]}});exports.inf=compile({args:["array"],pre:{body:"this_h=Infinity",args:[],thisVars:["this_h"],localVars:[]},body:{body:"if(_inline_1_arg0_<this_h)this_h=_inline_1_arg0_",args:[{name:"_inline_1_arg0_",lvalue:false,rvalue:true,count:2}],thisVars:["this_h"],localVars:[]},post:{body:"return this_h",args:[],thisVars:["this_h"],localVars:[]}});exports.argmin=compile({args:["index","array","shape"],pre:{body:"{this_v=Infinity;this_i=_inline_0_arg2_.slice(0)}",args:[{name:"_inline_0_arg0_",lvalue:false,rvalue:false,count:0},{name:"_inline_0_arg1_",lvalue:false,rvalue:false,count:0},{name:"_inline_0_arg2_",lvalue:false,rvalue:true,count:1}],thisVars:["this_i","this_v"],localVars:[]},body:{body:"{if(_inline_1_arg1_<this_v){this_v=_inline_1_arg1_;for(var _inline_1_k=0;_inline_1_k<_inline_1_arg0_.length;++_inline_1_k){this_i[_inline_1_k]=_inline_1_arg0_[_inline_1_k]}}}",args:[{name:"_inline_1_arg0_",lvalue:false,rvalue:true,count:2},{name:"_inline_1_arg1_",lvalue:false,rvalue:true,count:2}],thisVars:["this_i","this_v"],localVars:["_inline_1_k"]},post:{body:"{return this_i}",args:[],thisVars:["this_i"],localVars:[]}});exports.argmax=compile({args:["index","array","shape"],pre:{body:"{this_v=-Infinity;this_i=_inline_0_arg2_.slice(0)}",args:[{name:"_inline_0_arg0_",lvalue:false,rvalue:false,count:0},{name:"_inline_0_arg1_",lvalue:false,rvalue:false,count:0},{name:"_inline_0_arg2_",lvalue:false,rvalue:true,count:1}],thisVars:["this_i","this_v"],localVars:[]},body:{body:"{if(_inline_1_arg1_>this_v){this_v=_inline_1_arg1_;for(var _inline_1_k=0;_inline_1_k<_inline_1_arg0_.length;++_inline_1_k){this_i[_inline_1_k]=_inline_1_arg0_[_inline_1_k]}}}",args:[{name:"_inline_1_arg0_",lvalue:false,rvalue:true,count:2},{name:"_inline_1_arg1_",lvalue:false,rvalue:true,count:2}],thisVars:["this_i","this_v"],localVars:["_inline_1_k"]},post:{body:"{return this_i}",args:[],thisVars:["this_i"],localVars:[]}});exports.random=makeOp({args:["array"],pre:{args:[],body:"this_f=Math.random",thisVars:["this_f"]},body:{args:["a"],body:"a=this_f()",thisVars:["this_f"]},funcName:"random"});exports.assign=makeOp({args:["array","array"],body:{args:["a","b"],body:"a=b"},funcName:"assign"});exports.assigns=makeOp({args:["array","scalar"],body:{args:["a","b"],body:"a=b"},funcName:"assigns"});exports.equals=compile({args:["array","array"],pre:EmptyProc,body:{args:[{name:"x",lvalue:false,rvalue:true,count:1},{name:"y",lvalue:false,rvalue:true,count:1}],body:"if(x!==y){return false}",localVars:[],thisVars:[]},post:{args:[],localVars:[],thisVars:[],body:"return true"},funcName:"equals"})},{"cwise-compiler":68}],68:[function(require,module,exports){"use strict";var createThunk=require("./lib/thunk.js");function Procedure(){this.argTypes=[];this.shimArgs=[];this.arrayArgs=[];this.scalarArgs=[];this.offsetArgs=[];this.offsetArgIndex=[];this.indexArgs=[];this.shapeArgs=[];this.funcName="";
this.pre=null;this.body=null;this.post=null;this.debug=false}function compileCwise(user_args){var proc=new Procedure;proc.pre=user_args.pre;proc.body=user_args.body;proc.post=user_args.post;var proc_args=user_args.args.slice(0);proc.argTypes=proc_args;for(var i=0;i<proc_args.length;++i){var arg_type=proc_args[i];if(arg_type==="array"){proc.arrayArgs.push(i);proc.shimArgs.push("array"+i);if(i<proc.pre.args.length&&proc.pre.args[i].count>0){throw new Error("cwise: pre() block may not reference array args")}if(i<proc.post.args.length&&proc.post.args[i].count>0){throw new Error("cwise: post() block may not reference array args")}}else if(arg_type==="scalar"){proc.scalarArgs.push(i);proc.shimArgs.push("scalar"+i)}else if(arg_type==="index"){proc.indexArgs.push(i);if(i<proc.pre.args.length&&proc.pre.args[i].count>0){throw new Error("cwise: pre() block may not reference array index")}if(i<proc.body.args.length&&proc.body.args[i].lvalue){throw new Error("cwise: body() block may not write to array index")}if(i<proc.post.args.length&&proc.post.args[i].count>0){throw new Error("cwise: post() block may not reference array index")}}else if(arg_type==="shape"){proc.shapeArgs.push(i);if(i<proc.pre.args.length&&proc.pre.args[i].lvalue){throw new Error("cwise: pre() block may not write to array shape")}if(i<proc.body.args.length&&proc.body.args[i].lvalue){throw new Error("cwise: body() block may not write to array shape")}if(i<proc.post.args.length&&proc.post.args[i].lvalue){throw new Error("cwise: post() block may not write to array shape")}}else if(typeof arg_type==="object"&&arg_type.offset){proc.argTypes[i]="offset";proc.offsetArgs.push({array:arg_type.array,offset:arg_type.offset});proc.offsetArgIndex.push(i)}else{throw new Error("cwise: Unknown argument type "+proc_args[i])}}if(proc.arrayArgs.length<=0){throw new Error("cwise: No array arguments specified")}if(proc.pre.args.length>proc_args.length){throw new Error("cwise: Too many arguments in pre() block")}if(proc.body.args.length>proc_args.length){throw new Error("cwise: Too many arguments in body() block")}if(proc.post.args.length>proc_args.length){throw new Error("cwise: Too many arguments in post() block")}proc.debug=!!user_args.printCode||!!user_args.debug;proc.funcName=user_args.funcName||"cwise";proc.blockSize=user_args.blockSize||64;return createThunk(proc)}module.exports=compileCwise},{"./lib/thunk.js":70}],69:[function(require,module,exports){"use strict";var uniq=require("uniq");function innerFill(order,proc,body){var dimension=order.length,nargs=proc.arrayArgs.length,has_index=proc.indexArgs.length>0,code=[],vars=[],idx=0,pidx=0,i,j;for(i=0;i<dimension;++i){vars.push(["i",i,"=0"].join(""))}for(j=0;j<nargs;++j){for(i=0;i<dimension;++i){pidx=idx;idx=order[i];if(i===0){vars.push(["d",j,"s",i,"=t",j,"p",idx].join(""))}else{vars.push(["d",j,"s",i,"=(t",j,"p",idx,"-s",pidx,"*t",j,"p",pidx,")"].join(""))}}}code.push("var "+vars.join(","));for(i=dimension-1;i>=0;--i){idx=order[i];code.push(["for(i",i,"=0;i",i,"<s",idx,";++i",i,"){"].join(""))}code.push(body);for(i=0;i<dimension;++i){pidx=idx;idx=order[i];for(j=0;j<nargs;++j){code.push(["p",j,"+=d",j,"s",i].join(""))}if(has_index){if(i>0){code.push(["index[",pidx,"]-=s",pidx].join(""))}code.push(["++index[",idx,"]"].join(""))}code.push("}")}return code.join("\n")}function outerFill(matched,order,proc,body){var dimension=order.length,nargs=proc.arrayArgs.length,blockSize=proc.blockSize,has_index=proc.indexArgs.length>0,code=[];for(var i=0;i<nargs;++i){code.push(["var offset",i,"=p",i].join(""))}for(var i=matched;i<dimension;++i){code.push(["for(var j"+i+"=SS[",order[i],"]|0;j",i,">0;){"].join(""));code.push(["if(j",i,"<",blockSize,"){"].join(""));code.push(["s",order[i],"=j",i].join(""));code.push(["j",i,"=0"].join(""));code.push(["}else{s",order[i],"=",blockSize].join(""));code.push(["j",i,"-=",blockSize,"}"].join(""));if(has_index){code.push(["index[",order[i],"]=j",i].join(""))}}for(var i=0;i<nargs;++i){var indexStr=["offset"+i];for(var j=matched;j<dimension;++j){indexStr.push(["j",j,"*t",i,"p",order[j]].join(""))}code.push(["p",i,"=(",indexStr.join("+"),")"].join(""))}code.push(innerFill(order,proc,body));for(var i=matched;i<dimension;++i){code.push("}")}return code.join("\n")}function countMatches(orders){var matched=0,dimension=orders[0].length;while(matched<dimension){for(var j=1;j<orders.length;++j){if(orders[j][matched]!==orders[0][matched]){return matched}}++matched}return matched}function processBlock(block,proc,dtypes){var code=block.body;var pre=[];var post=[];for(var i=0;i<block.args.length;++i){var carg=block.args[i];if(carg.count<=0){continue}var re=new RegExp(carg.name,"g");var ptrStr="";var arrNum=proc.arrayArgs.indexOf(i);switch(proc.argTypes[i]){case"offset":var offArgIndex=proc.offsetArgIndex.indexOf(i);var offArg=proc.offsetArgs[offArgIndex];arrNum=offArg.array;ptrStr="+q"+offArgIndex;case"array":ptrStr="p"+arrNum+ptrStr;var localStr="l"+i;var arrStr="a"+arrNum;if(carg.count===1){if(dtypes[arrNum]==="generic"){if(carg.lvalue){pre.push(["var ",localStr,"=",arrStr,".get(",ptrStr,")"].join(""));code=code.replace(re,localStr);post.push([arrStr,".set(",ptrStr,",",localStr,")"].join(""))}else{code=code.replace(re,[arrStr,".get(",ptrStr,")"].join(""))}}else{code=code.replace(re,[arrStr,"[",ptrStr,"]"].join(""))}}else if(dtypes[arrNum]==="generic"){pre.push(["var ",localStr,"=",arrStr,".get(",ptrStr,")"].join(""));code=code.replace(re,localStr);if(carg.lvalue){post.push([arrStr,".set(",ptrStr,",",localStr,")"].join(""))}}else{pre.push(["var ",localStr,"=",arrStr,"[",ptrStr,"]"].join(""));code=code.replace(re,localStr);if(carg.lvalue){post.push([arrStr,"[",ptrStr,"]=",localStr].join(""))}}break;case"scalar":code=code.replace(re,"Y"+proc.scalarArgs.indexOf(i));break;case"index":code=code.replace(re,"index");break;case"shape":code=code.replace(re,"shape");break}}return[pre.join("\n"),code,post.join("\n")].join("\n").trim()}function typeSummary(dtypes){var summary=new Array(dtypes.length);var allEqual=true;for(var i=0;i<dtypes.length;++i){var t=dtypes[i];var digits=t.match(/\d+/);if(!digits){digits=""}else{digits=digits[0]}if(t.charAt(0)===0){summary[i]="u"+t.charAt(1)+digits}else{summary[i]=t.charAt(0)+digits}if(i>0){allEqual=allEqual&&summary[i]===summary[i-1]}}if(allEqual){return summary[0]}return summary.join("")}function generateCWiseOp(proc,typesig){var dimension=typesig[1].length|0;var orders=new Array(proc.arrayArgs.length);var dtypes=new Array(proc.arrayArgs.length);var arglist=["SS"];var code=["'use strict'"];var vars=[];for(var j=0;j<dimension;++j){vars.push(["s",j,"=SS[",j,"]"].join(""))}for(var i=0;i<proc.arrayArgs.length;++i){arglist.push("a"+i);arglist.push("t"+i);arglist.push("p"+i);dtypes[i]=typesig[2*i];orders[i]=typesig[2*i+1];for(var j=0;j<dimension;++j){vars.push(["t",i,"p",j,"=t",i,"[",j,"]"].join(""))}}for(var i=0;i<proc.scalarArgs.length;++i){arglist.push("Y"+i)}if(proc.shapeArgs.length>0){vars.push("shape=SS.slice(0)")}if(proc.indexArgs.length>0){var zeros=new Array(dimension);for(var i=0;i<dimension;++i){zeros[i]="0"}vars.push(["index=[",zeros.join(","),"]"].join(""))}for(var i=0;i<proc.offsetArgs.length;++i){var off_arg=proc.offsetArgs[i];var init_string=[];for(var j=0;j<off_arg.offset.length;++j){if(off_arg.offset[j]===0){continue}else if(off_arg.offset[j]===1){init_string.push(["t",off_arg.array,"p",j].join(""))}else{init_string.push([off_arg.offset[j],"*t",off_arg.array,"p",j].join(""))}}if(init_string.length===0){vars.push("q"+i+"=0")}else{vars.push(["q",i,"=",init_string.join("+")].join(""))}}var thisVars=uniq([].concat(proc.pre.thisVars).concat(proc.body.thisVars).concat(proc.post.thisVars));vars=vars.concat(thisVars);code.push("var "+vars.join(","));for(var i=0;i<proc.arrayArgs.length;++i){code.push("p"+i+"|=0")}if(proc.pre.body.length>3){code.push(processBlock(proc.pre,proc,dtypes))}var body=processBlock(proc.body,proc,dtypes);var matched=countMatches(orders);if(matched<dimension){code.push(outerFill(matched,orders[0],proc,body))}else{code.push(innerFill(orders[0],proc,body))}if(proc.post.body.length>3){code.push(processBlock(proc.post,proc,dtypes))}if(proc.debug){console.log("Generated cwise routine for ",typesig,":\n\n",code.join("\n"))}var loopName=[proc.funcName||"unnamed","_cwise_loop_",orders[0].join("s"),"m",matched,typeSummary(dtypes)].join("");var f=new Function(["function ",loopName,"(",arglist.join(","),"){",code.join("\n"),"} return ",loopName].join(""));return f()}module.exports=generateCWiseOp},{uniq:71}],70:[function(require,module,exports){"use strict";var compile=require("./compile.js");function createThunk(proc){var code=["'use strict'","var CACHED={}"];var vars=[];var thunkName=proc.funcName+"_cwise_thunk";code.push(["return function ",thunkName,"(",proc.shimArgs.join(","),"){"].join(""));var typesig=[];var string_typesig=[];var proc_args=[["array",proc.arrayArgs[0],".shape"].join("")];for(var i=0;i<proc.arrayArgs.length;++i){var j=proc.arrayArgs[i];vars.push(["t",j,"=array",j,".dtype,","r",j,"=array",j,".order"].join(""));typesig.push("t"+j);typesig.push("r"+j);string_typesig.push("t"+j);string_typesig.push("r"+j+".join()");proc_args.push("array"+j+".data");proc_args.push("array"+j+".stride");proc_args.push("array"+j+".offset|0")}for(var i=0;i<proc.scalarArgs.length;++i){proc_args.push("scalar"+proc.scalarArgs[i])}vars.push(["type=[",string_typesig.join(","),"].join()"].join(""));vars.push("proc=CACHED[type]");code.push("var "+vars.join(","));code.push(["if(!proc){","CACHED[type]=proc=compile([",typesig.join(","),"])}","return proc(",proc_args.join(","),")}"].join(""));if(proc.debug){console.log("Generated thunk:",code.join("\n"))}var thunk=new Function("compile",code.join("\n"));return thunk(compile.bind(undefined,proc))}module.exports=createThunk},{"./compile.js":69}],71:[function(require,module,exports){"use strict";function unique_pred(list,compare){var ptr=1,len=list.length,a=list[0],b=list[0];for(var i=1;i<len;++i){b=a;a=list[i];if(compare(a,b)){if(i===ptr){ptr++;continue}list[ptr++]=a}}list.length=ptr;return list}function unique_eq(list){var ptr=1,len=list.length,a=list[0],b=list[0];for(var i=1;i<len;++i,b=a){b=a;a=list[i];if(a!==b){if(i===ptr){ptr++;continue}list[ptr++]=a}}list.length=ptr;return list}function unique(list,compare,sorted){if(list.length===0){return list}if(compare){if(!sorted){list.sort(compare)}return unique_pred(list,compare)}if(!sorted){list.sort()}return unique_eq(list)}module.exports=unique},{}],72:[function(require,module,exports){(function(Buffer){var iota=require("iota-array");var hasTypedArrays=typeof Float64Array!=="undefined";var hasBuffer=typeof Buffer!=="undefined";function compare1st(a,b){return a[0]-b[0]}function order(){var stride=this.stride;var terms=new Array(stride.length);var i;for(i=0;i<terms.length;++i){terms[i]=[Math.abs(stride[i]),i]}terms.sort(compare1st);var result=new Array(terms.length);for(i=0;i<result.length;++i){result[i]=terms[i][1]}return result}function compileConstructor(dtype,dimension){var className=["View",dimension,"d",dtype].join("");if(dimension<0){className="View_Nil"+dtype}var useGetters=dtype==="generic";if(dimension===-1){var code="function "+className+"(a){this.data=a;};var proto="+className+".prototype;proto.dtype='"+dtype+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+className+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+className+"(a){return new "+className+"(a);}";var procedure=new Function(code);return procedure()}else if(dimension===0){var code="function "+className+"(a,d) {this.data = a;this.offset = d};var proto="+className+".prototype;proto.dtype='"+dtype+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+className+"_copy() {return new "+className+"(this.data,this.offset)};proto.pick=function "+className+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+className+"_get(){return "+(useGetters?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+className+"_set(v){return "+(useGetters?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+className+"(a,b,c,d){return new "+className+"(a,d)}";var procedure=new Function("TrivialArray",code);return procedure(CACHED_CONSTRUCTORS[dtype][0])}var code=["'use strict'"];var indices=iota(dimension);var args=indices.map(function(i){return"i"+i});var index_str="this.offset+"+indices.map(function(i){return"this.stride["+i+"]*i"+i}).join("+");var shapeArg=indices.map(function(i){return"b"+i}).join(",");var strideArg=indices.map(function(i){return"c"+i}).join(",");code.push("function "+className+"(a,"+shapeArg+","+strideArg+",d){this.data=a","this.shape=["+shapeArg+"]","this.stride=["+strideArg+"]","this.offset=d|0}","var proto="+className+".prototype","proto.dtype='"+dtype+"'","proto.dimension="+dimension);code.push("Object.defineProperty(proto,'size',{get:function "+className+"_size(){return "+indices.map(function(i){return"this.shape["+i+"]"}).join("*"),"}})");if(dimension===1){code.push("proto.order=[0]")}else{code.push("Object.defineProperty(proto,'order',{get:");if(dimension<4){code.push("function "+className+"_order(){");if(dimension===2){code.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})")}else if(dimension===3){code.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")}}else{code.push("ORDER})")}}code.push("proto.set=function "+className+"_set("+args.join(",")+",v){");if(useGetters){code.push("return this.data.set("+index_str+",v)}")}else{code.push("return this.data["+index_str+"]=v}")}code.push("proto.get=function "+className+"_get("+args.join(",")+"){");if(useGetters){code.push("return this.data.get("+index_str+")}")}else{code.push("return this.data["+index_str+"]}")}code.push("proto.index=function "+className+"_index(",args.join(),"){return "+index_str+"}");code.push("proto.hi=function "+className+"_hi("+args.join(",")+"){return new "+className+"(this.data,"+indices.map(function(i){return["(typeof i",i,"!=='number'||i",i,"<0)?this.shape[",i,"]:i",i,"|0"].join("")}).join(",")+","+indices.map(function(i){return"this.stride["+i+"]"}).join(",")+",this.offset)}");var a_vars=indices.map(function(i){return"a"+i+"=this.shape["+i+"]"});var c_vars=indices.map(function(i){return"c"+i+"=this.stride["+i+"]"});code.push("proto.lo=function "+className+"_lo("+args.join(",")+"){var b=this.offset,d=0,"+a_vars.join(",")+","+c_vars.join(","));for(var i=0;i<dimension;++i){code.push("if(typeof i"+i+"==='number'&&i"+i+">=0){d=i"+i+"|0;b+=c"+i+"*d;a"+i+"-=d}")}code.push("return new "+className+"(this.data,"+indices.map(function(i){return"a"+i}).join(",")+","+indices.map(function(i){return"c"+i}).join(",")+",b)}");code.push("proto.step=function "+className+"_step("+args.join(",")+"){var "+indices.map(function(i){return"a"+i+"=this.shape["+i+"]"}).join(",")+","+indices.map(function(i){return"b"+i+"=this.stride["+i+"]"}).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(var i=0;i<dimension;++i){code.push("if(typeof i"+i+"==='number'){d=i"+i+"|0;if(d<0){c+=b"+i+"*(a"+i+"-1);a"+i+"=ceil(-a"+i+"/d)}else{a"+i+"=ceil(a"+i+"/d)}b"+i+"*=d}")}code.push("return new "+className+"(this.data,"+indices.map(function(i){return"a"+i}).join(",")+","+indices.map(function(i){return"b"+i}).join(",")+",c)}");var tShape=new Array(dimension);var tStride=new Array(dimension);for(var i=0;i<dimension;++i){tShape[i]="a[i"+i+"]";tStride[i]="b[i"+i+"]"}code.push("proto.transpose=function "+className+"_transpose("+args+"){"+args.map(function(n,idx){return n+"=("+n+"===undefined?"+idx+":"+n+"|0)"}).join(";"),"var a=this.shape,b=this.stride;return new "+className+"(this.data,"+tShape.join(",")+","+tStride.join(",")+",this.offset)}");code.push("proto.pick=function "+className+"_pick("+args+"){var a=[],b=[],c=this.offset");for(var i=0;i<dimension;++i){code.push("if(typeof i"+i+"==='number'&&i"+i+">=0){c=(c+this.stride["+i+"]*i"+i+")|0}else{a.push(this.shape["+i+"]);b.push(this.stride["+i+"])}")}code.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}");code.push("return function construct_"+className+"(data,shape,stride,offset){return new "+className+"(data,"+indices.map(function(i){return"shape["+i+"]"}).join(",")+","+indices.map(function(i){return"stride["+i+"]"}).join(",")+",offset)}");var procedure=new Function("CTOR_LIST","ORDER",code.join("\n"));return procedure(CACHED_CONSTRUCTORS[dtype],order)}function arrayDType(data){if(hasBuffer){if(Buffer.isBuffer(data)){return"buffer"}}if(hasTypedArrays){switch(Object.prototype.toString.call(data)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped"}}if(Array.isArray(data)){return"array"}return"generic"}var CACHED_CONSTRUCTORS={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],buffer:[],generic:[]};(function(){for(var id in CACHED_CONSTRUCTORS){CACHED_CONSTRUCTORS[id].push(compileConstructor(id,-1))}});function wrappedNDArrayCtor(data,shape,stride,offset){if(data===undefined){var ctor=CACHED_CONSTRUCTORS.array[0];return ctor([])}else if(typeof data==="number"){data=[data]}if(shape===undefined){shape=[data.length]}var d=shape.length;if(stride===undefined){stride=new Array(d);for(var i=d-1,sz=1;i>=0;--i){stride[i]=sz;sz*=shape[i]}}if(offset===undefined){offset=0;for(var i=0;i<d;++i){if(stride[i]<0){offset-=(shape[i]-1)*stride[i]}}}var dtype=arrayDType(data);var ctor_list=CACHED_CONSTRUCTORS[dtype];while(ctor_list.length<=d+1){ctor_list.push(compileConstructor(dtype,ctor_list.length-1))}var ctor=ctor_list[d+1];return ctor(data,shape,stride,offset)}module.exports=wrappedNDArrayCtor}).call(this,require("buffer").Buffer)},{buffer:20,"iota-array":73}],73:[function(require,module,exports){"use strict";function iota(n){var result=new Array(n);for(var i=0;i<n;++i){result[i]=i}return result}module.exports=iota},{}],74:[function(require,module,exports){var int8=new Int8Array(4);var int32=new Int32Array(int8.buffer,0,1);var float32=new Float32Array(int8.buffer,0,1);var NumberUtil=function(){};NumberUtil.intBitsToFloat=function(i){int32[0]=i;return float32[0]};NumberUtil.floatToIntBits=function(f){float32[0]=f;return int32[0]};NumberUtil.intToFloatColor=function(value){return NumberUtil.intBitsToFloat(value&4278190079)};NumberUtil.colorToFloat=function(r,g,b,a){var bits=a<<24|b<<16|g<<8|r;return NumberUtil.intToFloatColor(bits)};NumberUtil.isPowerOfTwo=function(n){return(n&n-1)===0};NumberUtil.nextPowerOfTwo=function(n){n--;n|=n>>1;n|=n>>2;n|=n>>4;n|=n>>8;n|=n>>16;return n+1};module.exports=NumberUtil},{}],75:[function(require,module,exports){module.exports=plucker;function plucker(path,object){return arguments.length>=2?pluck(path)(object):pluck(path)}function pluck(path){path=typeof path==="string"?String(path).trim().split("."):path;if(path.length<2){path=path[0];return pluckSingle}else{var l=path.length;return pluckPath}function pluckSingle(object){return object[path]}function pluckPath(object){for(var i=0;i<l;i++){if(typeof object==="undefined")break;object=object[path[i]]}return object}}},{}],76:[function(require,module,exports){(function(window){var lastTime=0,vendors=["webkit","moz"],requestAnimationFrame=window.requestAnimationFrame,cancelAnimationFrame=window.cancelAnimationFrame,i=vendors.length;while(--i>=0&&!requestAnimationFrame){requestAnimationFrame=window[vendors[i]+"RequestAnimationFrame"];cancelAnimationFrame=window[vendors[i]+"CancelAnimationFrame"]}if(!requestAnimationFrame||!cancelAnimationFrame){requestAnimationFrame=function(callback){var now=+new Date,nextTime=Math.max(lastTime+16,now);return setTimeout(function(){callback(lastTime=nextTime)},nextTime-now)};cancelAnimationFrame=clearTimeout}window.requestAnimationFrame=requestAnimationFrame;window.cancelAnimationFrame=cancelAnimationFrame})(window)},{}],77:[function(require,module,exports){function random(start,end){var n0=typeof start==="number",n1=typeof end==="number";if(n0&&!n1){end=start;start=0}else if(!n0&&!n1){start=0;end=1}return start+Math.random()*(end-start)}module.exports=random},{}],78:[function(require,module,exports){module.exports=function smoothstep(min,max,value){var x=Math.max(0,Math.min(1,(value-min)/(max-min)));return x*x*(3-2*x)}},{}],79:[function(require,module,exports){module.exports=function(THREE){var CopyShader=EffectComposer.CopyShader=require("three-copyshader"),RenderPass=EffectComposer.RenderPass=require("./lib/renderpass")(THREE),ShaderPass=EffectComposer.ShaderPass=require("./lib/shaderpass")(THREE,EffectComposer),MaskPass=EffectComposer.MaskPass=require("./lib/maskpass")(THREE),ClearMaskPass=EffectComposer.ClearMaskPass=require("./lib/clearmaskpass")(THREE);function EffectComposer(renderer,renderTarget){this.renderer=renderer;if(renderTarget===undefined){var width=window.innerWidth||1;var height=window.innerHeight||1;var parameters={minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBFormat,stencilBuffer:false};renderTarget=new THREE.WebGLRenderTarget(width,height,parameters)}this.renderTarget1=renderTarget;this.renderTarget2=renderTarget.clone();this.writeBuffer=this.renderTarget1;this.readBuffer=this.renderTarget2;this.passes=[];this.copyPass=new ShaderPass(CopyShader)}EffectComposer.prototype={swapBuffers:function(){var tmp=this.readBuffer;this.readBuffer=this.writeBuffer;this.writeBuffer=tmp},addPass:function(pass){this.passes.push(pass)},insertPass:function(pass,index){this.passes.splice(index,0,pass)},render:function(delta){this.writeBuffer=this.renderTarget1;this.readBuffer=this.renderTarget2;var maskActive=false;var pass,i,il=this.passes.length;for(i=0;i<il;i++){pass=this.passes[i];if(!pass.enabled)continue;pass.render(this.renderer,this.writeBuffer,this.readBuffer,delta,maskActive);if(pass.needsSwap){if(maskActive){var context=this.renderer.context;context.stencilFunc(context.NOTEQUAL,1,4294967295);this.copyPass.render(this.renderer,this.writeBuffer,this.readBuffer,delta);context.stencilFunc(context.EQUAL,1,4294967295)}this.swapBuffers()}if(pass instanceof MaskPass){maskActive=true}else if(pass instanceof ClearMaskPass){maskActive=false}}},reset:function(renderTarget){if(renderTarget===undefined){renderTarget=this.renderTarget1.clone();renderTarget.width=window.innerWidth;renderTarget.height=window.innerHeight}this.renderTarget1=renderTarget;this.renderTarget2=renderTarget.clone();this.writeBuffer=this.renderTarget1;this.readBuffer=this.renderTarget2},setSize:function(width,height){var renderTarget=this.renderTarget1.clone();renderTarget.width=width;renderTarget.height=height;this.reset(renderTarget)}};EffectComposer.camera=new THREE.OrthographicCamera(-1,1,1,-1,0,1);EffectComposer.quad=new THREE.Mesh(new THREE.PlaneGeometry(2,2),null);EffectComposer.scene=new THREE.Scene;EffectComposer.scene.add(EffectComposer.quad);return EffectComposer}},{"./lib/clearmaskpass":80,"./lib/maskpass":81,"./lib/renderpass":82,"./lib/shaderpass":83,"three-copyshader":84}],80:[function(require,module,exports){module.exports=function(THREE){function ClearMaskPass(){if(!(this instanceof ClearMaskPass))return new ClearMaskPass(scene,camera);this.enabled=true}ClearMaskPass.prototype={render:function(renderer,writeBuffer,readBuffer,delta){var context=renderer.context;context.disable(context.STENCIL_TEST)}};return ClearMaskPass}},{}],81:[function(require,module,exports){module.exports=function(THREE){function MaskPass(scene,camera){if(!(this instanceof MaskPass))return new MaskPass(scene,camera);this.scene=scene;this.camera=camera;this.enabled=true;this.clear=true;this.needsSwap=false;this.inverse=false}MaskPass.prototype={render:function(renderer,writeBuffer,readBuffer,delta){var context=renderer.context;context.colorMask(false,false,false,false);context.depthMask(false);var writeValue,clearValue;if(this.inverse){writeValue=0;clearValue=1}else{writeValue=1;clearValue=0}context.enable(context.STENCIL_TEST);context.stencilOp(context.REPLACE,context.REPLACE,context.REPLACE);context.stencilFunc(context.ALWAYS,writeValue,4294967295);context.clearStencil(clearValue);renderer.render(this.scene,this.camera,readBuffer,this.clear);renderer.render(this.scene,this.camera,writeBuffer,this.clear);context.colorMask(true,true,true,true);context.depthMask(true);context.stencilFunc(context.EQUAL,1,4294967295);context.stencilOp(context.KEEP,context.KEEP,context.KEEP)}};return MaskPass}},{}],82:[function(require,module,exports){module.exports=function(THREE){function RenderPass(scene,camera,overrideMaterial,clearColor,clearAlpha){if(!(this instanceof RenderPass))return new RenderPass(scene,camera,overrideMaterial,clearColor,clearAlpha);this.scene=scene;this.camera=camera;this.overrideMaterial=overrideMaterial;this.clearColor=clearColor;this.clearAlpha=clearAlpha!==undefined?clearAlpha:1;this.oldClearColor=new THREE.Color;this.oldClearAlpha=1;this.enabled=true;this.clear=true;this.needsSwap=false}RenderPass.prototype={render:function(renderer,writeBuffer,readBuffer,delta){this.scene.overrideMaterial=this.overrideMaterial;if(this.clearColor){this.oldClearColor.copy(renderer.getClearColor());this.oldClearAlpha=renderer.getClearAlpha();renderer.setClearColor(this.clearColor,this.clearAlpha)}renderer.render(this.scene,this.camera,readBuffer,this.clear);if(this.clearColor){renderer.setClearColor(this.oldClearColor,this.oldClearAlpha)}this.scene.overrideMaterial=null}};return RenderPass}},{}],83:[function(require,module,exports){module.exports=function(THREE,EffectComposer){function ShaderPass(shader,textureID){if(!(this instanceof ShaderPass))return new ShaderPass(shader,textureID);this.textureID=textureID!==undefined?textureID:"tDiffuse";this.uniforms=THREE.UniformsUtils.clone(shader.uniforms);this.material=new THREE.ShaderMaterial({uniforms:this.uniforms,vertexShader:shader.vertexShader,fragmentShader:shader.fragmentShader});this.renderToScreen=false;this.enabled=true;this.needsSwap=true;this.clear=false}ShaderPass.prototype={render:function(renderer,writeBuffer,readBuffer,delta){if(this.uniforms[this.textureID]){this.uniforms[this.textureID].value=readBuffer}EffectComposer.quad.material=this.material;if(this.renderToScreen){renderer.render(EffectComposer.scene,EffectComposer.camera)}else{renderer.render(EffectComposer.scene,EffectComposer.camera,writeBuffer,this.clear)}}};return ShaderPass}},{}],84:[function(require,module,exports){module.exports={uniforms:{tDiffuse:{type:"t",value:null},opacity:{type:"f",value:1}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform float opacity;","uniform sampler2D tDiffuse;","varying vec2 vUv;","void main() {","vec4 texel = texture2D( tDiffuse, vUv );","gl_FragColor = opacity * texel;","}"].join("\n")}},{}],85:[function(require,module,exports){var createTypes=require("./types");module.exports=function(THREE){var types=createTypes(THREE);return function create(glShader,opts){opts=opts||{};if(typeof opts.colors==="string")opts.colors=[opts.colors];var tUniforms=types(glShader.uniforms,opts.colors);var tAttribs=types(glShader.attributes,opts.colors);for(var k in tAttribs){tAttribs[k].value=[]}return{vertexShader:glShader.vertex,fragmentShader:glShader.fragment,uniforms:tUniforms,attributes:tAttribs}}}},{"./types":86}],86:[function(require,module,exports){var typeMap={"int":"i","float":"f",ivec2:"i2",ivec3:"i3",ivec4:"i4",vec2:"v2",vec3:"v3",vec4:"v4",mat4:"m4",mat3:"m3",sampler2D:"t",samplerCube:"t"};function create(THREE){function newInstance(type,isArray){switch(type){case"float":case"int":return 0;case"vec2":case"ivec2":return new THREE.Vector2;case"vec3":case"ivec3":return new THREE.Vector3;case"vec4":case"ivec4":return new THREE.Vector4;case"mat4":return new THREE.Matrix4;case"mat3":return new THREE.Matrix3;case"samplerCube":case"sampler2D":return new THREE.Texture;default:return undefined}}function defaultValue(type,isArray,arrayLen){if(isArray){if(type==="ivec3")arrayLen*=3;var ar=new Array(arrayLen);for(var i=0;i<ar.length;i++)ar[i]=newInstance(type,isArray);return ar}return newInstance(type)}function getType(type,isArray){if(!isArray)return typeMap[type];if(type==="int")return"iv1";else if(type==="float")return"fv1";else return typeMap[type]+"v"}return function setupUniforms(glUniforms,colorNames){if(!Array.isArray(colorNames))colorNames=Array.prototype.slice.call(arguments,1);var result={};var arrays={};glUniforms.forEach(function(uniform){var name=uniform.name;var isArray=/(.+)\[[0-9]+\]/.exec(name);if(colorNames&&colorNames.indexOf(name)!==-1){if(isArray)throw new Error("array of color uniforms not supported");if(uniform.type!=="vec3")throw new Error("ThreeJS expects vec3 for Color uniforms");result[name]={type:"c",value:new THREE.Color};return}if(isArray){name=isArray[1];if(name in arrays)arrays[name].count++;else arrays[name]={count:1,type:uniform.type}}result[name]={type:getType(uniform.type,isArray),value:isArray?null:defaultValue(uniform.type)}});for(var k in result){var u=result[k];if(k in arrays){var a=arrays[k];u.value=defaultValue(a.type,true,a.count)}}return result}}module.exports=create},{}],87:[function(require,module,exports){module.exports=require("./lib/renderer")},{"./lib/renderer":88}],88:[function(require,module,exports){var createText=require("gl-sprite-text");var mat4={create:require("gl-mat4/create"),scale:require("gl-mat4/scale"),multiply:require("gl-mat4/multiply")};var modelTransform=mat4.create();var flip=mat4.create();mat4.scale(flip,flip,[1,-1,1]);var WrapTexture=require("./texture-wrap");var number=require("as-number");var xtend=require("xtend");var createShader=require("gl-shader-core");var vertex="attribute vec4 position;\nattribute vec4 color;\nattribute vec2 texcoord0;\n\nuniform mat4 projection;\nuniform mat4 view;\nuniform mat4 model;\n\nvarying vec4 v_col;\nvarying vec2 v_tex0;\n\nvoid main() {\n gl_Position = projection * view * model * position;\n v_col = color;\n v_tex0 = texcoord0;\n gl_PointSize = 1.0;\n}";var fragment="#ifdef GL_ES\nprecision mediump float;\n#endif\n\nvarying vec4 v_col;\nvarying vec2 v_tex0;\nuniform sampler2D texture0;\n\nuniform float smoothing;\n// = 1.0/32.0;\n\n// drop shadow computed in fragment shader\nvoid main() {\n vec4 texColor = texture2D(texture0, v_tex0);\n\n float dst = texColor.a;\n float alpha = smoothstep(0.5 - smoothing, 0.5 + smoothing, dst);\n vec4 base = v_col * vec4(alpha);\n\n gl_FragColor = base;\n if (gl_FragColor.a<0.1)\n discard;\n}";var uniforms=[{type:"float",name:"smoothing"},{type:"sampler2D",name:"texture0"},{type:"mat4",name:"projection"},{type:"mat4",name:"view"},{type:"mat4",name:"model"}],attributes=[{type:"vec4",name:"position"},{type:"vec4",name:"color"},{type:"vec2",name:"texcoord0"}];function copyColor(out,color,opacity){out[0]=color.r;out[1]=color.g;out[2]=color.b;out[3]=opacity}module.exports=function(THREE){var sharedShader;function TextRenderer(renderer,opt){if(!(this instanceof TextRenderer))return new TextRenderer(renderer,opt);opt=opt||{};var gl=renderer.getContext();this.gl=gl;this.color=new THREE.Color;if(opt.color!==null&&typeof opt.color!=="undefined")this.color.set(opt.color);this.opacity=number(opt.opacity,1);var textOpts=xtend(opt);
if(textOpts.textures){textOpts.textures=textOpts.textures.map(function(tex){if(tex instanceof THREE.Texture)return WrapTexture(renderer,tex);return tex})}this.element=createText(gl,textOpts);this.transform=mat4.create();if(!sharedShader&&!opt.shader)sharedShader=createShader(gl,vertex,fragment,uniforms,attributes);this.shader=opt.shader||sharedShader;this.shader.bind();this.padding=number(opt.padding,0);var s=number(opt.smoothing,1/32);this.shader.uniforms.smoothing=s;this.shader.uniforms.texture0=0}TextRenderer.prototype.draw=function(camera,object){var gl=this.gl;if(!object.visible)return;if(!this.element.textures||this.element.textures.length===0)return;gl.enable(gl.BLEND);gl.enable(gl.DEPTH_TEST);gl.depthFunc(gl.LEQUAL);gl.enable(gl.CULL_FACE);gl.colorMask(true,true,true,true);gl.disable(gl.STENCIL_TEST);gl.activeTexture(gl.TEXTURE0);gl.depthMask(true);gl.blendFunc(gl.SRC_ALPHA,gl.ONE_MINUS_SRC_ALPHA);this.shader.bind();this.element.textures[0].bind(0);gl.cullFace(gl.FRONT);mat4.multiply(modelTransform,object.matrixWorld.elements,this.transform);mat4.multiply(modelTransform,modelTransform,flip);this.shader.bind();this.shader.uniforms.projection=camera.projectionMatrix.elements;this.shader.uniforms.view=camera.matrixWorldInverse.elements;this.shader.uniforms.model=modelTransform;copyColor(this.element.batch.color,this.color,this.opacity);this.element.draw(this.shader,this.padding,this.padding);gl.cullFace(gl.BACK)};return TextRenderer}},{"./texture-wrap":89,"as-number":19,"gl-mat4/create":32,"gl-mat4/multiply":34,"gl-mat4/scale":35,"gl-shader-core":40,"gl-sprite-text":41,xtend:100}],89:[function(require,module,exports){function TextureWrap(renderer,tex){if(!(this instanceof TextureWrap))return new TextureWrap(renderer,tex);this.renderer=renderer;this.texture=tex;this._shape=[0,0]}TextureWrap.prototype.bind=function(unit){updateSize(this._shape,this.texture);var gl=this.renderer.getContext();this.renderer.setTexture(this.texture,unit|0);gl.bindTexture(gl.TEXTURE_2D,this.texture.__webglTexture)};Object.defineProperty(TextureWrap.prototype,"shape",{get:function(){updateSize(this._shape,this.texture);return this._shape}});function updateSize(shape,texture){shape[0]=(texture.image&&texture.image.width)|0;shape[1]=(texture.image&&texture.image.height)|0}module.exports=TextureWrap},{}],90:[function(require,module,exports){module.exports={vertex:"\n#define GLSLIFY 1\n\nvarying vec2 vUv;\nvarying vec2 v_rgbNW;\nvarying vec2 v_rgbNE;\nvarying vec2 v_rgbSW;\nvarying vec2 v_rgbSE;\nvarying vec2 v_rgbM;\nuniform vec2 resolution;\nvoid a_x_texcoords(vec2 fragCoord, vec2 resolution, out vec2 v_rgbNW, out vec2 v_rgbNE, out vec2 v_rgbSW, out vec2 v_rgbSE, out vec2 v_rgbM) {\n  vec2 inverseVP = 1.0 / resolution.xy;\n  v_rgbNW = (fragCoord + vec2(-1.0, -1.0)) * inverseVP;\n  v_rgbNE = (fragCoord + vec2(1.0, -1.0)) * inverseVP;\n  v_rgbSW = (fragCoord + vec2(-1.0, 1.0)) * inverseVP;\n  v_rgbSE = (fragCoord + vec2(1.0, 1.0)) * inverseVP;\n  v_rgbM = vec2(fragCoord * inverseVP);\n}\nvoid main() {\n  vUv = uv;\n  vec2 fragCoord = uv * resolution;\n  a_x_texcoords(fragCoord, resolution, v_rgbNW, v_rgbNE, v_rgbSW, v_rgbSE, v_rgbM);\n  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}",fragment:"\n#define GLSLIFY 1\n\nvarying vec2 vUv;\nvarying vec2 v_rgbNW;\nvarying vec2 v_rgbNE;\nvarying vec2 v_rgbSW;\nvarying vec2 v_rgbSE;\nvarying vec2 v_rgbM;\nuniform vec2 resolution;\nuniform sampler2D tDiffuse;\n#ifndef FXAA_REDUCE_MIN\n\n#define FXAA_REDUCE_MIN   (1.0/ 128.0)\n\n#endif\n\n#ifndef FXAA_REDUCE_MUL\n\n#define FXAA_REDUCE_MUL   (1.0 / 8.0)\n\n#endif\n\n#ifndef FXAA_SPAN_MAX\n\n#define FXAA_SPAN_MAX     8.0\n\n#endif\n\nvec4 a_x_fxaa(sampler2D tex, vec2 fragCoord, vec2 resolution, vec2 v_rgbNW, vec2 v_rgbNE, vec2 v_rgbSW, vec2 v_rgbSE, vec2 v_rgbM) {\n  vec4 color;\n  mediump vec2 inverseVP = vec2(1.0 / resolution.x, 1.0 / resolution.y);\n  vec3 rgbNW = texture2D(tex, v_rgbNW).xyz;\n  vec3 rgbNE = texture2D(tex, v_rgbNE).xyz;\n  vec3 rgbSW = texture2D(tex, v_rgbSW).xyz;\n  vec3 rgbSE = texture2D(tex, v_rgbSE).xyz;\n  vec4 texColor = texture2D(tex, v_rgbM);\n  vec3 rgbM = texColor.xyz;\n  vec3 luma = vec3(0.299, 0.587, 0.114);\n  float lumaNW = dot(rgbNW, luma);\n  float lumaNE = dot(rgbNE, luma);\n  float lumaSW = dot(rgbSW, luma);\n  float lumaSE = dot(rgbSE, luma);\n  float lumaM = dot(rgbM, luma);\n  float lumaMin = min(lumaM, min(min(lumaNW, lumaNE), min(lumaSW, lumaSE)));\n  float lumaMax = max(lumaM, max(max(lumaNW, lumaNE), max(lumaSW, lumaSE)));\n  mediump vec2 dir;\n  dir.x = -((lumaNW + lumaNE) - (lumaSW + lumaSE));\n  dir.y = ((lumaNW + lumaSW) - (lumaNE + lumaSE));\n  float dirReduce = max((lumaNW + lumaNE + lumaSW + lumaSE) * (0.25 * FXAA_REDUCE_MUL), FXAA_REDUCE_MIN);\n  float rcpDirMin = 1.0 / (min(abs(dir.x), abs(dir.y)) + dirReduce);\n  dir = min(vec2(FXAA_SPAN_MAX, FXAA_SPAN_MAX), max(vec2(-FXAA_SPAN_MAX, -FXAA_SPAN_MAX), dir * rcpDirMin)) * inverseVP;\n  vec3 rgbA = 0.5 * (texture2D(tex, fragCoord * inverseVP + dir * (1.0 / 3.0 - 0.5)).xyz + texture2D(tex, fragCoord * inverseVP + dir * (2.0 / 3.0 - 0.5)).xyz);\n  vec3 rgbB = rgbA * 0.5 + 0.25 * (texture2D(tex, fragCoord * inverseVP + dir * -0.5).xyz + texture2D(tex, fragCoord * inverseVP + dir * 0.5).xyz);\n  float lumaB = dot(rgbB, luma);\n  if((lumaB < lumaMin) || (lumaB > lumaMax))\n    color = vec4(rgbA, texColor.a);\n  else\n    color = vec4(rgbB, texColor.a);\n  return color;\n}\nvoid main() {\n  vec2 fragCoord = vUv * resolution;\n  gl_FragColor = a_x_fxaa(tDiffuse, fragCoord, resolution, v_rgbNW, v_rgbNE, v_rgbSW, v_rgbSE, v_rgbM);\n}",uniforms:[{name:"resolution",type:"vec2"},{name:"resolution",type:"vec2"},{name:"tDiffuse",type:"sampler2D"}],attributes:[]}},{}],91:[function(require,module,exports){var threeify=require("three-glslify");var source=require("./compiled");module.exports=function(THREE){var createShader=threeify(THREE);return function(){return createShader(source)}}},{"./compiled":90,"three-glslify":85}],92:[function(require,module,exports){var inherits=require("inherits");module.exports=function(THREE){function Complex(mesh){if(!(this instanceof Complex))return new Complex(mesh);THREE.Geometry.call(this);this.dynamic=true;if(mesh)this.update(mesh)}inherits(Complex,THREE.Geometry);Complex.prototype._updatePositions=function(positions){for(var i=0;i<positions.length;i++){var pos=positions[i];if(i>this.vertices.length-1)this.vertices.push((new THREE.Vector3).fromArray(pos));else this.vertices[i].fromArray(pos)}this.vertices.length=positions.length;this.verticesNeedUpdate=true};Complex.prototype._updateCells=function(cells){for(var i=0;i<cells.length;i++){var face=cells[i];if(i>this.faces.length-1)this.faces.push(new THREE.Face3(face[0],face[1],face[2]));else{var tf=this.faces[i];tf.a=face[0];tf.b=face[1];tf.c=face[2]}}this.faces.length=cells.length;this.elementsNeedUpdate=true};Complex.prototype.update=function(mesh){this._updatePositions(mesh.positions);this._updateCells(mesh.cells)};return Complex}},{inherits:64}],93:[function(require,module,exports){"use strict";"use restrict";var INT_BITS=32;exports.INT_BITS=INT_BITS;exports.INT_MAX=2147483647;exports.INT_MIN=-1<<INT_BITS-1;exports.sign=function(v){return(v>0)-(v<0)};exports.abs=function(v){var mask=v>>INT_BITS-1;return(v^mask)-mask};exports.min=function(x,y){return y^(x^y)&-(x<y)};exports.max=function(x,y){return x^(x^y)&-(x<y)};exports.isPow2=function(v){return!(v&v-1)&&!!v};exports.log2=function(v){var r,shift;r=(v>65535)<<4;v>>>=r;shift=(v>255)<<3;v>>>=shift;r|=shift;shift=(v>15)<<2;v>>>=shift;r|=shift;shift=(v>3)<<1;v>>>=shift;r|=shift;return r|v>>1};exports.log10=function(v){return v>=1e9?9:v>=1e8?8:v>=1e7?7:v>=1e6?6:v>=1e5?5:v>=1e4?4:v>=1e3?3:v>=100?2:v>=10?1:0};exports.popCount=function(v){v=v-(v>>>1&1431655765);v=(v&858993459)+(v>>>2&858993459);return(v+(v>>>4)&252645135)*16843009>>>24};function countTrailingZeros(v){var c=32;v&=-v;if(v)c--;if(v&65535)c-=16;if(v&16711935)c-=8;if(v&252645135)c-=4;if(v&858993459)c-=2;if(v&1431655765)c-=1;return c}exports.countTrailingZeros=countTrailingZeros;exports.nextPow2=function(v){v+=v===0;--v;v|=v>>>1;v|=v>>>2;v|=v>>>4;v|=v>>>8;v|=v>>>16;return v+1};exports.prevPow2=function(v){v|=v>>>1;v|=v>>>2;v|=v>>>4;v|=v>>>8;v|=v>>>16;return v-(v>>>1)};exports.parity=function(v){v^=v>>>16;v^=v>>>8;v^=v>>>4;v&=15;return 27030>>>v&1};var REVERSE_TABLE=new Array(256);(function(tab){for(var i=0;i<256;++i){var v=i,r=i,s=7;for(v>>>=1;v;v>>>=1){r<<=1;r|=v&1;--s}tab[i]=r<<s&255}})(REVERSE_TABLE);exports.reverse=function(v){return REVERSE_TABLE[v&255]<<24|REVERSE_TABLE[v>>>8&255]<<16|REVERSE_TABLE[v>>>16&255]<<8|REVERSE_TABLE[v>>>24&255]};exports.interleave2=function(x,y){x&=65535;x=(x|x<<8)&16711935;x=(x|x<<4)&252645135;x=(x|x<<2)&858993459;x=(x|x<<1)&1431655765;y&=65535;y=(y|y<<8)&16711935;y=(y|y<<4)&252645135;y=(y|y<<2)&858993459;y=(y|y<<1)&1431655765;return x|y<<1};exports.deinterleave2=function(v,n){v=v>>>n&1431655765;v=(v|v>>>1)&858993459;v=(v|v>>>2)&252645135;v=(v|v>>>4)&16711935;v=(v|v>>>16)&65535;return v<<16>>16};exports.interleave3=function(x,y,z){x&=1023;x=(x|x<<16)&4278190335;x=(x|x<<8)&251719695;x=(x|x<<4)&3272356035;x=(x|x<<2)&1227133513;y&=1023;y=(y|y<<16)&4278190335;y=(y|y<<8)&251719695;y=(y|y<<4)&3272356035;y=(y|y<<2)&1227133513;x|=y<<1;z&=1023;z=(z|z<<16)&4278190335;z=(z|z<<8)&251719695;z=(z|z<<4)&3272356035;z=(z|z<<2)&1227133513;return x|z<<2};exports.deinterleave3=function(v,n){v=v>>>n&1227133513;v=(v|v>>>2)&3272356035;v=(v|v>>>4)&251719695;v=(v|v>>>8)&4278190335;v=(v|v>>>16)&1023;return v<<22>>22};exports.nextCombination=function(v){var t=v|v-1;return t+1|(~t&-~t)-1>>>countTrailingZeros(v)+1}},{}],94:[function(require,module,exports){(function(global,Buffer){"use strict";var bits=require("bit-twiddle");var dup=require("dup");if(!global.__TYPEDARRAY_POOL){global.__TYPEDARRAY_POOL={UINT8:dup([32,0]),UINT16:dup([32,0]),UINT32:dup([32,0]),INT8:dup([32,0]),INT16:dup([32,0]),INT32:dup([32,0]),FLOAT:dup([32,0]),DOUBLE:dup([32,0]),DATA:dup([32,0]),UINT8C:dup([32,0]),BUFFER:dup([32,0])}}var hasUint8C=typeof Uint8ClampedArray!=="undefined";var POOL=global.__TYPEDARRAY_POOL;if(!POOL.UINT8C){POOL.UINT8C=dup([32,0])}if(!POOL.BUFFER){POOL.BUFFER=dup([32,0])}var DATA=POOL.DATA,BUFFER=POOL.BUFFER;exports.free=function free(array){if(Buffer.isBuffer(array)){BUFFER[bits.log2(array.length)].push(array)}else{if(Object.prototype.toString.call(array)!=="[object ArrayBuffer]"){array=array.buffer}if(!array){return}var n=array.length||array.byteLength;var log_n=bits.log2(n)|0;DATA[log_n].push(array)}};function freeArrayBuffer(buffer){if(!buffer){return}var n=buffer.length||buffer.byteLength;var log_n=bits.log2(n);DATA[log_n].push(buffer)}function freeTypedArray(array){freeArrayBuffer(array.buffer)}exports.freeUint8=exports.freeUint16=exports.freeUint32=exports.freeInt8=exports.freeInt16=exports.freeInt32=exports.freeFloat32=exports.freeFloat=exports.freeFloat64=exports.freeDouble=exports.freeUint8Clamped=exports.freeDataView=freeTypedArray;exports.freeArrayBuffer=freeArrayBuffer;exports.freeBuffer=function freeBuffer(array){BUFFER[bits.log2(array.length)].push(array)};exports.malloc=function malloc(n,dtype){if(dtype===undefined||dtype==="arraybuffer"){return mallocArrayBuffer(n)}else{switch(dtype){case"uint8":return mallocUint8(n);case"uint16":return mallocUint16(n);case"uint32":return mallocUint32(n);case"int8":return mallocInt8(n);case"int16":return mallocInt16(n);case"int32":return mallocInt32(n);case"float":case"float32":return mallocFloat(n);case"double":case"float64":return mallocDouble(n);case"uint8_clamped":return mallocUint8Clamped(n);case"buffer":return mallocBuffer(n);case"data":case"dataview":return mallocDataView(n);default:return null}}return null};function mallocArrayBuffer(n){var n=bits.nextPow2(n);var log_n=bits.log2(n);var d=DATA[log_n];if(d.length>0){return d.pop()}return new ArrayBuffer(n)}exports.mallocArrayBuffer=mallocArrayBuffer;function mallocUint8(n){return new Uint8Array(mallocArrayBuffer(n),0,n)}exports.mallocUint8=mallocUint8;function mallocUint16(n){return new Uint16Array(mallocArrayBuffer(2*n),0,n)}exports.mallocUint16=mallocUint16;function mallocUint32(n){return new Uint32Array(mallocArrayBuffer(4*n),0,n)}exports.mallocUint32=mallocUint32;function mallocInt8(n){return new Int8Array(mallocArrayBuffer(n),0,n)}exports.mallocInt8=mallocInt8;function mallocInt16(n){return new Int16Array(mallocArrayBuffer(2*n),0,n)}exports.mallocInt16=mallocInt16;function mallocInt32(n){return new Int32Array(mallocArrayBuffer(4*n),0,n)}exports.mallocInt32=mallocInt32;function mallocFloat(n){return new Float32Array(mallocArrayBuffer(4*n),0,n)}exports.mallocFloat32=exports.mallocFloat=mallocFloat;function mallocDouble(n){return new Float64Array(mallocArrayBuffer(8*n),0,n)}exports.mallocFloat64=exports.mallocDouble=mallocDouble;function mallocUint8Clamped(n){if(hasUint8C){return new Uint8ClampedArray(mallocArrayBuffer(n),0,n)}else{return mallocUint8(n)}}exports.mallocUint8Clamped=mallocUint8Clamped;function mallocDataView(n){return new DataView(mallocArrayBuffer(n),0,n)}exports.mallocDataView=mallocDataView;function mallocBuffer(n){n=bits.nextPow2(n);var log_n=bits.log2(n);var cache=BUFFER[log_n];if(cache.length>0){return cache.pop()}return new Buffer(n)}exports.mallocBuffer=mallocBuffer;exports.clearCache=function clearCache(){for(var i=0;i<32;++i){POOL.UINT8[i].length=0;POOL.UINT16[i].length=0;POOL.UINT32[i].length=0;POOL.INT8[i].length=0;POOL.INT16[i].length=0;POOL.INT32[i].length=0;POOL.FLOAT[i].length=0;POOL.DOUBLE[i].length=0;POOL.UINT8C[i].length=0;DATA[i].length=0;BUFFER[i].length=0}}}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{},require("buffer").Buffer)},{"bit-twiddle":93,buffer:20,dup:31}],95:[function(require,module,exports){var defaultOptions={emptyUserAgentDeviceType:"desktop",unknownUserAgentDeviceType:"phone",botUserAgentDeviceType:"bot"};var devices={tv:"tv",tablet:"tablet",phone:"phone",desktop:"desktop",bot:"bot"};module.exports=function(ua,options){options=options||{};if(!ua||ua===""){return options.emptyUserAgentDeviceType||devices.desktop}if(ua.match(/GoogleTV|SmartTV|Internet TV|NetCast|NETTV|AppleTV|boxee|Kylo|Roku|DLNADOC|CE\-HTML/i)){return devices.tv}else if(ua.match(/Xbox|PLAYSTATION 3|Wii/i)){return devices.tv}else if(ua.match(/iP(a|ro)d/i)||ua.match(/tablet/i)&&!ua.match(/RX-34/i)||ua.match(/FOLIO/i)){return devices.tablet}else if(ua.match(/Linux/i)&&ua.match(/Android/i)&&!ua.match(/Fennec|mobi|HTC Magic|HTCX06HT|Nexus One|SC-02B|fone 945/i)){return devices.tablet}else if(ua.match(/Kindle/i)||ua.match(/Mac OS/i)&&ua.match(/Silk/i)){return devices.tablet}else if(ua.match(/GT-P10|SC-01C|SHW-M180S|SGH-T849|SCH-I800|SHW-M180L|SPH-P100|SGH-I987|zt180|HTC( Flyer|_Flyer)|Sprint ATP51|ViewPad7|pandigital(sprnova|nova)|Ideos S7|Dell Streak 7|Advent Vega|A101IT|A70BHT|MID7015|Next2|nook/i)||ua.match(/MB511/i)&&ua.match(/RUTEM/i)){return devices.tablet}else if(ua.match(/BOLT|Fennec|Iris|Maemo|Minimo|Mobi|mowser|NetFront|Novarra|Prism|RX-34|Skyfire|Tear|XV6875|XV6975|Google Wireless Transcoder/i)){return devices.phone}else if(ua.match(/Opera/i)&&ua.match(/Windows NT 5/i)&&ua.match(/HTC|Xda|Mini|Vario|SAMSUNG\-GT\-i8000|SAMSUNG\-SGH\-i9/i)){return devices.phone}else if(ua.match(/Windows (NT|XP|ME|9)/)&&!ua.match(/Phone/i)&&!ua.match(/Bot|Spider|ia_archiver|NewsGator/i)||ua.match(/Win( ?9|NT)/i)){return devices.desktop}else if(ua.match(/Macintosh|PowerPC/i)&&!ua.match(/Silk/i)){return devices.desktop}else if(ua.match(/Linux/i)&&ua.match(/X11/i)&&!ua.match(/Charlotte/i)){return devices.desktop}else if(ua.match(/CrOS/)){return devices.desktop}else if(ua.match(/Solaris|SunOS|BSD/i)){return devices.desktop}else if(ua.match(/curl|Bot|B-O-T|Crawler|Spider|Spyder|Yahoo|ia_archiver|Covario-IDS|findlinks|DataparkSearch|larbin|Mediapartners-Google|NG-Search|Snappy|Teoma|Jeeves|Charlotte|NewsGator|TinEye|Cerberian|SearchSight|Zao|Scrubby|Qseero|PycURL|Pompos|oegp|SBIder|yoogliFetchAgent|yacy|webcollage|VYU2|voyager|updated|truwoGPS|StackRambler|Sqworm|silk|semanticdiscovery|ScoutJet|Nymesis|NetResearchServer|MVAClient|mogimogi|Mnogosearch|Arachmo|Accoona|holmes|htdig|ichiro|webis|LinkWalker|lwp-trivial/i)&&!ua.match(/mobile|Playstation/i)){return options.botUserAgentDeviceType||devices.bot}else{return options.unknownUserAgentDeviceType||devices.phone}};module.exports.devices=devices;module.exports.defaultOptions=defaultOptions},{}],96:[function(require,module,exports){module.exports=function range(min,max,value){return(value-min)/(max-min)}},{}],97:[function(require,module,exports){module.exports=function(opts){if(typeof document==="undefined")return null;opts=opts||{};var canvas=opts.canvas||document.createElement("canvas");if(typeof opts.width==="number")canvas.width=opts.width;if(typeof opts.height==="number")canvas.height=opts.height;var attribs=opts;var gl;try{gl=canvas.getContext("webgl",attribs)||canvas.getContext("experimental-webgl",attribs)}catch(e){gl=null}return gl||null}},{}],98:[function(require,module,exports){(function WeakMapModule(){"use strict";if(typeof ses!=="undefined"&&ses.ok&&!ses.ok()){return}function weakMapPermitHostObjects(map){if(map.permitHostObjects___){map.permitHostObjects___(weakMapPermitHostObjects)}}if(typeof ses!=="undefined"){ses.weakMapPermitHostObjects=weakMapPermitHostObjects}var doubleWeakMapCheckSilentFailure=false;if(typeof WeakMap==="function"){var HostWeakMap=WeakMap;if(typeof navigator!=="undefined"&&/Firefox/.test(navigator.userAgent)){}else{var testMap=new HostWeakMap;var testObject=Object.freeze({});testMap.set(testObject,1);if(testMap.get(testObject)!==1){doubleWeakMapCheckSilentFailure=true}else{module.exports=WeakMap;return}}}var hop=Object.prototype.hasOwnProperty;var gopn=Object.getOwnPropertyNames;var defProp=Object.defineProperty;var isExtensible=Object.isExtensible;var HIDDEN_NAME_PREFIX="weakmap:";var HIDDEN_NAME=HIDDEN_NAME_PREFIX+"ident:"+Math.random()+"___";if(typeof crypto!=="undefined"&&typeof crypto.getRandomValues==="function"&&typeof ArrayBuffer==="function"&&typeof Uint8Array==="function"){var ab=new ArrayBuffer(25);var u8s=new Uint8Array(ab);crypto.getRandomValues(u8s);HIDDEN_NAME=HIDDEN_NAME_PREFIX+"rand:"+Array.prototype.map.call(u8s,function(u8){return(u8%36).toString(36)}).join("")+"___"}function isNotHiddenName(name){return!(name.substr(0,HIDDEN_NAME_PREFIX.length)==HIDDEN_NAME_PREFIX&&name.substr(name.length-3)==="___")}defProp(Object,"getOwnPropertyNames",{value:function fakeGetOwnPropertyNames(obj){return gopn(obj).filter(isNotHiddenName)}});if("getPropertyNames"in Object){var originalGetPropertyNames=Object.getPropertyNames;defProp(Object,"getPropertyNames",{value:function fakeGetPropertyNames(obj){return originalGetPropertyNames(obj).filter(isNotHiddenName)}})}function getHiddenRecord(key){if(key!==Object(key)){throw new TypeError("Not an object: "+key)}var hiddenRecord=key[HIDDEN_NAME];if(hiddenRecord&&hiddenRecord.key===key){return hiddenRecord}if(!isExtensible(key)){return void 0}hiddenRecord={key:key};try{defProp(key,HIDDEN_NAME,{value:hiddenRecord,writable:false,enumerable:false,configurable:false});return hiddenRecord}catch(error){return void 0}}(function(){var oldFreeze=Object.freeze;defProp(Object,"freeze",{value:function identifyingFreeze(obj){getHiddenRecord(obj);return oldFreeze(obj)}});var oldSeal=Object.seal;defProp(Object,"seal",{value:function identifyingSeal(obj){getHiddenRecord(obj);return oldSeal(obj)}});var oldPreventExtensions=Object.preventExtensions;defProp(Object,"preventExtensions",{value:function identifyingPreventExtensions(obj){getHiddenRecord(obj);return oldPreventExtensions(obj)}})})();function constFunc(func){func.prototype=null;return Object.freeze(func)}var calledAsFunctionWarningDone=false;function calledAsFunctionWarning(){if(!calledAsFunctionWarningDone&&typeof console!=="undefined"){calledAsFunctionWarningDone=true;console.warn("WeakMap should be invoked as new WeakMap(), not "+"WeakMap(). This will be an error in the future.")}}var nextId=0;var OurWeakMap=function(){if(!(this instanceof OurWeakMap)){calledAsFunctionWarning()}var keys=[];var values=[];var id=nextId++;function get___(key,opt_default){var index;var hiddenRecord=getHiddenRecord(key);if(hiddenRecord){return id in hiddenRecord?hiddenRecord[id]:opt_default}else{index=keys.indexOf(key);return index>=0?values[index]:opt_default}}function has___(key){var hiddenRecord=getHiddenRecord(key);if(hiddenRecord){return id in hiddenRecord}else{return keys.indexOf(key)>=0}}function set___(key,value){var index;var hiddenRecord=getHiddenRecord(key);if(hiddenRecord){hiddenRecord[id]=value}else{index=keys.indexOf(key);if(index>=0){values[index]=value}else{index=keys.length;values[index]=value;keys[index]=key}}return this}function delete___(key){var hiddenRecord=getHiddenRecord(key);var index,lastIndex;if(hiddenRecord){return id in hiddenRecord&&delete hiddenRecord[id]}else{index=keys.indexOf(key);if(index<0){return false}lastIndex=keys.length-1;keys[index]=void 0;values[index]=values[lastIndex];keys[index]=keys[lastIndex];keys.length=lastIndex;values.length=lastIndex;return true}}return Object.create(OurWeakMap.prototype,{get___:{value:constFunc(get___)},has___:{value:constFunc(has___)},set___:{value:constFunc(set___)},delete___:{value:constFunc(delete___)}})};OurWeakMap.prototype=Object.create(Object.prototype,{get:{value:function get(key,opt_default){return this.get___(key,opt_default)},writable:true,configurable:true},has:{value:function has(key){return this.has___(key)},writable:true,configurable:true},set:{value:function set(key,value){return this.set___(key,value)},writable:true,configurable:true},"delete":{value:function remove(key){return this.delete___(key)},writable:true,configurable:true}});if(typeof HostWeakMap==="function"){(function(){if(doubleWeakMapCheckSilentFailure&&typeof Proxy!=="undefined"){Proxy=undefined}function DoubleWeakMap(){if(!(this instanceof OurWeakMap)){calledAsFunctionWarning()}var hmap=new HostWeakMap;var omap=undefined;var enableSwitching=false;function dget(key,opt_default){if(omap){return hmap.has(key)?hmap.get(key):omap.get___(key,opt_default)}else{return hmap.get(key,opt_default)}}function dhas(key){return hmap.has(key)||(omap?omap.has___(key):false)}var dset;if(doubleWeakMapCheckSilentFailure){dset=function(key,value){hmap.set(key,value);if(!hmap.has(key)){if(!omap){omap=new OurWeakMap}omap.set(key,value)}return this}}else{dset=function(key,value){if(enableSwitching){try{hmap.set(key,value)}catch(e){if(!omap){omap=new OurWeakMap}omap.set___(key,value)}}else{hmap.set(key,value)}return this}}function ddelete(key){var result=!!hmap["delete"](key);if(omap){return omap.delete___(key)||result}return result}return Object.create(OurWeakMap.prototype,{get___:{value:constFunc(dget)},has___:{value:constFunc(dhas)},set___:{value:constFunc(dset)},delete___:{value:constFunc(ddelete)},permitHostObjects___:{value:constFunc(function(token){if(token===weakMapPermitHostObjects){enableSwitching=true}else{throw new Error("bogus call to permitHostObjects___")}})}})}DoubleWeakMap.prototype=OurWeakMap.prototype;module.exports=DoubleWeakMap;Object.defineProperty(WeakMap.prototype,"constructor",{value:WeakMap,enumerable:false,configurable:true,writable:true})})()}else{if(typeof Proxy!=="undefined"){Proxy=undefined}module.exports=OurWeakMap}})()},{}],99:[function(require,module,exports){"use strict";var weakMap=typeof WeakMap==="undefined"?require("weak-map"):WeakMap;var WebGLEWStruct=new weakMap;function baseName(ext_name){return ext_name.replace(/^[A-Z]+_/,"")}function initWebGLEW(gl){var struct=WebGLEWStruct.get(gl);if(struct){return struct}var extensions={};var supported=gl.getSupportedExtensions();for(var i=0;i<supported.length;++i){var extName=supported[i];if(extName.indexOf("MOZ_")===0){continue}var ext=gl.getExtension(supported[i]);if(!ext){continue}while(true){extensions[extName]=ext;var base=baseName(extName);if(base===extName){break}extName=base}}WebGLEWStruct.set(gl,extensions);return extensions}module.exports=initWebGLEW},{"weak-map":98}],100:[function(require,module,exports){module.exports=extend;function extend(){var target={};for(var i=0;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(source.hasOwnProperty(key)){target[key]=source[key]}}}return target}},{}]},{},[1])(1)});