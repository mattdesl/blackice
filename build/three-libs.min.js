var _gsScope=typeof module!=="undefined"&&module.exports&&typeof global!=="undefined"?global:this||window;(_gsScope._gsQueue||(_gsScope._gsQueue=[])).push(function(){"use strict";_gsScope._gsDefine("TweenMax",["core.Animation","core.SimpleTimeline","TweenLite"],function(Animation,SimpleTimeline,TweenLite){var _slice=function(a){var b=[],l=a.length,i;for(i=0;i!==l;b.push(a[i++]));return b},TweenMax=function(target,duration,vars){TweenLite.call(this,target,duration,vars);this._cycle=0;this._yoyo=this.vars.yoyo===true;this._repeat=this.vars.repeat||0;this._repeatDelay=this.vars.repeatDelay||0;this._dirty=true;this.render=TweenMax.prototype.render},_tinyNum=1e-10,TweenLiteInternals=TweenLite._internals,_isSelector=TweenLiteInternals.isSelector,_isArray=TweenLiteInternals.isArray,p=TweenMax.prototype=TweenLite.to({},.1,{}),_blankArray=[];TweenMax.version="1.14.1";p.constructor=TweenMax;p.kill()._gc=false;TweenMax.killTweensOf=TweenMax.killDelayedCallsTo=TweenLite.killTweensOf;TweenMax.getTweensOf=TweenLite.getTweensOf;TweenMax.lagSmoothing=TweenLite.lagSmoothing;TweenMax.ticker=TweenLite.ticker;TweenMax.render=TweenLite.render;p.invalidate=function(){this._yoyo=this.vars.yoyo===true;this._repeat=this.vars.repeat||0;this._repeatDelay=this.vars.repeatDelay||0;this._uncache(true);return TweenLite.prototype.invalidate.call(this)};p.updateTo=function(vars,resetDuration){var curRatio=this.ratio,p;if(resetDuration&&this._startTime<this._timeline._time){this._startTime=this._timeline._time;this._uncache(false);if(this._gc){this._enabled(true,false)}else{this._timeline.insert(this,this._startTime-this._delay)}}for(p in vars){this.vars[p]=vars[p]}if(this._initted){if(resetDuration){this._initted=false}else{if(this._gc){this._enabled(true,false)}if(this._notifyPluginsOfEnabled&&this._firstPT){TweenLite._onPluginEvent("_onDisable",this)}if(this._time/this._duration>.998){var prevTime=this._time;this.render(0,true,false);this._initted=false;this.render(prevTime,true,false)}else if(this._time>0){this._initted=false;this._init();var inv=1/(1-curRatio),pt=this._firstPT,endValue;while(pt){endValue=pt.s+pt.c;pt.c*=inv;pt.s=endValue-pt.c;pt=pt._next}}}}return this};p.render=function(time,suppressEvents,force){if(!this._initted)if(this._duration===0&&this.vars.repeat){this.invalidate()}var totalDur=!this._dirty?this._totalDuration:this.totalDuration(),prevTime=this._time,prevTotalTime=this._totalTime,prevCycle=this._cycle,duration=this._duration,prevRawPrevTime=this._rawPrevTime,isComplete,callback,pt,cycleDuration,r,type,pow,rawPrevTime,i;if(time>=totalDur){this._totalTime=totalDur;this._cycle=this._repeat;if(this._yoyo&&(this._cycle&1)!==0){this._time=0;this.ratio=this._ease._calcEnd?this._ease.getRatio(0):0}else{this._time=duration;this.ratio=this._ease._calcEnd?this._ease.getRatio(1):1}if(!this._reversed){isComplete=true;callback="onComplete"}if(duration===0)if(this._initted||!this.vars.lazy||force){if(this._startTime===this._timeline._duration){time=0}if(time===0||prevRawPrevTime<0||prevRawPrevTime===_tinyNum)if(prevRawPrevTime!==time){force=true;if(prevRawPrevTime>_tinyNum){callback="onReverseComplete"}}this._rawPrevTime=rawPrevTime=!suppressEvents||time||prevRawPrevTime===time?time:_tinyNum}}else if(time<1e-7){this._totalTime=this._time=this._cycle=0;this.ratio=this._ease._calcEnd?this._ease.getRatio(0):0;if(prevTotalTime!==0||duration===0&&prevRawPrevTime>0&&prevRawPrevTime!==_tinyNum){callback="onReverseComplete";isComplete=this._reversed}if(time<0){this._active=false;if(duration===0)if(this._initted||!this.vars.lazy||force){if(prevRawPrevTime>=0){force=true}this._rawPrevTime=rawPrevTime=!suppressEvents||time||prevRawPrevTime===time?time:_tinyNum}}if(!this._initted){force=true}}else{this._totalTime=this._time=time;if(this._repeat!==0){cycleDuration=duration+this._repeatDelay;this._cycle=this._totalTime/cycleDuration>>0;if(this._cycle!==0)if(this._cycle===this._totalTime/cycleDuration){this._cycle--}this._time=this._totalTime-this._cycle*cycleDuration;if(this._yoyo)if((this._cycle&1)!==0){this._time=duration-this._time}if(this._time>duration){this._time=duration}else if(this._time<0){this._time=0}}if(this._easeType){r=this._time/duration;type=this._easeType;pow=this._easePower;if(type===1||type===3&&r>=.5){r=1-r}if(type===3){r*=2}if(pow===1){r*=r}else if(pow===2){r*=r*r}else if(pow===3){r*=r*r*r}else if(pow===4){r*=r*r*r*r}if(type===1){this.ratio=1-r}else if(type===2){this.ratio=r}else if(this._time/duration<.5){this.ratio=r/2}else{this.ratio=1-r/2}}else{this.ratio=this._ease.getRatio(this._time/duration)}}if(prevTime===this._time&&!force&&prevCycle===this._cycle){if(prevTotalTime!==this._totalTime)if(this._onUpdate)if(!suppressEvents){this._onUpdate.apply(this.vars.onUpdateScope||this,this.vars.onUpdateParams||_blankArray)}return}else if(!this._initted){this._init();if(!this._initted||this._gc){return}else if(!force&&this._firstPT&&(this.vars.lazy!==false&&this._duration||this.vars.lazy&&!this._duration)){this._time=prevTime;this._totalTime=prevTotalTime;this._rawPrevTime=prevRawPrevTime;this._cycle=prevCycle;TweenLiteInternals.lazyTweens.push(this);this._lazy=[time,suppressEvents];return}if(this._time&&!isComplete){this.ratio=this._ease.getRatio(this._time/duration)}else if(isComplete&&this._ease._calcEnd){this.ratio=this._ease.getRatio(this._time===0?0:1)}}if(this._lazy!==false){this._lazy=false}if(!this._active)if(!this._paused&&this._time!==prevTime&&time>=0){this._active=true}if(prevTotalTime===0){if(this._initted===2&&time>0){this._init()}if(this._startAt){if(time>=0){this._startAt.render(time,suppressEvents,force)}else if(!callback){callback="_dummyGS"}}if(this.vars.onStart)if(this._totalTime!==0||duration===0)if(!suppressEvents){this.vars.onStart.apply(this.vars.onStartScope||this,this.vars.onStartParams||_blankArray)}}pt=this._firstPT;while(pt){if(pt.f){pt.t[pt.p](pt.c*this.ratio+pt.s)}else{pt.t[pt.p]=pt.c*this.ratio+pt.s}pt=pt._next}if(this._onUpdate){if(time<0)if(this._startAt&&this._startTime){this._startAt.render(time,suppressEvents,force)}if(!suppressEvents)if(this._totalTime!==prevTotalTime||isComplete){this._onUpdate.apply(this.vars.onUpdateScope||this,this.vars.onUpdateParams||_blankArray)}}if(this._cycle!==prevCycle)if(!suppressEvents)if(!this._gc)if(this.vars.onRepeat){this.vars.onRepeat.apply(this.vars.onRepeatScope||this,this.vars.onRepeatParams||_blankArray)}if(callback)if(!this._gc||force){if(time<0&&this._startAt&&!this._onUpdate&&this._startTime){this._startAt.render(time,suppressEvents,force)}if(isComplete){if(this._timeline.autoRemoveChildren){this._enabled(false,false)}this._active=false}if(!suppressEvents&&this.vars[callback]){this.vars[callback].apply(this.vars[callback+"Scope"]||this,this.vars[callback+"Params"]||_blankArray)}if(duration===0&&this._rawPrevTime===_tinyNum&&rawPrevTime!==_tinyNum){this._rawPrevTime=0}}};TweenMax.to=function(target,duration,vars){return new TweenMax(target,duration,vars)};TweenMax.from=function(target,duration,vars){vars.runBackwards=true;vars.immediateRender=vars.immediateRender!=false;return new TweenMax(target,duration,vars)};TweenMax.fromTo=function(target,duration,fromVars,toVars){toVars.startAt=fromVars;toVars.immediateRender=toVars.immediateRender!=false&&fromVars.immediateRender!=false;return new TweenMax(target,duration,toVars)};TweenMax.staggerTo=TweenMax.allTo=function(targets,duration,vars,stagger,onCompleteAll,onCompleteAllParams,onCompleteAllScope){stagger=stagger||0;var delay=vars.delay||0,a=[],finalComplete=function(){if(vars.onComplete){vars.onComplete.apply(vars.onCompleteScope||this,arguments)}onCompleteAll.apply(onCompleteAllScope||this,onCompleteAllParams||_blankArray)},l,copy,i,p;if(!_isArray(targets)){if(typeof targets==="string"){targets=TweenLite.selector(targets)||targets}if(_isSelector(targets)){targets=_slice(targets)}}targets=targets||[];if(stagger<0){targets=_slice(targets);targets.reverse();stagger*=-1}l=targets.length-1;for(i=0;i<=l;i++){copy={};for(p in vars){copy[p]=vars[p]}copy.delay=delay;if(i===l&&onCompleteAll){copy.onComplete=finalComplete}a[i]=new TweenMax(targets[i],duration,copy);delay+=stagger}return a};TweenMax.staggerFrom=TweenMax.allFrom=function(targets,duration,vars,stagger,onCompleteAll,onCompleteAllParams,onCompleteAllScope){vars.runBackwards=true;vars.immediateRender=vars.immediateRender!=false;return TweenMax.staggerTo(targets,duration,vars,stagger,onCompleteAll,onCompleteAllParams,onCompleteAllScope)};TweenMax.staggerFromTo=TweenMax.allFromTo=function(targets,duration,fromVars,toVars,stagger,onCompleteAll,onCompleteAllParams,onCompleteAllScope){toVars.startAt=fromVars;toVars.immediateRender=toVars.immediateRender!=false&&fromVars.immediateRender!=false;return TweenMax.staggerTo(targets,duration,toVars,stagger,onCompleteAll,onCompleteAllParams,onCompleteAllScope)};TweenMax.delayedCall=function(delay,callback,params,scope,useFrames){return new TweenMax(callback,0,{delay:delay,onComplete:callback,onCompleteParams:params,onCompleteScope:scope,onReverseComplete:callback,onReverseCompleteParams:params,onReverseCompleteScope:scope,immediateRender:false,useFrames:useFrames,overwrite:0})};TweenMax.set=function(target,vars){return new TweenMax(target,0,vars)};TweenMax.isTweening=function(target){return TweenLite.getTweensOf(target,true).length>0};var _getChildrenOf=function(timeline,includeTimelines){var a=[],cnt=0,tween=timeline._first;while(tween){if(tween instanceof TweenLite){a[cnt++]=tween}else{if(includeTimelines){a[cnt++]=tween}a=a.concat(_getChildrenOf(tween,includeTimelines));cnt=a.length}tween=tween._next}return a},getAllTweens=TweenMax.getAllTweens=function(includeTimelines){return _getChildrenOf(Animation._rootTimeline,includeTimelines).concat(_getChildrenOf(Animation._rootFramesTimeline,includeTimelines))};TweenMax.killAll=function(complete,tweens,delayedCalls,timelines){if(tweens==null){tweens=true}if(delayedCalls==null){delayedCalls=true}var a=getAllTweens(timelines!=false),l=a.length,allTrue=tweens&&delayedCalls&&timelines,isDC,tween,i;for(i=0;i<l;i++){tween=a[i];if(allTrue||tween instanceof SimpleTimeline||(isDC=tween.target===tween.vars.onComplete)&&delayedCalls||tweens&&!isDC){if(complete){tween.totalTime(tween._reversed?0:tween.totalDuration())}else{tween._enabled(false,false)}}}};TweenMax.killChildTweensOf=function(parent,complete){if(parent==null){return}var tl=TweenLiteInternals.tweenLookup,a,curParent,p,i,l;if(typeof parent==="string"){parent=TweenLite.selector(parent)||parent}if(_isSelector(parent)){parent=_slice(parent)}if(_isArray(parent)){i=parent.length;while(--i>-1){TweenMax.killChildTweensOf(parent[i],complete)}return}a=[];for(p in tl){curParent=tl[p].target.parentNode;while(curParent){if(curParent===parent){a=a.concat(tl[p].tweens)}curParent=curParent.parentNode}}l=a.length;for(i=0;i<l;i++){if(complete){a[i].totalTime(a[i].totalDuration())}a[i]._enabled(false,false)}};var _changePause=function(pause,tweens,delayedCalls,timelines){tweens=tweens!==false;delayedCalls=delayedCalls!==false;timelines=timelines!==false;var a=getAllTweens(timelines),allTrue=tweens&&delayedCalls&&timelines,i=a.length,isDC,tween;while(--i>-1){tween=a[i];if(allTrue||tween instanceof SimpleTimeline||(isDC=tween.target===tween.vars.onComplete)&&delayedCalls||tweens&&!isDC){tween.paused(pause)}}};TweenMax.pauseAll=function(tweens,delayedCalls,timelines){_changePause(true,tweens,delayedCalls,timelines)};TweenMax.resumeAll=function(tweens,delayedCalls,timelines){_changePause(false,tweens,delayedCalls,timelines)};TweenMax.globalTimeScale=function(value){var tl=Animation._rootTimeline,t=TweenLite.ticker.time;if(!arguments.length){return tl._timeScale}value=value||_tinyNum;tl._startTime=t-(t-tl._startTime)*tl._timeScale/value;tl=Animation._rootFramesTimeline;t=TweenLite.ticker.frame;tl._startTime=t-(t-tl._startTime)*tl._timeScale/value;tl._timeScale=Animation._rootTimeline._timeScale=value;return value};p.progress=function(value){return!arguments.length?this._time/this.duration():this.totalTime(this.duration()*(this._yoyo&&(this._cycle&1)!==0?1-value:value)+this._cycle*(this._duration+this._repeatDelay),false)};p.totalProgress=function(value){return!arguments.length?this._totalTime/this.totalDuration():this.totalTime(this.totalDuration()*value,false)};p.time=function(value,suppressEvents){if(!arguments.length){return this._time}if(this._dirty){this.totalDuration()}if(value>this._duration){value=this._duration}if(this._yoyo&&(this._cycle&1)!==0){value=this._duration-value+this._cycle*(this._duration+this._repeatDelay)}else if(this._repeat!==0){value+=this._cycle*(this._duration+this._repeatDelay)}return this.totalTime(value,suppressEvents)};p.duration=function(value){if(!arguments.length){return this._duration}return Animation.prototype.duration.call(this,value)};p.totalDuration=function(value){if(!arguments.length){if(this._dirty){this._totalDuration=this._repeat===-1?999999999999:this._duration*(this._repeat+1)+this._repeatDelay*this._repeat;this._dirty=false}return this._totalDuration}return this._repeat===-1?this:this.duration((value-this._repeat*this._repeatDelay)/(this._repeat+1))};p.repeat=function(value){if(!arguments.length){return this._repeat}this._repeat=value;return this._uncache(true)};p.repeatDelay=function(value){if(!arguments.length){return this._repeatDelay}this._repeatDelay=value;return this._uncache(true)};p.yoyo=function(value){if(!arguments.length){return this._yoyo}this._yoyo=value;return this};return TweenMax},true);_gsScope._gsDefine("TimelineLite",["core.Animation","core.SimpleTimeline","TweenLite"],function(Animation,SimpleTimeline,TweenLite){var TimelineLite=function(vars){SimpleTimeline.call(this,vars);this._labels={};this.autoRemoveChildren=this.vars.autoRemoveChildren===true;this.smoothChildTiming=this.vars.smoothChildTiming===true;this._sortChildren=true;this._onUpdate=this.vars.onUpdate;var v=this.vars,val,p;for(p in v){val=v[p];if(_isArray(val))if(val.join("").indexOf("{self}")!==-1){v[p]=this._swapSelfInParams(val)}}if(_isArray(v.tweens)){this.add(v.tweens,0,v.align,v.stagger)}},_tinyNum=1e-10,TweenLiteInternals=TweenLite._internals,_isSelector=TweenLiteInternals.isSelector,_isArray=TweenLiteInternals.isArray,_lazyTweens=TweenLiteInternals.lazyTweens,_lazyRender=TweenLiteInternals.lazyRender,_blankArray=[],_globals=_gsScope._gsDefine.globals,_copy=function(vars){var copy={},p;for(p in vars){copy[p]=vars[p]}return copy},_pauseCallback=function(tween,callback,params,scope){var time=tween._timeline._totalTime;if(callback||!this._forcingPlayhead){tween._timeline.pause(tween._startTime);if(callback){callback.apply(scope||tween._timeline,params||_blankArray)}if(this._forcingPlayhead){tween._timeline.seek(time)}}},_slice=function(a){var b=[],l=a.length,i;for(i=0;i!==l;b.push(a[i++]));return b},p=TimelineLite.prototype=new SimpleTimeline;TimelineLite.version="1.14.1";p.constructor=TimelineLite;p.kill()._gc=p._forcingPlayhead=false;p.to=function(target,duration,vars,position){var Engine=vars.repeat&&_globals.TweenMax||TweenLite;return duration?this.add(new Engine(target,duration,vars),position):this.set(target,vars,position)};p.from=function(target,duration,vars,position){return this.add((vars.repeat&&_globals.TweenMax||TweenLite).from(target,duration,vars),position)};p.fromTo=function(target,duration,fromVars,toVars,position){var Engine=toVars.repeat&&_globals.TweenMax||TweenLite;return duration?this.add(Engine.fromTo(target,duration,fromVars,toVars),position):this.set(target,toVars,position)};p.staggerTo=function(targets,duration,vars,stagger,position,onCompleteAll,onCompleteAllParams,onCompleteAllScope){var tl=new TimelineLite({onComplete:onCompleteAll,onCompleteParams:onCompleteAllParams,onCompleteScope:onCompleteAllScope,smoothChildTiming:this.smoothChildTiming}),i;if(typeof targets==="string"){targets=TweenLite.selector(targets)||targets}targets=targets||[];if(_isSelector(targets)){targets=_slice(targets)}stagger=stagger||0;if(stagger<0){targets=_slice(targets);targets.reverse();stagger*=-1}for(i=0;i<targets.length;i++){if(vars.startAt){vars.startAt=_copy(vars.startAt)}tl.to(targets[i],duration,_copy(vars),i*stagger)}return this.add(tl,position)};p.staggerFrom=function(targets,duration,vars,stagger,position,onCompleteAll,onCompleteAllParams,onCompleteAllScope){vars.immediateRender=vars.immediateRender!=false;vars.runBackwards=true;return this.staggerTo(targets,duration,vars,stagger,position,onCompleteAll,onCompleteAllParams,onCompleteAllScope)};p.staggerFromTo=function(targets,duration,fromVars,toVars,stagger,position,onCompleteAll,onCompleteAllParams,onCompleteAllScope){toVars.startAt=fromVars;toVars.immediateRender=toVars.immediateRender!=false&&fromVars.immediateRender!=false;return this.staggerTo(targets,duration,toVars,stagger,position,onCompleteAll,onCompleteAllParams,onCompleteAllScope)};p.call=function(callback,params,scope,position){return this.add(TweenLite.delayedCall(0,callback,params,scope),position)};p.set=function(target,vars,position){position=this._parseTimeOrLabel(position,0,true);if(vars.immediateRender==null){vars.immediateRender=position===this._time&&!this._paused}return this.add(new TweenLite(target,0,vars),position)};TimelineLite.exportRoot=function(vars,ignoreDelayedCalls){vars=vars||{};if(vars.smoothChildTiming==null){vars.smoothChildTiming=true}var tl=new TimelineLite(vars),root=tl._timeline,tween,next;if(ignoreDelayedCalls==null){ignoreDelayedCalls=true}root._remove(tl,true);tl._startTime=0;tl._rawPrevTime=tl._time=tl._totalTime=root._time;tween=root._first;while(tween){next=tween._next;if(!ignoreDelayedCalls||!(tween instanceof TweenLite&&tween.target===tween.vars.onComplete)){tl.add(tween,tween._startTime-tween._delay)}tween=next}root.add(tl,0);return tl};p.add=function(value,position,align,stagger){var curTime,l,i,child,tl,beforeRawTime;if(typeof position!=="number"){position=this._parseTimeOrLabel(position,0,true,value)}if(!(value instanceof Animation)){if(value instanceof Array||value&&value.push&&_isArray(value)){align=align||"normal";stagger=stagger||0;curTime=position;l=value.length;for(i=0;i<l;i++){if(_isArray(child=value[i])){child=new TimelineLite({tweens:child})}this.add(child,curTime);if(typeof child!=="string"&&typeof child!=="function"){if(align==="sequence"){curTime=child._startTime+child.totalDuration()/child._timeScale}else if(align==="start"){child._startTime-=child.delay()}}curTime+=stagger}return this._uncache(true)}else if(typeof value==="string"){return this.addLabel(value,position)}else if(typeof value==="function"){value=TweenLite.delayedCall(0,value)}else{throw"Cannot add "+value+" into the timeline; it is not a tween, timeline, function, or string."}}SimpleTimeline.prototype.add.call(this,value,position);if(this._gc||this._time===this._duration)if(!this._paused)if(this._duration<this.duration()){tl=this;beforeRawTime=tl.rawTime()>value._startTime;while(tl._timeline){if(beforeRawTime&&tl._timeline.smoothChildTiming){tl.totalTime(tl._totalTime,true)}else if(tl._gc){tl._enabled(true,false)}tl=tl._timeline}}return this};p.remove=function(value){if(value instanceof Animation){return this._remove(value,false)}else if(value instanceof Array||value&&value.push&&_isArray(value)){var i=value.length;while(--i>-1){this.remove(value[i])}return this}else if(typeof value==="string"){return this.removeLabel(value)}return this.kill(null,value)};p._remove=function(tween,skipDisable){SimpleTimeline.prototype._remove.call(this,tween,skipDisable);var last=this._last;if(!last){this._time=this._totalTime=this._duration=this._totalDuration=0}else if(this._time>last._startTime+last._totalDuration/last._timeScale){this._time=this.duration();this._totalTime=this._totalDuration}return this};p.append=function(value,offsetOrLabel){return this.add(value,this._parseTimeOrLabel(null,offsetOrLabel,true,value))};p.insert=p.insertMultiple=function(value,position,align,stagger){return this.add(value,position||0,align,stagger)};p.appendMultiple=function(tweens,offsetOrLabel,align,stagger){return this.add(tweens,this._parseTimeOrLabel(null,offsetOrLabel,true,tweens),align,stagger)};p.addLabel=function(label,position){this._labels[label]=this._parseTimeOrLabel(position);return this};p.addPause=function(position,callback,params,scope){return this.call(_pauseCallback,["{self}",callback,params,scope],this,position)};p.removeLabel=function(label){delete this._labels[label];return this};p.getLabelTime=function(label){return this._labels[label]!=null?this._labels[label]:-1};p._parseTimeOrLabel=function(timeOrLabel,offsetOrLabel,appendIfAbsent,ignore){var i;if(ignore instanceof Animation&&ignore.timeline===this){this.remove(ignore)}else if(ignore&&(ignore instanceof Array||ignore.push&&_isArray(ignore))){i=ignore.length;while(--i>-1){if(ignore[i]instanceof Animation&&ignore[i].timeline===this){this.remove(ignore[i])}}}if(typeof offsetOrLabel==="string"){return this._parseTimeOrLabel(offsetOrLabel,appendIfAbsent&&typeof timeOrLabel==="number"&&this._labels[offsetOrLabel]==null?timeOrLabel-this.duration():0,appendIfAbsent)}offsetOrLabel=offsetOrLabel||0;if(typeof timeOrLabel==="string"&&(isNaN(timeOrLabel)||this._labels[timeOrLabel]!=null)){i=timeOrLabel.indexOf("=");if(i===-1){if(this._labels[timeOrLabel]==null){return appendIfAbsent?this._labels[timeOrLabel]=this.duration()+offsetOrLabel:offsetOrLabel}return this._labels[timeOrLabel]+offsetOrLabel}offsetOrLabel=parseInt(timeOrLabel.charAt(i-1)+"1",10)*Number(timeOrLabel.substr(i+1));timeOrLabel=i>1?this._parseTimeOrLabel(timeOrLabel.substr(0,i-1),0,appendIfAbsent):this.duration()}else if(timeOrLabel==null){timeOrLabel=this.duration()}return Number(timeOrLabel)+offsetOrLabel};p.seek=function(position,suppressEvents){return this.totalTime(typeof position==="number"?position:this._parseTimeOrLabel(position),suppressEvents!==false)};p.stop=function(){return this.paused(true)};p.gotoAndPlay=function(position,suppressEvents){return this.play(position,suppressEvents)};p.gotoAndStop=function(position,suppressEvents){return this.pause(position,suppressEvents)};p.render=function(time,suppressEvents,force){if(this._gc){this._enabled(true,false)}var totalDur=!this._dirty?this._totalDuration:this.totalDuration(),prevTime=this._time,prevStart=this._startTime,prevTimeScale=this._timeScale,prevPaused=this._paused,tween,isComplete,next,callback,internalForce;if(time>=totalDur){this._totalTime=this._time=totalDur;if(!this._reversed)if(!this._hasPausedChild()){isComplete=true;callback="onComplete";if(this._duration===0)if(time===0||this._rawPrevTime<0||this._rawPrevTime===_tinyNum)if(this._rawPrevTime!==time&&this._first){internalForce=true;if(this._rawPrevTime>_tinyNum){callback="onReverseComplete"}}}this._rawPrevTime=this._duration||!suppressEvents||time||this._rawPrevTime===time?time:_tinyNum;time=totalDur+1e-4}else if(time<1e-7){this._totalTime=this._time=0;if(prevTime!==0||this._duration===0&&this._rawPrevTime!==_tinyNum&&(this._rawPrevTime>0||time<0&&this._rawPrevTime>=0)){callback="onReverseComplete";isComplete=this._reversed}if(time<0){this._active=false;if(this._rawPrevTime>=0&&this._first){internalForce=true}this._rawPrevTime=time}else{this._rawPrevTime=this._duration||!suppressEvents||time||this._rawPrevTime===time?time:_tinyNum;time=0;if(!this._initted){internalForce=true}}}else{this._totalTime=this._time=this._rawPrevTime=time}if((this._time===prevTime||!this._first)&&!force&&!internalForce){return}else if(!this._initted){this._initted=true}if(!this._active)if(!this._paused&&this._time!==prevTime&&time>0){this._active=true}if(prevTime===0)if(this.vars.onStart)if(this._time!==0)if(!suppressEvents){this.vars.onStart.apply(this.vars.onStartScope||this,this.vars.onStartParams||_blankArray)}if(this._time>=prevTime){tween=this._first;while(tween){next=tween._next;if(this._paused&&!prevPaused){break}else if(tween._active||tween._startTime<=this._time&&!tween._paused&&!tween._gc){if(!tween._reversed){tween.render((time-tween._startTime)*tween._timeScale,suppressEvents,force)}else{tween.render((!tween._dirty?tween._totalDuration:tween.totalDuration())-(time-tween._startTime)*tween._timeScale,suppressEvents,force)}}tween=next}}else{tween=this._last;while(tween){next=tween._prev;if(this._paused&&!prevPaused){break}else if(tween._active||tween._startTime<=prevTime&&!tween._paused&&!tween._gc){if(!tween._reversed){tween.render((time-tween._startTime)*tween._timeScale,suppressEvents,force)}else{tween.render((!tween._dirty?tween._totalDuration:tween.totalDuration())-(time-tween._startTime)*tween._timeScale,suppressEvents,force)}}tween=next}}if(this._onUpdate)if(!suppressEvents){if(_lazyTweens.length){_lazyRender()}this._onUpdate.apply(this.vars.onUpdateScope||this,this.vars.onUpdateParams||_blankArray)}if(callback)if(!this._gc)if(prevStart===this._startTime||prevTimeScale!==this._timeScale)if(this._time===0||totalDur>=this.totalDuration()){if(isComplete){if(_lazyTweens.length){_lazyRender()}if(this._timeline.autoRemoveChildren){this._enabled(false,false)}this._active=false}if(!suppressEvents&&this.vars[callback]){this.vars[callback].apply(this.vars[callback+"Scope"]||this,this.vars[callback+"Params"]||_blankArray)}}};p._hasPausedChild=function(){var tween=this._first;while(tween){if(tween._paused||tween instanceof TimelineLite&&tween._hasPausedChild()){return true}tween=tween._next}return false};p.getChildren=function(nested,tweens,timelines,ignoreBeforeTime){ignoreBeforeTime=ignoreBeforeTime||-9999999999;var a=[],tween=this._first,cnt=0;while(tween){if(tween._startTime<ignoreBeforeTime){}else if(tween instanceof TweenLite){if(tweens!==false){a[cnt++]=tween}}else{if(timelines!==false){a[cnt++]=tween}if(nested!==false){a=a.concat(tween.getChildren(true,tweens,timelines));cnt=a.length}}tween=tween._next}return a};p.getTweensOf=function(target,nested){var disabled=this._gc,a=[],cnt=0,tweens,i;if(disabled){this._enabled(true,true)}tweens=TweenLite.getTweensOf(target);i=tweens.length;while(--i>-1){if(tweens[i].timeline===this||nested&&this._contains(tweens[i])){a[cnt++]=tweens[i]}}if(disabled){this._enabled(false,true)}return a};p.recent=function(){return this._recent};p._contains=function(tween){var tl=tween.timeline;while(tl){if(tl===this){return true}tl=tl.timeline}return false};p.shiftChildren=function(amount,adjustLabels,ignoreBeforeTime){ignoreBeforeTime=ignoreBeforeTime||0;var tween=this._first,labels=this._labels,p;while(tween){if(tween._startTime>=ignoreBeforeTime){tween._startTime+=amount}tween=tween._next}if(adjustLabels){for(p in labels){if(labels[p]>=ignoreBeforeTime){labels[p]+=amount}}}return this._uncache(true)};p._kill=function(vars,target){if(!vars&&!target){return this._enabled(false,false)}var tweens=!target?this.getChildren(true,true,false):this.getTweensOf(target),i=tweens.length,changed=false;while(--i>-1){if(tweens[i]._kill(vars,target)){changed=true}}return changed};p.clear=function(labels){var tweens=this.getChildren(false,true,true),i=tweens.length;this._time=this._totalTime=0;while(--i>-1){tweens[i]._enabled(false,false)}if(labels!==false){this._labels={}}return this._uncache(true)};p.invalidate=function(){var tween=this._first;while(tween){tween.invalidate();tween=tween._next}return Animation.prototype.invalidate.call(this)};p._enabled=function(enabled,ignoreTimeline){if(enabled===this._gc){var tween=this._first;while(tween){tween._enabled(enabled,true);tween=tween._next}}return SimpleTimeline.prototype._enabled.call(this,enabled,ignoreTimeline)};p.totalTime=function(time,suppressEvents,uncapped){this._forcingPlayhead=true;var val=Animation.prototype.totalTime.apply(this,arguments);this._forcingPlayhead=false;return val};p.duration=function(value){if(!arguments.length){if(this._dirty){this.totalDuration()}return this._duration}if(this.duration()!==0&&value!==0){this.timeScale(this._duration/value)}return this};p.totalDuration=function(value){if(!arguments.length){if(this._dirty){var max=0,tween=this._last,prevStart=999999999999,prev,end;while(tween){prev=tween._prev;if(tween._dirty){tween.totalDuration()}if(tween._startTime>prevStart&&this._sortChildren&&!tween._paused){this.add(tween,tween._startTime-tween._delay)}else{prevStart=tween._startTime}if(tween._startTime<0&&!tween._paused){max-=tween._startTime;if(this._timeline.smoothChildTiming){this._startTime+=tween._startTime/this._timeScale}this.shiftChildren(-tween._startTime,false,-9999999999);prevStart=0}end=tween._startTime+tween._totalDuration/tween._timeScale;if(end>max){max=end}tween=prev}this._duration=this._totalDuration=max;this._dirty=false}return this._totalDuration}if(this.totalDuration()!==0)if(value!==0){this.timeScale(this._totalDuration/value)}return this};p.usesFrames=function(){var tl=this._timeline;while(tl._timeline){tl=tl._timeline}return tl===Animation._rootFramesTimeline};p.rawTime=function(){return this._paused?this._totalTime:(this._timeline.rawTime()-this._startTime)*this._timeScale};return TimelineLite},true);_gsScope._gsDefine("TimelineMax",["TimelineLite","TweenLite","easing.Ease"],function(TimelineLite,TweenLite,Ease){var TimelineMax=function(vars){TimelineLite.call(this,vars);this._repeat=this.vars.repeat||0;this._repeatDelay=this.vars.repeatDelay||0;this._cycle=0;this._yoyo=this.vars.yoyo===true;this._dirty=true},_tinyNum=1e-10,_blankArray=[],TweenLiteInternals=TweenLite._internals,_lazyTweens=TweenLiteInternals.lazyTweens,_lazyRender=TweenLiteInternals.lazyRender,_easeNone=new Ease(null,null,1,0),p=TimelineMax.prototype=new TimelineLite;p.constructor=TimelineMax;p.kill()._gc=false;TimelineMax.version="1.14.1";p.invalidate=function(){this._yoyo=this.vars.yoyo===true;this._repeat=this.vars.repeat||0;this._repeatDelay=this.vars.repeatDelay||0;this._uncache(true);return TimelineLite.prototype.invalidate.call(this)};p.addCallback=function(callback,position,params,scope){return this.add(TweenLite.delayedCall(0,callback,params,scope),position)};p.removeCallback=function(callback,position){if(callback){if(position==null){this._kill(null,callback)}else{var a=this.getTweensOf(callback,false),i=a.length,time=this._parseTimeOrLabel(position);while(--i>-1){if(a[i]._startTime===time){a[i]._enabled(false,false)}}}}return this};p.tweenTo=function(position,vars){vars=vars||{};var copy={ease:_easeNone,overwrite:vars.delay?2:1,useFrames:this.usesFrames(),immediateRender:false},duration,p,t;for(p in vars){copy[p]=vars[p]}copy.time=this._parseTimeOrLabel(position);duration=Math.abs(Number(copy.time)-this._time)/this._timeScale||.001;t=new TweenLite(this,duration,copy);copy.onStart=function(){t.target.paused(true);if(t.vars.time!==t.target.time()&&duration===t.duration()){t.duration(Math.abs(t.vars.time-t.target.time())/t.target._timeScale)}if(vars.onStart){vars.onStart.apply(vars.onStartScope||t,vars.onStartParams||_blankArray)}};return t};p.tweenFromTo=function(fromPosition,toPosition,vars){vars=vars||{};fromPosition=this._parseTimeOrLabel(fromPosition);vars.startAt={onComplete:this.seek,onCompleteParams:[fromPosition],onCompleteScope:this};vars.immediateRender=vars.immediateRender!==false;var t=this.tweenTo(toPosition,vars);return t.duration(Math.abs(t.vars.time-fromPosition)/this._timeScale||.001)};p.render=function(time,suppressEvents,force){if(this._gc){this._enabled(true,false)}var totalDur=!this._dirty?this._totalDuration:this.totalDuration(),dur=this._duration,prevTime=this._time,prevTotalTime=this._totalTime,prevStart=this._startTime,prevTimeScale=this._timeScale,prevRawPrevTime=this._rawPrevTime,prevPaused=this._paused,prevCycle=this._cycle,tween,isComplete,next,callback,internalForce,cycleDuration;if(time>=totalDur){if(!this._locked){this._totalTime=totalDur;this._cycle=this._repeat}if(!this._reversed)if(!this._hasPausedChild()){isComplete=true;callback="onComplete";if(this._duration===0)if(time===0||prevRawPrevTime<0||prevRawPrevTime===_tinyNum)if(prevRawPrevTime!==time&&this._first){internalForce=true;if(prevRawPrevTime>_tinyNum){callback="onReverseComplete"}}}this._rawPrevTime=this._duration||!suppressEvents||time||this._rawPrevTime===time?time:_tinyNum;
if(this._yoyo&&(this._cycle&1)!==0){this._time=time=0}else{this._time=dur;time=dur+1e-4}}else if(time<1e-7){if(!this._locked){this._totalTime=this._cycle=0}this._time=0;if(prevTime!==0||dur===0&&prevRawPrevTime!==_tinyNum&&(prevRawPrevTime>0||time<0&&prevRawPrevTime>=0)&&!this._locked){callback="onReverseComplete";isComplete=this._reversed}if(time<0){this._active=false;if(prevRawPrevTime>=0&&this._first){internalForce=true}this._rawPrevTime=time}else{this._rawPrevTime=dur||!suppressEvents||time||this._rawPrevTime===time?time:_tinyNum;time=0;if(!this._initted){internalForce=true}}}else{if(dur===0&&prevRawPrevTime<0){internalForce=true}this._time=this._rawPrevTime=time;if(!this._locked){this._totalTime=time;if(this._repeat!==0){cycleDuration=dur+this._repeatDelay;this._cycle=this._totalTime/cycleDuration>>0;if(this._cycle!==0)if(this._cycle===this._totalTime/cycleDuration){this._cycle--}this._time=this._totalTime-this._cycle*cycleDuration;if(this._yoyo)if((this._cycle&1)!==0){this._time=dur-this._time}if(this._time>dur){this._time=dur;time=dur+1e-4}else if(this._time<0){this._time=time=0}else{time=this._time}}}}if(this._cycle!==prevCycle)if(!this._locked){var backwards=this._yoyo&&(prevCycle&1)!==0,wrap=backwards===(this._yoyo&&(this._cycle&1)!==0),recTotalTime=this._totalTime,recCycle=this._cycle,recRawPrevTime=this._rawPrevTime,recTime=this._time;this._totalTime=prevCycle*dur;if(this._cycle<prevCycle){backwards=!backwards}else{this._totalTime+=dur}this._time=prevTime;this._rawPrevTime=dur===0?prevRawPrevTime-1e-4:prevRawPrevTime;this._cycle=prevCycle;this._locked=true;prevTime=backwards?0:dur;this.render(prevTime,suppressEvents,dur===0);if(!suppressEvents)if(!this._gc){if(this.vars.onRepeat){this.vars.onRepeat.apply(this.vars.onRepeatScope||this,this.vars.onRepeatParams||_blankArray)}}if(wrap){prevTime=backwards?dur+1e-4:-1e-4;this.render(prevTime,true,false)}this._locked=false;if(this._paused&&!prevPaused){return}this._time=recTime;this._totalTime=recTotalTime;this._cycle=recCycle;this._rawPrevTime=recRawPrevTime}if((this._time===prevTime||!this._first)&&!force&&!internalForce){if(prevTotalTime!==this._totalTime)if(this._onUpdate)if(!suppressEvents){this._onUpdate.apply(this.vars.onUpdateScope||this,this.vars.onUpdateParams||_blankArray)}return}else if(!this._initted){this._initted=true}if(!this._active)if(!this._paused&&this._totalTime!==prevTotalTime&&time>0){this._active=true}if(prevTotalTime===0)if(this.vars.onStart)if(this._totalTime!==0)if(!suppressEvents){this.vars.onStart.apply(this.vars.onStartScope||this,this.vars.onStartParams||_blankArray)}if(this._time>=prevTime){tween=this._first;while(tween){next=tween._next;if(this._paused&&!prevPaused){break}else if(tween._active||tween._startTime<=this._time&&!tween._paused&&!tween._gc){if(!tween._reversed){tween.render((time-tween._startTime)*tween._timeScale,suppressEvents,force)}else{tween.render((!tween._dirty?tween._totalDuration:tween.totalDuration())-(time-tween._startTime)*tween._timeScale,suppressEvents,force)}}tween=next}}else{tween=this._last;while(tween){next=tween._prev;if(this._paused&&!prevPaused){break}else if(tween._active||tween._startTime<=prevTime&&!tween._paused&&!tween._gc){if(!tween._reversed){tween.render((time-tween._startTime)*tween._timeScale,suppressEvents,force)}else{tween.render((!tween._dirty?tween._totalDuration:tween.totalDuration())-(time-tween._startTime)*tween._timeScale,suppressEvents,force)}}tween=next}}if(this._onUpdate)if(!suppressEvents){if(_lazyTweens.length){_lazyRender()}this._onUpdate.apply(this.vars.onUpdateScope||this,this.vars.onUpdateParams||_blankArray)}if(callback)if(!this._locked)if(!this._gc)if(prevStart===this._startTime||prevTimeScale!==this._timeScale)if(this._time===0||totalDur>=this.totalDuration()){if(isComplete){if(_lazyTweens.length){_lazyRender()}if(this._timeline.autoRemoveChildren){this._enabled(false,false)}this._active=false}if(!suppressEvents&&this.vars[callback]){this.vars[callback].apply(this.vars[callback+"Scope"]||this,this.vars[callback+"Params"]||_blankArray)}}};p.getActive=function(nested,tweens,timelines){if(nested==null){nested=true}if(tweens==null){tweens=true}if(timelines==null){timelines=false}var a=[],all=this.getChildren(nested,tweens,timelines),cnt=0,l=all.length,i,tween;for(i=0;i<l;i++){tween=all[i];if(tween.isActive()){a[cnt++]=tween}}return a};p.getLabelAfter=function(time){if(!time)if(time!==0){time=this._time}var labels=this.getLabelsArray(),l=labels.length,i;for(i=0;i<l;i++){if(labels[i].time>time){return labels[i].name}}return null};p.getLabelBefore=function(time){if(time==null){time=this._time}var labels=this.getLabelsArray(),i=labels.length;while(--i>-1){if(labels[i].time<time){return labels[i].name}}return null};p.getLabelsArray=function(){var a=[],cnt=0,p;for(p in this._labels){a[cnt++]={time:this._labels[p],name:p}}a.sort(function(a,b){return a.time-b.time});return a};p.progress=function(value,suppressEvents){return!arguments.length?this._time/this.duration():this.totalTime(this.duration()*(this._yoyo&&(this._cycle&1)!==0?1-value:value)+this._cycle*(this._duration+this._repeatDelay),suppressEvents)};p.totalProgress=function(value,suppressEvents){return!arguments.length?this._totalTime/this.totalDuration():this.totalTime(this.totalDuration()*value,suppressEvents)};p.totalDuration=function(value){if(!arguments.length){if(this._dirty){TimelineLite.prototype.totalDuration.call(this);this._totalDuration=this._repeat===-1?999999999999:this._duration*(this._repeat+1)+this._repeatDelay*this._repeat}return this._totalDuration}return this._repeat===-1?this:this.duration((value-this._repeat*this._repeatDelay)/(this._repeat+1))};p.time=function(value,suppressEvents){if(!arguments.length){return this._time}if(this._dirty){this.totalDuration()}if(value>this._duration){value=this._duration}if(this._yoyo&&(this._cycle&1)!==0){value=this._duration-value+this._cycle*(this._duration+this._repeatDelay)}else if(this._repeat!==0){value+=this._cycle*(this._duration+this._repeatDelay)}return this.totalTime(value,suppressEvents)};p.repeat=function(value){if(!arguments.length){return this._repeat}this._repeat=value;return this._uncache(true)};p.repeatDelay=function(value){if(!arguments.length){return this._repeatDelay}this._repeatDelay=value;return this._uncache(true)};p.yoyo=function(value){if(!arguments.length){return this._yoyo}this._yoyo=value;return this};p.currentLabel=function(value){if(!arguments.length){return this.getLabelBefore(this._time+1e-8)}return this.seek(value,true)};return TimelineMax},true);(function(){var _RAD2DEG=180/Math.PI,_r1=[],_r2=[],_r3=[],_corProps={},Segment=function(a,b,c,d){this.a=a;this.b=b;this.c=c;this.d=d;this.da=d-a;this.ca=c-a;this.ba=b-a},_correlate=",x,y,z,left,top,right,bottom,marginTop,marginLeft,marginRight,marginBottom,paddingLeft,paddingTop,paddingRight,paddingBottom,backgroundPosition,backgroundPosition_y,",cubicToQuadratic=function(a,b,c,d){var q1={a:a},q2={},q3={},q4={c:d},mab=(a+b)/2,mbc=(b+c)/2,mcd=(c+d)/2,mabc=(mab+mbc)/2,mbcd=(mbc+mcd)/2,m8=(mbcd-mabc)/8;q1.b=mab+(a-mab)/4;q2.b=mabc+m8;q1.c=q2.a=(q1.b+q2.b)/2;q2.c=q3.a=(mabc+mbcd)/2;q3.b=mbcd-m8;q4.b=mcd+(d-mcd)/4;q3.c=q4.a=(q3.b+q4.b)/2;return[q1,q2,q3,q4]},_calculateControlPoints=function(a,curviness,quad,basic,correlate){var l=a.length-1,ii=0,cp1=a[0].a,i,p1,p2,p3,seg,m1,m2,mm,cp2,qb,r1,r2,tl;for(i=0;i<l;i++){seg=a[ii];p1=seg.a;p2=seg.d;p3=a[ii+1].d;if(correlate){r1=_r1[i];r2=_r2[i];tl=(r2+r1)*curviness*.25/(basic?.5:_r3[i]||.5);m1=p2-(p2-p1)*(basic?curviness*.5:r1!==0?tl/r1:0);m2=p2+(p3-p2)*(basic?curviness*.5:r2!==0?tl/r2:0);mm=p2-(m1+((m2-m1)*(r1*3/(r1+r2)+.5)/4||0))}else{m1=p2-(p2-p1)*curviness*.5;m2=p2+(p3-p2)*curviness*.5;mm=p2-(m1+m2)/2}m1+=mm;m2+=mm;seg.c=cp2=m1;if(i!==0){seg.b=cp1}else{seg.b=cp1=seg.a+(seg.c-seg.a)*.6}seg.da=p2-p1;seg.ca=cp2-p1;seg.ba=cp1-p1;if(quad){qb=cubicToQuadratic(p1,cp1,cp2,p2);a.splice(ii,1,qb[0],qb[1],qb[2],qb[3]);ii+=4}else{ii++}cp1=m2}seg=a[ii];seg.b=cp1;seg.c=cp1+(seg.d-cp1)*.4;seg.da=seg.d-seg.a;seg.ca=seg.c-seg.a;seg.ba=cp1-seg.a;if(quad){qb=cubicToQuadratic(seg.a,cp1,seg.c,seg.d);a.splice(ii,1,qb[0],qb[1],qb[2],qb[3])}},_parseAnchors=function(values,p,correlate,prepend){var a=[],l,i,p1,p2,p3,tmp;if(prepend){values=[prepend].concat(values);i=values.length;while(--i>-1){if(typeof(tmp=values[i][p])==="string")if(tmp.charAt(1)==="="){values[i][p]=prepend[p]+Number(tmp.charAt(0)+tmp.substr(2))}}}l=values.length-2;if(l<0){a[0]=new Segment(values[0][p],0,0,values[l<-1?0:1][p]);return a}for(i=0;i<l;i++){p1=values[i][p];p2=values[i+1][p];a[i]=new Segment(p1,0,0,p2);if(correlate){p3=values[i+2][p];_r1[i]=(_r1[i]||0)+(p2-p1)*(p2-p1);_r2[i]=(_r2[i]||0)+(p3-p2)*(p3-p2)}}a[i]=new Segment(values[i][p],0,0,values[i+1][p]);return a},bezierThrough=function(values,curviness,quadratic,basic,correlate,prepend){var obj={},props=[],first=prepend||values[0],i,p,a,j,r,l,seamless,last;correlate=typeof correlate==="string"?","+correlate+",":_correlate;if(curviness==null){curviness=1}for(p in values[0]){props.push(p)}if(values.length>1){last=values[values.length-1];seamless=true;i=props.length;while(--i>-1){p=props[i];if(Math.abs(first[p]-last[p])>.05){seamless=false;break}}if(seamless){values=values.concat();if(prepend){values.unshift(prepend)}values.push(values[1]);prepend=values[values.length-3]}}_r1.length=_r2.length=_r3.length=0;i=props.length;while(--i>-1){p=props[i];_corProps[p]=correlate.indexOf(","+p+",")!==-1;obj[p]=_parseAnchors(values,p,_corProps[p],prepend)}i=_r1.length;while(--i>-1){_r1[i]=Math.sqrt(_r1[i]);_r2[i]=Math.sqrt(_r2[i])}if(!basic){i=props.length;while(--i>-1){if(_corProps[p]){a=obj[props[i]];l=a.length-1;for(j=0;j<l;j++){r=a[j+1].da/_r2[j]+a[j].da/_r1[j];_r3[j]=(_r3[j]||0)+r*r}}}i=_r3.length;while(--i>-1){_r3[i]=Math.sqrt(_r3[i])}}i=props.length;j=quadratic?4:1;while(--i>-1){p=props[i];a=obj[p];_calculateControlPoints(a,curviness,quadratic,basic,_corProps[p]);if(seamless){a.splice(0,j);a.splice(a.length-j,j)}}return obj},_parseBezierData=function(values,type,prepend){type=type||"soft";var obj={},inc=type==="cubic"?3:2,soft=type==="soft",props=[],a,b,c,d,cur,i,j,l,p,cnt,tmp;if(soft&&prepend){values=[prepend].concat(values)}if(values==null||values.length<inc+1){throw"invalid Bezier data"}for(p in values[0]){props.push(p)}i=props.length;while(--i>-1){p=props[i];obj[p]=cur=[];cnt=0;l=values.length;for(j=0;j<l;j++){a=prepend==null?values[j][p]:typeof(tmp=values[j][p])==="string"&&tmp.charAt(1)==="="?prepend[p]+Number(tmp.charAt(0)+tmp.substr(2)):Number(tmp);if(soft)if(j>1)if(j<l-1){cur[cnt++]=(a+cur[cnt-2])/2}cur[cnt++]=a}l=cnt-inc+1;cnt=0;for(j=0;j<l;j+=inc){a=cur[j];b=cur[j+1];c=cur[j+2];d=inc===2?0:cur[j+3];cur[cnt++]=tmp=inc===3?new Segment(a,b,c,d):new Segment(a,(2*b+a)/3,(2*b+c)/3,c)}cur.length=cnt}return obj},_addCubicLengths=function(a,steps,resolution){var inc=1/resolution,j=a.length,d,d1,s,da,ca,ba,p,i,inv,bez,index;while(--j>-1){bez=a[j];s=bez.a;da=bez.d-s;ca=bez.c-s;ba=bez.b-s;d=d1=0;for(i=1;i<=resolution;i++){p=inc*i;inv=1-p;d=d1-(d1=(p*p*da+3*inv*(p*ca+inv*ba))*p);index=j*resolution+i-1;steps[index]=(steps[index]||0)+d*d}}},_parseLengthData=function(obj,resolution){resolution=resolution>>0||6;var a=[],lengths=[],d=0,total=0,threshold=resolution-1,segments=[],curLS=[],p,i,l,index;for(p in obj){_addCubicLengths(obj[p],a,resolution)}l=a.length;for(i=0;i<l;i++){d+=Math.sqrt(a[i]);index=i%resolution;curLS[index]=d;if(index===threshold){total+=d;index=i/resolution>>0;segments[index]=curLS;lengths[index]=total;d=0;curLS=[]}}return{length:total,lengths:lengths,segments:segments}},BezierPlugin=_gsScope._gsDefine.plugin({propName:"bezier",priority:-1,version:"1.3.3",API:2,global:true,init:function(target,vars,tween){this._target=target;if(vars instanceof Array){vars={values:vars}}this._func={};this._round={};this._props=[];this._timeRes=vars.timeResolution==null?6:parseInt(vars.timeResolution,10);var values=vars.values||[],first={},second=values[0],autoRotate=vars.autoRotate||tween.vars.orientToBezier,p,isFunc,i,j,prepend;this._autoRotate=autoRotate?autoRotate instanceof Array?autoRotate:[["x","y","rotation",autoRotate===true?0:Number(autoRotate)||0]]:null;for(p in second){this._props.push(p)}i=this._props.length;while(--i>-1){p=this._props[i];this._overwriteProps.push(p);isFunc=this._func[p]=typeof target[p]==="function";first[p]=!isFunc?parseFloat(target[p]):target[p.indexOf("set")||typeof target["get"+p.substr(3)]!=="function"?p:"get"+p.substr(3)]();if(!prepend)if(first[p]!==values[0][p]){prepend=first}}this._beziers=vars.type!=="cubic"&&vars.type!=="quadratic"&&vars.type!=="soft"?bezierThrough(values,isNaN(vars.curviness)?1:vars.curviness,false,vars.type==="thruBasic",vars.correlate,prepend):_parseBezierData(values,vars.type,first);this._segCount=this._beziers[p].length;if(this._timeRes){var ld=_parseLengthData(this._beziers,this._timeRes);this._length=ld.length;this._lengths=ld.lengths;this._segments=ld.segments;this._l1=this._li=this._s1=this._si=0;this._l2=this._lengths[0];this._curSeg=this._segments[0];this._s2=this._curSeg[0];this._prec=1/this._curSeg.length}if(autoRotate=this._autoRotate){this._initialRotations=[];if(!(autoRotate[0]instanceof Array)){this._autoRotate=autoRotate=[autoRotate]}i=autoRotate.length;while(--i>-1){for(j=0;j<3;j++){p=autoRotate[i][j];this._func[p]=typeof target[p]==="function"?target[p.indexOf("set")||typeof target["get"+p.substr(3)]!=="function"?p:"get"+p.substr(3)]:false}p=autoRotate[i][2];this._initialRotations[i]=this._func[p]?this._func[p].call(this._target):this._target[p]}}this._startRatio=tween.vars.runBackwards?1:0;return true},set:function(v){var segments=this._segCount,func=this._func,target=this._target,notStart=v!==this._startRatio,curIndex,inv,i,p,b,t,val,l,lengths,curSeg;if(!this._timeRes){curIndex=v<0?0:v>=1?segments-1:segments*v>>0;t=(v-curIndex*(1/segments))*segments}else{lengths=this._lengths;curSeg=this._curSeg;v*=this._length;i=this._li;if(v>this._l2&&i<segments-1){l=segments-1;while(i<l&&(this._l2=lengths[++i])<=v){}this._l1=lengths[i-1];this._li=i;this._curSeg=curSeg=this._segments[i];this._s2=curSeg[this._s1=this._si=0]}else if(v<this._l1&&i>0){while(i>0&&(this._l1=lengths[--i])>=v){}if(i===0&&v<this._l1){this._l1=0}else{i++}this._l2=lengths[i];this._li=i;this._curSeg=curSeg=this._segments[i];this._s1=curSeg[(this._si=curSeg.length-1)-1]||0;this._s2=curSeg[this._si]}curIndex=i;v-=this._l1;i=this._si;if(v>this._s2&&i<curSeg.length-1){l=curSeg.length-1;while(i<l&&(this._s2=curSeg[++i])<=v){}this._s1=curSeg[i-1];this._si=i}else if(v<this._s1&&i>0){while(i>0&&(this._s1=curSeg[--i])>=v){}if(i===0&&v<this._s1){this._s1=0}else{i++}this._s2=curSeg[i];this._si=i}t=(i+(v-this._s1)/(this._s2-this._s1))*this._prec}inv=1-t;i=this._props.length;while(--i>-1){p=this._props[i];b=this._beziers[p][curIndex];val=(t*t*b.da+3*inv*(t*b.ca+inv*b.ba))*t+b.a;if(this._round[p]){val=Math.round(val)}if(func[p]){target[p](val)}else{target[p]=val}}if(this._autoRotate){var ar=this._autoRotate,b2,x1,y1,x2,y2,add,conv;i=ar.length;while(--i>-1){p=ar[i][2];add=ar[i][3]||0;conv=ar[i][4]===true?1:_RAD2DEG;b=this._beziers[ar[i][0]];b2=this._beziers[ar[i][1]];if(b&&b2){b=b[curIndex];b2=b2[curIndex];x1=b.a+(b.b-b.a)*t;x2=b.b+(b.c-b.b)*t;x1+=(x2-x1)*t;x2+=(b.c+(b.d-b.c)*t-x2)*t;y1=b2.a+(b2.b-b2.a)*t;y2=b2.b+(b2.c-b2.b)*t;y1+=(y2-y1)*t;y2+=(b2.c+(b2.d-b2.c)*t-y2)*t;val=notStart?Math.atan2(y2-y1,x2-x1)*conv+add:this._initialRotations[i];if(func[p]){target[p](val)}else{target[p]=val}}}}}}),p=BezierPlugin.prototype;BezierPlugin.bezierThrough=bezierThrough;BezierPlugin.cubicToQuadratic=cubicToQuadratic;BezierPlugin._autoCSS=true;BezierPlugin.quadraticToCubic=function(a,b,c){return new Segment(a,(2*b+a)/3,(2*b+c)/3,c)};BezierPlugin._cssRegister=function(){var CSSPlugin=_gsScope._gsDefine.globals.CSSPlugin;if(!CSSPlugin){return}var _internals=CSSPlugin._internals,_parseToProxy=_internals._parseToProxy,_setPluginRatio=_internals._setPluginRatio,CSSPropTween=_internals.CSSPropTween;_internals._registerComplexSpecialProp("bezier",{parser:function(t,e,prop,cssp,pt,plugin){if(e instanceof Array){e={values:e}}plugin=new BezierPlugin;var values=e.values,l=values.length-1,pluginValues=[],v={},i,p,data;if(l<0){return pt}for(i=0;i<=l;i++){data=_parseToProxy(t,values[i],cssp,pt,plugin,l!==i);pluginValues[i]=data.end}for(p in e){v[p]=e[p]}v.values=pluginValues;pt=new CSSPropTween(t,"bezier",0,0,data.pt,2);pt.data=data;pt.plugin=plugin;pt.setRatio=_setPluginRatio;if(v.autoRotate===0){v.autoRotate=true}if(v.autoRotate&&!(v.autoRotate instanceof Array)){i=v.autoRotate===true?0:Number(v.autoRotate);v.autoRotate=data.end.left!=null?[["left","top","rotation",i,false]]:data.end.x!=null?[["x","y","rotation",i,false]]:false}if(v.autoRotate){if(!cssp._transform){cssp._enableTransforms(false)}data.autoRotate=cssp._target._gsTransform}plugin._onInitTween(data.proxy,v,cssp._tween);return pt}})};p._roundProps=function(lookup,value){var op=this._overwriteProps,i=op.length;while(--i>-1){if(lookup[op[i]]||lookup.bezier||lookup.bezierThrough){this._round[op[i]]=value}}};p._kill=function(lookup){var a=this._props,p,i;for(p in this._beziers){if(p in lookup){delete this._beziers[p];delete this._func[p];i=a.length;while(--i>-1){if(a[i]===p){a.splice(i,1)}}}}return this._super._kill.call(this,lookup)}})();_gsScope._gsDefine("plugins.CSSPlugin",["plugins.TweenPlugin","TweenLite"],function(TweenPlugin,TweenLite){var CSSPlugin=function(){TweenPlugin.call(this,"css");this._overwriteProps.length=0;this.setRatio=CSSPlugin.prototype.setRatio},_hasPriority,_suffixMap,_cs,_overwriteProps,_specialProps={},p=CSSPlugin.prototype=new TweenPlugin("css");p.constructor=CSSPlugin;CSSPlugin.version="1.14.1";CSSPlugin.API=2;CSSPlugin.defaultTransformPerspective=0;CSSPlugin.defaultSkewType="compensated";p="px";CSSPlugin.suffixMap={top:p,right:p,bottom:p,left:p,width:p,height:p,fontSize:p,padding:p,margin:p,perspective:p,lineHeight:""};var _numExp=/(?:\d|\-\d|\.\d|\-\.\d)+/g,_relNumExp=/(?:\d|\-\d|\.\d|\-\.\d|\+=\d|\-=\d|\+=.\d|\-=\.\d)+/g,_valuesExp=/(?:\+=|\-=|\-|\b)[\d\-\.]+[a-zA-Z0-9]*(?:%|\b)/gi,_NaNExp=/[^\d\-\.]/g,_suffixExp=/(?:\d|\-|\+|=|#|\.)*/g,_opacityExp=/opacity *= *([^)]*)/i,_opacityValExp=/opacity:([^;]*)/i,_alphaFilterExp=/alpha\(opacity *=.+?\)/i,_rgbhslExp=/^(rgb|hsl)/,_capsExp=/([A-Z])/g,_camelExp=/-([a-z])/gi,_urlExp=/(^(?:url\(\"|url\())|(?:(\"\))$|\)$)/gi,_camelFunc=function(s,g){return g.toUpperCase()},_horizExp=/(?:Left|Right|Width)/i,_ieGetMatrixExp=/(M11|M12|M21|M22)=[\d\-\.e]+/gi,_ieSetMatrixExp=/progid\:DXImageTransform\.Microsoft\.Matrix\(.+?\)/i,_commasOutsideParenExp=/,(?=[^\)]*(?:\(|$))/gi,_DEG2RAD=Math.PI/180,_RAD2DEG=180/Math.PI,_forcePT={},_doc=document,_docElement=_doc.documentElement,_tempDiv=_doc.createElement("div"),_tempImg=_doc.createElement("img"),_internals=CSSPlugin._internals={_specialProps:_specialProps},_agent=navigator.userAgent,_autoRound,_reqSafariFix,_isSafari,_isFirefox,_isSafariLT6,_ieVers,_supportsOpacity=function(){var i=_agent.indexOf("Android"),d=_doc.createElement("div"),a;_isSafari=_agent.indexOf("Safari")!==-1&&_agent.indexOf("Chrome")===-1&&(i===-1||Number(_agent.substr(i+8,1))>3);_isSafariLT6=_isSafari&&Number(_agent.substr(_agent.indexOf("Version/")+8,1))<6;_isFirefox=_agent.indexOf("Firefox")!==-1;if(/MSIE ([0-9]{1,}[\.0-9]{0,})/.exec(_agent)||/Trident\/.*rv:([0-9]{1,}[\.0-9]{0,})/.exec(_agent)){_ieVers=parseFloat(RegExp.$1)}d.innerHTML="<a style='top:1px;opacity:.55;'>a</a>";a=d.getElementsByTagName("a")[0];return a?/^0.55/.test(a.style.opacity):false}(),_getIEOpacity=function(v){return _opacityExp.test(typeof v==="string"?v:(v.currentStyle?v.currentStyle.filter:v.style.filter)||"")?parseFloat(RegExp.$1)/100:1},_log=function(s){if(window.console){console.log(s)}},_prefixCSS="",_prefix="",_checkPropPrefix=function(p,e){e=e||_tempDiv;var s=e.style,a,i;if(s[p]!==undefined){return p}p=p.charAt(0).toUpperCase()+p.substr(1);a=["O","Moz","ms","Ms","Webkit"];i=5;while(--i>-1&&s[a[i]+p]===undefined){}if(i>=0){_prefix=i===3?"ms":a[i];_prefixCSS="-"+_prefix.toLowerCase()+"-";return _prefix+p}return null},_getComputedStyle=_doc.defaultView?_doc.defaultView.getComputedStyle:function(){},_getStyle=CSSPlugin.getStyle=function(t,p,cs,calc,dflt){var rv;if(!_supportsOpacity)if(p==="opacity"){return _getIEOpacity(t)}if(!calc&&t.style[p]){rv=t.style[p]}else if(cs=cs||_getComputedStyle(t)){rv=cs[p]||cs.getPropertyValue(p)||cs.getPropertyValue(p.replace(_capsExp,"-$1").toLowerCase())}else if(t.currentStyle){rv=t.currentStyle[p]}return dflt!=null&&(!rv||rv==="none"||rv==="auto"||rv==="auto auto")?dflt:rv},_convertToPixels=_internals.convertToPixels=function(t,p,v,sfx,recurse){if(sfx==="px"||!sfx){return v}if(sfx==="auto"||!v){return 0}var horiz=_horizExp.test(p),node=t,style=_tempDiv.style,neg=v<0,pix,cache,time;if(neg){v=-v}if(sfx==="%"&&p.indexOf("border")!==-1){pix=v/100*(horiz?t.clientWidth:t.clientHeight)}else{style.cssText="border:0 solid red;position:"+_getStyle(t,"position")+";line-height:0;";if(sfx==="%"||!node.appendChild){node=t.parentNode||_doc.body;cache=node._gsCache;time=TweenLite.ticker.frame;if(cache&&horiz&&cache.time===time){return cache.width*v/100}style[horiz?"width":"height"]=v+sfx}else{style[horiz?"borderLeftWidth":"borderTopWidth"]=v+sfx}node.appendChild(_tempDiv);pix=parseFloat(_tempDiv[horiz?"offsetWidth":"offsetHeight"]);node.removeChild(_tempDiv);if(horiz&&sfx==="%"&&CSSPlugin.cacheWidths!==false){cache=node._gsCache=node._gsCache||{};cache.time=time;cache.width=pix/v*100}if(pix===0&&!recurse){pix=_convertToPixels(t,p,v,sfx,true)}}return neg?-pix:pix},_calculateOffset=_internals.calculateOffset=function(t,p,cs){if(_getStyle(t,"position",cs)!=="absolute"){return 0}var dim=p==="left"?"Left":"Top",v=_getStyle(t,"margin"+dim,cs);return t["offset"+dim]-(_convertToPixels(t,p,parseFloat(v),v.replace(_suffixExp,""))||0)},_getAllStyles=function(t,cs){var s={},i,tr;if(cs=cs||_getComputedStyle(t,null)){if(i=cs.length){while(--i>-1){s[cs[i].replace(_camelExp,_camelFunc)]=cs.getPropertyValue(cs[i])}}else{for(i in cs){s[i]=cs[i]}}}else if(cs=t.currentStyle||t.style){for(i in cs){if(typeof i==="string"&&s[i]===undefined){s[i.replace(_camelExp,_camelFunc)]=cs[i]}}}if(!_supportsOpacity){s.opacity=_getIEOpacity(t)}tr=_getTransform(t,cs,false);s.rotation=tr.rotation;s.skewX=tr.skewX;s.scaleX=tr.scaleX;s.scaleY=tr.scaleY;s.x=tr.x;s.y=tr.y;if(_supports3D){s.z=tr.z;s.rotationX=tr.rotationX;s.rotationY=tr.rotationY;s.scaleZ=tr.scaleZ}if(s.filters){delete s.filters}return s},_cssDif=function(t,s1,s2,vars,forceLookup){var difs={},style=t.style,val,p,mpt;for(p in s2){if(p!=="cssText")if(p!=="length")if(isNaN(p))if(s1[p]!==(val=s2[p])||forceLookup&&forceLookup[p])if(p.indexOf("Origin")===-1)if(typeof val==="number"||typeof val==="string"){difs[p]=val==="auto"&&(p==="left"||p==="top")?_calculateOffset(t,p):(val===""||val==="auto"||val==="none")&&typeof s1[p]==="string"&&s1[p].replace(_NaNExp,"")!==""?0:val;if(style[p]!==undefined){mpt=new MiniPropTween(style,p,style[p],mpt)}}}if(vars){for(p in vars){if(p!=="className"){difs[p]=vars[p]}}}return{difs:difs,firstMPT:mpt}},_dimensions={width:["Left","Right"],height:["Top","Bottom"]},_margins=["marginLeft","marginRight","marginTop","marginBottom"],_getDimension=function(t,p,cs){var v=parseFloat(p==="width"?t.offsetWidth:t.offsetHeight),a=_dimensions[p],i=a.length;cs=cs||_getComputedStyle(t,null);while(--i>-1){v-=parseFloat(_getStyle(t,"padding"+a[i],cs,true))||0;v-=parseFloat(_getStyle(t,"border"+a[i]+"Width",cs,true))||0}return v},_parsePosition=function(v,recObj){if(v==null||v===""||v==="auto"||v==="auto auto"){v="0 0"}var a=v.split(" "),x=v.indexOf("left")!==-1?"0%":v.indexOf("right")!==-1?"100%":a[0],y=v.indexOf("top")!==-1?"0%":v.indexOf("bottom")!==-1?"100%":a[1];if(y==null){y="0"}else if(y==="center"){y="50%"}if(x==="center"||isNaN(parseFloat(x))&&(x+"").indexOf("=")===-1){x="50%"}if(recObj){recObj.oxp=x.indexOf("%")!==-1;recObj.oyp=y.indexOf("%")!==-1;recObj.oxr=x.charAt(1)==="=";recObj.oyr=y.charAt(1)==="=";recObj.ox=parseFloat(x.replace(_NaNExp,""));recObj.oy=parseFloat(y.replace(_NaNExp,""))}return x+" "+y+(a.length>2?" "+a[2]:"")},_parseChange=function(e,b){return typeof e==="string"&&e.charAt(1)==="="?parseInt(e.charAt(0)+"1",10)*parseFloat(e.substr(2)):parseFloat(e)-parseFloat(b)},_parseVal=function(v,d){return v==null?d:typeof v==="string"&&v.charAt(1)==="="?parseInt(v.charAt(0)+"1",10)*parseFloat(v.substr(2))+d:parseFloat(v)},_parseAngle=function(v,d,p,directionalEnd){var min=1e-6,cap,split,dif,result;if(v==null){result=d}else if(typeof v==="number"){result=v}else{cap=360;split=v.split("_");dif=Number(split[0].replace(_NaNExp,""))*(v.indexOf("rad")===-1?1:_RAD2DEG)-(v.charAt(1)==="="?0:d);if(split.length){if(directionalEnd){directionalEnd[p]=d+dif}if(v.indexOf("short")!==-1){dif=dif%cap;if(dif!==dif%(cap/2)){dif=dif<0?dif+cap:dif-cap}}if(v.indexOf("_cw")!==-1&&dif<0){dif=(dif+cap*9999999999)%cap-(dif/cap|0)*cap}else if(v.indexOf("ccw")!==-1&&dif>0){dif=(dif-cap*9999999999)%cap-(dif/cap|0)*cap}}result=d+dif}if(result<min&&result>-min){result=0}return result},_colorLookup={aqua:[0,255,255],lime:[0,255,0],silver:[192,192,192],black:[0,0,0],maroon:[128,0,0],teal:[0,128,128],blue:[0,0,255],navy:[0,0,128],white:[255,255,255],fuchsia:[255,0,255],olive:[128,128,0],yellow:[255,255,0],orange:[255,165,0],gray:[128,128,128],purple:[128,0,128],green:[0,128,0],red:[255,0,0],pink:[255,192,203],cyan:[0,255,255],transparent:[255,255,255,0]},_hue=function(h,m1,m2){h=h<0?h+1:h>1?h-1:h;return(h*6<1?m1+(m2-m1)*h*6:h<.5?m2:h*3<2?m1+(m2-m1)*(2/3-h)*6:m1)*255+.5|0},_parseColor=function(v){var c1,c2,c3,h,s,l;if(!v||v===""){return _colorLookup.black}if(typeof v==="number"){return[v>>16,v>>8&255,v&255]}if(v.charAt(v.length-1)===","){v=v.substr(0,v.length-1)}if(_colorLookup[v]){return _colorLookup[v]}if(v.charAt(0)==="#"){if(v.length===4){c1=v.charAt(1),c2=v.charAt(2),c3=v.charAt(3);v="#"+c1+c1+c2+c2+c3+c3}v=parseInt(v.substr(1),16);return[v>>16,v>>8&255,v&255]}if(v.substr(0,3)==="hsl"){v=v.match(_numExp);h=Number(v[0])%360/360;s=Number(v[1])/100;l=Number(v[2])/100;c2=l<=.5?l*(s+1):l+s-l*s;c1=l*2-c2;if(v.length>3){v[3]=Number(v[3])}v[0]=_hue(h+1/3,c1,c2);v[1]=_hue(h,c1,c2);v[2]=_hue(h-1/3,c1,c2);return v}v=v.match(_numExp)||_colorLookup.transparent;v[0]=Number(v[0]);v[1]=Number(v[1]);v[2]=Number(v[2]);if(v.length>3){v[3]=Number(v[3])}return v},_colorExp="(?:\\b(?:(?:rgb|rgba|hsl|hsla)\\(.+?\\))|\\B#.+?\\b";for(p in _colorLookup){_colorExp+="|"+p+"\\b"}_colorExp=new RegExp(_colorExp+")","gi");var _getFormatter=function(dflt,clr,collapsible,multi){if(dflt==null){return function(v){return v}}var dColor=clr?(dflt.match(_colorExp)||[""])[0]:"",dVals=dflt.split(dColor).join("").match(_valuesExp)||[],pfx=dflt.substr(0,dflt.indexOf(dVals[0])),sfx=dflt.charAt(dflt.length-1)===")"?")":"",delim=dflt.indexOf(" ")!==-1?" ":",",numVals=dVals.length,dSfx=numVals>0?dVals[0].replace(_numExp,""):"",formatter;if(!numVals){return function(v){return v}}if(clr){formatter=function(v){var color,vals,i,a;if(typeof v==="number"){v+=dSfx}else if(multi&&_commasOutsideParenExp.test(v)){a=v.replace(_commasOutsideParenExp,"|").split("|");for(i=0;i<a.length;i++){a[i]=formatter(a[i])}return a.join(",")}color=(v.match(_colorExp)||[dColor])[0];vals=v.split(color).join("").match(_valuesExp)||[];i=vals.length;if(numVals>i--){while(++i<numVals){vals[i]=collapsible?vals[(i-1)/2|0]:dVals[i]}}return pfx+vals.join(delim)+delim+color+sfx+(v.indexOf("inset")!==-1?" inset":"")};return formatter}formatter=function(v){var vals,a,i;if(typeof v==="number"){v+=dSfx}else if(multi&&_commasOutsideParenExp.test(v)){a=v.replace(_commasOutsideParenExp,"|").split("|");for(i=0;i<a.length;i++){a[i]=formatter(a[i])}return a.join(",")}vals=v.match(_valuesExp)||[];i=vals.length;if(numVals>i--){while(++i<numVals){vals[i]=collapsible?vals[(i-1)/2|0]:dVals[i]}}return pfx+vals.join(delim)+sfx};return formatter},_getEdgeParser=function(props){props=props.split(",");return function(t,e,p,cssp,pt,plugin,vars){var a=(e+"").split(" "),i;vars={};for(i=0;i<4;i++){vars[props[i]]=a[i]=a[i]||a[(i-1)/2>>0]}return cssp.parse(t,vars,pt,plugin)}},_setPluginRatio=_internals._setPluginRatio=function(v){this.plugin.setRatio(v);var d=this.data,proxy=d.proxy,mpt=d.firstMPT,min=1e-6,val,pt,i,str;while(mpt){val=proxy[mpt.v];if(mpt.r){val=Math.round(val)}else if(val<min&&val>-min){val=0}mpt.t[mpt.p]=val;mpt=mpt._next}if(d.autoRotate){d.autoRotate.rotation=proxy.rotation}if(v===1){mpt=d.firstMPT;while(mpt){pt=mpt.t;if(!pt.type){pt.e=pt.s+pt.xs0}else if(pt.type===1){str=pt.xs0+pt.s+pt.xs1;for(i=1;i<pt.l;i++){str+=pt["xn"+i]+pt["xs"+(i+1)]}pt.e=str}mpt=mpt._next}}},MiniPropTween=function(t,p,v,next,r){this.t=t;this.p=p;this.v=v;this.r=r;if(next){next._prev=this;this._next=next}},_parseToProxy=_internals._parseToProxy=function(t,vars,cssp,pt,plugin,shallow){var bpt=pt,start={},end={},transform=cssp._transform,oldForce=_forcePT,i,p,xp,mpt,firstPT;cssp._transform=null;_forcePT=vars;pt=firstPT=cssp.parse(t,vars,pt,plugin);_forcePT=oldForce;if(shallow){cssp._transform=transform;if(bpt){bpt._prev=null;if(bpt._prev){bpt._prev._next=null}}}while(pt&&pt!==bpt){if(pt.type<=1){p=pt.p;end[p]=pt.s+pt.c;start[p]=pt.s;if(!shallow){mpt=new MiniPropTween(pt,"s",p,mpt,pt.r);pt.c=0}if(pt.type===1){i=pt.l;while(--i>0){xp="xn"+i;p=pt.p+"_"+xp;end[p]=pt.data[xp];start[p]=pt[xp];if(!shallow){mpt=new MiniPropTween(pt,xp,p,mpt,pt.rxp[xp])}}}}pt=pt._next}return{proxy:start,end:end,firstMPT:mpt,pt:firstPT}},CSSPropTween=_internals.CSSPropTween=function(t,p,s,c,next,type,n,r,pr,b,e){this.t=t;this.p=p;this.s=s;this.c=c;this.n=n||p;if(!(t instanceof CSSPropTween)){_overwriteProps.push(this.n)}this.r=r;this.type=type||0;if(pr){this.pr=pr;_hasPriority=true}this.b=b===undefined?s:b;this.e=e===undefined?s+c:e;if(next){this._next=next;next._prev=this}},_parseComplex=CSSPlugin.parseComplex=function(t,p,b,e,clrs,dflt,pt,pr,plugin,setRatio){b=b||dflt||"";pt=new CSSPropTween(t,p,0,0,pt,setRatio?2:1,null,false,pr,b,e);e+="";var ba=b.split(", ").join(",").split(" "),ea=e.split(", ").join(",").split(" "),l=ba.length,autoRound=_autoRound!==false,i,xi,ni,bv,ev,bnums,enums,bn,rgba,temp,cv,str;if(e.indexOf(",")!==-1||b.indexOf(",")!==-1){ba=ba.join(" ").replace(_commasOutsideParenExp,", ").split(" ");ea=ea.join(" ").replace(_commasOutsideParenExp,", ").split(" ");l=ba.length}if(l!==ea.length){ba=(dflt||"").split(" ");l=ba.length}pt.plugin=plugin;pt.setRatio=setRatio;for(i=0;i<l;i++){bv=ba[i];ev=ea[i];bn=parseFloat(bv);if(bn||bn===0){pt.appendXtra("",bn,_parseChange(ev,bn),ev.replace(_relNumExp,""),autoRound&&ev.indexOf("px")!==-1,true)}else if(clrs&&(bv.charAt(0)==="#"||_colorLookup[bv]||_rgbhslExp.test(bv))){str=ev.charAt(ev.length-1)===","?"),":")";bv=_parseColor(bv);ev=_parseColor(ev);rgba=bv.length+ev.length>6;if(rgba&&!_supportsOpacity&&ev[3]===0){pt["xs"+pt.l]+=pt.l?" transparent":"transparent";pt.e=pt.e.split(ea[i]).join("transparent")}else{if(!_supportsOpacity){rgba=false}pt.appendXtra(rgba?"rgba(":"rgb(",bv[0],ev[0]-bv[0],",",true,true).appendXtra("",bv[1],ev[1]-bv[1],",",true).appendXtra("",bv[2],ev[2]-bv[2],rgba?",":str,true);if(rgba){bv=bv.length<4?1:bv[3];pt.appendXtra("",bv,(ev.length<4?1:ev[3])-bv,str,false)}}}else{bnums=bv.match(_numExp);if(!bnums){pt["xs"+pt.l]+=pt.l?" "+bv:bv}else{enums=ev.match(_relNumExp);if(!enums||enums.length!==bnums.length){return pt}ni=0;for(xi=0;xi<bnums.length;xi++){cv=bnums[xi];temp=bv.indexOf(cv,ni);pt.appendXtra(bv.substr(ni,temp-ni),Number(cv),_parseChange(enums[xi],cv),"",autoRound&&bv.substr(temp+cv.length,2)==="px",xi===0);ni=temp+cv.length}pt["xs"+pt.l]+=bv.substr(ni)}}}if(e.indexOf("=")!==-1)if(pt.data){str=pt.xs0+pt.data.s;for(i=1;i<pt.l;i++){str+=pt["xs"+i]+pt.data["xn"+i]}pt.e=str+pt["xs"+i]}if(!pt.l){pt.type=-1;pt.xs0=pt.e}return pt.xfirst||pt},i=9;p=CSSPropTween.prototype;p.l=p.pr=0;while(--i>0){p["xn"+i]=0;p["xs"+i]=""}p.xs0="";p._next=p._prev=p.xfirst=p.data=p.plugin=p.setRatio=p.rxp=null;p.appendXtra=function(pfx,s,c,sfx,r,pad){var pt=this,l=pt.l;pt["xs"+l]+=pad&&l?" "+pfx:pfx||"";
if(!c)if(l!==0&&!pt.plugin){pt["xs"+l]+=s+(sfx||"");return pt}pt.l++;pt.type=pt.setRatio?2:1;pt["xs"+pt.l]=sfx||"";if(l>0){pt.data["xn"+l]=s+c;pt.rxp["xn"+l]=r;pt["xn"+l]=s;if(!pt.plugin){pt.xfirst=new CSSPropTween(pt,"xn"+l,s,c,pt.xfirst||pt,0,pt.n,r,pt.pr);pt.xfirst.xs0=0}return pt}pt.data={s:s+c};pt.rxp={};pt.s=s;pt.c=c;pt.r=r;return pt};var SpecialProp=function(p,options){options=options||{};this.p=options.prefix?_checkPropPrefix(p)||p:p;_specialProps[p]=_specialProps[this.p]=this;this.format=options.formatter||_getFormatter(options.defaultValue,options.color,options.collapsible,options.multi);if(options.parser){this.parse=options.parser}this.clrs=options.color;this.multi=options.multi;this.keyword=options.keyword;this.dflt=options.defaultValue;this.pr=options.priority||0},_registerComplexSpecialProp=_internals._registerComplexSpecialProp=function(p,options,defaults){if(typeof options!=="object"){options={parser:defaults}}var a=p.split(","),d=options.defaultValue,i,temp;defaults=defaults||[d];for(i=0;i<a.length;i++){options.prefix=i===0&&options.prefix;options.defaultValue=defaults[i]||d;temp=new SpecialProp(a[i],options)}},_registerPluginProp=function(p){if(!_specialProps[p]){var pluginName=p.charAt(0).toUpperCase()+p.substr(1)+"Plugin";_registerComplexSpecialProp(p,{parser:function(t,e,p,cssp,pt,plugin,vars){var pluginClass=(_gsScope.GreenSockGlobals||_gsScope).com.greensock.plugins[pluginName];if(!pluginClass){_log("Error: "+pluginName+" js file not loaded.");return pt}pluginClass._cssRegister();return _specialProps[p].parse(t,e,p,cssp,pt,plugin,vars)}})}};p=SpecialProp.prototype;p.parseComplex=function(t,b,e,pt,plugin,setRatio){var kwd=this.keyword,i,ba,ea,l,bi,ei;if(this.multi)if(_commasOutsideParenExp.test(e)||_commasOutsideParenExp.test(b)){ba=b.replace(_commasOutsideParenExp,"|").split("|");ea=e.replace(_commasOutsideParenExp,"|").split("|")}else if(kwd){ba=[b];ea=[e]}if(ea){l=ea.length>ba.length?ea.length:ba.length;for(i=0;i<l;i++){b=ba[i]=ba[i]||this.dflt;e=ea[i]=ea[i]||this.dflt;if(kwd){bi=b.indexOf(kwd);ei=e.indexOf(kwd);if(bi!==ei){e=ei===-1?ea:ba;e[i]+=" "+kwd}}}b=ba.join(", ");e=ea.join(", ")}return _parseComplex(t,this.p,b,e,this.clrs,this.dflt,pt,this.pr,plugin,setRatio)};p.parse=function(t,e,p,cssp,pt,plugin,vars){return this.parseComplex(t.style,this.format(_getStyle(t,this.p,_cs,false,this.dflt)),this.format(e),pt,plugin)};CSSPlugin.registerSpecialProp=function(name,onInitTween,priority){_registerComplexSpecialProp(name,{parser:function(t,e,p,cssp,pt,plugin,vars){var rv=new CSSPropTween(t,p,0,0,pt,2,p,false,priority);rv.plugin=plugin;rv.setRatio=onInitTween(t,e,cssp._tween,p);return rv},priority:priority})};var _transformProps="scaleX,scaleY,scaleZ,x,y,z,skewX,skewY,rotation,rotationX,rotationY,perspective,xPercent,yPercent".split(","),_transformProp=_checkPropPrefix("transform"),_transformPropCSS=_prefixCSS+"transform",_transformOriginProp=_checkPropPrefix("transformOrigin"),_supports3D=_checkPropPrefix("perspective")!==null,Transform=_internals.Transform=function(){this.skewY=0},_SVGElement=window.SVGElement,_forceSVGTransformToAttr=_SVGElement&&(_ieVers||/Android/i.test(_agent)&&!window.chrome),_parseSVGOrigin=function(e,origin,decoratee){var bbox=e.getBBox();origin=_parsePosition(origin).split(" ");decoratee.xOrigin=(origin[0].indexOf("%")!==-1?parseFloat(origin[0])/100*bbox.width:parseFloat(origin[0]))+bbox.x;decoratee.yOrigin=(origin[1].indexOf("%")!==-1?parseFloat(origin[1])/100*bbox.height:parseFloat(origin[1]))+bbox.y},_getTransform=_internals.getTransform=function(t,cs,rec,parse){if(t._gsTransform&&rec&&!parse){return t._gsTransform}var tm=rec?t._gsTransform||new Transform:new Transform,invX=tm.scaleX<0,min=2e-5,rnd=1e5,minAngle=179.99,minPI=minAngle*_DEG2RAD,zOrigin=_supports3D?parseFloat(_getStyle(t,_transformOriginProp,cs,false,"0 0 0").split(" ")[2])||tm.zOrigin||0:0,defaultTransformPerspective=parseFloat(CSSPlugin.defaultTransformPerspective)||0,s,m,i,n,dec,scaleX,scaleY,rotation,skewX,difX,difY,difR,difS;if(_transformProp){s=_getStyle(t,_transformPropCSS,cs,true)}else if(t.currentStyle){s=t.currentStyle.filter.match(_ieGetMatrixExp);s=s&&s.length===4?[s[0].substr(4),Number(s[2].substr(4)),Number(s[1].substr(4)),s[3].substr(4),tm.x||0,tm.y||0].join(","):""}if(!s||s==="none"||s==="matrix(1, 0, 0, 1, 0, 0)"){tm={x:0,y:0,z:0,scaleX:1,scaleY:1,scaleZ:1,skewX:0,skewY:0,perspective:defaultTransformPerspective,rotation:0,rotationX:0,rotationY:0,zOrigin:0}}else{m=(s||"").match(/(?:\-|\b)[\d\-\.e]+\b/gi)||[];i=m.length;while(--i>-1){n=Number(m[i]);m[i]=(dec=n-(n|=0))?(dec*rnd+(dec<0?-.5:.5)|0)/rnd+n:n}if(m.length===16){var a13=m[8],a23=m[9],a33=m[10],a14=m[12],a24=m[13],a34=m[14];if(tm.zOrigin){a34=-tm.zOrigin;a14=a13*a34-m[12];a24=a23*a34-m[13];a34=a33*a34+tm.zOrigin-m[14]}if(!rec||parse||tm.rotationX==null){var a11=m[0],a21=m[1],a31=m[2],a41=m[3],a12=m[4],a22=m[5],a32=m[6],a42=m[7],a43=m[11],angle=Math.atan2(a32,a33),xFlip=angle<-minPI||angle>minPI,t1,t2,t3,cos,sin,yFlip,zFlip;tm.rotationX=angle*_RAD2DEG;if(angle){cos=Math.cos(-angle);sin=Math.sin(-angle);t1=a12*cos+a13*sin;t2=a22*cos+a23*sin;t3=a32*cos+a33*sin;a13=a12*-sin+a13*cos;a23=a22*-sin+a23*cos;a33=a32*-sin+a33*cos;a43=a42*-sin+a43*cos;a12=t1;a22=t2;a32=t3}angle=Math.atan2(a13,a11);tm.rotationY=angle*_RAD2DEG;if(angle){yFlip=angle<-minPI||angle>minPI;cos=Math.cos(-angle);sin=Math.sin(-angle);t1=a11*cos-a13*sin;t2=a21*cos-a23*sin;t3=a31*cos-a33*sin;a23=a21*sin+a23*cos;a33=a31*sin+a33*cos;a43=a41*sin+a43*cos;a11=t1;a21=t2;a31=t3}angle=Math.atan2(a21,a22);tm.rotation=angle*_RAD2DEG;if(angle){zFlip=angle<-minPI||angle>minPI;cos=Math.cos(-angle);sin=Math.sin(-angle);a11=a11*cos+a12*sin;t2=a21*cos+a22*sin;a22=a21*-sin+a22*cos;a32=a31*-sin+a32*cos;a21=t2}if(zFlip&&xFlip){tm.rotation=tm.rotationX=0}else if(zFlip&&yFlip){tm.rotation=tm.rotationY=0}else if(yFlip&&xFlip){tm.rotationY=tm.rotationX=0}tm.scaleX=(Math.sqrt(a11*a11+a21*a21)*rnd+.5|0)/rnd;tm.scaleY=(Math.sqrt(a22*a22+a23*a23)*rnd+.5|0)/rnd;tm.scaleZ=(Math.sqrt(a32*a32+a33*a33)*rnd+.5|0)/rnd;tm.skewX=0;tm.perspective=a43?1/(a43<0?-a43:a43):0;tm.x=a14;tm.y=a24;tm.z=a34}}else if((!_supports3D||parse||!m.length||tm.x!==m[4]||tm.y!==m[5]||!tm.rotationX&&!tm.rotationY)&&!(tm.x!==undefined&&_getStyle(t,"display",cs)==="none")){var k=m.length>=6,a=k?m[0]:1,b=m[1]||0,c=m[2]||0,d=k?m[3]:1;tm.x=m[4]||0;tm.y=m[5]||0;scaleX=Math.sqrt(a*a+b*b);scaleY=Math.sqrt(d*d+c*c);rotation=a||b?Math.atan2(b,a)*_RAD2DEG:tm.rotation||0;skewX=c||d?Math.atan2(c,d)*_RAD2DEG+rotation:tm.skewX||0;difX=scaleX-Math.abs(tm.scaleX||0);difY=scaleY-Math.abs(tm.scaleY||0);if(Math.abs(skewX)>90&&Math.abs(skewX)<270){if(invX){scaleX*=-1;skewX+=rotation<=0?180:-180;rotation+=rotation<=0?180:-180}else{scaleY*=-1;skewX+=skewX<=0?180:-180}}difR=(rotation-tm.rotation)%180;difS=(skewX-tm.skewX)%180;if(tm.skewX===undefined||difX>min||difX<-min||difY>min||difY<-min||difR>-minAngle&&difR<minAngle&&difR*rnd|0!==0||difS>-minAngle&&difS<minAngle&&difS*rnd|0!==0){tm.scaleX=scaleX;tm.scaleY=scaleY;tm.rotation=rotation;tm.skewX=skewX}if(_supports3D){tm.rotationX=tm.rotationY=tm.z=0;tm.perspective=defaultTransformPerspective;tm.scaleZ=1}}tm.zOrigin=zOrigin;for(i in tm){if(tm[i]<min)if(tm[i]>-min){tm[i]=0}}}if(rec){t._gsTransform=tm}tm.svg=_SVGElement&&t instanceof _SVGElement;if(tm.svg){_parseSVGOrigin(t,_getStyle(t,_transformOriginProp,_cs,false,"50% 50%")+"",tm)}tm.xPercent=tm.yPercent=0;return tm},_setIETransformRatio=function(v){var t=this.data,ang=-t.rotation*_DEG2RAD,skew=ang+t.skewX*_DEG2RAD,rnd=1e5,a=(Math.cos(ang)*t.scaleX*rnd|0)/rnd,b=(Math.sin(ang)*t.scaleX*rnd|0)/rnd,c=(Math.sin(skew)*-t.scaleY*rnd|0)/rnd,d=(Math.cos(skew)*t.scaleY*rnd|0)/rnd,style=this.t.style,cs=this.t.currentStyle,filters,val;if(!cs){return}val=b;b=-c;c=-val;filters=cs.filter;style.filter="";var w=this.t.offsetWidth,h=this.t.offsetHeight,clip=cs.position!=="absolute",m="progid:DXImageTransform.Microsoft.Matrix(M11="+a+", M12="+b+", M21="+c+", M22="+d,ox=t.x+w*t.xPercent/100,oy=t.y+h*t.yPercent/100,dx,dy;if(t.ox!=null){dx=(t.oxp?w*t.ox*.01:t.ox)-w/2;dy=(t.oyp?h*t.oy*.01:t.oy)-h/2;ox+=dx-(dx*a+dy*b);oy+=dy-(dx*c+dy*d)}if(!clip){m+=", sizingMethod='auto expand')"}else{dx=w/2;dy=h/2;m+=", Dx="+(dx-(dx*a+dy*b)+ox)+", Dy="+(dy-(dx*c+dy*d)+oy)+")"}if(filters.indexOf("DXImageTransform.Microsoft.Matrix(")!==-1){style.filter=filters.replace(_ieSetMatrixExp,m)}else{style.filter=m+" "+filters}if(v===0||v===1)if(a===1)if(b===0)if(c===0)if(d===1)if(!clip||m.indexOf("Dx=0, Dy=0")!==-1)if(!_opacityExp.test(filters)||parseFloat(RegExp.$1)===100)if(filters.indexOf("gradient("&&filters.indexOf("Alpha"))===-1){style.removeAttribute("filter")}if(!clip){var mult=_ieVers<8?1:-1,marg,prop,dif;dx=t.ieOffsetX||0;dy=t.ieOffsetY||0;t.ieOffsetX=Math.round((w-((a<0?-a:a)*w+(b<0?-b:b)*h))/2+ox);t.ieOffsetY=Math.round((h-((d<0?-d:d)*h+(c<0?-c:c)*w))/2+oy);for(i=0;i<4;i++){prop=_margins[i];marg=cs[prop];val=marg.indexOf("px")!==-1?parseFloat(marg):_convertToPixels(this.t,prop,parseFloat(marg),marg.replace(_suffixExp,""))||0;if(val!==t[prop]){dif=i<2?-t.ieOffsetX:-t.ieOffsetY}else{dif=i<2?dx-t.ieOffsetX:dy-t.ieOffsetY}style[prop]=(t[prop]=Math.round(val-dif*(i===0||i===2?1:mult)))+"px"}}},_set3DTransformRatio=_internals.set3DTransformRatio=function(v){var t=this.data,style=this.t.style,angle=t.rotation*_DEG2RAD,sx=t.scaleX,sy=t.scaleY,sz=t.scaleZ,x=t.x,y=t.y,z=t.z,perspective=t.perspective,a11,a12,a13,a14,a21,a22,a23,a24,a31,a32,a33,a34,a41,a42,a43,zOrigin,rnd,cos,sin,t1,t2,t3,t4;if(v===1||v===0)if(t.force3D==="auto")if(!t.rotationY&&!t.rotationX&&sz===1&&!perspective&&!z){_set2DTransformRatio.call(this,v);return}if(_isFirefox){var n=1e-4;if(sx<n&&sx>-n){sx=sz=2e-5}if(sy<n&&sy>-n){sy=sz=2e-5}if(perspective&&!t.z&&!t.rotationX&&!t.rotationY){perspective=0}}if(angle||t.skewX){cos=Math.cos(angle);sin=Math.sin(angle);a11=cos;a21=sin;if(t.skewX){angle-=t.skewX*_DEG2RAD;cos=Math.cos(angle);sin=Math.sin(angle);if(t.skewType==="simple"){t1=Math.tan(t.skewX*_DEG2RAD);t1=Math.sqrt(1+t1*t1);cos*=t1;sin*=t1}}a12=-sin;a22=cos}else if(!t.rotationY&&!t.rotationX&&sz===1&&!perspective&&!t.svg){style[_transformProp]=(t.xPercent||t.yPercent?"translate("+t.xPercent+"%,"+t.yPercent+"%) translate3d(":"translate3d(")+x+"px,"+y+"px,"+z+"px)"+(sx!==1||sy!==1?" scale("+sx+","+sy+")":"");return}else{a11=a22=1;a12=a21=0}a33=1;a13=a14=a23=a24=a31=a32=a34=a41=a42=0;a43=perspective?-1/perspective:0;zOrigin=t.zOrigin;rnd=1e5;angle=t.rotationY*_DEG2RAD;if(angle){cos=Math.cos(angle);sin=Math.sin(angle);a31=a33*-sin;a41=a43*-sin;a13=a11*sin;a23=a21*sin;a33*=cos;a43*=cos;a11*=cos;a21*=cos}angle=t.rotationX*_DEG2RAD;if(angle){cos=Math.cos(angle);sin=Math.sin(angle);t1=a12*cos+a13*sin;t2=a22*cos+a23*sin;t3=a32*cos+a33*sin;t4=a42*cos+a43*sin;a13=a12*-sin+a13*cos;a23=a22*-sin+a23*cos;a33=a32*-sin+a33*cos;a43=a42*-sin+a43*cos;a12=t1;a22=t2;a32=t3;a42=t4}if(sz!==1){a13*=sz;a23*=sz;a33*=sz;a43*=sz}if(sy!==1){a12*=sy;a22*=sy;a32*=sy;a42*=sy}if(sx!==1){a11*=sx;a21*=sx;a31*=sx;a41*=sx}if(zOrigin){a34-=zOrigin;a14=a13*a34;a24=a23*a34;a34=a33*a34+zOrigin}if(t.svg){a14+=t.xOrigin-(t.xOrigin*a11+t.yOrigin*a12);a24+=t.yOrigin-(t.xOrigin*a21+t.yOrigin*a22)}a14=(t1=(a14+=x)-(a14|=0))?(t1*rnd+(t1<0?-.5:.5)|0)/rnd+a14:a14;a24=(t1=(a24+=y)-(a24|=0))?(t1*rnd+(t1<0?-.5:.5)|0)/rnd+a24:a24;a34=(t1=(a34+=z)-(a34|=0))?(t1*rnd+(t1<0?-.5:.5)|0)/rnd+a34:a34;style[_transformProp]=(t.xPercent||t.yPercent?"translate("+t.xPercent+"%,"+t.yPercent+"%) matrix3d(":"matrix3d(")+[(a11*rnd|0)/rnd,(a21*rnd|0)/rnd,(a31*rnd|0)/rnd,(a41*rnd|0)/rnd,(a12*rnd|0)/rnd,(a22*rnd|0)/rnd,(a32*rnd|0)/rnd,(a42*rnd|0)/rnd,(a13*rnd|0)/rnd,(a23*rnd|0)/rnd,(a33*rnd|0)/rnd,(a43*rnd|0)/rnd,a14,a24,a34,perspective?1+-a34/perspective:1].join(",")+")"},_set2DTransformRatio=_internals.set2DTransformRatio=function(v){var t=this.data,targ=this.t,style=targ.style,x=t.x,y=t.y,ang,skew,rnd,sx,sy,a,b,c,d,matrix,min;if((t.rotationX||t.rotationY||t.z||t.force3D===true||t.force3D==="auto"&&v!==1&&v!==0)&&!(t.svg&&_forceSVGTransformToAttr)&&_supports3D){this.setRatio=_set3DTransformRatio;_set3DTransformRatio.call(this,v);return}sx=t.scaleX;sy=t.scaleY;if(t.rotation||t.skewX||t.svg){ang=t.rotation*_DEG2RAD;skew=ang-t.skewX*_DEG2RAD;rnd=1e5;a=Math.cos(ang)*sx;b=Math.sin(ang)*sx;c=Math.sin(skew)*-sy;d=Math.cos(skew)*sy;if(t.svg){x+=t.xOrigin-(t.xOrigin*a+t.yOrigin*c);y+=t.yOrigin-(t.xOrigin*b+t.yOrigin*d);min=1e-6;if(x<min)if(x>-min){x=0}if(y<min)if(y>-min){y=0}}matrix=(a*rnd|0)/rnd+","+(b*rnd|0)/rnd+","+(c*rnd|0)/rnd+","+(d*rnd|0)/rnd+","+x+","+y+")";if(t.svg&&_forceSVGTransformToAttr){targ.setAttribute("transform","matrix("+matrix)}else{style[_transformProp]=(t.xPercent||t.yPercent?"translate("+t.xPercent+"%,"+t.yPercent+"%) matrix(":"matrix(")+matrix}}else{style[_transformProp]=(t.xPercent||t.yPercent?"translate("+t.xPercent+"%,"+t.yPercent+"%) matrix(":"matrix(")+sx+",0,0,"+sy+","+x+","+y+")"}};_registerComplexSpecialProp("transform,scale,scaleX,scaleY,scaleZ,x,y,z,rotation,rotationX,rotationY,rotationZ,skewX,skewY,shortRotation,shortRotationX,shortRotationY,shortRotationZ,transformOrigin,transformPerspective,directionalRotation,parseTransform,force3D,skewType,xPercent,yPercent",{parser:function(t,e,p,cssp,pt,plugin,vars){if(cssp._transform){return pt}var m1=cssp._transform=_getTransform(t,_cs,true,vars.parseTransform),style=t.style,min=1e-6,i=_transformProps.length,v=vars,endRotations={},m2,skewY,copy,orig,has3D,hasChange,dr;if(typeof v.transform==="string"&&_transformProp){copy=_tempDiv.style;copy[_transformProp]=v.transform;copy.display="block";copy.position="absolute";_doc.body.appendChild(_tempDiv);m2=_getTransform(_tempDiv,null,false);_doc.body.removeChild(_tempDiv)}else if(typeof v==="object"){m2={scaleX:_parseVal(v.scaleX!=null?v.scaleX:v.scale,m1.scaleX),scaleY:_parseVal(v.scaleY!=null?v.scaleY:v.scale,m1.scaleY),scaleZ:_parseVal(v.scaleZ,m1.scaleZ),x:_parseVal(v.x,m1.x),y:_parseVal(v.y,m1.y),z:_parseVal(v.z,m1.z),xPercent:_parseVal(v.xPercent,m1.xPercent),yPercent:_parseVal(v.yPercent,m1.yPercent),perspective:_parseVal(v.transformPerspective,m1.perspective)};dr=v.directionalRotation;if(dr!=null){if(typeof dr==="object"){for(copy in dr){v[copy]=dr[copy]}}else{v.rotation=dr}}if(typeof v.x==="string"&&v.x.indexOf("%")!==-1){m2.x=0;m2.xPercent=_parseVal(v.x,m1.xPercent)}if(typeof v.y==="string"&&v.y.indexOf("%")!==-1){m2.y=0;m2.yPercent=_parseVal(v.y,m1.yPercent)}m2.rotation=_parseAngle("rotation"in v?v.rotation:"shortRotation"in v?v.shortRotation+"_short":"rotationZ"in v?v.rotationZ:m1.rotation,m1.rotation,"rotation",endRotations);if(_supports3D){m2.rotationX=_parseAngle("rotationX"in v?v.rotationX:"shortRotationX"in v?v.shortRotationX+"_short":m1.rotationX||0,m1.rotationX,"rotationX",endRotations);m2.rotationY=_parseAngle("rotationY"in v?v.rotationY:"shortRotationY"in v?v.shortRotationY+"_short":m1.rotationY||0,m1.rotationY,"rotationY",endRotations)}m2.skewX=v.skewX==null?m1.skewX:_parseAngle(v.skewX,m1.skewX);m2.skewY=v.skewY==null?m1.skewY:_parseAngle(v.skewY,m1.skewY);if(skewY=m2.skewY-m1.skewY){m2.skewX+=skewY;m2.rotation+=skewY}}if(_supports3D&&v.force3D!=null){m1.force3D=v.force3D;hasChange=true}m1.skewType=v.skewType||m1.skewType||CSSPlugin.defaultSkewType;has3D=m1.force3D||m1.z||m1.rotationX||m1.rotationY||m2.z||m2.rotationX||m2.rotationY||m2.perspective;if(!has3D&&v.scale!=null){m2.scaleZ=1}while(--i>-1){p=_transformProps[i];orig=m2[p]-m1[p];if(orig>min||orig<-min||v[p]!=null||_forcePT[p]!=null){hasChange=true;pt=new CSSPropTween(m1,p,m1[p],orig,pt);if(p in endRotations){pt.e=endRotations[p]}pt.xs0=0;pt.plugin=plugin;cssp._overwriteProps.push(pt.n)}}orig=v.transformOrigin;if(orig&&m1.svg){_parseSVGOrigin(t,orig,m2);pt=new CSSPropTween(m1,"xOrigin",m1.xOrigin,m2.xOrigin-m1.xOrigin,pt,-1,"transformOrigin");pt.b=m1.xOrigin;pt.e=pt.xs0=m2.xOrigin;pt=new CSSPropTween(m1,"yOrigin",m1.yOrigin,m2.yOrigin-m1.yOrigin,pt,-1,"transformOrigin");pt.b=m1.yOrigin;pt.e=pt.xs0=m2.yOrigin;_removeProp(style,_transformOriginProp)}else if(orig||_supports3D&&has3D&&m1.zOrigin){if(_transformProp){hasChange=true;p=_transformOriginProp;orig=(orig||_getStyle(t,p,_cs,false,"50% 50%"))+"";pt=new CSSPropTween(style,p,0,0,pt,-1,"transformOrigin");pt.b=style[p];pt.plugin=plugin;if(_supports3D){copy=m1.zOrigin;orig=orig.split(" ");m1.zOrigin=(orig.length>2&&!(copy!==0&&orig[2]==="0px")?parseFloat(orig[2]):copy)||0;pt.xs0=pt.e=orig[0]+" "+(orig[1]||"50%")+" 0px";pt=new CSSPropTween(m1,"zOrigin",0,0,pt,-1,pt.n);pt.b=copy;pt.xs0=pt.e=m1.zOrigin}else{pt.xs0=pt.e=orig}}else{_parsePosition(orig+"",m1)}}if(hasChange){cssp._transformType=!(m1.svg&&_forceSVGTransformToAttr)&&(has3D||this._transformType===3)?3:2}return pt},prefix:true});_registerComplexSpecialProp("boxShadow",{defaultValue:"0px 0px 0px 0px #999",prefix:true,color:true,multi:true,keyword:"inset"});_registerComplexSpecialProp("borderRadius",{defaultValue:"0px",parser:function(t,e,p,cssp,pt,plugin){e=this.format(e);var props=["borderTopLeftRadius","borderTopRightRadius","borderBottomRightRadius","borderBottomLeftRadius"],style=t.style,ea1,i,es2,bs2,bs,es,bn,en,w,h,esfx,bsfx,rel,hn,vn,em;w=parseFloat(t.offsetWidth);h=parseFloat(t.offsetHeight);ea1=e.split(" ");for(i=0;i<props.length;i++){if(this.p.indexOf("border")){props[i]=_checkPropPrefix(props[i])}bs=bs2=_getStyle(t,props[i],_cs,false,"0px");if(bs.indexOf(" ")!==-1){bs2=bs.split(" ");bs=bs2[0];bs2=bs2[1]}es=es2=ea1[i];bn=parseFloat(bs);bsfx=bs.substr((bn+"").length);rel=es.charAt(1)==="=";if(rel){en=parseInt(es.charAt(0)+"1",10);es=es.substr(2);en*=parseFloat(es);esfx=es.substr((en+"").length-(en<0?1:0))||""}else{en=parseFloat(es);esfx=es.substr((en+"").length)}if(esfx===""){esfx=_suffixMap[p]||bsfx}if(esfx!==bsfx){hn=_convertToPixels(t,"borderLeft",bn,bsfx);vn=_convertToPixels(t,"borderTop",bn,bsfx);if(esfx==="%"){bs=hn/w*100+"%";bs2=vn/h*100+"%"}else if(esfx==="em"){em=_convertToPixels(t,"borderLeft",1,"em");bs=hn/em+"em";bs2=vn/em+"em"}else{bs=hn+"px";bs2=vn+"px"}if(rel){es=parseFloat(bs)+en+esfx;es2=parseFloat(bs2)+en+esfx}}pt=_parseComplex(style,props[i],bs+" "+bs2,es+" "+es2,false,"0px",pt)}return pt},prefix:true,formatter:_getFormatter("0px 0px 0px 0px",false,true)});_registerComplexSpecialProp("backgroundPosition",{defaultValue:"0 0",parser:function(t,e,p,cssp,pt,plugin){var bp="background-position",cs=_cs||_getComputedStyle(t,null),bs=this.format((cs?_ieVers?cs.getPropertyValue(bp+"-x")+" "+cs.getPropertyValue(bp+"-y"):cs.getPropertyValue(bp):t.currentStyle.backgroundPositionX+" "+t.currentStyle.backgroundPositionY)||"0 0"),es=this.format(e),ba,ea,i,pct,overlap,src;if(bs.indexOf("%")!==-1!==(es.indexOf("%")!==-1)){src=_getStyle(t,"backgroundImage").replace(_urlExp,"");if(src&&src!=="none"){ba=bs.split(" ");ea=es.split(" ");_tempImg.setAttribute("src",src);i=2;while(--i>-1){bs=ba[i];pct=bs.indexOf("%")!==-1;if(pct!==(ea[i].indexOf("%")!==-1)){overlap=i===0?t.offsetWidth-_tempImg.width:t.offsetHeight-_tempImg.height;ba[i]=pct?parseFloat(bs)/100*overlap+"px":parseFloat(bs)/overlap*100+"%"}}bs=ba.join(" ")}}return this.parseComplex(t.style,bs,es,pt,plugin)},formatter:_parsePosition});_registerComplexSpecialProp("backgroundSize",{defaultValue:"0 0",formatter:_parsePosition});_registerComplexSpecialProp("perspective",{defaultValue:"0px",prefix:true});_registerComplexSpecialProp("perspectiveOrigin",{defaultValue:"50% 50%",prefix:true});_registerComplexSpecialProp("transformStyle",{prefix:true});_registerComplexSpecialProp("backfaceVisibility",{prefix:true});_registerComplexSpecialProp("userSelect",{prefix:true});_registerComplexSpecialProp("margin",{parser:_getEdgeParser("marginTop,marginRight,marginBottom,marginLeft")});_registerComplexSpecialProp("padding",{parser:_getEdgeParser("paddingTop,paddingRight,paddingBottom,paddingLeft")});_registerComplexSpecialProp("clip",{defaultValue:"rect(0px,0px,0px,0px)",parser:function(t,e,p,cssp,pt,plugin){var b,cs,delim;if(_ieVers<9){cs=t.currentStyle;delim=_ieVers<8?" ":",";b="rect("+cs.clipTop+delim+cs.clipRight+delim+cs.clipBottom+delim+cs.clipLeft+")";e=this.format(e).split(",").join(delim)}else{b=this.format(_getStyle(t,this.p,_cs,false,this.dflt));e=this.format(e)}return this.parseComplex(t.style,b,e,pt,plugin)}});_registerComplexSpecialProp("textShadow",{defaultValue:"0px 0px 0px #999",color:true,multi:true});_registerComplexSpecialProp("autoRound,strictUnits",{parser:function(t,e,p,cssp,pt){return pt}});_registerComplexSpecialProp("border",{defaultValue:"0px solid #000",parser:function(t,e,p,cssp,pt,plugin){return this.parseComplex(t.style,this.format(_getStyle(t,"borderTopWidth",_cs,false,"0px")+" "+_getStyle(t,"borderTopStyle",_cs,false,"solid")+" "+_getStyle(t,"borderTopColor",_cs,false,"#000")),this.format(e),pt,plugin)},color:true,formatter:function(v){var a=v.split(" ");return a[0]+" "+(a[1]||"solid")+" "+(v.match(_colorExp)||["#000"])[0]}});_registerComplexSpecialProp("borderWidth",{parser:_getEdgeParser("borderTopWidth,borderRightWidth,borderBottomWidth,borderLeftWidth")});_registerComplexSpecialProp("float,cssFloat,styleFloat",{parser:function(t,e,p,cssp,pt,plugin){var s=t.style,prop="cssFloat"in s?"cssFloat":"styleFloat";return new CSSPropTween(s,prop,0,0,pt,-1,p,false,0,s[prop],e)}});var _setIEOpacityRatio=function(v){var t=this.t,filters=t.filter||_getStyle(this.data,"filter")||"",val=this.s+this.c*v|0,skip;if(val===100){if(filters.indexOf("atrix(")===-1&&filters.indexOf("radient(")===-1&&filters.indexOf("oader(")===-1){t.removeAttribute("filter");skip=!_getStyle(this.data,"filter")}else{t.filter=filters.replace(_alphaFilterExp,"");skip=true}}if(!skip){if(this.xn1){t.filter=filters=filters||"alpha(opacity="+val+")"}if(filters.indexOf("pacity")===-1){if(val!==0||!this.xn1){t.filter=filters+" alpha(opacity="+val+")"}}else{t.filter=filters.replace(_opacityExp,"opacity="+val)}}};_registerComplexSpecialProp("opacity,alpha,autoAlpha",{defaultValue:"1",parser:function(t,e,p,cssp,pt,plugin){var b=parseFloat(_getStyle(t,"opacity",_cs,false,"1")),style=t.style,isAutoAlpha=p==="autoAlpha";if(typeof e==="string"&&e.charAt(1)==="="){e=(e.charAt(0)==="-"?-1:1)*parseFloat(e.substr(2))+b}if(isAutoAlpha&&b===1&&_getStyle(t,"visibility",_cs)==="hidden"&&e!==0){b=0}if(_supportsOpacity){pt=new CSSPropTween(style,"opacity",b,e-b,pt)}else{pt=new CSSPropTween(style,"opacity",b*100,(e-b)*100,pt);pt.xn1=isAutoAlpha?1:0;style.zoom=1;pt.type=2;pt.b="alpha(opacity="+pt.s+")";pt.e="alpha(opacity="+(pt.s+pt.c)+")";pt.data=t;pt.plugin=plugin;pt.setRatio=_setIEOpacityRatio}if(isAutoAlpha){pt=new CSSPropTween(style,"visibility",0,0,pt,-1,null,false,0,b!==0?"inherit":"hidden",e===0?"hidden":"inherit");pt.xs0="inherit";cssp._overwriteProps.push(pt.n);cssp._overwriteProps.push(p)}return pt}});var _removeProp=function(s,p){if(p){if(s.removeProperty){if(p.substr(0,2)==="ms"){p="M"+p.substr(1)}s.removeProperty(p.replace(_capsExp,"-$1").toLowerCase())}else{s.removeAttribute(p)}}},_setClassNameRatio=function(v){this.t._gsClassPT=this;if(v===1||v===0){this.t.setAttribute("class",v===0?this.b:this.e);var mpt=this.data,s=this.t.style;while(mpt){if(!mpt.v){_removeProp(s,mpt.p)}else{s[mpt.p]=mpt.v}mpt=mpt._next}if(v===1&&this.t._gsClassPT===this){this.t._gsClassPT=null}}else if(this.t.getAttribute("class")!==this.e){this.t.setAttribute("class",this.e)}};_registerComplexSpecialProp("className",{parser:function(t,e,p,cssp,pt,plugin,vars){var b=t.getAttribute("class")||"",cssText=t.style.cssText,difData,bs,cnpt,cnptLookup,mpt;pt=cssp._classNamePT=new CSSPropTween(t,p,0,0,pt,2);pt.setRatio=_setClassNameRatio;pt.pr=-11;_hasPriority=true;pt.b=b;bs=_getAllStyles(t,_cs);cnpt=t._gsClassPT;if(cnpt){cnptLookup={};mpt=cnpt.data;while(mpt){cnptLookup[mpt.p]=1;mpt=mpt._next}cnpt.setRatio(1)}t._gsClassPT=pt;pt.e=e.charAt(1)!=="="?e:b.replace(new RegExp("\\s*\\b"+e.substr(2)+"\\b"),"")+(e.charAt(0)==="+"?" "+e.substr(2):"");if(cssp._tween._duration){t.setAttribute("class",pt.e);difData=_cssDif(t,bs,_getAllStyles(t),vars,cnptLookup);t.setAttribute("class",b);pt.data=difData.firstMPT;t.style.cssText=cssText;pt=pt.xfirst=cssp.parse(t,difData.difs,pt,plugin)}return pt}});var _setClearPropsRatio=function(v){if(v===1||v===0)if(this.data._totalTime===this.data._totalDuration&&this.data.data!=="isFromStart"){var s=this.t.style,transformParse=_specialProps.transform.parse,a,p,i,clearTransform;if(this.e==="all"){s.cssText="";clearTransform=true}else{a=this.e.split(" ").join("").split(",");i=a.length;while(--i>-1){p=a[i];if(_specialProps[p]){if(_specialProps[p].parse===transformParse){clearTransform=true}else{p=p==="transformOrigin"?_transformOriginProp:_specialProps[p].p}}_removeProp(s,p)}}if(clearTransform){_removeProp(s,_transformProp);if(this.t._gsTransform){delete this.t._gsTransform}}}};_registerComplexSpecialProp("clearProps",{parser:function(t,e,p,cssp,pt){pt=new CSSPropTween(t,p,0,0,pt,2);pt.setRatio=_setClearPropsRatio;pt.e=e;pt.pr=-10;pt.data=cssp._tween;_hasPriority=true;return pt}});p="bezier,throwProps,physicsProps,physics2D".split(",");i=p.length;while(i--){_registerPluginProp(p[i])}p=CSSPlugin.prototype;p._firstPT=null;p._onInitTween=function(target,vars,tween){if(!target.nodeType){return false}this._target=target;this._tween=tween;this._vars=vars;_autoRound=vars.autoRound;_hasPriority=false;_suffixMap=vars.suffixMap||CSSPlugin.suffixMap;_cs=_getComputedStyle(target,"");_overwriteProps=this._overwriteProps;var style=target.style,v,pt,pt2,first,last,next,zIndex,tpt,threeD;if(_reqSafariFix)if(style.zIndex===""){v=_getStyle(target,"zIndex",_cs);if(v==="auto"||v===""){this._addLazySet(style,"zIndex",0)}}if(typeof vars==="string"){first=style.cssText;v=_getAllStyles(target,_cs);style.cssText=first+";"+vars;v=_cssDif(target,v,_getAllStyles(target)).difs;if(!_supportsOpacity&&_opacityValExp.test(vars)){v.opacity=parseFloat(RegExp.$1)}vars=v;style.cssText=first}this._firstPT=pt=this.parse(target,vars,null);if(this._transformType){threeD=this._transformType===3;if(!_transformProp){style.zoom=1}else if(_isSafari){_reqSafariFix=true;if(style.zIndex===""){zIndex=_getStyle(target,"zIndex",_cs);if(zIndex==="auto"||zIndex===""){this._addLazySet(style,"zIndex",0)}}if(_isSafariLT6){this._addLazySet(style,"WebkitBackfaceVisibility",this._vars.WebkitBackfaceVisibility||(threeD?"visible":"hidden"))}}pt2=pt;while(pt2&&pt2._next){pt2=pt2._next}tpt=new CSSPropTween(target,"transform",0,0,null,2);this._linkCSSP(tpt,null,pt2);tpt.setRatio=threeD&&_supports3D?_set3DTransformRatio:_transformProp?_set2DTransformRatio:_setIETransformRatio;tpt.data=this._transform||_getTransform(target,_cs,true);_overwriteProps.pop()}if(_hasPriority){while(pt){next=pt._next;pt2=first;while(pt2&&pt2.pr>pt.pr){pt2=pt2._next}if(pt._prev=pt2?pt2._prev:last){pt._prev._next=pt}else{first=pt}if(pt._next=pt2){pt2._prev=pt}else{last=pt}pt=next}this._firstPT=first}return true};p.parse=function(target,vars,pt,plugin){var style=target.style,p,sp,bn,en,bs,es,bsfx,esfx,isStr,rel;for(p in vars){es=vars[p];sp=_specialProps[p];if(sp){pt=sp.parse(target,es,p,this,pt,plugin,vars)}else{bs=_getStyle(target,p,_cs)+"";isStr=typeof es==="string";if(p==="color"||p==="fill"||p==="stroke"||p.indexOf("Color")!==-1||isStr&&_rgbhslExp.test(es)){if(!isStr){es=_parseColor(es);es=(es.length>3?"rgba(":"rgb(")+es.join(",")+")"}pt=_parseComplex(style,p,bs,es,true,"transparent",pt,0,plugin)}else if(isStr&&(es.indexOf(" ")!==-1||es.indexOf(",")!==-1)){pt=_parseComplex(style,p,bs,es,true,null,pt,0,plugin)}else{bn=parseFloat(bs);bsfx=bn||bn===0?bs.substr((bn+"").length):"";if(bs===""||bs==="auto"){if(p==="width"||p==="height"){bn=_getDimension(target,p,_cs);bsfx="px"}else if(p==="left"||p==="top"){bn=_calculateOffset(target,p,_cs);bsfx="px"}else{bn=p!=="opacity"?0:1;bsfx=""}}rel=isStr&&es.charAt(1)==="=";if(rel){en=parseInt(es.charAt(0)+"1",10);es=es.substr(2);en*=parseFloat(es);esfx=es.replace(_suffixExp,"")}else{en=parseFloat(es);esfx=isStr?es.substr((en+"").length)||"":""}if(esfx===""){esfx=p in _suffixMap?_suffixMap[p]:bsfx}es=en||en===0?(rel?en+bn:en)+esfx:vars[p];if(bsfx!==esfx)if(esfx!=="")if(en||en===0)if(bn){bn=_convertToPixels(target,p,bn,bsfx);if(esfx==="%"){bn/=_convertToPixels(target,p,100,"%")/100;if(vars.strictUnits!==true){bs=bn+"%"}}else if(esfx==="em"){bn/=_convertToPixels(target,p,1,"em")}else if(esfx!=="px"){en=_convertToPixels(target,p,en,esfx);esfx="px"}if(rel)if(en||en===0){es=en+bn+esfx}}if(rel){en+=bn}if((bn||bn===0)&&(en||en===0)){pt=new CSSPropTween(style,p,bn,en-bn,pt,0,p,_autoRound!==false&&(esfx==="px"||p==="zIndex"),0,bs,es);pt.xs0=esfx}else if(style[p]===undefined||!es&&(es+""==="NaN"||es==null)){_log("invalid "+p+" tween value: "+vars[p])}else{pt=new CSSPropTween(style,p,en||bn||0,0,pt,-1,p,false,0,bs,es);pt.xs0=es==="none"&&(p==="display"||p.indexOf("Style")!==-1)?bs:es}}}if(plugin)if(pt&&!pt.plugin){pt.plugin=plugin}}return pt};p.setRatio=function(v){var pt=this._firstPT,min=1e-6,val,str,i;if(v===1&&(this._tween._time===this._tween._duration||this._tween._time===0)){while(pt){if(pt.type!==2){pt.t[pt.p]=pt.e}else{pt.setRatio(v)}pt=pt._next}}else if(v||!(this._tween._time===this._tween._duration||this._tween._time===0)||this._tween._rawPrevTime===-1e-6){while(pt){val=pt.c*v+pt.s;if(pt.r){val=Math.round(val)}else if(val<min)if(val>-min){val=0}if(!pt.type){pt.t[pt.p]=val+pt.xs0}else if(pt.type===1){i=pt.l;if(i===2){pt.t[pt.p]=pt.xs0+val+pt.xs1+pt.xn1+pt.xs2}else if(i===3){pt.t[pt.p]=pt.xs0+val+pt.xs1+pt.xn1+pt.xs2+pt.xn2+pt.xs3}else if(i===4){pt.t[pt.p]=pt.xs0+val+pt.xs1+pt.xn1+pt.xs2+pt.xn2+pt.xs3+pt.xn3+pt.xs4}else if(i===5){pt.t[pt.p]=pt.xs0+val+pt.xs1+pt.xn1+pt.xs2+pt.xn2+pt.xs3+pt.xn3+pt.xs4+pt.xn4+pt.xs5}else{str=pt.xs0+val+pt.xs1;for(i=1;i<pt.l;i++){str+=pt["xn"+i]+pt["xs"+(i+1)]}pt.t[pt.p]=str}}else if(pt.type===-1){pt.t[pt.p]=pt.xs0}else if(pt.setRatio){pt.setRatio(v)}pt=pt._next}}else{while(pt){if(pt.type!==2){pt.t[pt.p]=pt.b}else{pt.setRatio(v)}pt=pt._next}}};p._enableTransforms=function(threeD){this._transform=this._transform||_getTransform(this._target,_cs,true);this._transformType=!(this._transform.svg&&_forceSVGTransformToAttr)&&(threeD||this._transformType===3)?3:2};var lazySet=function(v){this.t[this.p]=this.e;this.data._linkCSSP(this,this._next,null,true)};p._addLazySet=function(t,p,v){var pt=this._firstPT=new CSSPropTween(t,p,0,0,this._firstPT,2);pt.e=v;pt.setRatio=lazySet;pt.data=this};p._linkCSSP=function(pt,next,prev,remove){if(pt){if(next){next._prev=pt}if(pt._next){pt._next._prev=pt._prev}if(pt._prev){pt._prev._next=pt._next}else if(this._firstPT===pt){this._firstPT=pt._next;remove=true}if(prev){prev._next=pt}else if(!remove&&this._firstPT===null){this._firstPT=pt}pt._next=next;pt._prev=prev}return pt};p._kill=function(lookup){var copy=lookup,pt,p,xfirst;if(lookup.autoAlpha||lookup.alpha){copy={};for(p in lookup){copy[p]=lookup[p]}copy.opacity=1;if(copy.autoAlpha){copy.visibility=1}}if(lookup.className&&(pt=this._classNamePT)){xfirst=pt.xfirst;if(xfirst&&xfirst._prev){this._linkCSSP(xfirst._prev,pt._next,xfirst._prev._prev)}else if(xfirst===this._firstPT){this._firstPT=pt._next}if(pt._next){this._linkCSSP(pt._next,pt._next._next,xfirst._prev)}this._classNamePT=null}return TweenPlugin.prototype._kill.call(this,copy)};var _getChildStyles=function(e,props,targets){var children,i,child,type;if(e.slice){i=e.length;while(--i>-1){_getChildStyles(e[i],props,targets)}return}children=e.childNodes;i=children.length;while(--i>-1){child=children[i];type=child.type;if(child.style){props.push(_getAllStyles(child));if(targets){targets.push(child)}}if((type===1||type===9||type===11)&&child.childNodes.length){_getChildStyles(child,props,targets)}}};CSSPlugin.cascadeTo=function(target,duration,vars){var tween=TweenLite.to(target,duration,vars),results=[tween],b=[],e=[],targets=[],_reservedProps=TweenLite._internals.reservedProps,i,difs,p;target=tween._targets||tween.target;_getChildStyles(target,b,targets);tween.render(duration,true);_getChildStyles(target,e);tween.render(0,true);tween._enabled(true);i=targets.length;while(--i>-1){difs=_cssDif(targets[i],b[i],e[i]);if(difs.firstMPT){difs=difs.difs;for(p in vars){if(_reservedProps[p]){difs[p]=vars[p]
}}results.push(TweenLite.to(targets[i],duration,difs))}}return results};TweenPlugin.activate([CSSPlugin]);return CSSPlugin},true);(function(){var RoundPropsPlugin=_gsScope._gsDefine.plugin({propName:"roundProps",priority:-1,API:2,init:function(target,value,tween){this._tween=tween;return true}}),p=RoundPropsPlugin.prototype;p._onInitAllProps=function(){var tween=this._tween,rp=tween.vars.roundProps instanceof Array?tween.vars.roundProps:tween.vars.roundProps.split(","),i=rp.length,lookup={},rpt=tween._propLookup.roundProps,prop,pt,next;while(--i>-1){lookup[rp[i]]=1}i=rp.length;while(--i>-1){prop=rp[i];pt=tween._firstPT;while(pt){next=pt._next;if(pt.pg){pt.t._roundProps(lookup,true)}else if(pt.n===prop){this._add(pt.t,prop,pt.s,pt.c);if(next){next._prev=pt._prev}if(pt._prev){pt._prev._next=next}else if(tween._firstPT===pt){tween._firstPT=next}pt._next=pt._prev=null;tween._propLookup[prop]=rpt}pt=next}}return false};p._add=function(target,p,s,c){this._addTween(target,p,s,s+c,p,true);this._overwriteProps.push(p)}})();_gsScope._gsDefine.plugin({propName:"attr",API:2,version:"0.3.3",init:function(target,value,tween){var p,start,end;if(typeof target.setAttribute!=="function"){return false}this._target=target;this._proxy={};this._start={};this._end={};for(p in value){this._start[p]=this._proxy[p]=start=target.getAttribute(p);end=this._addTween(this._proxy,p,parseFloat(start),value[p],p);this._end[p]=end?end.s+end.c:value[p];this._overwriteProps.push(p)}return true},set:function(ratio){this._super.setRatio.call(this,ratio);var props=this._overwriteProps,i=props.length,lookup=ratio===1?this._end:ratio?this._proxy:this._start,p;while(--i>-1){p=props[i];this._target.setAttribute(p,lookup[p]+"")}}});_gsScope._gsDefine.plugin({propName:"directionalRotation",version:"0.2.1",API:2,init:function(target,value,tween){if(typeof value!=="object"){value={rotation:value}}this.finals={};var cap=value.useRadians===true?Math.PI*2:360,min=1e-6,p,v,start,end,dif,split;for(p in value){if(p!=="useRadians"){split=(value[p]+"").split("_");v=split[0];start=parseFloat(typeof target[p]!=="function"?target[p]:target[p.indexOf("set")||typeof target["get"+p.substr(3)]!=="function"?p:"get"+p.substr(3)]());end=this.finals[p]=typeof v==="string"&&v.charAt(1)==="="?start+parseInt(v.charAt(0)+"1",10)*Number(v.substr(2)):Number(v)||0;dif=end-start;if(split.length){v=split.join("_");if(v.indexOf("short")!==-1){dif=dif%cap;if(dif!==dif%(cap/2)){dif=dif<0?dif+cap:dif-cap}}if(v.indexOf("_cw")!==-1&&dif<0){dif=(dif+cap*9999999999)%cap-(dif/cap|0)*cap}else if(v.indexOf("ccw")!==-1&&dif>0){dif=(dif-cap*9999999999)%cap-(dif/cap|0)*cap}}if(dif>min||dif<-min){this._addTween(target,p,start,start+dif,p);this._overwriteProps.push(p)}}}return true},set:function(ratio){var pt;if(ratio!==1){this._super.setRatio.call(this,ratio)}else{pt=this._firstPT;while(pt){if(pt.f){pt.t[pt.p](this.finals[pt.p])}else{pt.t[pt.p]=this.finals[pt.p]}pt=pt._next}}}})._autoCSS=true;_gsScope._gsDefine("easing.Back",["easing.Ease"],function(Ease){var w=_gsScope.GreenSockGlobals||_gsScope,gs=w.com.greensock,_2PI=Math.PI*2,_HALF_PI=Math.PI/2,_class=gs._class,_create=function(n,f){var C=_class("easing."+n,function(){},true),p=C.prototype=new Ease;p.constructor=C;p.getRatio=f;return C},_easeReg=Ease.register||function(){},_wrap=function(name,EaseOut,EaseIn,EaseInOut,aliases){var C=_class("easing."+name,{easeOut:new EaseOut,easeIn:new EaseIn,easeInOut:new EaseInOut},true);_easeReg(C,name);return C},EasePoint=function(time,value,next){this.t=time;this.v=value;if(next){this.next=next;next.prev=this;this.c=next.v-value;this.gap=next.t-time}},_createBack=function(n,f){var C=_class("easing."+n,function(overshoot){this._p1=overshoot||overshoot===0?overshoot:1.70158;this._p2=this._p1*1.525},true),p=C.prototype=new Ease;p.constructor=C;p.getRatio=f;p.config=function(overshoot){return new C(overshoot)};return C},Back=_wrap("Back",_createBack("BackOut",function(p){return(p=p-1)*p*((this._p1+1)*p+this._p1)+1}),_createBack("BackIn",function(p){return p*p*((this._p1+1)*p-this._p1)}),_createBack("BackInOut",function(p){return(p*=2)<1?.5*p*p*((this._p2+1)*p-this._p2):.5*((p-=2)*p*((this._p2+1)*p+this._p2)+2)})),SlowMo=_class("easing.SlowMo",function(linearRatio,power,yoyoMode){power=power||power===0?power:.7;if(linearRatio==null){linearRatio=.7}else if(linearRatio>1){linearRatio=1}this._p=linearRatio!==1?power:0;this._p1=(1-linearRatio)/2;this._p2=linearRatio;this._p3=this._p1+this._p2;this._calcEnd=yoyoMode===true},true),p=SlowMo.prototype=new Ease,SteppedEase,RoughEase,_createElastic;p.constructor=SlowMo;p.getRatio=function(p){var r=p+(.5-p)*this._p;if(p<this._p1){return this._calcEnd?1-(p=1-p/this._p1)*p:r-(p=1-p/this._p1)*p*p*p*r}else if(p>this._p3){return this._calcEnd?1-(p=(p-this._p3)/this._p1)*p:r+(p-r)*(p=(p-this._p3)/this._p1)*p*p*p}return this._calcEnd?1:r};SlowMo.ease=new SlowMo(.7,.7);p.config=SlowMo.config=function(linearRatio,power,yoyoMode){return new SlowMo(linearRatio,power,yoyoMode)};SteppedEase=_class("easing.SteppedEase",function(steps){steps=steps||1;this._p1=1/steps;this._p2=steps+1},true);p=SteppedEase.prototype=new Ease;p.constructor=SteppedEase;p.getRatio=function(p){if(p<0){p=0}else if(p>=1){p=.999999999}return(this._p2*p>>0)*this._p1};p.config=SteppedEase.config=function(steps){return new SteppedEase(steps)};RoughEase=_class("easing.RoughEase",function(vars){vars=vars||{};var taper=vars.taper||"none",a=[],cnt=0,points=(vars.points||20)|0,i=points,randomize=vars.randomize!==false,clamp=vars.clamp===true,template=vars.template instanceof Ease?vars.template:null,strength=typeof vars.strength==="number"?vars.strength*.4:.4,x,y,bump,invX,obj,pnt;while(--i>-1){x=randomize?Math.random():1/points*i;y=template?template.getRatio(x):x;if(taper==="none"){bump=strength}else if(taper==="out"){invX=1-x;bump=invX*invX*strength}else if(taper==="in"){bump=x*x*strength}else if(x<.5){invX=x*2;bump=invX*invX*.5*strength}else{invX=(1-x)*2;bump=invX*invX*.5*strength}if(randomize){y+=Math.random()*bump-bump*.5}else if(i%2){y+=bump*.5}else{y-=bump*.5}if(clamp){if(y>1){y=1}else if(y<0){y=0}}a[cnt++]={x:x,y:y}}a.sort(function(a,b){return a.x-b.x});pnt=new EasePoint(1,1,null);i=points;while(--i>-1){obj=a[i];pnt=new EasePoint(obj.x,obj.y,pnt)}this._prev=new EasePoint(0,0,pnt.t!==0?pnt:pnt.next)},true);p=RoughEase.prototype=new Ease;p.constructor=RoughEase;p.getRatio=function(p){var pnt=this._prev;if(p>pnt.t){while(pnt.next&&p>=pnt.t){pnt=pnt.next}pnt=pnt.prev}else{while(pnt.prev&&p<=pnt.t){pnt=pnt.prev}}this._prev=pnt;return pnt.v+(p-pnt.t)/pnt.gap*pnt.c};p.config=function(vars){return new RoughEase(vars)};RoughEase.ease=new RoughEase;_wrap("Bounce",_create("BounceOut",function(p){if(p<1/2.75){return 7.5625*p*p}else if(p<2/2.75){return 7.5625*(p-=1.5/2.75)*p+.75}else if(p<2.5/2.75){return 7.5625*(p-=2.25/2.75)*p+.9375}return 7.5625*(p-=2.625/2.75)*p+.984375}),_create("BounceIn",function(p){if((p=1-p)<1/2.75){return 1-7.5625*p*p}else if(p<2/2.75){return 1-(7.5625*(p-=1.5/2.75)*p+.75)}else if(p<2.5/2.75){return 1-(7.5625*(p-=2.25/2.75)*p+.9375)}return 1-(7.5625*(p-=2.625/2.75)*p+.984375)}),_create("BounceInOut",function(p){var invert=p<.5;if(invert){p=1-p*2}else{p=p*2-1}if(p<1/2.75){p=7.5625*p*p}else if(p<2/2.75){p=7.5625*(p-=1.5/2.75)*p+.75}else if(p<2.5/2.75){p=7.5625*(p-=2.25/2.75)*p+.9375}else{p=7.5625*(p-=2.625/2.75)*p+.984375}return invert?(1-p)*.5:p*.5+.5}));_wrap("Circ",_create("CircOut",function(p){return Math.sqrt(1-(p=p-1)*p)}),_create("CircIn",function(p){return-(Math.sqrt(1-p*p)-1)}),_create("CircInOut",function(p){return(p*=2)<1?-.5*(Math.sqrt(1-p*p)-1):.5*(Math.sqrt(1-(p-=2)*p)+1)}));_createElastic=function(n,f,def){var C=_class("easing."+n,function(amplitude,period){this._p1=amplitude||1;this._p2=period||def;this._p3=this._p2/_2PI*(Math.asin(1/this._p1)||0)},true),p=C.prototype=new Ease;p.constructor=C;p.getRatio=f;p.config=function(amplitude,period){return new C(amplitude,period)};return C};_wrap("Elastic",_createElastic("ElasticOut",function(p){return this._p1*Math.pow(2,-10*p)*Math.sin((p-this._p3)*_2PI/this._p2)+1},.3),_createElastic("ElasticIn",function(p){return-(this._p1*Math.pow(2,10*(p-=1))*Math.sin((p-this._p3)*_2PI/this._p2))},.3),_createElastic("ElasticInOut",function(p){return(p*=2)<1?-.5*(this._p1*Math.pow(2,10*(p-=1))*Math.sin((p-this._p3)*_2PI/this._p2)):this._p1*Math.pow(2,-10*(p-=1))*Math.sin((p-this._p3)*_2PI/this._p2)*.5+1},.45));_wrap("Expo",_create("ExpoOut",function(p){return 1-Math.pow(2,-10*p)}),_create("ExpoIn",function(p){return Math.pow(2,10*(p-1))-.001}),_create("ExpoInOut",function(p){return(p*=2)<1?.5*Math.pow(2,10*(p-1)):.5*(2-Math.pow(2,-10*(p-1)))}));_wrap("Sine",_create("SineOut",function(p){return Math.sin(p*_HALF_PI)}),_create("SineIn",function(p){return-Math.cos(p*_HALF_PI)+1}),_create("SineInOut",function(p){return-.5*(Math.cos(Math.PI*p)-1)}));_class("easing.EaseLookup",{find:function(s){return Ease.map[s]}},true);_easeReg(w.SlowMo,"SlowMo","ease,");_easeReg(RoughEase,"RoughEase","ease,");_easeReg(SteppedEase,"SteppedEase","ease,");return Back},true)});if(_gsScope._gsDefine){_gsScope._gsQueue.pop()()}(function(window,moduleName){"use strict";var _globals=window.GreenSockGlobals=window.GreenSockGlobals||window;if(_globals.TweenLite){return}var _namespace=function(ns){var a=ns.split("."),p=_globals,i;for(i=0;i<a.length;i++){p[a[i]]=p=p[a[i]]||{}}return p},gs=_namespace("com.greensock"),_tinyNum=1e-10,_slice=function(a){var b=[],l=a.length,i;for(i=0;i!==l;b.push(a[i++]));return b},_emptyFunc=function(){},_isArray=function(){var toString=Object.prototype.toString,array=toString.call([]);return function(obj){return obj!=null&&(obj instanceof Array||typeof obj==="object"&&!!obj.push&&toString.call(obj)===array)}}(),a,i,p,_ticker,_tickerActive,_defLookup={},Definition=function(ns,dependencies,func,global){this.sc=_defLookup[ns]?_defLookup[ns].sc:[];_defLookup[ns]=this;this.gsClass=null;this.func=func;var _classes=[];this.check=function(init){var i=dependencies.length,missing=i,cur,a,n,cl;while(--i>-1){if((cur=_defLookup[dependencies[i]]||new Definition(dependencies[i],[])).gsClass){_classes[i]=cur.gsClass;missing--}else if(init){cur.sc.push(this)}}if(missing===0&&func){a=("com.greensock."+ns).split(".");n=a.pop();cl=_namespace(a.join("."))[n]=this.gsClass=func.apply(func,_classes);if(global){_globals[n]=cl;if(typeof define==="function"&&define.amd){define((window.GreenSockAMDPath?window.GreenSockAMDPath+"/":"")+ns.split(".").pop(),[],function(){return cl})}else if(ns===moduleName&&typeof module!=="undefined"&&module.exports){module.exports=cl}}for(i=0;i<this.sc.length;i++){this.sc[i].check()}}};this.check(true)},_gsDefine=window._gsDefine=function(ns,dependencies,func,global){return new Definition(ns,dependencies,func,global)},_class=gs._class=function(ns,func,global){func=func||function(){};_gsDefine(ns,[],function(){return func},global);return func};_gsDefine.globals=_globals;var _baseParams=[0,0,1,1],_blankArray=[],Ease=_class("easing.Ease",function(func,extraParams,type,power){this._func=func;this._type=type||0;this._power=power||0;this._params=extraParams?_baseParams.concat(extraParams):_baseParams},true),_easeMap=Ease.map={},_easeReg=Ease.register=function(ease,names,types,create){var na=names.split(","),i=na.length,ta=(types||"easeIn,easeOut,easeInOut").split(","),e,name,j,type;while(--i>-1){name=na[i];e=create?_class("easing."+name,null,true):gs.easing[name]||{};j=ta.length;while(--j>-1){type=ta[j];_easeMap[name+"."+type]=_easeMap[type+name]=e[type]=ease.getRatio?ease:ease[type]||new ease}}};p=Ease.prototype;p._calcEnd=false;p.getRatio=function(p){if(this._func){this._params[0]=p;return this._func.apply(null,this._params)}var t=this._type,pw=this._power,r=t===1?1-p:t===2?p:p<.5?p*2:(1-p)*2;if(pw===1){r*=r}else if(pw===2){r*=r*r}else if(pw===3){r*=r*r*r}else if(pw===4){r*=r*r*r*r}return t===1?1-r:t===2?r:p<.5?r/2:1-r/2};a=["Linear","Quad","Cubic","Quart","Quint,Strong"];i=a.length;while(--i>-1){p=a[i]+",Power"+i;_easeReg(new Ease(null,null,1,i),p,"easeOut",true);_easeReg(new Ease(null,null,2,i),p,"easeIn"+(i===0?",easeNone":""));_easeReg(new Ease(null,null,3,i),p,"easeInOut")}_easeMap.linear=gs.easing.Linear.easeIn;_easeMap.swing=gs.easing.Quad.easeInOut;var EventDispatcher=_class("events.EventDispatcher",function(target){this._listeners={};this._eventTarget=target||this});p=EventDispatcher.prototype;p.addEventListener=function(type,callback,scope,useParam,priority){priority=priority||0;var list=this._listeners[type],index=0,listener,i;if(list==null){this._listeners[type]=list=[]}i=list.length;while(--i>-1){listener=list[i];if(listener.c===callback&&listener.s===scope){list.splice(i,1)}else if(index===0&&listener.pr<priority){index=i+1}}list.splice(index,0,{c:callback,s:scope,up:useParam,pr:priority});if(this===_ticker&&!_tickerActive){_ticker.wake()}};p.removeEventListener=function(type,callback){var list=this._listeners[type],i;if(list){i=list.length;while(--i>-1){if(list[i].c===callback){list.splice(i,1);return}}}};p.dispatchEvent=function(type){var list=this._listeners[type],i,t,listener;if(list){i=list.length;t=this._eventTarget;while(--i>-1){listener=list[i];if(listener){if(listener.up){listener.c.call(listener.s||t,{type:type,target:t})}else{listener.c.call(listener.s||t)}}}}};var _reqAnimFrame=window.requestAnimationFrame,_cancelAnimFrame=window.cancelAnimationFrame,_getTime=Date.now||function(){return(new Date).getTime()},_lastUpdate=_getTime();a=["ms","moz","webkit","o"];i=a.length;while(--i>-1&&!_reqAnimFrame){_reqAnimFrame=window[a[i]+"RequestAnimationFrame"];_cancelAnimFrame=window[a[i]+"CancelAnimationFrame"]||window[a[i]+"CancelRequestAnimationFrame"]}_class("Ticker",function(fps,useRAF){var _self=this,_startTime=_getTime(),_useRAF=useRAF!==false&&_reqAnimFrame,_lagThreshold=500,_adjustedLag=33,_fps,_req,_id,_gap,_nextTime,_tick=function(manual){var elapsed=_getTime()-_lastUpdate,overlap,dispatch;if(elapsed>_lagThreshold){_startTime+=elapsed-_adjustedLag}_lastUpdate+=elapsed;_self.time=(_lastUpdate-_startTime)/1e3;overlap=_self.time-_nextTime;if(!_fps||overlap>0||manual===true){_self.frame++;_nextTime+=overlap+(overlap>=_gap?.004:_gap-overlap);dispatch=true}if(manual!==true){_id=_req(_tick)}if(dispatch){_self.dispatchEvent("tick")}};EventDispatcher.call(_self);_self.time=_self.frame=0;_self.tick=function(){_tick(true)};_self.lagSmoothing=function(threshold,adjustedLag){_lagThreshold=threshold||1/_tinyNum;_adjustedLag=Math.min(adjustedLag,_lagThreshold,0)};_self.sleep=function(){if(_id==null){return}if(!_useRAF||!_cancelAnimFrame){clearTimeout(_id)}else{_cancelAnimFrame(_id)}_req=_emptyFunc;_id=null;if(_self===_ticker){_tickerActive=false}};_self.wake=function(){if(_id!==null){_self.sleep()}else if(_self.frame>10){_lastUpdate=_getTime()-_lagThreshold+5}_req=_fps===0?_emptyFunc:!_useRAF||!_reqAnimFrame?function(f){return setTimeout(f,(_nextTime-_self.time)*1e3+1|0)}:_reqAnimFrame;if(_self===_ticker){_tickerActive=true}_tick(2)};_self.fps=function(value){if(!arguments.length){return _fps}_fps=value;_gap=1/(_fps||60);_nextTime=this.time+_gap;_self.wake()};_self.useRAF=function(value){if(!arguments.length){return _useRAF}_self.sleep();_useRAF=value;_self.fps(_fps)};_self.fps(fps);setTimeout(function(){if(_useRAF&&(!_id||_self.frame<5)){_self.useRAF(false)}},1500)});p=gs.Ticker.prototype=new gs.events.EventDispatcher;p.constructor=gs.Ticker;var Animation=_class("core.Animation",function(duration,vars){this.vars=vars=vars||{};this._duration=this._totalDuration=duration||0;this._delay=Number(vars.delay)||0;this._timeScale=1;this._active=vars.immediateRender===true;this.data=vars.data;this._reversed=vars.reversed===true;if(!_rootTimeline){return}if(!_tickerActive){_ticker.wake()}var tl=this.vars.useFrames?_rootFramesTimeline:_rootTimeline;tl.add(this,tl._time);if(this.vars.paused){this.paused(true)}});_ticker=Animation.ticker=new gs.Ticker;p=Animation.prototype;p._dirty=p._gc=p._initted=p._paused=false;p._totalTime=p._time=0;p._rawPrevTime=-1;p._next=p._last=p._onUpdate=p._timeline=p.timeline=null;p._paused=false;var _checkTimeout=function(){if(_tickerActive&&_getTime()-_lastUpdate>2e3){_ticker.wake()}setTimeout(_checkTimeout,2e3)};_checkTimeout();p.play=function(from,suppressEvents){if(from!=null){this.seek(from,suppressEvents)}return this.reversed(false).paused(false)};p.pause=function(atTime,suppressEvents){if(atTime!=null){this.seek(atTime,suppressEvents)}return this.paused(true)};p.resume=function(from,suppressEvents){if(from!=null){this.seek(from,suppressEvents)}return this.paused(false)};p.seek=function(time,suppressEvents){return this.totalTime(Number(time),suppressEvents!==false)};p.restart=function(includeDelay,suppressEvents){return this.reversed(false).paused(false).totalTime(includeDelay?-this._delay:0,suppressEvents!==false,true)};p.reverse=function(from,suppressEvents){if(from!=null){this.seek(from||this.totalDuration(),suppressEvents)}return this.reversed(true).paused(false)};p.render=function(time,suppressEvents,force){};p.invalidate=function(){this._time=this._totalTime=0;this._initted=this._gc=false;this._rawPrevTime=-1;if(this._gc||!this.timeline){this._enabled(true)}return this};p.isActive=function(){var tl=this._timeline,startTime=this._startTime,rawTime;return!tl||!this._gc&&!this._paused&&tl.isActive()&&(rawTime=tl.rawTime())>=startTime&&rawTime<startTime+this.totalDuration()/this._timeScale};p._enabled=function(enabled,ignoreTimeline){if(!_tickerActive){_ticker.wake()}this._gc=!enabled;this._active=this.isActive();if(ignoreTimeline!==true){if(enabled&&!this.timeline){this._timeline.add(this,this._startTime-this._delay)}else if(!enabled&&this.timeline){this._timeline._remove(this,true)}}return false};p._kill=function(vars,target){return this._enabled(false,false)};p.kill=function(vars,target){this._kill(vars,target);return this};p._uncache=function(includeSelf){var tween=includeSelf?this:this.timeline;while(tween){tween._dirty=true;tween=tween.timeline}return this};p._swapSelfInParams=function(params){var i=params.length,copy=params.concat();while(--i>-1){if(params[i]==="{self}"){copy[i]=this}}return copy};p.eventCallback=function(type,callback,params,scope){if((type||"").substr(0,2)==="on"){var v=this.vars;if(arguments.length===1){return v[type]}if(callback==null){delete v[type]}else{v[type]=callback;v[type+"Params"]=_isArray(params)&&params.join("").indexOf("{self}")!==-1?this._swapSelfInParams(params):params;v[type+"Scope"]=scope}if(type==="onUpdate"){this._onUpdate=callback}}return this};p.delay=function(value){if(!arguments.length){return this._delay}if(this._timeline.smoothChildTiming){this.startTime(this._startTime+value-this._delay)}this._delay=value;return this};p.duration=function(value){if(!arguments.length){this._dirty=false;return this._duration}this._duration=this._totalDuration=value;this._uncache(true);if(this._timeline.smoothChildTiming)if(this._time>0)if(this._time<this._duration)if(value!==0){this.totalTime(this._totalTime*(value/this._duration),true)}return this};p.totalDuration=function(value){this._dirty=false;return!arguments.length?this._totalDuration:this.duration(value)};p.time=function(value,suppressEvents){if(!arguments.length){return this._time}if(this._dirty){this.totalDuration()}return this.totalTime(value>this._duration?this._duration:value,suppressEvents)};p.totalTime=function(time,suppressEvents,uncapped){if(!_tickerActive){_ticker.wake()}if(!arguments.length){return this._totalTime}if(this._timeline){if(time<0&&!uncapped){time+=this.totalDuration()}if(this._timeline.smoothChildTiming){if(this._dirty){this.totalDuration()}var totalDuration=this._totalDuration,tl=this._timeline;if(time>totalDuration&&!uncapped){time=totalDuration}this._startTime=(this._paused?this._pauseTime:tl._time)-(!this._reversed?time:totalDuration-time)/this._timeScale;if(!tl._dirty){this._uncache(false)}if(tl._timeline){while(tl._timeline){if(tl._timeline._time!==(tl._startTime+tl._totalTime)/tl._timeScale){tl.totalTime(tl._totalTime,true)}tl=tl._timeline}}}if(this._gc){this._enabled(true,false)}if(this._totalTime!==time||this._duration===0){this.render(time,suppressEvents,false);if(_lazyTweens.length){_lazyRender()}}}return this};p.progress=p.totalProgress=function(value,suppressEvents){return!arguments.length?this._time/this.duration():this.totalTime(this.duration()*value,suppressEvents)};p.startTime=function(value){if(!arguments.length){return this._startTime}if(value!==this._startTime){this._startTime=value;if(this.timeline)if(this.timeline._sortChildren){this.timeline.add(this,value-this._delay)}}return this};p.endTime=function(includeRepeats){return this._startTime+(includeRepeats!=false?this.totalDuration():this.duration())/this._timeScale};p.timeScale=function(value){if(!arguments.length){return this._timeScale}value=value||_tinyNum;if(this._timeline&&this._timeline.smoothChildTiming){var pauseTime=this._pauseTime,t=pauseTime||pauseTime===0?pauseTime:this._timeline.totalTime();this._startTime=t-(t-this._startTime)*this._timeScale/value}this._timeScale=value;return this._uncache(false)};p.reversed=function(value){if(!arguments.length){return this._reversed}if(value!=this._reversed){this._reversed=value;this.totalTime(this._timeline&&!this._timeline.smoothChildTiming?this.totalDuration()-this._totalTime:this._totalTime,true)}return this};p.paused=function(value){if(!arguments.length){return this._paused}if(value!=this._paused)if(this._timeline){if(!_tickerActive&&!value){_ticker.wake()}var tl=this._timeline,raw=tl.rawTime(),elapsed=raw-this._pauseTime;if(!value&&tl.smoothChildTiming){this._startTime+=elapsed;this._uncache(false)}this._pauseTime=value?raw:null;this._paused=value;this._active=this.isActive();if(!value&&elapsed!==0&&this._initted&&this.duration()){this.render(tl.smoothChildTiming?this._totalTime:(raw-this._startTime)/this._timeScale,true,true)}}if(this._gc&&!value){this._enabled(true,false)}return this};var SimpleTimeline=_class("core.SimpleTimeline",function(vars){Animation.call(this,0,vars);this.autoRemoveChildren=this.smoothChildTiming=true});p=SimpleTimeline.prototype=new Animation;p.constructor=SimpleTimeline;p.kill()._gc=false;p._first=p._last=p._recent=null;p._sortChildren=false;p.add=p.insert=function(child,position,align,stagger){var prevTween,st;child._startTime=Number(position||0)+child._delay;if(child._paused)if(this!==child._timeline){child._pauseTime=child._startTime+(this.rawTime()-child._startTime)/child._timeScale}if(child.timeline){child.timeline._remove(child,true)}child.timeline=child._timeline=this;if(child._gc){child._enabled(true,true)}prevTween=this._last;if(this._sortChildren){st=child._startTime;while(prevTween&&prevTween._startTime>st){prevTween=prevTween._prev}}if(prevTween){child._next=prevTween._next;prevTween._next=child}else{child._next=this._first;this._first=child}if(child._next){child._next._prev=child}else{this._last=child}child._prev=prevTween;this._recent=child;if(this._timeline){this._uncache(true)}return this};p._remove=function(tween,skipDisable){if(tween.timeline===this){if(!skipDisable){tween._enabled(false,true)}if(tween._prev){tween._prev._next=tween._next}else if(this._first===tween){this._first=tween._next}if(tween._next){tween._next._prev=tween._prev}else if(this._last===tween){this._last=tween._prev}tween._next=tween._prev=tween.timeline=null;if(tween===this._recent){this._recent=this._last}if(this._timeline){this._uncache(true)}}return this};p.render=function(time,suppressEvents,force){var tween=this._first,next;this._totalTime=this._time=this._rawPrevTime=time;while(tween){next=tween._next;if(tween._active||time>=tween._startTime&&!tween._paused){if(!tween._reversed){tween.render((time-tween._startTime)*tween._timeScale,suppressEvents,force)}else{tween.render((!tween._dirty?tween._totalDuration:tween.totalDuration())-(time-tween._startTime)*tween._timeScale,suppressEvents,force)}}tween=next}};p.rawTime=function(){if(!_tickerActive){_ticker.wake()}return this._totalTime};var TweenLite=_class("TweenLite",function(target,duration,vars){Animation.call(this,duration,vars);this.render=TweenLite.prototype.render;if(target==null){throw"Cannot tween a null target."}this.target=target=typeof target!=="string"?target:TweenLite.selector(target)||target;var isSelector=target.jquery||target.length&&target!==window&&target[0]&&(target[0]===window||target[0].nodeType&&target[0].style&&!target.nodeType),overwrite=this.vars.overwrite,i,targ,targets;this._overwrite=overwrite=overwrite==null?_overwriteLookup[TweenLite.defaultOverwrite]:typeof overwrite==="number"?overwrite>>0:_overwriteLookup[overwrite];if((isSelector||target instanceof Array||target.push&&_isArray(target))&&typeof target[0]!=="number"){this._targets=targets=_slice(target);this._propLookup=[];this._siblings=[];for(i=0;i<targets.length;i++){targ=targets[i];if(!targ){targets.splice(i--,1);continue}else if(typeof targ==="string"){targ=targets[i--]=TweenLite.selector(targ);if(typeof targ==="string"){targets.splice(i+1,1)}continue}else if(targ.length&&targ!==window&&targ[0]&&(targ[0]===window||targ[0].nodeType&&targ[0].style&&!targ.nodeType)){targets.splice(i--,1);this._targets=targets=targets.concat(_slice(targ));continue}this._siblings[i]=_register(targ,this,false);if(overwrite===1)if(this._siblings[i].length>1){_applyOverwrite(targ,this,null,1,this._siblings[i])}}}else{this._propLookup={};this._siblings=_register(target,this,false);if(overwrite===1)if(this._siblings.length>1){_applyOverwrite(target,this,null,1,this._siblings)}}if(this.vars.immediateRender||duration===0&&this._delay===0&&this.vars.immediateRender!==false){this._time=-_tinyNum;this.render(-this._delay)}},true),_isSelector=function(v){return v&&v.length&&v!==window&&v[0]&&(v[0]===window||v[0].nodeType&&v[0].style&&!v.nodeType)},_autoCSS=function(vars,target){var css={},p;for(p in vars){if(!_reservedProps[p]&&(!(p in target)||p==="transform"||p==="x"||p==="y"||p==="width"||p==="height"||p==="className"||p==="border")&&(!_plugins[p]||_plugins[p]&&_plugins[p]._autoCSS)){css[p]=vars[p];delete vars[p]}}vars.css=css};p=TweenLite.prototype=new Animation;p.constructor=TweenLite;p.kill()._gc=false;p.ratio=0;p._firstPT=p._targets=p._overwrittenProps=p._startAt=null;p._notifyPluginsOfEnabled=p._lazy=false;TweenLite.version="1.14.1";TweenLite.defaultEase=p._ease=new Ease(null,null,1,1);TweenLite.defaultOverwrite="auto";TweenLite.ticker=_ticker;TweenLite.autoSleep=true;TweenLite.lagSmoothing=function(threshold,adjustedLag){_ticker.lagSmoothing(threshold,adjustedLag)};TweenLite.selector=window.$||window.jQuery||function(e){var selector=window.$||window.jQuery;if(selector){TweenLite.selector=selector;return selector(e)}return typeof document==="undefined"?e:document.querySelectorAll?document.querySelectorAll(e):document.getElementById(e.charAt(0)==="#"?e.substr(1):e)};var _lazyTweens=[],_lazyLookup={},_internals=TweenLite._internals={isArray:_isArray,isSelector:_isSelector,lazyTweens:_lazyTweens},_plugins=TweenLite._plugins={},_tweenLookup=_internals.tweenLookup={},_tweenLookupNum=0,_reservedProps=_internals.reservedProps={ease:1,delay:1,overwrite:1,onComplete:1,onCompleteParams:1,onCompleteScope:1,useFrames:1,runBackwards:1,startAt:1,onUpdate:1,onUpdateParams:1,onUpdateScope:1,onStart:1,onStartParams:1,onStartScope:1,onReverseComplete:1,onReverseCompleteParams:1,onReverseCompleteScope:1,onRepeat:1,onRepeatParams:1,onRepeatScope:1,easeParams:1,yoyo:1,immediateRender:1,repeat:1,repeatDelay:1,data:1,paused:1,reversed:1,autoCSS:1,lazy:1,onOverwrite:1},_overwriteLookup={none:0,all:1,auto:2,concurrent:3,allOnStart:4,preexisting:5,"true":1,"false":0},_rootFramesTimeline=Animation._rootFramesTimeline=new SimpleTimeline,_rootTimeline=Animation._rootTimeline=new SimpleTimeline,_lazyRender=_internals.lazyRender=function(){var i=_lazyTweens.length,tween;_lazyLookup={};while(--i>-1){tween=_lazyTweens[i];if(tween&&tween._lazy!==false){tween.render(tween._lazy[0],tween._lazy[1],true);tween._lazy=false}}_lazyTweens.length=0};_rootTimeline._startTime=_ticker.time;_rootFramesTimeline._startTime=_ticker.frame;_rootTimeline._active=_rootFramesTimeline._active=true;setTimeout(_lazyRender,1);Animation._updateRoot=TweenLite.render=function(){var i,a,p;if(_lazyTweens.length){_lazyRender()}_rootTimeline.render((_ticker.time-_rootTimeline._startTime)*_rootTimeline._timeScale,false,false);_rootFramesTimeline.render((_ticker.frame-_rootFramesTimeline._startTime)*_rootFramesTimeline._timeScale,false,false);if(_lazyTweens.length){_lazyRender()}if(!(_ticker.frame%120)){for(p in _tweenLookup){a=_tweenLookup[p].tweens;i=a.length;while(--i>-1){if(a[i]._gc){a.splice(i,1)}}if(a.length===0){delete _tweenLookup[p]}}p=_rootTimeline._first;if(!p||p._paused)if(TweenLite.autoSleep&&!_rootFramesTimeline._first&&_ticker._listeners.tick.length===1){while(p&&p._paused){p=p._next}if(!p){_ticker.sleep()}}}};_ticker.addEventListener("tick",Animation._updateRoot);var _register=function(target,tween,scrub){var id=target._gsTweenID,a,i;if(!_tweenLookup[id||(target._gsTweenID=id="t"+_tweenLookupNum++)]){_tweenLookup[id]={target:target,tweens:[]}}if(tween){a=_tweenLookup[id].tweens;a[i=a.length]=tween;if(scrub){while(--i>-1){if(a[i]===tween){a.splice(i,1)}}}}return _tweenLookup[id].tweens},_onOverwrite=function(overwrittenTween,overwritingTween,target,killedProps){var func=overwrittenTween.vars.onOverwrite;if(func){func(overwrittenTween,overwritingTween,target,killedProps)}func=TweenLite.onOverwrite;if(func){func(overwrittenTween,overwritingTween,target,killedProps)}},_applyOverwrite=function(target,tween,props,mode,siblings){var i,changed,curTween,l;if(mode===1||mode>=4){l=siblings.length;for(i=0;i<l;i++){if((curTween=siblings[i])!==tween){if(!curTween._gc){if(curTween._enabled(false,false)){changed=true}_onOverwrite(curTween,tween)}}else if(mode===5){break}}return changed}var startTime=tween._startTime+_tinyNum,overlaps=[],oCount=0,zeroDur=tween._duration===0,globalStart;i=siblings.length;while(--i>-1){if((curTween=siblings[i])===tween||curTween._gc||curTween._paused){}else if(curTween._timeline!==tween._timeline){globalStart=globalStart||_checkOverlap(tween,0,zeroDur);if(_checkOverlap(curTween,globalStart,zeroDur)===0){overlaps[oCount++]=curTween}}else if(curTween._startTime<=startTime)if(curTween._startTime+curTween.totalDuration()/curTween._timeScale>startTime)if(!((zeroDur||!curTween._initted)&&startTime-curTween._startTime<=2e-10)){overlaps[oCount++]=curTween}}i=oCount;while(--i>-1){curTween=overlaps[i];if(mode===2)if(curTween._kill(props,target,tween)){changed=true}if(mode!==2||!curTween._firstPT&&curTween._initted){if(curTween._enabled(false,false)){changed=true}if(mode!==2){_onOverwrite(curTween,tween)}}}return changed},_checkOverlap=function(tween,reference,zeroDur){var tl=tween._timeline,ts=tl._timeScale,t=tween._startTime;while(tl._timeline){t+=tl._startTime;ts*=tl._timeScale;if(tl._paused){return-100}tl=tl._timeline}t/=ts;return t>reference?t-reference:zeroDur&&t===reference||!tween._initted&&t-reference<2*_tinyNum?_tinyNum:(t+=tween.totalDuration()/tween._timeScale/ts)>reference+_tinyNum?0:t-reference-_tinyNum};p._init=function(){var v=this.vars,op=this._overwrittenProps,dur=this._duration,immediate=!!v.immediateRender,ease=v.ease,i,initPlugins,pt,p,startVars;if(v.startAt){if(this._startAt){this._startAt.render(-1,true);this._startAt.kill()}startVars={};for(p in v.startAt){startVars[p]=v.startAt[p]}startVars.overwrite=false;startVars.immediateRender=true;startVars.lazy=immediate&&v.lazy!==false;startVars.startAt=startVars.delay=null;this._startAt=TweenLite.to(this.target,0,startVars);if(immediate){if(this._time>0){this._startAt=null}else if(dur!==0){return}}}else if(v.runBackwards&&dur!==0){if(this._startAt){this._startAt.render(-1,true);this._startAt.kill();this._startAt=null}else{if(this._time!==0){immediate=false}pt={};for(p in v){if(!_reservedProps[p]||p==="autoCSS"){pt[p]=v[p]}}pt.overwrite=0;pt.data="isFromStart";pt.lazy=immediate&&v.lazy!==false;pt.immediateRender=immediate;
this._startAt=TweenLite.to(this.target,0,pt);if(!immediate){this._startAt._init();this._startAt._enabled(false);if(this.vars.immediateRender){this._startAt=null}}else if(this._time===0){return}}}this._ease=ease=!ease?TweenLite.defaultEase:ease instanceof Ease?ease:typeof ease==="function"?new Ease(ease,v.easeParams):_easeMap[ease]||TweenLite.defaultEase;if(v.easeParams instanceof Array&&ease.config){this._ease=ease.config.apply(ease,v.easeParams)}this._easeType=this._ease._type;this._easePower=this._ease._power;this._firstPT=null;if(this._targets){i=this._targets.length;while(--i>-1){if(this._initProps(this._targets[i],this._propLookup[i]={},this._siblings[i],op?op[i]:null)){initPlugins=true}}}else{initPlugins=this._initProps(this.target,this._propLookup,this._siblings,op)}if(initPlugins){TweenLite._onPluginEvent("_onInitAllProps",this)}if(op)if(!this._firstPT)if(typeof this.target!=="function"){this._enabled(false,false)}if(v.runBackwards){pt=this._firstPT;while(pt){pt.s+=pt.c;pt.c=-pt.c;pt=pt._next}}this._onUpdate=v.onUpdate;this._initted=true};p._initProps=function(target,propLookup,siblings,overwrittenProps){var p,i,initPlugins,plugin,pt,v;if(target==null){return false}if(_lazyLookup[target._gsTweenID]){_lazyRender()}if(!this.vars.css)if(target.style)if(target!==window&&target.nodeType)if(_plugins.css)if(this.vars.autoCSS!==false){_autoCSS(this.vars,target)}for(p in this.vars){v=this.vars[p];if(_reservedProps[p]){if(v)if(v instanceof Array||v.push&&_isArray(v))if(v.join("").indexOf("{self}")!==-1){this.vars[p]=v=this._swapSelfInParams(v,this)}}else if(_plugins[p]&&(plugin=new _plugins[p])._onInitTween(target,this.vars[p],this)){this._firstPT=pt={_next:this._firstPT,t:plugin,p:"setRatio",s:0,c:1,f:true,n:p,pg:true,pr:plugin._priority};i=plugin._overwriteProps.length;while(--i>-1){propLookup[plugin._overwriteProps[i]]=this._firstPT}if(plugin._priority||plugin._onInitAllProps){initPlugins=true}if(plugin._onDisable||plugin._onEnable){this._notifyPluginsOfEnabled=true}}else{this._firstPT=propLookup[p]=pt={_next:this._firstPT,t:target,p:p,f:typeof target[p]==="function",n:p,pg:false,pr:0};pt.s=!pt.f?parseFloat(target[p]):target[p.indexOf("set")||typeof target["get"+p.substr(3)]!=="function"?p:"get"+p.substr(3)]();pt.c=typeof v==="string"&&v.charAt(1)==="="?parseInt(v.charAt(0)+"1",10)*Number(v.substr(2)):Number(v)-pt.s||0}if(pt)if(pt._next){pt._next._prev=pt}}if(overwrittenProps)if(this._kill(overwrittenProps,target)){return this._initProps(target,propLookup,siblings,overwrittenProps)}if(this._overwrite>1)if(this._firstPT)if(siblings.length>1)if(_applyOverwrite(target,this,propLookup,this._overwrite,siblings)){this._kill(propLookup,target);return this._initProps(target,propLookup,siblings,overwrittenProps)}if(this._firstPT)if(this.vars.lazy!==false&&this._duration||this.vars.lazy&&!this._duration){_lazyLookup[target._gsTweenID]=true}return initPlugins};p.render=function(time,suppressEvents,force){var prevTime=this._time,duration=this._duration,prevRawPrevTime=this._rawPrevTime,isComplete,callback,pt,rawPrevTime;if(time>=duration){this._totalTime=this._time=duration;this.ratio=this._ease._calcEnd?this._ease.getRatio(1):1;if(!this._reversed){isComplete=true;callback="onComplete"}if(duration===0)if(this._initted||!this.vars.lazy||force){if(this._startTime===this._timeline._duration){time=0}if(time===0||prevRawPrevTime<0||prevRawPrevTime===_tinyNum)if(prevRawPrevTime!==time){force=true;if(prevRawPrevTime>_tinyNum){callback="onReverseComplete"}}this._rawPrevTime=rawPrevTime=!suppressEvents||time||prevRawPrevTime===time?time:_tinyNum}}else if(time<1e-7){this._totalTime=this._time=0;this.ratio=this._ease._calcEnd?this._ease.getRatio(0):0;if(prevTime!==0||duration===0&&prevRawPrevTime>0&&prevRawPrevTime!==_tinyNum){callback="onReverseComplete";isComplete=this._reversed}if(time<0){this._active=false;if(duration===0)if(this._initted||!this.vars.lazy||force){if(prevRawPrevTime>=0){force=true}this._rawPrevTime=rawPrevTime=!suppressEvents||time||prevRawPrevTime===time?time:_tinyNum}}if(!this._initted){force=true}}else{this._totalTime=this._time=time;if(this._easeType){var r=time/duration,type=this._easeType,pow=this._easePower;if(type===1||type===3&&r>=.5){r=1-r}if(type===3){r*=2}if(pow===1){r*=r}else if(pow===2){r*=r*r}else if(pow===3){r*=r*r*r}else if(pow===4){r*=r*r*r*r}if(type===1){this.ratio=1-r}else if(type===2){this.ratio=r}else if(time/duration<.5){this.ratio=r/2}else{this.ratio=1-r/2}}else{this.ratio=this._ease.getRatio(time/duration)}}if(this._time===prevTime&&!force){return}else if(!this._initted){this._init();if(!this._initted||this._gc){return}else if(!force&&this._firstPT&&(this.vars.lazy!==false&&this._duration||this.vars.lazy&&!this._duration)){this._time=this._totalTime=prevTime;this._rawPrevTime=prevRawPrevTime;_lazyTweens.push(this);this._lazy=[time,suppressEvents];return}if(this._time&&!isComplete){this.ratio=this._ease.getRatio(this._time/duration)}else if(isComplete&&this._ease._calcEnd){this.ratio=this._ease.getRatio(this._time===0?0:1)}}if(this._lazy!==false){this._lazy=false}if(!this._active)if(!this._paused&&this._time!==prevTime&&time>=0){this._active=true}if(prevTime===0){if(this._startAt){if(time>=0){this._startAt.render(time,suppressEvents,force)}else if(!callback){callback="_dummyGS"}}if(this.vars.onStart)if(this._time!==0||duration===0)if(!suppressEvents){this.vars.onStart.apply(this.vars.onStartScope||this,this.vars.onStartParams||_blankArray)}}pt=this._firstPT;while(pt){if(pt.f){pt.t[pt.p](pt.c*this.ratio+pt.s)}else{pt.t[pt.p]=pt.c*this.ratio+pt.s}pt=pt._next}if(this._onUpdate){if(time<0)if(this._startAt&&time!==-1e-4){this._startAt.render(time,suppressEvents,force)}if(!suppressEvents)if(this._time!==prevTime||isComplete){this._onUpdate.apply(this.vars.onUpdateScope||this,this.vars.onUpdateParams||_blankArray)}}if(callback)if(!this._gc||force){if(time<0&&this._startAt&&!this._onUpdate&&time!==-1e-4){this._startAt.render(time,suppressEvents,force)}if(isComplete){if(this._timeline.autoRemoveChildren){this._enabled(false,false)}this._active=false}if(!suppressEvents&&this.vars[callback]){this.vars[callback].apply(this.vars[callback+"Scope"]||this,this.vars[callback+"Params"]||_blankArray)}if(duration===0&&this._rawPrevTime===_tinyNum&&rawPrevTime!==_tinyNum){this._rawPrevTime=0}}};p._kill=function(vars,target,overwritingTween){if(vars==="all"){vars=null}if(vars==null)if(target==null||target===this.target){this._lazy=false;return this._enabled(false,false)}target=typeof target!=="string"?target||this._targets||this.target:TweenLite.selector(target)||target;var i,overwrittenProps,p,pt,propLookup,changed,killProps,record,killed;if((_isArray(target)||_isSelector(target))&&typeof target[0]!=="number"){i=target.length;while(--i>-1){if(this._kill(vars,target[i])){changed=true}}}else{if(this._targets){i=this._targets.length;while(--i>-1){if(target===this._targets[i]){propLookup=this._propLookup[i]||{};this._overwrittenProps=this._overwrittenProps||[];overwrittenProps=this._overwrittenProps[i]=vars?this._overwrittenProps[i]||{}:"all";break}}}else if(target!==this.target){return false}else{propLookup=this._propLookup;overwrittenProps=this._overwrittenProps=vars?this._overwrittenProps||{}:"all"}if(propLookup){killProps=vars||propLookup;record=vars!==overwrittenProps&&overwrittenProps!=="all"&&vars!==propLookup&&(typeof vars!=="object"||!vars._tempKill);for(p in killProps){if(pt=propLookup[p]){if(!killed){killed=[]}killed.push(p);if(pt.pg&&pt.t._kill(killProps)){changed=true}if(!pt.pg||pt.t._overwriteProps.length===0){if(pt._prev){pt._prev._next=pt._next}else if(pt===this._firstPT){this._firstPT=pt._next}if(pt._next){pt._next._prev=pt._prev}pt._next=pt._prev=null}delete propLookup[p]}if(record){overwrittenProps[p]=1}}if(!this._firstPT&&this._initted){this._enabled(false,false)}if(killed&&overwritingTween){_onOverwrite(this,overwritingTween,target,killed)}}}return changed};p.invalidate=function(){if(this._notifyPluginsOfEnabled){TweenLite._onPluginEvent("_onDisable",this)}this._firstPT=this._overwrittenProps=this._startAt=this._onUpdate=null;this._notifyPluginsOfEnabled=this._active=this._lazy=false;this._propLookup=this._targets?{}:[];Animation.prototype.invalidate.call(this);if(this.vars.immediateRender){this._time=-_tinyNum;this.render(-this._delay)}return this};p._enabled=function(enabled,ignoreTimeline){if(!_tickerActive){_ticker.wake()}if(enabled&&this._gc){var targets=this._targets,i;if(targets){i=targets.length;while(--i>-1){this._siblings[i]=_register(targets[i],this,true)}}else{this._siblings=_register(this.target,this,true)}}Animation.prototype._enabled.call(this,enabled,ignoreTimeline);if(this._notifyPluginsOfEnabled)if(this._firstPT){return TweenLite._onPluginEvent(enabled?"_onEnable":"_onDisable",this)}return false};TweenLite.to=function(target,duration,vars){return new TweenLite(target,duration,vars)};TweenLite.from=function(target,duration,vars){vars.runBackwards=true;vars.immediateRender=vars.immediateRender!=false;return new TweenLite(target,duration,vars)};TweenLite.fromTo=function(target,duration,fromVars,toVars){toVars.startAt=fromVars;toVars.immediateRender=toVars.immediateRender!=false&&fromVars.immediateRender!=false;return new TweenLite(target,duration,toVars)};TweenLite.delayedCall=function(delay,callback,params,scope,useFrames){return new TweenLite(callback,0,{delay:delay,onComplete:callback,onCompleteParams:params,onCompleteScope:scope,onReverseComplete:callback,onReverseCompleteParams:params,onReverseCompleteScope:scope,immediateRender:false,useFrames:useFrames,overwrite:0})};TweenLite.set=function(target,vars){return new TweenLite(target,0,vars)};TweenLite.getTweensOf=function(target,onlyActive){if(target==null){return[]}target=typeof target!=="string"?target:TweenLite.selector(target)||target;var i,a,j,t;if((_isArray(target)||_isSelector(target))&&typeof target[0]!=="number"){i=target.length;a=[];while(--i>-1){a=a.concat(TweenLite.getTweensOf(target[i],onlyActive))}i=a.length;while(--i>-1){t=a[i];j=i;while(--j>-1){if(t===a[j]){a.splice(i,1)}}}}else{a=_register(target).concat();i=a.length;while(--i>-1){if(a[i]._gc||onlyActive&&!a[i].isActive()){a.splice(i,1)}}}return a};TweenLite.killTweensOf=TweenLite.killDelayedCallsTo=function(target,onlyActive,vars){if(typeof onlyActive==="object"){vars=onlyActive;onlyActive=false}var a=TweenLite.getTweensOf(target,onlyActive),i=a.length;while(--i>-1){a[i]._kill(vars,target)}};var TweenPlugin=_class("plugins.TweenPlugin",function(props,priority){this._overwriteProps=(props||"").split(",");this._propName=this._overwriteProps[0];this._priority=priority||0;this._super=TweenPlugin.prototype},true);p=TweenPlugin.prototype;TweenPlugin.version="1.10.1";TweenPlugin.API=2;p._firstPT=null;p._addTween=function(target,prop,start,end,overwriteProp,round){var c,pt;if(end!=null&&(c=typeof end==="number"||end.charAt(1)!=="="?Number(end)-start:parseInt(end.charAt(0)+"1",10)*Number(end.substr(2)))){this._firstPT=pt={_next:this._firstPT,t:target,p:prop,s:start,c:c,f:typeof target[prop]==="function",n:overwriteProp||prop,r:round};if(pt._next){pt._next._prev=pt}return pt}};p.setRatio=function(v){var pt=this._firstPT,min=1e-6,val;while(pt){val=pt.c*v+pt.s;if(pt.r){val=Math.round(val)}else if(val<min)if(val>-min){val=0}if(pt.f){pt.t[pt.p](val)}else{pt.t[pt.p]=val}pt=pt._next}};p._kill=function(lookup){var a=this._overwriteProps,pt=this._firstPT,i;if(lookup[this._propName]!=null){this._overwriteProps=[]}else{i=a.length;while(--i>-1){if(lookup[a[i]]!=null){a.splice(i,1)}}}while(pt){if(lookup[pt.n]!=null){if(pt._next){pt._next._prev=pt._prev}if(pt._prev){pt._prev._next=pt._next;pt._prev=null}else if(this._firstPT===pt){this._firstPT=pt._next}}pt=pt._next}return false};p._roundProps=function(lookup,value){var pt=this._firstPT;while(pt){if(lookup[this._propName]||pt.n!=null&&lookup[pt.n.split(this._propName+"_").join("")]){pt.r=value}pt=pt._next}};TweenLite._onPluginEvent=function(type,tween){var pt=tween._firstPT,changed,pt2,first,last,next;if(type==="_onInitAllProps"){while(pt){next=pt._next;pt2=first;while(pt2&&pt2.pr>pt.pr){pt2=pt2._next}if(pt._prev=pt2?pt2._prev:last){pt._prev._next=pt}else{first=pt}if(pt._next=pt2){pt2._prev=pt}else{last=pt}pt=next}pt=tween._firstPT=first}while(pt){if(pt.pg)if(typeof pt.t[type]==="function")if(pt.t[type]()){changed=true}pt=pt._next}return changed};TweenPlugin.activate=function(plugins){var i=plugins.length;while(--i>-1){if(plugins[i].API===TweenPlugin.API){_plugins[(new plugins[i])._propName]=plugins[i]}}return true};_gsDefine.plugin=function(config){if(!config||!config.propName||!config.init||!config.API){throw"illegal plugin definition."}var propName=config.propName,priority=config.priority||0,overwriteProps=config.overwriteProps,map={init:"_onInitTween",set:"setRatio",kill:"_kill",round:"_roundProps",initAll:"_onInitAllProps"},Plugin=_class("plugins."+propName.charAt(0).toUpperCase()+propName.substr(1)+"Plugin",function(){TweenPlugin.call(this,propName,priority);this._overwriteProps=overwriteProps||[]},config.global===true),p=Plugin.prototype=new TweenPlugin(propName),prop;p.constructor=Plugin;Plugin.API=config.API;for(prop in map){if(typeof config[prop]==="function"){p[map[prop]]=config[prop]}}Plugin.version=config.version;TweenPlugin.activate([Plugin]);return Plugin};a=window._gsQueue;if(a){for(i=0;i<a.length;i++){a[i]()}for(p in _defLookup){if(!_defLookup[p].func){window.console.log("GSAP encountered missing dependency: com.greensock."+p)}}}_tickerActive=false})(typeof module!=="undefined"&&module.exports&&typeof global!=="undefined"?global:this||window,"TweenMax");var THREE={REVISION:"69"};if(typeof module==="object"){module.exports=THREE}if(Math.sign===undefined){Math.sign=function(x){return x<0?-1:x>0?1:0}}THREE.MOUSE={LEFT:0,MIDDLE:1,RIGHT:2};THREE.CullFaceNone=0;THREE.CullFaceBack=1;THREE.CullFaceFront=2;THREE.CullFaceFrontBack=3;THREE.FrontFaceDirectionCW=0;THREE.FrontFaceDirectionCCW=1;THREE.BasicShadowMap=0;THREE.PCFShadowMap=1;THREE.PCFSoftShadowMap=2;THREE.FrontSide=0;THREE.BackSide=1;THREE.DoubleSide=2;THREE.NoShading=0;THREE.FlatShading=1;THREE.SmoothShading=2;THREE.NoColors=0;THREE.FaceColors=1;THREE.VertexColors=2;THREE.NoBlending=0;THREE.NormalBlending=1;THREE.AdditiveBlending=2;THREE.SubtractiveBlending=3;THREE.MultiplyBlending=4;THREE.CustomBlending=5;THREE.AddEquation=100;THREE.SubtractEquation=101;THREE.ReverseSubtractEquation=102;THREE.MinEquation=103;THREE.MaxEquation=104;THREE.ZeroFactor=200;THREE.OneFactor=201;THREE.SrcColorFactor=202;THREE.OneMinusSrcColorFactor=203;THREE.SrcAlphaFactor=204;THREE.OneMinusSrcAlphaFactor=205;THREE.DstAlphaFactor=206;THREE.OneMinusDstAlphaFactor=207;THREE.DstColorFactor=208;THREE.OneMinusDstColorFactor=209;THREE.SrcAlphaSaturateFactor=210;THREE.MultiplyOperation=0;THREE.MixOperation=1;THREE.AddOperation=2;THREE.UVMapping=function(){};THREE.CubeReflectionMapping=function(){};THREE.CubeRefractionMapping=function(){};THREE.SphericalReflectionMapping=function(){};THREE.SphericalRefractionMapping=function(){};THREE.RepeatWrapping=1e3;THREE.ClampToEdgeWrapping=1001;THREE.MirroredRepeatWrapping=1002;THREE.NearestFilter=1003;THREE.NearestMipMapNearestFilter=1004;THREE.NearestMipMapLinearFilter=1005;THREE.LinearFilter=1006;THREE.LinearMipMapNearestFilter=1007;THREE.LinearMipMapLinearFilter=1008;THREE.UnsignedByteType=1009;THREE.ByteType=1010;THREE.ShortType=1011;THREE.UnsignedShortType=1012;THREE.IntType=1013;THREE.UnsignedIntType=1014;THREE.FloatType=1015;THREE.UnsignedShort4444Type=1016;THREE.UnsignedShort5551Type=1017;THREE.UnsignedShort565Type=1018;THREE.AlphaFormat=1019;THREE.RGBFormat=1020;THREE.RGBAFormat=1021;THREE.LuminanceFormat=1022;THREE.LuminanceAlphaFormat=1023;THREE.RGB_S3TC_DXT1_Format=2001;THREE.RGBA_S3TC_DXT1_Format=2002;THREE.RGBA_S3TC_DXT3_Format=2003;THREE.RGBA_S3TC_DXT5_Format=2004;THREE.RGB_PVRTC_4BPPV1_Format=2100;THREE.RGB_PVRTC_2BPPV1_Format=2101;THREE.RGBA_PVRTC_4BPPV1_Format=2102;THREE.RGBA_PVRTC_2BPPV1_Format=2103;THREE.Color=function(color){if(arguments.length===3){return this.setRGB(arguments[0],arguments[1],arguments[2])}return this.set(color)};THREE.Color.prototype={constructor:THREE.Color,r:1,g:1,b:1,set:function(value){if(value instanceof THREE.Color){this.copy(value)}else if(typeof value==="number"){this.setHex(value)}else if(typeof value==="string"){this.setStyle(value)}return this},setHex:function(hex){hex=Math.floor(hex);this.r=(hex>>16&255)/255;this.g=(hex>>8&255)/255;this.b=(hex&255)/255;return this},setRGB:function(r,g,b){this.r=r;this.g=g;this.b=b;return this},setHSL:function(h,s,l){if(s===0){this.r=this.g=this.b=l}else{var hue2rgb=function(p,q,t){if(t<0)t+=1;if(t>1)t-=1;if(t<1/6)return p+(q-p)*6*t;if(t<1/2)return q;if(t<2/3)return p+(q-p)*6*(2/3-t);return p};var p=l<=.5?l*(1+s):l+s-l*s;var q=2*l-p;this.r=hue2rgb(q,p,h+1/3);this.g=hue2rgb(q,p,h);this.b=hue2rgb(q,p,h-1/3)}return this},setStyle:function(style){if(/^rgb\((\d+), ?(\d+), ?(\d+)\)$/i.test(style)){var color=/^rgb\((\d+), ?(\d+), ?(\d+)\)$/i.exec(style);this.r=Math.min(255,parseInt(color[1],10))/255;this.g=Math.min(255,parseInt(color[2],10))/255;this.b=Math.min(255,parseInt(color[3],10))/255;return this}if(/^rgb\((\d+)\%, ?(\d+)\%, ?(\d+)\%\)$/i.test(style)){var color=/^rgb\((\d+)\%, ?(\d+)\%, ?(\d+)\%\)$/i.exec(style);this.r=Math.min(100,parseInt(color[1],10))/100;this.g=Math.min(100,parseInt(color[2],10))/100;this.b=Math.min(100,parseInt(color[3],10))/100;return this}if(/^\#([0-9a-f]{6})$/i.test(style)){var color=/^\#([0-9a-f]{6})$/i.exec(style);this.setHex(parseInt(color[1],16));return this}if(/^\#([0-9a-f])([0-9a-f])([0-9a-f])$/i.test(style)){var color=/^\#([0-9a-f])([0-9a-f])([0-9a-f])$/i.exec(style);this.setHex(parseInt(color[1]+color[1]+color[2]+color[2]+color[3]+color[3],16));return this}if(/^(\w+)$/i.test(style)){this.setHex(THREE.ColorKeywords[style]);return this}},copy:function(color){this.r=color.r;this.g=color.g;this.b=color.b;return this},copyGammaToLinear:function(color){this.r=color.r*color.r;this.g=color.g*color.g;this.b=color.b*color.b;return this},copyLinearToGamma:function(color){this.r=Math.sqrt(color.r);this.g=Math.sqrt(color.g);this.b=Math.sqrt(color.b);return this},convertGammaToLinear:function(){var r=this.r,g=this.g,b=this.b;this.r=r*r;this.g=g*g;this.b=b*b;return this},convertLinearToGamma:function(){this.r=Math.sqrt(this.r);this.g=Math.sqrt(this.g);this.b=Math.sqrt(this.b);return this},getHex:function(){return this.r*255<<16^this.g*255<<8^this.b*255<<0},getHexString:function(){return("000000"+this.getHex().toString(16)).slice(-6)},getHSL:function(optionalTarget){var hsl=optionalTarget||{h:0,s:0,l:0};var r=this.r,g=this.g,b=this.b;var max=Math.max(r,g,b);var min=Math.min(r,g,b);var hue,saturation;var lightness=(min+max)/2;if(min===max){hue=0;saturation=0}else{var delta=max-min;saturation=lightness<=.5?delta/(max+min):delta/(2-max-min);switch(max){case r:hue=(g-b)/delta+(g<b?6:0);break;case g:hue=(b-r)/delta+2;break;case b:hue=(r-g)/delta+4;break}hue/=6}hsl.h=hue;hsl.s=saturation;hsl.l=lightness;return hsl},getStyle:function(){return"rgb("+(this.r*255|0)+","+(this.g*255|0)+","+(this.b*255|0)+")"},offsetHSL:function(h,s,l){var hsl=this.getHSL();hsl.h+=h;hsl.s+=s;hsl.l+=l;this.setHSL(hsl.h,hsl.s,hsl.l);return this},add:function(color){this.r+=color.r;this.g+=color.g;this.b+=color.b;return this},addColors:function(color1,color2){this.r=color1.r+color2.r;this.g=color1.g+color2.g;this.b=color1.b+color2.b;return this},addScalar:function(s){this.r+=s;this.g+=s;this.b+=s;return this},multiply:function(color){this.r*=color.r;this.g*=color.g;this.b*=color.b;return this},multiplyScalar:function(s){this.r*=s;this.g*=s;this.b*=s;return this},lerp:function(color,alpha){this.r+=(color.r-this.r)*alpha;this.g+=(color.g-this.g)*alpha;this.b+=(color.b-this.b)*alpha;return this},equals:function(c){return c.r===this.r&&c.g===this.g&&c.b===this.b},fromArray:function(array){this.r=array[0];this.g=array[1];this.b=array[2];return this},toArray:function(){return[this.r,this.g,this.b]},clone:function(){return(new THREE.Color).setRGB(this.r,this.g,this.b)}};THREE.ColorKeywords={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};THREE.Quaternion=function(x,y,z,w){this._x=x||0;this._y=y||0;this._z=z||0;this._w=w!==undefined?w:1};THREE.Quaternion.prototype={constructor:THREE.Quaternion,_x:0,_y:0,_z:0,_w:0,get x(){return this._x},set x(value){this._x=value;this.onChangeCallback()},get y(){return this._y},set y(value){this._y=value;this.onChangeCallback()},get z(){return this._z},set z(value){this._z=value;this.onChangeCallback()},get w(){return this._w},set w(value){this._w=value;this.onChangeCallback()},set:function(x,y,z,w){this._x=x;this._y=y;this._z=z;this._w=w;this.onChangeCallback();return this},copy:function(quaternion){this._x=quaternion.x;this._y=quaternion.y;this._z=quaternion.z;this._w=quaternion.w;this.onChangeCallback();return this},setFromEuler:function(euler,update){if(euler instanceof THREE.Euler===false){throw new Error("THREE.Quaternion: .setFromEuler() now expects a Euler rotation rather than a Vector3 and order.")}var c1=Math.cos(euler._x/2);var c2=Math.cos(euler._y/2);var c3=Math.cos(euler._z/2);var s1=Math.sin(euler._x/2);var s2=Math.sin(euler._y/2);var s3=Math.sin(euler._z/2);if(euler.order==="XYZ"){this._x=s1*c2*c3+c1*s2*s3;this._y=c1*s2*c3-s1*c2*s3;this._z=c1*c2*s3+s1*s2*c3;this._w=c1*c2*c3-s1*s2*s3}else if(euler.order==="YXZ"){this._x=s1*c2*c3+c1*s2*s3;this._y=c1*s2*c3-s1*c2*s3;this._z=c1*c2*s3-s1*s2*c3;this._w=c1*c2*c3+s1*s2*s3}else if(euler.order==="ZXY"){this._x=s1*c2*c3-c1*s2*s3;this._y=c1*s2*c3+s1*c2*s3;this._z=c1*c2*s3+s1*s2*c3;this._w=c1*c2*c3-s1*s2*s3}else if(euler.order==="ZYX"){this._x=s1*c2*c3-c1*s2*s3;this._y=c1*s2*c3+s1*c2*s3;this._z=c1*c2*s3-s1*s2*c3;this._w=c1*c2*c3+s1*s2*s3}else if(euler.order==="YZX"){this._x=s1*c2*c3+c1*s2*s3;this._y=c1*s2*c3+s1*c2*s3;this._z=c1*c2*s3-s1*s2*c3;this._w=c1*c2*c3-s1*s2*s3}else if(euler.order==="XZY"){this._x=s1*c2*c3-c1*s2*s3;this._y=c1*s2*c3-s1*c2*s3;this._z=c1*c2*s3+s1*s2*c3;this._w=c1*c2*c3+s1*s2*s3}if(update!==false)this.onChangeCallback();return this},setFromAxisAngle:function(axis,angle){var halfAngle=angle/2,s=Math.sin(halfAngle);this._x=axis.x*s;this._y=axis.y*s;this._z=axis.z*s;this._w=Math.cos(halfAngle);this.onChangeCallback();return this},setFromRotationMatrix:function(m){var te=m.elements,m11=te[0],m12=te[4],m13=te[8],m21=te[1],m22=te[5],m23=te[9],m31=te[2],m32=te[6],m33=te[10],trace=m11+m22+m33,s;if(trace>0){s=.5/Math.sqrt(trace+1);this._w=.25/s;this._x=(m32-m23)*s;this._y=(m13-m31)*s;this._z=(m21-m12)*s}else if(m11>m22&&m11>m33){s=2*Math.sqrt(1+m11-m22-m33);this._w=(m32-m23)/s;this._x=.25*s;this._y=(m12+m21)/s;this._z=(m13+m31)/s}else if(m22>m33){s=2*Math.sqrt(1+m22-m11-m33);this._w=(m13-m31)/s;this._x=(m12+m21)/s;this._y=.25*s;this._z=(m23+m32)/s}else{s=2*Math.sqrt(1+m33-m11-m22);this._w=(m21-m12)/s;this._x=(m13+m31)/s;this._y=(m23+m32)/s;this._z=.25*s}this.onChangeCallback();return this},setFromUnitVectors:function(){var v1,r;var EPS=1e-6;return function(vFrom,vTo){if(v1===undefined)v1=new THREE.Vector3;r=vFrom.dot(vTo)+1;if(r<EPS){r=0;if(Math.abs(vFrom.x)>Math.abs(vFrom.z)){v1.set(-vFrom.y,vFrom.x,0)}else{v1.set(0,-vFrom.z,vFrom.y)}}else{v1.crossVectors(vFrom,vTo)}this._x=v1.x;this._y=v1.y;this._z=v1.z;this._w=r;this.normalize();return this}}(),inverse:function(){this.conjugate().normalize();return this},conjugate:function(){this._x*=-1;this._y*=-1;this._z*=-1;this.onChangeCallback();return this},dot:function(v){return this._x*v._x+this._y*v._y+this._z*v._z+this._w*v._w},lengthSq:function(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w},length:function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)},normalize:function(){var l=this.length();if(l===0){this._x=0;this._y=0;this._z=0;this._w=1}else{l=1/l;this._x=this._x*l;this._y=this._y*l;this._z=this._z*l;this._w=this._w*l}this.onChangeCallback();return this},multiply:function(q,p){if(p!==undefined){console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead.");return this.multiplyQuaternions(q,p)}return this.multiplyQuaternions(this,q)},multiplyQuaternions:function(a,b){var qax=a._x,qay=a._y,qaz=a._z,qaw=a._w;var qbx=b._x,qby=b._y,qbz=b._z,qbw=b._w;this._x=qax*qbw+qaw*qbx+qay*qbz-qaz*qby;this._y=qay*qbw+qaw*qby+qaz*qbx-qax*qbz;this._z=qaz*qbw+qaw*qbz+qax*qby-qay*qbx;this._w=qaw*qbw-qax*qbx-qay*qby-qaz*qbz;this.onChangeCallback();return this},multiplyVector3:function(vector){console.warn("THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead.");return vector.applyQuaternion(this)},slerp:function(qb,t){if(t===0)return this;if(t===1)return this.copy(qb);var x=this._x,y=this._y,z=this._z,w=this._w;var cosHalfTheta=w*qb._w+x*qb._x+y*qb._y+z*qb._z;if(cosHalfTheta<0){this._w=-qb._w;this._x=-qb._x;this._y=-qb._y;this._z=-qb._z;cosHalfTheta=-cosHalfTheta}else{this.copy(qb)}if(cosHalfTheta>=1){this._w=w;this._x=x;this._y=y;this._z=z;return this}var halfTheta=Math.acos(cosHalfTheta);var sinHalfTheta=Math.sqrt(1-cosHalfTheta*cosHalfTheta);if(Math.abs(sinHalfTheta)<.001){this._w=.5*(w+this._w);this._x=.5*(x+this._x);this._y=.5*(y+this._y);this._z=.5*(z+this._z);return this}var ratioA=Math.sin((1-t)*halfTheta)/sinHalfTheta,ratioB=Math.sin(t*halfTheta)/sinHalfTheta;this._w=w*ratioA+this._w*ratioB;this._x=x*ratioA+this._x*ratioB;this._y=y*ratioA+this._y*ratioB;this._z=z*ratioA+this._z*ratioB;this.onChangeCallback();return this},equals:function(quaternion){return quaternion._x===this._x&&quaternion._y===this._y&&quaternion._z===this._z&&quaternion._w===this._w},fromArray:function(array,offset){if(offset===undefined)offset=0;this._x=array[offset];this._y=array[offset+1];this._z=array[offset+2];this._w=array[offset+3];this.onChangeCallback();return this},toArray:function(array,offset){if(array===undefined)array=[];if(offset===undefined)offset=0;array[offset]=this._x;array[offset+1]=this._y;array[offset+2]=this._z;array[offset+3]=this._w;return array},onChange:function(callback){this.onChangeCallback=callback;return this},onChangeCallback:function(){},clone:function(){return new THREE.Quaternion(this._x,this._y,this._z,this._w)}};THREE.Quaternion.slerp=function(qa,qb,qm,t){return qm.copy(qa).slerp(qb,t)};THREE.Vector2=function(x,y){this.x=x||0;this.y=y||0};THREE.Vector2.prototype={constructor:THREE.Vector2,set:function(x,y){this.x=x;this.y=y;return this},setX:function(x){this.x=x;return this},setY:function(y){this.y=y;return this},setComponent:function(index,value){switch(index){case 0:this.x=value;break;case 1:this.y=value;break;default:throw new Error("index is out of range: "+index)}},getComponent:function(index){switch(index){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+index)}},copy:function(v){this.x=v.x;this.y=v.y;return this},add:function(v,w){if(w!==undefined){console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead.");return this.addVectors(v,w)}this.x+=v.x;this.y+=v.y;return this},addVectors:function(a,b){this.x=a.x+b.x;this.y=a.y+b.y;return this},addScalar:function(s){this.x+=s;this.y+=s;return this},sub:function(v,w){if(w!==undefined){console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead.");return this.subVectors(v,w)}this.x-=v.x;this.y-=v.y;return this},subVectors:function(a,b){this.x=a.x-b.x;this.y=a.y-b.y;return this},multiply:function(v){this.x*=v.x;this.y*=v.y;return this},multiplyScalar:function(s){this.x*=s;this.y*=s;return this},divide:function(v){this.x/=v.x;this.y/=v.y;return this},divideScalar:function(scalar){if(scalar!==0){var invScalar=1/scalar;this.x*=invScalar;this.y*=invScalar}else{this.x=0;this.y=0}return this},min:function(v){if(this.x>v.x){this.x=v.x}if(this.y>v.y){this.y=v.y}return this},max:function(v){if(this.x<v.x){this.x=v.x}if(this.y<v.y){this.y=v.y}return this},clamp:function(min,max){if(this.x<min.x){this.x=min.x}else if(this.x>max.x){this.x=max.x}if(this.y<min.y){this.y=min.y}else if(this.y>max.y){this.y=max.y}return this},clampScalar:function(){var min,max;return function(minVal,maxVal){if(min===undefined){min=new THREE.Vector2;max=new THREE.Vector2}min.set(minVal,minVal);max.set(maxVal,maxVal);return this.clamp(min,max)}}(),floor:function(){this.x=Math.floor(this.x);this.y=Math.floor(this.y);return this},ceil:function(){this.x=Math.ceil(this.x);this.y=Math.ceil(this.y);return this},round:function(){this.x=Math.round(this.x);this.y=Math.round(this.y);return this},roundToZero:function(){this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x);this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y);return this},negate:function(){this.x=-this.x;this.y=-this.y;return this},dot:function(v){return this.x*v.x+this.y*v.y},lengthSq:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},normalize:function(){return this.divideScalar(this.length())},distanceTo:function(v){return Math.sqrt(this.distanceToSquared(v))},distanceToSquared:function(v){var dx=this.x-v.x,dy=this.y-v.y;return dx*dx+dy*dy},setLength:function(l){var oldLength=this.length();if(oldLength!==0&&l!==oldLength){this.multiplyScalar(l/oldLength)}return this},lerp:function(v,alpha){this.x+=(v.x-this.x)*alpha;this.y+=(v.y-this.y)*alpha;
return this},equals:function(v){return v.x===this.x&&v.y===this.y},fromArray:function(array,offset){if(offset===undefined)offset=0;this.x=array[offset];this.y=array[offset+1];return this},toArray:function(array,offset){if(array===undefined)array=[];if(offset===undefined)offset=0;array[offset]=this.x;array[offset+1]=this.y;return array},clone:function(){return new THREE.Vector2(this.x,this.y)}};THREE.Vector3=function(x,y,z){this.x=x||0;this.y=y||0;this.z=z||0};THREE.Vector3.prototype={constructor:THREE.Vector3,set:function(x,y,z){this.x=x;this.y=y;this.z=z;return this},setX:function(x){this.x=x;return this},setY:function(y){this.y=y;return this},setZ:function(z){this.z=z;return this},setComponent:function(index,value){switch(index){case 0:this.x=value;break;case 1:this.y=value;break;case 2:this.z=value;break;default:throw new Error("index is out of range: "+index)}},getComponent:function(index){switch(index){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+index)}},copy:function(v){this.x=v.x;this.y=v.y;this.z=v.z;return this},add:function(v,w){if(w!==undefined){console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead.");return this.addVectors(v,w)}this.x+=v.x;this.y+=v.y;this.z+=v.z;return this},addScalar:function(s){this.x+=s;this.y+=s;this.z+=s;return this},addVectors:function(a,b){this.x=a.x+b.x;this.y=a.y+b.y;this.z=a.z+b.z;return this},sub:function(v,w){if(w!==undefined){console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead.");return this.subVectors(v,w)}this.x-=v.x;this.y-=v.y;this.z-=v.z;return this},subVectors:function(a,b){this.x=a.x-b.x;this.y=a.y-b.y;this.z=a.z-b.z;return this},multiply:function(v,w){if(w!==undefined){console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead.");return this.multiplyVectors(v,w)}this.x*=v.x;this.y*=v.y;this.z*=v.z;return this},multiplyScalar:function(scalar){this.x*=scalar;this.y*=scalar;this.z*=scalar;return this},multiplyVectors:function(a,b){this.x=a.x*b.x;this.y=a.y*b.y;this.z=a.z*b.z;return this},applyEuler:function(){var quaternion;return function(euler){if(euler instanceof THREE.Euler===false){console.error("THREE.Vector3: .applyEuler() now expects a Euler rotation rather than a Vector3 and order.")}if(quaternion===undefined)quaternion=new THREE.Quaternion;this.applyQuaternion(quaternion.setFromEuler(euler));return this}}(),applyAxisAngle:function(){var quaternion;return function(axis,angle){if(quaternion===undefined)quaternion=new THREE.Quaternion;this.applyQuaternion(quaternion.setFromAxisAngle(axis,angle));return this}}(),applyMatrix3:function(m){var x=this.x;var y=this.y;var z=this.z;var e=m.elements;this.x=e[0]*x+e[3]*y+e[6]*z;this.y=e[1]*x+e[4]*y+e[7]*z;this.z=e[2]*x+e[5]*y+e[8]*z;return this},applyMatrix4:function(m){var x=this.x,y=this.y,z=this.z;var e=m.elements;this.x=e[0]*x+e[4]*y+e[8]*z+e[12];this.y=e[1]*x+e[5]*y+e[9]*z+e[13];this.z=e[2]*x+e[6]*y+e[10]*z+e[14];return this},applyProjection:function(m){var x=this.x,y=this.y,z=this.z;var e=m.elements;var d=1/(e[3]*x+e[7]*y+e[11]*z+e[15]);this.x=(e[0]*x+e[4]*y+e[8]*z+e[12])*d;this.y=(e[1]*x+e[5]*y+e[9]*z+e[13])*d;this.z=(e[2]*x+e[6]*y+e[10]*z+e[14])*d;return this},applyQuaternion:function(q){var x=this.x;var y=this.y;var z=this.z;var qx=q.x;var qy=q.y;var qz=q.z;var qw=q.w;var ix=qw*x+qy*z-qz*y;var iy=qw*y+qz*x-qx*z;var iz=qw*z+qx*y-qy*x;var iw=-qx*x-qy*y-qz*z;this.x=ix*qw+iw*-qx+iy*-qz-iz*-qy;this.y=iy*qw+iw*-qy+iz*-qx-ix*-qz;this.z=iz*qw+iw*-qz+ix*-qy-iy*-qx;return this},project:function(){var matrix;return function(camera){if(matrix===undefined)matrix=new THREE.Matrix4;matrix.multiplyMatrices(camera.projectionMatrix,matrix.getInverse(camera.matrixWorld));return this.applyProjection(matrix)}}(),unproject:function(){var matrix;return function(camera){if(matrix===undefined)matrix=new THREE.Matrix4;matrix.multiplyMatrices(camera.matrixWorld,matrix.getInverse(camera.projectionMatrix));return this.applyProjection(matrix)}}(),transformDirection:function(m){var x=this.x,y=this.y,z=this.z;var e=m.elements;this.x=e[0]*x+e[4]*y+e[8]*z;this.y=e[1]*x+e[5]*y+e[9]*z;this.z=e[2]*x+e[6]*y+e[10]*z;this.normalize();return this},divide:function(v){this.x/=v.x;this.y/=v.y;this.z/=v.z;return this},divideScalar:function(scalar){if(scalar!==0){var invScalar=1/scalar;this.x*=invScalar;this.y*=invScalar;this.z*=invScalar}else{this.x=0;this.y=0;this.z=0}return this},min:function(v){if(this.x>v.x){this.x=v.x}if(this.y>v.y){this.y=v.y}if(this.z>v.z){this.z=v.z}return this},max:function(v){if(this.x<v.x){this.x=v.x}if(this.y<v.y){this.y=v.y}if(this.z<v.z){this.z=v.z}return this},clamp:function(min,max){if(this.x<min.x){this.x=min.x}else if(this.x>max.x){this.x=max.x}if(this.y<min.y){this.y=min.y}else if(this.y>max.y){this.y=max.y}if(this.z<min.z){this.z=min.z}else if(this.z>max.z){this.z=max.z}return this},clampScalar:function(){var min,max;return function(minVal,maxVal){if(min===undefined){min=new THREE.Vector3;max=new THREE.Vector3}min.set(minVal,minVal,minVal);max.set(maxVal,maxVal,maxVal);return this.clamp(min,max)}}(),floor:function(){this.x=Math.floor(this.x);this.y=Math.floor(this.y);this.z=Math.floor(this.z);return this},ceil:function(){this.x=Math.ceil(this.x);this.y=Math.ceil(this.y);this.z=Math.ceil(this.z);return this},round:function(){this.x=Math.round(this.x);this.y=Math.round(this.y);this.z=Math.round(this.z);return this},roundToZero:function(){this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x);this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y);this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z);return this},negate:function(){this.x=-this.x;this.y=-this.y;this.z=-this.z;return this},dot:function(v){return this.x*v.x+this.y*v.y+this.z*v.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)},normalize:function(){return this.divideScalar(this.length())},setLength:function(l){var oldLength=this.length();if(oldLength!==0&&l!==oldLength){this.multiplyScalar(l/oldLength)}return this},lerp:function(v,alpha){this.x+=(v.x-this.x)*alpha;this.y+=(v.y-this.y)*alpha;this.z+=(v.z-this.z)*alpha;return this},cross:function(v,w){if(w!==undefined){console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead.");return this.crossVectors(v,w)}var x=this.x,y=this.y,z=this.z;this.x=y*v.z-z*v.y;this.y=z*v.x-x*v.z;this.z=x*v.y-y*v.x;return this},crossVectors:function(a,b){var ax=a.x,ay=a.y,az=a.z;var bx=b.x,by=b.y,bz=b.z;this.x=ay*bz-az*by;this.y=az*bx-ax*bz;this.z=ax*by-ay*bx;return this},projectOnVector:function(){var v1,dot;return function(vector){if(v1===undefined)v1=new THREE.Vector3;v1.copy(vector).normalize();dot=this.dot(v1);return this.copy(v1).multiplyScalar(dot)}}(),projectOnPlane:function(){var v1;return function(planeNormal){if(v1===undefined)v1=new THREE.Vector3;v1.copy(this).projectOnVector(planeNormal);return this.sub(v1)}}(),reflect:function(){var v1;return function(normal){if(v1===undefined)v1=new THREE.Vector3;return this.sub(v1.copy(normal).multiplyScalar(2*this.dot(normal)))}}(),angleTo:function(v){var theta=this.dot(v)/(this.length()*v.length());return Math.acos(THREE.Math.clamp(theta,-1,1))},distanceTo:function(v){return Math.sqrt(this.distanceToSquared(v))},distanceToSquared:function(v){var dx=this.x-v.x;var dy=this.y-v.y;var dz=this.z-v.z;return dx*dx+dy*dy+dz*dz},setEulerFromRotationMatrix:function(m,order){console.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")},setEulerFromQuaternion:function(q,order){console.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")},getPositionFromMatrix:function(m){console.warn("THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition().");return this.setFromMatrixPosition(m)},getScaleFromMatrix:function(m){console.warn("THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale().");return this.setFromMatrixScale(m)},getColumnFromMatrix:function(index,matrix){console.warn("THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn().");return this.setFromMatrixColumn(index,matrix)},setFromMatrixPosition:function(m){this.x=m.elements[12];this.y=m.elements[13];this.z=m.elements[14];return this},setFromMatrixScale:function(m){var sx=this.set(m.elements[0],m.elements[1],m.elements[2]).length();var sy=this.set(m.elements[4],m.elements[5],m.elements[6]).length();var sz=this.set(m.elements[8],m.elements[9],m.elements[10]).length();this.x=sx;this.y=sy;this.z=sz;return this},setFromMatrixColumn:function(index,matrix){var offset=index*4;var me=matrix.elements;this.x=me[offset];this.y=me[offset+1];this.z=me[offset+2];return this},equals:function(v){return v.x===this.x&&v.y===this.y&&v.z===this.z},fromArray:function(array,offset){if(offset===undefined)offset=0;this.x=array[offset];this.y=array[offset+1];this.z=array[offset+2];return this},toArray:function(array,offset){if(array===undefined)array=[];if(offset===undefined)offset=0;array[offset]=this.x;array[offset+1]=this.y;array[offset+2]=this.z;return array},clone:function(){return new THREE.Vector3(this.x,this.y,this.z)}};THREE.Vector4=function(x,y,z,w){this.x=x||0;this.y=y||0;this.z=z||0;this.w=w!==undefined?w:1};THREE.Vector4.prototype={constructor:THREE.Vector4,set:function(x,y,z,w){this.x=x;this.y=y;this.z=z;this.w=w;return this},setX:function(x){this.x=x;return this},setY:function(y){this.y=y;return this},setZ:function(z){this.z=z;return this},setW:function(w){this.w=w;return this},setComponent:function(index,value){switch(index){case 0:this.x=value;break;case 1:this.y=value;break;case 2:this.z=value;break;case 3:this.w=value;break;default:throw new Error("index is out of range: "+index)}},getComponent:function(index){switch(index){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+index)}},copy:function(v){this.x=v.x;this.y=v.y;this.z=v.z;this.w=v.w!==undefined?v.w:1;return this},add:function(v,w){if(w!==undefined){console.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead.");return this.addVectors(v,w)}this.x+=v.x;this.y+=v.y;this.z+=v.z;this.w+=v.w;return this},addScalar:function(s){this.x+=s;this.y+=s;this.z+=s;this.w+=s;return this},addVectors:function(a,b){this.x=a.x+b.x;this.y=a.y+b.y;this.z=a.z+b.z;this.w=a.w+b.w;return this},sub:function(v,w){if(w!==undefined){console.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead.");return this.subVectors(v,w)}this.x-=v.x;this.y-=v.y;this.z-=v.z;this.w-=v.w;return this},subVectors:function(a,b){this.x=a.x-b.x;this.y=a.y-b.y;this.z=a.z-b.z;this.w=a.w-b.w;return this},multiplyScalar:function(scalar){this.x*=scalar;this.y*=scalar;this.z*=scalar;this.w*=scalar;return this},applyMatrix4:function(m){var x=this.x;var y=this.y;var z=this.z;var w=this.w;var e=m.elements;this.x=e[0]*x+e[4]*y+e[8]*z+e[12]*w;this.y=e[1]*x+e[5]*y+e[9]*z+e[13]*w;this.z=e[2]*x+e[6]*y+e[10]*z+e[14]*w;this.w=e[3]*x+e[7]*y+e[11]*z+e[15]*w;return this},divideScalar:function(scalar){if(scalar!==0){var invScalar=1/scalar;this.x*=invScalar;this.y*=invScalar;this.z*=invScalar;this.w*=invScalar}else{this.x=0;this.y=0;this.z=0;this.w=1}return this},setAxisAngleFromQuaternion:function(q){this.w=2*Math.acos(q.w);var s=Math.sqrt(1-q.w*q.w);if(s<1e-4){this.x=1;this.y=0;this.z=0}else{this.x=q.x/s;this.y=q.y/s;this.z=q.z/s}return this},setAxisAngleFromRotationMatrix:function(m){var angle,x,y,z,epsilon=.01,epsilon2=.1,te=m.elements,m11=te[0],m12=te[4],m13=te[8],m21=te[1],m22=te[5],m23=te[9],m31=te[2],m32=te[6],m33=te[10];if(Math.abs(m12-m21)<epsilon&&Math.abs(m13-m31)<epsilon&&Math.abs(m23-m32)<epsilon){if(Math.abs(m12+m21)<epsilon2&&Math.abs(m13+m31)<epsilon2&&Math.abs(m23+m32)<epsilon2&&Math.abs(m11+m22+m33-3)<epsilon2){this.set(1,0,0,0);return this}angle=Math.PI;var xx=(m11+1)/2;var yy=(m22+1)/2;var zz=(m33+1)/2;var xy=(m12+m21)/4;var xz=(m13+m31)/4;var yz=(m23+m32)/4;if(xx>yy&&xx>zz){if(xx<epsilon){x=0;y=.707106781;z=.707106781}else{x=Math.sqrt(xx);y=xy/x;z=xz/x}}else if(yy>zz){if(yy<epsilon){x=.707106781;y=0;z=.707106781}else{y=Math.sqrt(yy);x=xy/y;z=yz/y}}else{if(zz<epsilon){x=.707106781;y=.707106781;z=0}else{z=Math.sqrt(zz);x=xz/z;y=yz/z}}this.set(x,y,z,angle);return this}var s=Math.sqrt((m32-m23)*(m32-m23)+(m13-m31)*(m13-m31)+(m21-m12)*(m21-m12));if(Math.abs(s)<.001)s=1;this.x=(m32-m23)/s;this.y=(m13-m31)/s;this.z=(m21-m12)/s;this.w=Math.acos((m11+m22+m33-1)/2);return this},min:function(v){if(this.x>v.x){this.x=v.x}if(this.y>v.y){this.y=v.y}if(this.z>v.z){this.z=v.z}if(this.w>v.w){this.w=v.w}return this},max:function(v){if(this.x<v.x){this.x=v.x}if(this.y<v.y){this.y=v.y}if(this.z<v.z){this.z=v.z}if(this.w<v.w){this.w=v.w}return this},clamp:function(min,max){if(this.x<min.x){this.x=min.x}else if(this.x>max.x){this.x=max.x}if(this.y<min.y){this.y=min.y}else if(this.y>max.y){this.y=max.y}if(this.z<min.z){this.z=min.z}else if(this.z>max.z){this.z=max.z}if(this.w<min.w){this.w=min.w}else if(this.w>max.w){this.w=max.w}return this},clampScalar:function(){var min,max;return function(minVal,maxVal){if(min===undefined){min=new THREE.Vector4;max=new THREE.Vector4}min.set(minVal,minVal,minVal,minVal);max.set(maxVal,maxVal,maxVal,maxVal);return this.clamp(min,max)}}(),floor:function(){this.x=Math.floor(this.x);this.y=Math.floor(this.y);this.z=Math.floor(this.z);this.w=Math.floor(this.w);return this},ceil:function(){this.x=Math.ceil(this.x);this.y=Math.ceil(this.y);this.z=Math.ceil(this.z);this.w=Math.ceil(this.w);return this},round:function(){this.x=Math.round(this.x);this.y=Math.round(this.y);this.z=Math.round(this.z);this.w=Math.round(this.w);return this},roundToZero:function(){this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x);this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y);this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z);this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w);return this},negate:function(){this.x=-this.x;this.y=-this.y;this.z=-this.z;this.w=-this.w;return this},dot:function(v){return this.x*v.x+this.y*v.y+this.z*v.z+this.w*v.w},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)},normalize:function(){return this.divideScalar(this.length())},setLength:function(l){var oldLength=this.length();if(oldLength!==0&&l!==oldLength){this.multiplyScalar(l/oldLength)}return this},lerp:function(v,alpha){this.x+=(v.x-this.x)*alpha;this.y+=(v.y-this.y)*alpha;this.z+=(v.z-this.z)*alpha;this.w+=(v.w-this.w)*alpha;return this},equals:function(v){return v.x===this.x&&v.y===this.y&&v.z===this.z&&v.w===this.w},fromArray:function(array,offset){if(offset===undefined)offset=0;this.x=array[offset];this.y=array[offset+1];this.z=array[offset+2];this.w=array[offset+3];return this},toArray:function(array,offset){if(array===undefined)array=[];if(offset===undefined)offset=0;array[offset]=this.x;array[offset+1]=this.y;array[offset+2]=this.z;array[offset+3]=this.w;return array},clone:function(){return new THREE.Vector4(this.x,this.y,this.z,this.w)}};THREE.Euler=function(x,y,z,order){this._x=x||0;this._y=y||0;this._z=z||0;this._order=order||THREE.Euler.DefaultOrder};THREE.Euler.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"];THREE.Euler.DefaultOrder="XYZ";THREE.Euler.prototype={constructor:THREE.Euler,_x:0,_y:0,_z:0,_order:THREE.Euler.DefaultOrder,get x(){return this._x},set x(value){this._x=value;this.onChangeCallback()},get y(){return this._y},set y(value){this._y=value;this.onChangeCallback()},get z(){return this._z},set z(value){this._z=value;this.onChangeCallback()},get order(){return this._order},set order(value){this._order=value;this.onChangeCallback()},set:function(x,y,z,order){this._x=x;this._y=y;this._z=z;this._order=order||this._order;this.onChangeCallback();return this},copy:function(euler){this._x=euler._x;this._y=euler._y;this._z=euler._z;this._order=euler._order;this.onChangeCallback();return this},setFromRotationMatrix:function(m,order){var clamp=THREE.Math.clamp;var te=m.elements;var m11=te[0],m12=te[4],m13=te[8];var m21=te[1],m22=te[5],m23=te[9];var m31=te[2],m32=te[6],m33=te[10];order=order||this._order;if(order==="XYZ"){this._y=Math.asin(clamp(m13,-1,1));if(Math.abs(m13)<.99999){this._x=Math.atan2(-m23,m33);this._z=Math.atan2(-m12,m11)}else{this._x=Math.atan2(m32,m22);this._z=0}}else if(order==="YXZ"){this._x=Math.asin(-clamp(m23,-1,1));if(Math.abs(m23)<.99999){this._y=Math.atan2(m13,m33);this._z=Math.atan2(m21,m22)}else{this._y=Math.atan2(-m31,m11);this._z=0}}else if(order==="ZXY"){this._x=Math.asin(clamp(m32,-1,1));if(Math.abs(m32)<.99999){this._y=Math.atan2(-m31,m33);this._z=Math.atan2(-m12,m22)}else{this._y=0;this._z=Math.atan2(m21,m11)}}else if(order==="ZYX"){this._y=Math.asin(-clamp(m31,-1,1));if(Math.abs(m31)<.99999){this._x=Math.atan2(m32,m33);this._z=Math.atan2(m21,m11)}else{this._x=0;this._z=Math.atan2(-m12,m22)}}else if(order==="YZX"){this._z=Math.asin(clamp(m21,-1,1));if(Math.abs(m21)<.99999){this._x=Math.atan2(-m23,m22);this._y=Math.atan2(-m31,m11)}else{this._x=0;this._y=Math.atan2(m13,m33)}}else if(order==="XZY"){this._z=Math.asin(-clamp(m12,-1,1));if(Math.abs(m12)<.99999){this._x=Math.atan2(m32,m22);this._y=Math.atan2(m13,m11)}else{this._x=Math.atan2(-m23,m33);this._y=0}}else{console.warn("THREE.Euler: .setFromRotationMatrix() given unsupported order: "+order)}this._order=order;this.onChangeCallback();return this},setFromQuaternion:function(q,order,update){var clamp=THREE.Math.clamp;var sqx=q.x*q.x;var sqy=q.y*q.y;var sqz=q.z*q.z;var sqw=q.w*q.w;order=order||this._order;if(order==="XYZ"){this._x=Math.atan2(2*(q.x*q.w-q.y*q.z),sqw-sqx-sqy+sqz);this._y=Math.asin(clamp(2*(q.x*q.z+q.y*q.w),-1,1));this._z=Math.atan2(2*(q.z*q.w-q.x*q.y),sqw+sqx-sqy-sqz)}else if(order==="YXZ"){this._x=Math.asin(clamp(2*(q.x*q.w-q.y*q.z),-1,1));this._y=Math.atan2(2*(q.x*q.z+q.y*q.w),sqw-sqx-sqy+sqz);this._z=Math.atan2(2*(q.x*q.y+q.z*q.w),sqw-sqx+sqy-sqz)}else if(order==="ZXY"){this._x=Math.asin(clamp(2*(q.x*q.w+q.y*q.z),-1,1));this._y=Math.atan2(2*(q.y*q.w-q.z*q.x),sqw-sqx-sqy+sqz);this._z=Math.atan2(2*(q.z*q.w-q.x*q.y),sqw-sqx+sqy-sqz)}else if(order==="ZYX"){this._x=Math.atan2(2*(q.x*q.w+q.z*q.y),sqw-sqx-sqy+sqz);this._y=Math.asin(clamp(2*(q.y*q.w-q.x*q.z),-1,1));this._z=Math.atan2(2*(q.x*q.y+q.z*q.w),sqw+sqx-sqy-sqz)}else if(order==="YZX"){this._x=Math.atan2(2*(q.x*q.w-q.z*q.y),sqw-sqx+sqy-sqz);this._y=Math.atan2(2*(q.y*q.w-q.x*q.z),sqw+sqx-sqy-sqz);this._z=Math.asin(clamp(2*(q.x*q.y+q.z*q.w),-1,1))}else if(order==="XZY"){this._x=Math.atan2(2*(q.x*q.w+q.y*q.z),sqw-sqx+sqy-sqz);this._y=Math.atan2(2*(q.x*q.z+q.y*q.w),sqw+sqx-sqy-sqz);this._z=Math.asin(clamp(2*(q.z*q.w-q.x*q.y),-1,1))}else{console.warn("THREE.Euler: .setFromQuaternion() given unsupported order: "+order)}this._order=order;if(update!==false)this.onChangeCallback();return this},reorder:function(){var q=new THREE.Quaternion;return function(newOrder){q.setFromEuler(this);this.setFromQuaternion(q,newOrder)}}(),equals:function(euler){return euler._x===this._x&&euler._y===this._y&&euler._z===this._z&&euler._order===this._order},fromArray:function(array){this._x=array[0];this._y=array[1];this._z=array[2];if(array[3]!==undefined)this._order=array[3];this.onChangeCallback();return this},toArray:function(){return[this._x,this._y,this._z,this._order]},onChange:function(callback){this.onChangeCallback=callback;return this},onChangeCallback:function(){},clone:function(){return new THREE.Euler(this._x,this._y,this._z,this._order)}};THREE.Line3=function(start,end){this.start=start!==undefined?start:new THREE.Vector3;this.end=end!==undefined?end:new THREE.Vector3};THREE.Line3.prototype={constructor:THREE.Line3,set:function(start,end){this.start.copy(start);this.end.copy(end);return this},copy:function(line){this.start.copy(line.start);this.end.copy(line.end);return this},center:function(optionalTarget){var result=optionalTarget||new THREE.Vector3;return result.addVectors(this.start,this.end).multiplyScalar(.5)},delta:function(optionalTarget){var result=optionalTarget||new THREE.Vector3;return result.subVectors(this.end,this.start)},distanceSq:function(){return this.start.distanceToSquared(this.end)},distance:function(){return this.start.distanceTo(this.end)},at:function(t,optionalTarget){var result=optionalTarget||new THREE.Vector3;return this.delta(result).multiplyScalar(t).add(this.start)},closestPointToPointParameter:function(){var startP=new THREE.Vector3;var startEnd=new THREE.Vector3;return function(point,clampToLine){startP.subVectors(point,this.start);startEnd.subVectors(this.end,this.start);var startEnd2=startEnd.dot(startEnd);var startEnd_startP=startEnd.dot(startP);var t=startEnd_startP/startEnd2;if(clampToLine){t=THREE.Math.clamp(t,0,1)}return t}}(),closestPointToPoint:function(point,clampToLine,optionalTarget){var t=this.closestPointToPointParameter(point,clampToLine);var result=optionalTarget||new THREE.Vector3;return this.delta(result).multiplyScalar(t).add(this.start)},applyMatrix4:function(matrix){this.start.applyMatrix4(matrix);this.end.applyMatrix4(matrix);return this},equals:function(line){return line.start.equals(this.start)&&line.end.equals(this.end)},clone:function(){return(new THREE.Line3).copy(this)}};THREE.Box2=function(min,max){this.min=min!==undefined?min:new THREE.Vector2(Infinity,Infinity);this.max=max!==undefined?max:new THREE.Vector2(-Infinity,-Infinity)};THREE.Box2.prototype={constructor:THREE.Box2,set:function(min,max){this.min.copy(min);this.max.copy(max);return this},setFromPoints:function(points){this.makeEmpty();for(var i=0,il=points.length;i<il;i++){this.expandByPoint(points[i])}return this},setFromCenterAndSize:function(){var v1=new THREE.Vector2;return function(center,size){var halfSize=v1.copy(size).multiplyScalar(.5);this.min.copy(center).sub(halfSize);this.max.copy(center).add(halfSize);return this}}(),copy:function(box){this.min.copy(box.min);this.max.copy(box.max);return this},makeEmpty:function(){this.min.x=this.min.y=Infinity;this.max.x=this.max.y=-Infinity;return this},empty:function(){return this.max.x<this.min.x||this.max.y<this.min.y},center:function(optionalTarget){var result=optionalTarget||new THREE.Vector2;return result.addVectors(this.min,this.max).multiplyScalar(.5)},size:function(optionalTarget){var result=optionalTarget||new THREE.Vector2;return result.subVectors(this.max,this.min)},expandByPoint:function(point){this.min.min(point);this.max.max(point);return this},expandByVector:function(vector){this.min.sub(vector);this.max.add(vector);return this},expandByScalar:function(scalar){this.min.addScalar(-scalar);this.max.addScalar(scalar);return this},containsPoint:function(point){if(point.x<this.min.x||point.x>this.max.x||point.y<this.min.y||point.y>this.max.y){return false}return true},containsBox:function(box){if(this.min.x<=box.min.x&&box.max.x<=this.max.x&&this.min.y<=box.min.y&&box.max.y<=this.max.y){return true}return false},getParameter:function(point,optionalTarget){var result=optionalTarget||new THREE.Vector2;return result.set((point.x-this.min.x)/(this.max.x-this.min.x),(point.y-this.min.y)/(this.max.y-this.min.y))},isIntersectionBox:function(box){if(box.max.x<this.min.x||box.min.x>this.max.x||box.max.y<this.min.y||box.min.y>this.max.y){return false}return true},clampPoint:function(point,optionalTarget){var result=optionalTarget||new THREE.Vector2;return result.copy(point).clamp(this.min,this.max)},distanceToPoint:function(){var v1=new THREE.Vector2;return function(point){var clampedPoint=v1.copy(point).clamp(this.min,this.max);return clampedPoint.sub(point).length()}}(),intersect:function(box){this.min.max(box.min);this.max.min(box.max);return this},union:function(box){this.min.min(box.min);this.max.max(box.max);return this},translate:function(offset){this.min.add(offset);this.max.add(offset);return this},equals:function(box){return box.min.equals(this.min)&&box.max.equals(this.max)},clone:function(){return(new THREE.Box2).copy(this)}};THREE.Box3=function(min,max){this.min=min!==undefined?min:new THREE.Vector3(Infinity,Infinity,Infinity);this.max=max!==undefined?max:new THREE.Vector3(-Infinity,-Infinity,-Infinity)};THREE.Box3.prototype={constructor:THREE.Box3,set:function(min,max){this.min.copy(min);this.max.copy(max);return this},setFromPoints:function(points){this.makeEmpty();for(var i=0,il=points.length;i<il;i++){this.expandByPoint(points[i])}return this},setFromCenterAndSize:function(){var v1=new THREE.Vector3;return function(center,size){var halfSize=v1.copy(size).multiplyScalar(.5);this.min.copy(center).sub(halfSize);this.max.copy(center).add(halfSize);return this}}(),setFromObject:function(){var v1=new THREE.Vector3;return function(object){var scope=this;object.updateMatrixWorld(true);this.makeEmpty();object.traverse(function(node){var geometry=node.geometry;if(geometry!==undefined){if(geometry instanceof THREE.Geometry){var vertices=geometry.vertices;for(var i=0,il=vertices.length;i<il;i++){v1.copy(vertices[i]);v1.applyMatrix4(node.matrixWorld);scope.expandByPoint(v1)}}else if(geometry instanceof THREE.BufferGeometry&&geometry.attributes["position"]!==undefined){var positions=geometry.attributes["position"].array;for(var i=0,il=positions.length;i<il;i+=3){v1.set(positions[i],positions[i+1],positions[i+2]);v1.applyMatrix4(node.matrixWorld);scope.expandByPoint(v1)}}}});return this}}(),copy:function(box){this.min.copy(box.min);this.max.copy(box.max);return this},makeEmpty:function(){this.min.x=this.min.y=this.min.z=Infinity;this.max.x=this.max.y=this.max.z=-Infinity;return this},empty:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z},center:function(optionalTarget){var result=optionalTarget||new THREE.Vector3;return result.addVectors(this.min,this.max).multiplyScalar(.5)},size:function(optionalTarget){var result=optionalTarget||new THREE.Vector3;return result.subVectors(this.max,this.min)},expandByPoint:function(point){this.min.min(point);this.max.max(point);return this},expandByVector:function(vector){this.min.sub(vector);this.max.add(vector);return this},expandByScalar:function(scalar){this.min.addScalar(-scalar);this.max.addScalar(scalar);return this},containsPoint:function(point){if(point.x<this.min.x||point.x>this.max.x||point.y<this.min.y||point.y>this.max.y||point.z<this.min.z||point.z>this.max.z){return false}return true},containsBox:function(box){if(this.min.x<=box.min.x&&box.max.x<=this.max.x&&this.min.y<=box.min.y&&box.max.y<=this.max.y&&this.min.z<=box.min.z&&box.max.z<=this.max.z){return true}return false},getParameter:function(point,optionalTarget){var result=optionalTarget||new THREE.Vector3;return result.set((point.x-this.min.x)/(this.max.x-this.min.x),(point.y-this.min.y)/(this.max.y-this.min.y),(point.z-this.min.z)/(this.max.z-this.min.z))},isIntersectionBox:function(box){if(box.max.x<this.min.x||box.min.x>this.max.x||box.max.y<this.min.y||box.min.y>this.max.y||box.max.z<this.min.z||box.min.z>this.max.z){return false}return true},clampPoint:function(point,optionalTarget){var result=optionalTarget||new THREE.Vector3;return result.copy(point).clamp(this.min,this.max)},distanceToPoint:function(){var v1=new THREE.Vector3;return function(point){var clampedPoint=v1.copy(point).clamp(this.min,this.max);return clampedPoint.sub(point).length()}}(),getBoundingSphere:function(){var v1=new THREE.Vector3;return function(optionalTarget){var result=optionalTarget||new THREE.Sphere;result.center=this.center();result.radius=this.size(v1).length()*.5;return result}}(),intersect:function(box){this.min.max(box.min);this.max.min(box.max);return this},union:function(box){this.min.min(box.min);this.max.max(box.max);return this},applyMatrix4:function(){var points=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3];return function(matrix){points[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(matrix);points[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(matrix);points[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(matrix);points[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(matrix);points[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(matrix);points[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(matrix);points[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(matrix);points[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(matrix);this.makeEmpty();this.setFromPoints(points);return this}}(),translate:function(offset){this.min.add(offset);this.max.add(offset);return this},equals:function(box){return box.min.equals(this.min)&&box.max.equals(this.max)},clone:function(){return(new THREE.Box3).copy(this)}};THREE.Matrix3=function(){this.elements=new Float32Array([1,0,0,0,1,0,0,0,1]);if(arguments.length>0){console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")}};THREE.Matrix3.prototype={constructor:THREE.Matrix3,set:function(n11,n12,n13,n21,n22,n23,n31,n32,n33){var te=this.elements;te[0]=n11;te[3]=n12;te[6]=n13;te[1]=n21;te[4]=n22;te[7]=n23;te[2]=n31;te[5]=n32;te[8]=n33;return this},identity:function(){this.set(1,0,0,0,1,0,0,0,1);return this},copy:function(m){var me=m.elements;this.set(me[0],me[3],me[6],me[1],me[4],me[7],me[2],me[5],me[8]);return this},multiplyVector3:function(vector){console.warn("THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead.");return vector.applyMatrix3(this)},multiplyVector3Array:function(a){console.warn("THREE.Matrix3: .multiplyVector3Array() has been renamed. Use matrix.applyToVector3Array( array ) instead.");return this.applyToVector3Array(a)},applyToVector3Array:function(){var v1=new THREE.Vector3;return function(array,offset,length){if(offset===undefined)offset=0;if(length===undefined)length=array.length;for(var i=0,j=offset,il;i<length;i+=3,j+=3){v1.x=array[j];v1.y=array[j+1];v1.z=array[j+2];v1.applyMatrix3(this);array[j]=v1.x;array[j+1]=v1.y;array[j+2]=v1.z}return array}}(),multiplyScalar:function(s){var te=this.elements;te[0]*=s;te[3]*=s;te[6]*=s;te[1]*=s;te[4]*=s;te[7]*=s;te[2]*=s;te[5]*=s;te[8]*=s;return this},determinant:function(){var te=this.elements;var a=te[0],b=te[1],c=te[2],d=te[3],e=te[4],f=te[5],g=te[6],h=te[7],i=te[8];return a*e*i-a*f*h-b*d*i+b*f*g+c*d*h-c*e*g},getInverse:function(matrix,throwOnInvertible){var me=matrix.elements;var te=this.elements;te[0]=me[10]*me[5]-me[6]*me[9];te[1]=-me[10]*me[1]+me[2]*me[9];te[2]=me[6]*me[1]-me[2]*me[5];te[3]=-me[10]*me[4]+me[6]*me[8];te[4]=me[10]*me[0]-me[2]*me[8];te[5]=-me[6]*me[0]+me[2]*me[4];te[6]=me[9]*me[4]-me[5]*me[8];te[7]=-me[9]*me[0]+me[1]*me[8];te[8]=me[5]*me[0]-me[1]*me[4];var det=me[0]*te[0]+me[1]*te[3]+me[2]*te[6];if(det===0){var msg="Matrix3.getInverse(): can't invert matrix, determinant is 0";if(throwOnInvertible||false){throw new Error(msg)}else{console.warn(msg)}this.identity();return this}this.multiplyScalar(1/det);return this},transpose:function(){var tmp,m=this.elements;tmp=m[1];m[1]=m[3];m[3]=tmp;tmp=m[2];m[2]=m[6];m[6]=tmp;tmp=m[5];m[5]=m[7];m[7]=tmp;return this},flattenToArrayOffset:function(array,offset){var te=this.elements;array[offset]=te[0];array[offset+1]=te[1];array[offset+2]=te[2];array[offset+3]=te[3];array[offset+4]=te[4];array[offset+5]=te[5];array[offset+6]=te[6];array[offset+7]=te[7];array[offset+8]=te[8];return array},getNormalMatrix:function(m){this.getInverse(m).transpose();return this},transposeIntoArray:function(r){var m=this.elements;
r[0]=m[0];r[1]=m[3];r[2]=m[6];r[3]=m[1];r[4]=m[4];r[5]=m[7];r[6]=m[2];r[7]=m[5];r[8]=m[8];return this},fromArray:function(array){this.elements.set(array);return this},toArray:function(){var te=this.elements;return[te[0],te[1],te[2],te[3],te[4],te[5],te[6],te[7],te[8]]},clone:function(){return(new THREE.Matrix3).fromArray(this.elements)}};THREE.Matrix4=function(){this.elements=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);if(arguments.length>0){console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")}};THREE.Matrix4.prototype={constructor:THREE.Matrix4,set:function(n11,n12,n13,n14,n21,n22,n23,n24,n31,n32,n33,n34,n41,n42,n43,n44){var te=this.elements;te[0]=n11;te[4]=n12;te[8]=n13;te[12]=n14;te[1]=n21;te[5]=n22;te[9]=n23;te[13]=n24;te[2]=n31;te[6]=n32;te[10]=n33;te[14]=n34;te[3]=n41;te[7]=n42;te[11]=n43;te[15]=n44;return this},identity:function(){this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1);return this},copy:function(m){this.elements.set(m.elements);return this},extractPosition:function(m){console.warn("THREE.Matrix4: .extractPosition() has been renamed to .copyPosition().");return this.copyPosition(m)},copyPosition:function(m){var te=this.elements;var me=m.elements;te[12]=me[12];te[13]=me[13];te[14]=me[14];return this},extractRotation:function(){var v1=new THREE.Vector3;return function(m){var te=this.elements;var me=m.elements;var scaleX=1/v1.set(me[0],me[1],me[2]).length();var scaleY=1/v1.set(me[4],me[5],me[6]).length();var scaleZ=1/v1.set(me[8],me[9],me[10]).length();te[0]=me[0]*scaleX;te[1]=me[1]*scaleX;te[2]=me[2]*scaleX;te[4]=me[4]*scaleY;te[5]=me[5]*scaleY;te[6]=me[6]*scaleY;te[8]=me[8]*scaleZ;te[9]=me[9]*scaleZ;te[10]=me[10]*scaleZ;return this}}(),makeRotationFromEuler:function(euler){if(euler instanceof THREE.Euler===false){console.error("THREE.Matrix: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.")}var te=this.elements;var x=euler.x,y=euler.y,z=euler.z;var a=Math.cos(x),b=Math.sin(x);var c=Math.cos(y),d=Math.sin(y);var e=Math.cos(z),f=Math.sin(z);if(euler.order==="XYZ"){var ae=a*e,af=a*f,be=b*e,bf=b*f;te[0]=c*e;te[4]=-c*f;te[8]=d;te[1]=af+be*d;te[5]=ae-bf*d;te[9]=-b*c;te[2]=bf-ae*d;te[6]=be+af*d;te[10]=a*c}else if(euler.order==="YXZ"){var ce=c*e,cf=c*f,de=d*e,df=d*f;te[0]=ce+df*b;te[4]=de*b-cf;te[8]=a*d;te[1]=a*f;te[5]=a*e;te[9]=-b;te[2]=cf*b-de;te[6]=df+ce*b;te[10]=a*c}else if(euler.order==="ZXY"){var ce=c*e,cf=c*f,de=d*e,df=d*f;te[0]=ce-df*b;te[4]=-a*f;te[8]=de+cf*b;te[1]=cf+de*b;te[5]=a*e;te[9]=df-ce*b;te[2]=-a*d;te[6]=b;te[10]=a*c}else if(euler.order==="ZYX"){var ae=a*e,af=a*f,be=b*e,bf=b*f;te[0]=c*e;te[4]=be*d-af;te[8]=ae*d+bf;te[1]=c*f;te[5]=bf*d+ae;te[9]=af*d-be;te[2]=-d;te[6]=b*c;te[10]=a*c}else if(euler.order==="YZX"){var ac=a*c,ad=a*d,bc=b*c,bd=b*d;te[0]=c*e;te[4]=bd-ac*f;te[8]=bc*f+ad;te[1]=f;te[5]=a*e;te[9]=-b*e;te[2]=-d*e;te[6]=ad*f+bc;te[10]=ac-bd*f}else if(euler.order==="XZY"){var ac=a*c,ad=a*d,bc=b*c,bd=b*d;te[0]=c*e;te[4]=-f;te[8]=d*e;te[1]=ac*f+bd;te[5]=a*e;te[9]=ad*f-bc;te[2]=bc*f-ad;te[6]=b*e;te[10]=bd*f+ac}te[3]=0;te[7]=0;te[11]=0;te[12]=0;te[13]=0;te[14]=0;te[15]=1;return this},setRotationFromQuaternion:function(q){console.warn("THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion().");return this.makeRotationFromQuaternion(q)},makeRotationFromQuaternion:function(q){var te=this.elements;var x=q.x,y=q.y,z=q.z,w=q.w;var x2=x+x,y2=y+y,z2=z+z;var xx=x*x2,xy=x*y2,xz=x*z2;var yy=y*y2,yz=y*z2,zz=z*z2;var wx=w*x2,wy=w*y2,wz=w*z2;te[0]=1-(yy+zz);te[4]=xy-wz;te[8]=xz+wy;te[1]=xy+wz;te[5]=1-(xx+zz);te[9]=yz-wx;te[2]=xz-wy;te[6]=yz+wx;te[10]=1-(xx+yy);te[3]=0;te[7]=0;te[11]=0;te[12]=0;te[13]=0;te[14]=0;te[15]=1;return this},lookAt:function(){var x=new THREE.Vector3;var y=new THREE.Vector3;var z=new THREE.Vector3;return function(eye,target,up){var te=this.elements;z.subVectors(eye,target).normalize();if(z.length()===0){z.z=1}x.crossVectors(up,z).normalize();if(x.length()===0){z.x+=1e-4;x.crossVectors(up,z).normalize()}y.crossVectors(z,x);te[0]=x.x;te[4]=y.x;te[8]=z.x;te[1]=x.y;te[5]=y.y;te[9]=z.y;te[2]=x.z;te[6]=y.z;te[10]=z.z;return this}}(),multiply:function(m,n){if(n!==undefined){console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead.");return this.multiplyMatrices(m,n)}return this.multiplyMatrices(this,m)},multiplyMatrices:function(a,b){var ae=a.elements;var be=b.elements;var te=this.elements;var a11=ae[0],a12=ae[4],a13=ae[8],a14=ae[12];var a21=ae[1],a22=ae[5],a23=ae[9],a24=ae[13];var a31=ae[2],a32=ae[6],a33=ae[10],a34=ae[14];var a41=ae[3],a42=ae[7],a43=ae[11],a44=ae[15];var b11=be[0],b12=be[4],b13=be[8],b14=be[12];var b21=be[1],b22=be[5],b23=be[9],b24=be[13];var b31=be[2],b32=be[6],b33=be[10],b34=be[14];var b41=be[3],b42=be[7],b43=be[11],b44=be[15];te[0]=a11*b11+a12*b21+a13*b31+a14*b41;te[4]=a11*b12+a12*b22+a13*b32+a14*b42;te[8]=a11*b13+a12*b23+a13*b33+a14*b43;te[12]=a11*b14+a12*b24+a13*b34+a14*b44;te[1]=a21*b11+a22*b21+a23*b31+a24*b41;te[5]=a21*b12+a22*b22+a23*b32+a24*b42;te[9]=a21*b13+a22*b23+a23*b33+a24*b43;te[13]=a21*b14+a22*b24+a23*b34+a24*b44;te[2]=a31*b11+a32*b21+a33*b31+a34*b41;te[6]=a31*b12+a32*b22+a33*b32+a34*b42;te[10]=a31*b13+a32*b23+a33*b33+a34*b43;te[14]=a31*b14+a32*b24+a33*b34+a34*b44;te[3]=a41*b11+a42*b21+a43*b31+a44*b41;te[7]=a41*b12+a42*b22+a43*b32+a44*b42;te[11]=a41*b13+a42*b23+a43*b33+a44*b43;te[15]=a41*b14+a42*b24+a43*b34+a44*b44;return this},multiplyToArray:function(a,b,r){var te=this.elements;this.multiplyMatrices(a,b);r[0]=te[0];r[1]=te[1];r[2]=te[2];r[3]=te[3];r[4]=te[4];r[5]=te[5];r[6]=te[6];r[7]=te[7];r[8]=te[8];r[9]=te[9];r[10]=te[10];r[11]=te[11];r[12]=te[12];r[13]=te[13];r[14]=te[14];r[15]=te[15];return this},multiplyScalar:function(s){var te=this.elements;te[0]*=s;te[4]*=s;te[8]*=s;te[12]*=s;te[1]*=s;te[5]*=s;te[9]*=s;te[13]*=s;te[2]*=s;te[6]*=s;te[10]*=s;te[14]*=s;te[3]*=s;te[7]*=s;te[11]*=s;te[15]*=s;return this},multiplyVector3:function(vector){console.warn("THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) or vector.applyProjection( matrix ) instead.");return vector.applyProjection(this)},multiplyVector4:function(vector){console.warn("THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead.");return vector.applyMatrix4(this)},multiplyVector3Array:function(a){console.warn("THREE.Matrix4: .multiplyVector3Array() has been renamed. Use matrix.applyToVector3Array( array ) instead.");return this.applyToVector3Array(a)},applyToVector3Array:function(){var v1=new THREE.Vector3;return function(array,offset,length){if(offset===undefined)offset=0;if(length===undefined)length=array.length;for(var i=0,j=offset,il;i<length;i+=3,j+=3){v1.x=array[j];v1.y=array[j+1];v1.z=array[j+2];v1.applyMatrix4(this);array[j]=v1.x;array[j+1]=v1.y;array[j+2]=v1.z}return array}}(),rotateAxis:function(v){console.warn("THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead.");v.transformDirection(this)},crossVector:function(vector){console.warn("THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead.");return vector.applyMatrix4(this)},determinant:function(){var te=this.elements;var n11=te[0],n12=te[4],n13=te[8],n14=te[12];var n21=te[1],n22=te[5],n23=te[9],n24=te[13];var n31=te[2],n32=te[6],n33=te[10],n34=te[14];var n41=te[3],n42=te[7],n43=te[11],n44=te[15];return n41*(+n14*n23*n32-n13*n24*n32-n14*n22*n33+n12*n24*n33+n13*n22*n34-n12*n23*n34)+n42*(+n11*n23*n34-n11*n24*n33+n14*n21*n33-n13*n21*n34+n13*n24*n31-n14*n23*n31)+n43*(+n11*n24*n32-n11*n22*n34-n14*n21*n32+n12*n21*n34+n14*n22*n31-n12*n24*n31)+n44*(-n13*n22*n31-n11*n23*n32+n11*n22*n33+n13*n21*n32-n12*n21*n33+n12*n23*n31)},transpose:function(){var te=this.elements;var tmp;tmp=te[1];te[1]=te[4];te[4]=tmp;tmp=te[2];te[2]=te[8];te[8]=tmp;tmp=te[6];te[6]=te[9];te[9]=tmp;tmp=te[3];te[3]=te[12];te[12]=tmp;tmp=te[7];te[7]=te[13];te[13]=tmp;tmp=te[11];te[11]=te[14];te[14]=tmp;return this},flattenToArrayOffset:function(array,offset){var te=this.elements;array[offset]=te[0];array[offset+1]=te[1];array[offset+2]=te[2];array[offset+3]=te[3];array[offset+4]=te[4];array[offset+5]=te[5];array[offset+6]=te[6];array[offset+7]=te[7];array[offset+8]=te[8];array[offset+9]=te[9];array[offset+10]=te[10];array[offset+11]=te[11];array[offset+12]=te[12];array[offset+13]=te[13];array[offset+14]=te[14];array[offset+15]=te[15];return array},getPosition:function(){var v1=new THREE.Vector3;return function(){console.warn("THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead.");var te=this.elements;return v1.set(te[12],te[13],te[14])}}(),setPosition:function(v){var te=this.elements;te[12]=v.x;te[13]=v.y;te[14]=v.z;return this},getInverse:function(m,throwOnInvertible){var te=this.elements;var me=m.elements;var n11=me[0],n12=me[4],n13=me[8],n14=me[12];var n21=me[1],n22=me[5],n23=me[9],n24=me[13];var n31=me[2],n32=me[6],n33=me[10],n34=me[14];var n41=me[3],n42=me[7],n43=me[11],n44=me[15];te[0]=n23*n34*n42-n24*n33*n42+n24*n32*n43-n22*n34*n43-n23*n32*n44+n22*n33*n44;te[4]=n14*n33*n42-n13*n34*n42-n14*n32*n43+n12*n34*n43+n13*n32*n44-n12*n33*n44;te[8]=n13*n24*n42-n14*n23*n42+n14*n22*n43-n12*n24*n43-n13*n22*n44+n12*n23*n44;te[12]=n14*n23*n32-n13*n24*n32-n14*n22*n33+n12*n24*n33+n13*n22*n34-n12*n23*n34;te[1]=n24*n33*n41-n23*n34*n41-n24*n31*n43+n21*n34*n43+n23*n31*n44-n21*n33*n44;te[5]=n13*n34*n41-n14*n33*n41+n14*n31*n43-n11*n34*n43-n13*n31*n44+n11*n33*n44;te[9]=n14*n23*n41-n13*n24*n41-n14*n21*n43+n11*n24*n43+n13*n21*n44-n11*n23*n44;te[13]=n13*n24*n31-n14*n23*n31+n14*n21*n33-n11*n24*n33-n13*n21*n34+n11*n23*n34;te[2]=n22*n34*n41-n24*n32*n41+n24*n31*n42-n21*n34*n42-n22*n31*n44+n21*n32*n44;te[6]=n14*n32*n41-n12*n34*n41-n14*n31*n42+n11*n34*n42+n12*n31*n44-n11*n32*n44;te[10]=n12*n24*n41-n14*n22*n41+n14*n21*n42-n11*n24*n42-n12*n21*n44+n11*n22*n44;te[14]=n14*n22*n31-n12*n24*n31-n14*n21*n32+n11*n24*n32+n12*n21*n34-n11*n22*n34;te[3]=n23*n32*n41-n22*n33*n41-n23*n31*n42+n21*n33*n42+n22*n31*n43-n21*n32*n43;te[7]=n12*n33*n41-n13*n32*n41+n13*n31*n42-n11*n33*n42-n12*n31*n43+n11*n32*n43;te[11]=n13*n22*n41-n12*n23*n41-n13*n21*n42+n11*n23*n42+n12*n21*n43-n11*n22*n43;te[15]=n12*n23*n31-n13*n22*n31+n13*n21*n32-n11*n23*n32-n12*n21*n33+n11*n22*n33;var det=n11*te[0]+n21*te[4]+n31*te[8]+n41*te[12];if(det==0){var msg="Matrix4.getInverse(): can't invert matrix, determinant is 0";if(throwOnInvertible||false){throw new Error(msg)}else{console.warn(msg)}this.identity();return this}this.multiplyScalar(1/det);return this},translate:function(v){console.warn("THREE.Matrix4: .translate() has been removed.")},rotateX:function(angle){console.warn("THREE.Matrix4: .rotateX() has been removed.")},rotateY:function(angle){console.warn("THREE.Matrix4: .rotateY() has been removed.")},rotateZ:function(angle){console.warn("THREE.Matrix4: .rotateZ() has been removed.")},rotateByAxis:function(axis,angle){console.warn("THREE.Matrix4: .rotateByAxis() has been removed.")},scale:function(v){var te=this.elements;var x=v.x,y=v.y,z=v.z;te[0]*=x;te[4]*=y;te[8]*=z;te[1]*=x;te[5]*=y;te[9]*=z;te[2]*=x;te[6]*=y;te[10]*=z;te[3]*=x;te[7]*=y;te[11]*=z;return this},getMaxScaleOnAxis:function(){var te=this.elements;var scaleXSq=te[0]*te[0]+te[1]*te[1]+te[2]*te[2];var scaleYSq=te[4]*te[4]+te[5]*te[5]+te[6]*te[6];var scaleZSq=te[8]*te[8]+te[9]*te[9]+te[10]*te[10];return Math.sqrt(Math.max(scaleXSq,Math.max(scaleYSq,scaleZSq)))},makeTranslation:function(x,y,z){this.set(1,0,0,x,0,1,0,y,0,0,1,z,0,0,0,1);return this},makeRotationX:function(theta){var c=Math.cos(theta),s=Math.sin(theta);this.set(1,0,0,0,0,c,-s,0,0,s,c,0,0,0,0,1);return this},makeRotationY:function(theta){var c=Math.cos(theta),s=Math.sin(theta);this.set(c,0,s,0,0,1,0,0,-s,0,c,0,0,0,0,1);return this},makeRotationZ:function(theta){var c=Math.cos(theta),s=Math.sin(theta);this.set(c,-s,0,0,s,c,0,0,0,0,1,0,0,0,0,1);return this},makeRotationAxis:function(axis,angle){var c=Math.cos(angle);var s=Math.sin(angle);var t=1-c;var x=axis.x,y=axis.y,z=axis.z;var tx=t*x,ty=t*y;this.set(tx*x+c,tx*y-s*z,tx*z+s*y,0,tx*y+s*z,ty*y+c,ty*z-s*x,0,tx*z-s*y,ty*z+s*x,t*z*z+c,0,0,0,0,1);return this},makeScale:function(x,y,z){this.set(x,0,0,0,0,y,0,0,0,0,z,0,0,0,0,1);return this},compose:function(position,quaternion,scale){this.makeRotationFromQuaternion(quaternion);this.scale(scale);this.setPosition(position);return this},decompose:function(){var vector=new THREE.Vector3;var matrix=new THREE.Matrix4;return function(position,quaternion,scale){var te=this.elements;var sx=vector.set(te[0],te[1],te[2]).length();var sy=vector.set(te[4],te[5],te[6]).length();var sz=vector.set(te[8],te[9],te[10]).length();var det=this.determinant();if(det<0){sx=-sx}position.x=te[12];position.y=te[13];position.z=te[14];matrix.elements.set(this.elements);var invSX=1/sx;var invSY=1/sy;var invSZ=1/sz;matrix.elements[0]*=invSX;matrix.elements[1]*=invSX;matrix.elements[2]*=invSX;matrix.elements[4]*=invSY;matrix.elements[5]*=invSY;matrix.elements[6]*=invSY;matrix.elements[8]*=invSZ;matrix.elements[9]*=invSZ;matrix.elements[10]*=invSZ;quaternion.setFromRotationMatrix(matrix);scale.x=sx;scale.y=sy;scale.z=sz;return this}}(),makeFrustum:function(left,right,bottom,top,near,far){var te=this.elements;var x=2*near/(right-left);var y=2*near/(top-bottom);var a=(right+left)/(right-left);var b=(top+bottom)/(top-bottom);var c=-(far+near)/(far-near);var d=-2*far*near/(far-near);te[0]=x;te[4]=0;te[8]=a;te[12]=0;te[1]=0;te[5]=y;te[9]=b;te[13]=0;te[2]=0;te[6]=0;te[10]=c;te[14]=d;te[3]=0;te[7]=0;te[11]=-1;te[15]=0;return this},makePerspective:function(fov,aspect,near,far){var ymax=near*Math.tan(THREE.Math.degToRad(fov*.5));var ymin=-ymax;var xmin=ymin*aspect;var xmax=ymax*aspect;return this.makeFrustum(xmin,xmax,ymin,ymax,near,far)},makeOrthographic:function(left,right,top,bottom,near,far){var te=this.elements;var w=right-left;var h=top-bottom;var p=far-near;var x=(right+left)/w;var y=(top+bottom)/h;var z=(far+near)/p;te[0]=2/w;te[4]=0;te[8]=0;te[12]=-x;te[1]=0;te[5]=2/h;te[9]=0;te[13]=-y;te[2]=0;te[6]=0;te[10]=-2/p;te[14]=-z;te[3]=0;te[7]=0;te[11]=0;te[15]=1;return this},fromArray:function(array){this.elements.set(array);return this},toArray:function(){var te=this.elements;return[te[0],te[1],te[2],te[3],te[4],te[5],te[6],te[7],te[8],te[9],te[10],te[11],te[12],te[13],te[14],te[15]]},clone:function(){return(new THREE.Matrix4).fromArray(this.elements)}};THREE.Ray=function(origin,direction){this.origin=origin!==undefined?origin:new THREE.Vector3;this.direction=direction!==undefined?direction:new THREE.Vector3};THREE.Ray.prototype={constructor:THREE.Ray,set:function(origin,direction){this.origin.copy(origin);this.direction.copy(direction);return this},copy:function(ray){this.origin.copy(ray.origin);this.direction.copy(ray.direction);return this},at:function(t,optionalTarget){var result=optionalTarget||new THREE.Vector3;return result.copy(this.direction).multiplyScalar(t).add(this.origin)},recast:function(){var v1=new THREE.Vector3;return function(t){this.origin.copy(this.at(t,v1));return this}}(),closestPointToPoint:function(point,optionalTarget){var result=optionalTarget||new THREE.Vector3;result.subVectors(point,this.origin);var directionDistance=result.dot(this.direction);if(directionDistance<0){return result.copy(this.origin)}return result.copy(this.direction).multiplyScalar(directionDistance).add(this.origin)},distanceToPoint:function(){var v1=new THREE.Vector3;return function(point){var directionDistance=v1.subVectors(point,this.origin).dot(this.direction);if(directionDistance<0){return this.origin.distanceTo(point)}v1.copy(this.direction).multiplyScalar(directionDistance).add(this.origin);return v1.distanceTo(point)}}(),distanceSqToSegment:function(v0,v1,optionalPointOnRay,optionalPointOnSegment){var segCenter=v0.clone().add(v1).multiplyScalar(.5);var segDir=v1.clone().sub(v0).normalize();var segExtent=v0.distanceTo(v1)*.5;var diff=this.origin.clone().sub(segCenter);var a01=-this.direction.dot(segDir);var b0=diff.dot(this.direction);var b1=-diff.dot(segDir);var c=diff.lengthSq();var det=Math.abs(1-a01*a01);var s0,s1,sqrDist,extDet;if(det>=0){s0=a01*b1-b0;s1=a01*b0-b1;extDet=segExtent*det;if(s0>=0){if(s1>=-extDet){if(s1<=extDet){var invDet=1/det;s0*=invDet;s1*=invDet;sqrDist=s0*(s0+a01*s1+2*b0)+s1*(a01*s0+s1+2*b1)+c}else{s1=segExtent;s0=Math.max(0,-(a01*s1+b0));sqrDist=-s0*s0+s1*(s1+2*b1)+c}}else{s1=-segExtent;s0=Math.max(0,-(a01*s1+b0));sqrDist=-s0*s0+s1*(s1+2*b1)+c}}else{if(s1<=-extDet){s0=Math.max(0,-(-a01*segExtent+b0));s1=s0>0?-segExtent:Math.min(Math.max(-segExtent,-b1),segExtent);sqrDist=-s0*s0+s1*(s1+2*b1)+c}else if(s1<=extDet){s0=0;s1=Math.min(Math.max(-segExtent,-b1),segExtent);sqrDist=s1*(s1+2*b1)+c}else{s0=Math.max(0,-(a01*segExtent+b0));s1=s0>0?segExtent:Math.min(Math.max(-segExtent,-b1),segExtent);sqrDist=-s0*s0+s1*(s1+2*b1)+c}}}else{s1=a01>0?-segExtent:segExtent;s0=Math.max(0,-(a01*s1+b0));sqrDist=-s0*s0+s1*(s1+2*b1)+c}if(optionalPointOnRay){optionalPointOnRay.copy(this.direction.clone().multiplyScalar(s0).add(this.origin))}if(optionalPointOnSegment){optionalPointOnSegment.copy(segDir.clone().multiplyScalar(s1).add(segCenter))}return sqrDist},isIntersectionSphere:function(sphere){return this.distanceToPoint(sphere.center)<=sphere.radius},intersectSphere:function(){var v1=new THREE.Vector3;return function(sphere,optionalTarget){v1.subVectors(sphere.center,this.origin);var tca=v1.dot(this.direction);var d2=v1.dot(v1)-tca*tca;var radius2=sphere.radius*sphere.radius;if(d2>radius2)return null;var thc=Math.sqrt(radius2-d2);var t0=tca-thc;var t1=tca+thc;if(t0<0&&t1<0)return null;if(t0<0)return this.at(t1,optionalTarget);return this.at(t0,optionalTarget)}}(),isIntersectionPlane:function(plane){var distToPoint=plane.distanceToPoint(this.origin);if(distToPoint===0){return true}var denominator=plane.normal.dot(this.direction);if(denominator*distToPoint<0){return true}return false},distanceToPlane:function(plane){var denominator=plane.normal.dot(this.direction);if(denominator==0){if(plane.distanceToPoint(this.origin)==0){return 0}return null}var t=-(this.origin.dot(plane.normal)+plane.constant)/denominator;return t>=0?t:null},intersectPlane:function(plane,optionalTarget){var t=this.distanceToPlane(plane);if(t===null){return null}return this.at(t,optionalTarget)},isIntersectionBox:function(){var v=new THREE.Vector3;return function(box){return this.intersectBox(box,v)!==null}}(),intersectBox:function(box,optionalTarget){var tmin,tmax,tymin,tymax,tzmin,tzmax;var invdirx=1/this.direction.x,invdiry=1/this.direction.y,invdirz=1/this.direction.z;var origin=this.origin;if(invdirx>=0){tmin=(box.min.x-origin.x)*invdirx;tmax=(box.max.x-origin.x)*invdirx}else{tmin=(box.max.x-origin.x)*invdirx;tmax=(box.min.x-origin.x)*invdirx}if(invdiry>=0){tymin=(box.min.y-origin.y)*invdiry;tymax=(box.max.y-origin.y)*invdiry}else{tymin=(box.max.y-origin.y)*invdiry;tymax=(box.min.y-origin.y)*invdiry}if(tmin>tymax||tymin>tmax)return null;if(tymin>tmin||tmin!==tmin)tmin=tymin;if(tymax<tmax||tmax!==tmax)tmax=tymax;if(invdirz>=0){tzmin=(box.min.z-origin.z)*invdirz;tzmax=(box.max.z-origin.z)*invdirz}else{tzmin=(box.max.z-origin.z)*invdirz;tzmax=(box.min.z-origin.z)*invdirz}if(tmin>tzmax||tzmin>tmax)return null;if(tzmin>tmin||tmin!==tmin)tmin=tzmin;if(tzmax<tmax||tmax!==tmax)tmax=tzmax;if(tmax<0)return null;return this.at(tmin>=0?tmin:tmax,optionalTarget)},intersectTriangle:function(){var diff=new THREE.Vector3;var edge1=new THREE.Vector3;var edge2=new THREE.Vector3;var normal=new THREE.Vector3;return function(a,b,c,backfaceCulling,optionalTarget){edge1.subVectors(b,a);edge2.subVectors(c,a);normal.crossVectors(edge1,edge2);var DdN=this.direction.dot(normal);var sign;if(DdN>0){if(backfaceCulling)return null;sign=1}else if(DdN<0){sign=-1;DdN=-DdN}else{return null}diff.subVectors(this.origin,a);var DdQxE2=sign*this.direction.dot(edge2.crossVectors(diff,edge2));if(DdQxE2<0){return null}var DdE1xQ=sign*this.direction.dot(edge1.cross(diff));if(DdE1xQ<0){return null}if(DdQxE2+DdE1xQ>DdN){return null}var QdN=-sign*diff.dot(normal);if(QdN<0){return null}return this.at(QdN/DdN,optionalTarget)}}(),applyMatrix4:function(matrix4){this.direction.add(this.origin).applyMatrix4(matrix4);this.origin.applyMatrix4(matrix4);this.direction.sub(this.origin);this.direction.normalize();return this},equals:function(ray){return ray.origin.equals(this.origin)&&ray.direction.equals(this.direction)},clone:function(){return(new THREE.Ray).copy(this)}};THREE.Sphere=function(center,radius){this.center=center!==undefined?center:new THREE.Vector3;this.radius=radius!==undefined?radius:0};THREE.Sphere.prototype={constructor:THREE.Sphere,set:function(center,radius){this.center.copy(center);this.radius=radius;return this},setFromPoints:function(){var box=new THREE.Box3;return function(points,optionalCenter){var center=this.center;if(optionalCenter!==undefined){center.copy(optionalCenter)}else{box.setFromPoints(points).center(center)}var maxRadiusSq=0;for(var i=0,il=points.length;i<il;i++){maxRadiusSq=Math.max(maxRadiusSq,center.distanceToSquared(points[i]))}this.radius=Math.sqrt(maxRadiusSq);return this}}(),copy:function(sphere){this.center.copy(sphere.center);this.radius=sphere.radius;return this},empty:function(){return this.radius<=0},containsPoint:function(point){return point.distanceToSquared(this.center)<=this.radius*this.radius},distanceToPoint:function(point){return point.distanceTo(this.center)-this.radius},intersectsSphere:function(sphere){var radiusSum=this.radius+sphere.radius;return sphere.center.distanceToSquared(this.center)<=radiusSum*radiusSum},clampPoint:function(point,optionalTarget){var deltaLengthSq=this.center.distanceToSquared(point);var result=optionalTarget||new THREE.Vector3;result.copy(point);if(deltaLengthSq>this.radius*this.radius){result.sub(this.center).normalize();result.multiplyScalar(this.radius).add(this.center)}return result},getBoundingBox:function(optionalTarget){var box=optionalTarget||new THREE.Box3;box.set(this.center,this.center);box.expandByScalar(this.radius);return box},applyMatrix4:function(matrix){this.center.applyMatrix4(matrix);this.radius=this.radius*matrix.getMaxScaleOnAxis();return this},translate:function(offset){this.center.add(offset);return this},equals:function(sphere){return sphere.center.equals(this.center)&&sphere.radius===this.radius},clone:function(){return(new THREE.Sphere).copy(this)}};THREE.Frustum=function(p0,p1,p2,p3,p4,p5){this.planes=[p0!==undefined?p0:new THREE.Plane,p1!==undefined?p1:new THREE.Plane,p2!==undefined?p2:new THREE.Plane,p3!==undefined?p3:new THREE.Plane,p4!==undefined?p4:new THREE.Plane,p5!==undefined?p5:new THREE.Plane]};THREE.Frustum.prototype={constructor:THREE.Frustum,set:function(p0,p1,p2,p3,p4,p5){var planes=this.planes;planes[0].copy(p0);planes[1].copy(p1);planes[2].copy(p2);planes[3].copy(p3);planes[4].copy(p4);planes[5].copy(p5);return this},copy:function(frustum){var planes=this.planes;for(var i=0;i<6;i++){planes[i].copy(frustum.planes[i])}return this},setFromMatrix:function(m){var planes=this.planes;var me=m.elements;var me0=me[0],me1=me[1],me2=me[2],me3=me[3];var me4=me[4],me5=me[5],me6=me[6],me7=me[7];var me8=me[8],me9=me[9],me10=me[10],me11=me[11];var me12=me[12],me13=me[13],me14=me[14],me15=me[15];planes[0].setComponents(me3-me0,me7-me4,me11-me8,me15-me12).normalize();planes[1].setComponents(me3+me0,me7+me4,me11+me8,me15+me12).normalize();planes[2].setComponents(me3+me1,me7+me5,me11+me9,me15+me13).normalize();planes[3].setComponents(me3-me1,me7-me5,me11-me9,me15-me13).normalize();planes[4].setComponents(me3-me2,me7-me6,me11-me10,me15-me14).normalize();planes[5].setComponents(me3+me2,me7+me6,me11+me10,me15+me14).normalize();return this},intersectsObject:function(){var sphere=new THREE.Sphere;return function(object){var geometry=object.geometry;if(geometry.boundingSphere===null)geometry.computeBoundingSphere();sphere.copy(geometry.boundingSphere);sphere.applyMatrix4(object.matrixWorld);return this.intersectsSphere(sphere)}}(),intersectsSphere:function(sphere){var planes=this.planes;var center=sphere.center;var negRadius=-sphere.radius;for(var i=0;i<6;i++){var distance=planes[i].distanceToPoint(center);if(distance<negRadius){return false}}return true},intersectsBox:function(){var p1=new THREE.Vector3,p2=new THREE.Vector3;return function(box){var planes=this.planes;for(var i=0;i<6;i++){var plane=planes[i];p1.x=plane.normal.x>0?box.min.x:box.max.x;p2.x=plane.normal.x>0?box.max.x:box.min.x;p1.y=plane.normal.y>0?box.min.y:box.max.y;p2.y=plane.normal.y>0?box.max.y:box.min.y;p1.z=plane.normal.z>0?box.min.z:box.max.z;p2.z=plane.normal.z>0?box.max.z:box.min.z;var d1=plane.distanceToPoint(p1);var d2=plane.distanceToPoint(p2);if(d1<0&&d2<0){return false}}return true}}(),containsPoint:function(point){var planes=this.planes;for(var i=0;i<6;i++){if(planes[i].distanceToPoint(point)<0){return false}}return true},clone:function(){return(new THREE.Frustum).copy(this)}};THREE.Plane=function(normal,constant){this.normal=normal!==undefined?normal:new THREE.Vector3(1,0,0);this.constant=constant!==undefined?constant:0};THREE.Plane.prototype={constructor:THREE.Plane,set:function(normal,constant){this.normal.copy(normal);this.constant=constant;return this},setComponents:function(x,y,z,w){this.normal.set(x,y,z);this.constant=w;return this},setFromNormalAndCoplanarPoint:function(normal,point){this.normal.copy(normal);this.constant=-point.dot(this.normal);return this},setFromCoplanarPoints:function(){var v1=new THREE.Vector3;var v2=new THREE.Vector3;return function(a,b,c){var normal=v1.subVectors(c,b).cross(v2.subVectors(a,b)).normalize();this.setFromNormalAndCoplanarPoint(normal,a);return this}}(),copy:function(plane){this.normal.copy(plane.normal);this.constant=plane.constant;return this},normalize:function(){var inverseNormalLength=1/this.normal.length();this.normal.multiplyScalar(inverseNormalLength);this.constant*=inverseNormalLength;return this},negate:function(){this.constant*=-1;this.normal.negate();return this},distanceToPoint:function(point){return this.normal.dot(point)+this.constant},distanceToSphere:function(sphere){return this.distanceToPoint(sphere.center)-sphere.radius},projectPoint:function(point,optionalTarget){return this.orthoPoint(point,optionalTarget).sub(point).negate()},orthoPoint:function(point,optionalTarget){var perpendicularMagnitude=this.distanceToPoint(point);var result=optionalTarget||new THREE.Vector3;return result.copy(this.normal).multiplyScalar(perpendicularMagnitude)},isIntersectionLine:function(line){var startSign=this.distanceToPoint(line.start);var endSign=this.distanceToPoint(line.end);return startSign<0&&endSign>0||endSign<0&&startSign>0},intersectLine:function(){var v1=new THREE.Vector3;return function(line,optionalTarget){var result=optionalTarget||new THREE.Vector3;var direction=line.delta(v1);var denominator=this.normal.dot(direction);if(denominator==0){if(this.distanceToPoint(line.start)==0){return result.copy(line.start)}return undefined}var t=-(line.start.dot(this.normal)+this.constant)/denominator;if(t<0||t>1){return undefined}return result.copy(direction).multiplyScalar(t).add(line.start)}}(),coplanarPoint:function(optionalTarget){var result=optionalTarget||new THREE.Vector3;return result.copy(this.normal).multiplyScalar(-this.constant)},applyMatrix4:function(){var v1=new THREE.Vector3;var v2=new THREE.Vector3;var m1=new THREE.Matrix3;return function(matrix,optionalNormalMatrix){var normalMatrix=optionalNormalMatrix||m1.getNormalMatrix(matrix);var newNormal=v1.copy(this.normal).applyMatrix3(normalMatrix);var newCoplanarPoint=this.coplanarPoint(v2);newCoplanarPoint.applyMatrix4(matrix);this.setFromNormalAndCoplanarPoint(newNormal,newCoplanarPoint);return this}}(),translate:function(offset){this.constant=this.constant-offset.dot(this.normal);return this},equals:function(plane){return plane.normal.equals(this.normal)&&plane.constant==this.constant},clone:function(){return(new THREE.Plane).copy(this)}};THREE.Math={generateUUID:function(){var chars="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split("");var uuid=new Array(36);var rnd=0,r;return function(){for(var i=0;i<36;i++){if(i==8||i==13||i==18||i==23){uuid[i]="-"}else if(i==14){uuid[i]="4"}else{if(rnd<=2)rnd=33554432+Math.random()*16777216|0;r=rnd&15;rnd=rnd>>4;uuid[i]=chars[i==19?r&3|8:r]}}return uuid.join("")}}(),clamp:function(x,a,b){return x<a?a:x>b?b:x},clampBottom:function(x,a){return x<a?a:x},mapLinear:function(x,a1,a2,b1,b2){return b1+(x-a1)*(b2-b1)/(a2-a1)},smoothstep:function(x,min,max){if(x<=min)return 0;if(x>=max)return 1;x=(x-min)/(max-min);return x*x*(3-2*x)},smootherstep:function(x,min,max){if(x<=min)return 0;if(x>=max)return 1;x=(x-min)/(max-min);return x*x*x*(x*(x*6-15)+10)},random16:function(){return(65280*Math.random()+255*Math.random())/65535},randInt:function(low,high){return low+Math.floor(Math.random()*(high-low+1))},randFloat:function(low,high){return low+Math.random()*(high-low)},randFloatSpread:function(range){return range*(.5-Math.random())},degToRad:function(){var degreeToRadiansFactor=Math.PI/180;return function(degrees){return degrees*degreeToRadiansFactor}}(),radToDeg:function(){var radianToDegreesFactor=180/Math.PI;return function(radians){return radians*radianToDegreesFactor}}(),isPowerOfTwo:function(value){return(value&value-1)===0&&value!==0}};THREE.Spline=function(points){this.points=points;var c=[],v3={x:0,y:0,z:0},point,intPoint,weight,w2,w3,pa,pb,pc,pd;this.initFromArray=function(a){this.points=[];for(var i=0;i<a.length;i++){this.points[i]={x:a[i][0],y:a[i][1],z:a[i][2]}}};this.getPoint=function(k){point=(this.points.length-1)*k;intPoint=Math.floor(point);weight=point-intPoint;c[0]=intPoint===0?intPoint:intPoint-1;c[1]=intPoint;c[2]=intPoint>this.points.length-2?this.points.length-1:intPoint+1;c[3]=intPoint>this.points.length-3?this.points.length-1:intPoint+2;pa=this.points[c[0]];pb=this.points[c[1]];pc=this.points[c[2]];pd=this.points[c[3]];w2=weight*weight;w3=weight*w2;v3.x=interpolate(pa.x,pb.x,pc.x,pd.x,weight,w2,w3);v3.y=interpolate(pa.y,pb.y,pc.y,pd.y,weight,w2,w3);v3.z=interpolate(pa.z,pb.z,pc.z,pd.z,weight,w2,w3);return v3};this.getControlPointsArray=function(){var i,p,l=this.points.length,coords=[];for(i=0;i<l;i++){p=this.points[i];coords[i]=[p.x,p.y,p.z]}return coords};this.getLength=function(nSubDivisions){var i,index,nSamples,position,point=0,intPoint=0,oldIntPoint=0,oldPosition=new THREE.Vector3,tmpVec=new THREE.Vector3,chunkLengths=[],totalLength=0;chunkLengths[0]=0;if(!nSubDivisions)nSubDivisions=100;nSamples=this.points.length*nSubDivisions;oldPosition.copy(this.points[0]);for(i=1;i<nSamples;i++){index=i/nSamples;position=this.getPoint(index);tmpVec.copy(position);totalLength+=tmpVec.distanceTo(oldPosition);oldPosition.copy(position);point=(this.points.length-1)*index;intPoint=Math.floor(point);if(intPoint!=oldIntPoint){chunkLengths[intPoint]=totalLength;oldIntPoint=intPoint}}chunkLengths[chunkLengths.length]=totalLength;return{chunks:chunkLengths,total:totalLength}};this.reparametrizeByArcLength=function(samplingCoef){var i,j,index,indexCurrent,indexNext,linearDistance,realDistance,sampling,position,newpoints=[],tmpVec=new THREE.Vector3,sl=this.getLength();newpoints.push(tmpVec.copy(this.points[0]).clone());for(i=1;i<this.points.length;i++){realDistance=sl.chunks[i]-sl.chunks[i-1];sampling=Math.ceil(samplingCoef*realDistance/sl.total);indexCurrent=(i-1)/(this.points.length-1);indexNext=i/(this.points.length-1);for(j=1;j<sampling-1;j++){index=indexCurrent+j*(1/sampling)*(indexNext-indexCurrent);position=this.getPoint(index);newpoints.push(tmpVec.copy(position).clone())}newpoints.push(tmpVec.copy(this.points[i]).clone())}this.points=newpoints};function interpolate(p0,p1,p2,p3,t,t2,t3){var v0=(p2-p0)*.5,v1=(p3-p1)*.5;return(2*(p1-p2)+v0+v1)*t3+(-3*(p1-p2)-2*v0-v1)*t2+v0*t+p1}};THREE.Triangle=function(a,b,c){this.a=a!==undefined?a:new THREE.Vector3;this.b=b!==undefined?b:new THREE.Vector3;this.c=c!==undefined?c:new THREE.Vector3
};THREE.Triangle.normal=function(){var v0=new THREE.Vector3;return function(a,b,c,optionalTarget){var result=optionalTarget||new THREE.Vector3;result.subVectors(c,b);v0.subVectors(a,b);result.cross(v0);var resultLengthSq=result.lengthSq();if(resultLengthSq>0){return result.multiplyScalar(1/Math.sqrt(resultLengthSq))}return result.set(0,0,0)}}();THREE.Triangle.barycoordFromPoint=function(){var v0=new THREE.Vector3;var v1=new THREE.Vector3;var v2=new THREE.Vector3;return function(point,a,b,c,optionalTarget){v0.subVectors(c,a);v1.subVectors(b,a);v2.subVectors(point,a);var dot00=v0.dot(v0);var dot01=v0.dot(v1);var dot02=v0.dot(v2);var dot11=v1.dot(v1);var dot12=v1.dot(v2);var denom=dot00*dot11-dot01*dot01;var result=optionalTarget||new THREE.Vector3;if(denom==0){return result.set(-2,-1,-1)}var invDenom=1/denom;var u=(dot11*dot02-dot01*dot12)*invDenom;var v=(dot00*dot12-dot01*dot02)*invDenom;return result.set(1-u-v,v,u)}}();THREE.Triangle.containsPoint=function(){var v1=new THREE.Vector3;return function(point,a,b,c){var result=THREE.Triangle.barycoordFromPoint(point,a,b,c,v1);return result.x>=0&&result.y>=0&&result.x+result.y<=1}}();THREE.Triangle.prototype={constructor:THREE.Triangle,set:function(a,b,c){this.a.copy(a);this.b.copy(b);this.c.copy(c);return this},setFromPointsAndIndices:function(points,i0,i1,i2){this.a.copy(points[i0]);this.b.copy(points[i1]);this.c.copy(points[i2]);return this},copy:function(triangle){this.a.copy(triangle.a);this.b.copy(triangle.b);this.c.copy(triangle.c);return this},area:function(){var v0=new THREE.Vector3;var v1=new THREE.Vector3;return function(){v0.subVectors(this.c,this.b);v1.subVectors(this.a,this.b);return v0.cross(v1).length()*.5}}(),midpoint:function(optionalTarget){var result=optionalTarget||new THREE.Vector3;return result.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)},normal:function(optionalTarget){return THREE.Triangle.normal(this.a,this.b,this.c,optionalTarget)},plane:function(optionalTarget){var result=optionalTarget||new THREE.Plane;return result.setFromCoplanarPoints(this.a,this.b,this.c)},barycoordFromPoint:function(point,optionalTarget){return THREE.Triangle.barycoordFromPoint(point,this.a,this.b,this.c,optionalTarget)},containsPoint:function(point){return THREE.Triangle.containsPoint(point,this.a,this.b,this.c)},equals:function(triangle){return triangle.a.equals(this.a)&&triangle.b.equals(this.b)&&triangle.c.equals(this.c)},clone:function(){return(new THREE.Triangle).copy(this)}};THREE.Clock=function(autoStart){this.autoStart=autoStart!==undefined?autoStart:true;this.startTime=0;this.oldTime=0;this.elapsedTime=0;this.running=false};THREE.Clock.prototype={constructor:THREE.Clock,start:function(){this.startTime=self.performance!==undefined&&self.performance.now!==undefined?self.performance.now():Date.now();this.oldTime=this.startTime;this.running=true},stop:function(){this.getElapsedTime();this.running=false},getElapsedTime:function(){this.getDelta();return this.elapsedTime},getDelta:function(){var diff=0;if(this.autoStart&&!this.running){this.start()}if(this.running){var newTime=self.performance!==undefined&&self.performance.now!==undefined?self.performance.now():Date.now();diff=.001*(newTime-this.oldTime);this.oldTime=newTime;this.elapsedTime+=diff}return diff}};THREE.EventDispatcher=function(){};THREE.EventDispatcher.prototype={constructor:THREE.EventDispatcher,apply:function(object){object.addEventListener=THREE.EventDispatcher.prototype.addEventListener;object.hasEventListener=THREE.EventDispatcher.prototype.hasEventListener;object.removeEventListener=THREE.EventDispatcher.prototype.removeEventListener;object.dispatchEvent=THREE.EventDispatcher.prototype.dispatchEvent},addEventListener:function(type,listener){if(this._listeners===undefined)this._listeners={};var listeners=this._listeners;if(listeners[type]===undefined){listeners[type]=[]}if(listeners[type].indexOf(listener)===-1){listeners[type].push(listener)}},hasEventListener:function(type,listener){if(this._listeners===undefined)return false;var listeners=this._listeners;if(listeners[type]!==undefined&&listeners[type].indexOf(listener)!==-1){return true}return false},removeEventListener:function(type,listener){if(this._listeners===undefined)return;var listeners=this._listeners;var listenerArray=listeners[type];if(listenerArray!==undefined){var index=listenerArray.indexOf(listener);if(index!==-1){listenerArray.splice(index,1)}}},dispatchEvent:function(event){if(this._listeners===undefined)return;var listeners=this._listeners;var listenerArray=listeners[event.type];if(listenerArray!==undefined){event.target=this;var array=[];var length=listenerArray.length;for(var i=0;i<length;i++){array[i]=listenerArray[i]}for(var i=0;i<length;i++){array[i].call(this,event)}}}};(function(THREE){THREE.Raycaster=function(origin,direction,near,far){this.ray=new THREE.Ray(origin,direction);this.near=near||0;this.far=far||Infinity;this.params={Sprite:{},Mesh:{},PointCloud:{threshold:1},LOD:{},Line:{}}};var descSort=function(a,b){return a.distance-b.distance};var intersectObject=function(object,raycaster,intersects,recursive){object.raycast(raycaster,intersects);if(recursive===true){var children=object.children;for(var i=0,l=children.length;i<l;i++){intersectObject(children[i],raycaster,intersects,true)}}};THREE.Raycaster.prototype={constructor:THREE.Raycaster,precision:1e-4,linePrecision:1,set:function(origin,direction){this.ray.set(origin,direction)},intersectObject:function(object,recursive){var intersects=[];intersectObject(object,this,intersects,recursive);intersects.sort(descSort);return intersects},intersectObjects:function(objects,recursive){var intersects=[];if(objects instanceof Array===false){console.log("THREE.Raycaster.intersectObjects: objects is not an Array.");return intersects}for(var i=0,l=objects.length;i<l;i++){intersectObject(objects[i],this,intersects,recursive)}intersects.sort(descSort);return intersects}}})(THREE);THREE.Object3D=function(){Object.defineProperty(this,"id",{value:THREE.Object3DIdCount++});this.uuid=THREE.Math.generateUUID();this.name="";this.type="Object3D";this.parent=undefined;this.children=[];this.up=THREE.Object3D.DefaultUp.clone();var scope=this;var position=new THREE.Vector3;var rotation=new THREE.Euler;var quaternion=new THREE.Quaternion;var scale=new THREE.Vector3(1,1,1);var onRotationChange=function(){quaternion.setFromEuler(rotation,false)};var onQuaternionChange=function(){rotation.setFromQuaternion(quaternion,undefined,false)};rotation.onChange(onRotationChange);quaternion.onChange(onQuaternionChange);Object.defineProperties(this,{position:{enumerable:true,value:position},rotation:{enumerable:true,value:rotation},quaternion:{enumerable:true,value:quaternion},scale:{enumerable:true,value:scale}});this.renderDepth=null;this.rotationAutoUpdate=true;this.matrix=new THREE.Matrix4;this.matrixWorld=new THREE.Matrix4;this.matrixAutoUpdate=true;this.matrixWorldNeedsUpdate=false;this.visible=true;this.castShadow=false;this.receiveShadow=false;this.frustumCulled=true;this.userData={}};THREE.Object3D.DefaultUp=new THREE.Vector3(0,1,0);THREE.Object3D.prototype={constructor:THREE.Object3D,get eulerOrder(){console.warn("THREE.Object3D: .eulerOrder has been moved to .rotation.order.");return this.rotation.order},set eulerOrder(value){console.warn("THREE.Object3D: .eulerOrder has been moved to .rotation.order.");this.rotation.order=value},get useQuaternion(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},set useQuaternion(value){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},applyMatrix:function(matrix){this.matrix.multiplyMatrices(matrix,this.matrix);this.matrix.decompose(this.position,this.quaternion,this.scale)},setRotationFromAxisAngle:function(axis,angle){this.quaternion.setFromAxisAngle(axis,angle)},setRotationFromEuler:function(euler){this.quaternion.setFromEuler(euler,true)},setRotationFromMatrix:function(m){this.quaternion.setFromRotationMatrix(m)},setRotationFromQuaternion:function(q){this.quaternion.copy(q)},rotateOnAxis:function(){var q1=new THREE.Quaternion;return function(axis,angle){q1.setFromAxisAngle(axis,angle);this.quaternion.multiply(q1);return this}}(),rotateX:function(){var v1=new THREE.Vector3(1,0,0);return function(angle){return this.rotateOnAxis(v1,angle)}}(),rotateY:function(){var v1=new THREE.Vector3(0,1,0);return function(angle){return this.rotateOnAxis(v1,angle)}}(),rotateZ:function(){var v1=new THREE.Vector3(0,0,1);return function(angle){return this.rotateOnAxis(v1,angle)}}(),translateOnAxis:function(){var v1=new THREE.Vector3;return function(axis,distance){v1.copy(axis).applyQuaternion(this.quaternion);this.position.add(v1.multiplyScalar(distance));return this}}(),translate:function(distance,axis){console.warn("THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead.");return this.translateOnAxis(axis,distance)},translateX:function(){var v1=new THREE.Vector3(1,0,0);return function(distance){return this.translateOnAxis(v1,distance)}}(),translateY:function(){var v1=new THREE.Vector3(0,1,0);return function(distance){return this.translateOnAxis(v1,distance)}}(),translateZ:function(){var v1=new THREE.Vector3(0,0,1);return function(distance){return this.translateOnAxis(v1,distance)}}(),localToWorld:function(vector){return vector.applyMatrix4(this.matrixWorld)},worldToLocal:function(){var m1=new THREE.Matrix4;return function(vector){return vector.applyMatrix4(m1.getInverse(this.matrixWorld))}}(),lookAt:function(){var m1=new THREE.Matrix4;return function(vector){m1.lookAt(vector,this.position,this.up);this.quaternion.setFromRotationMatrix(m1)}}(),add:function(object){if(arguments.length>1){for(var i=0;i<arguments.length;i++){this.add(arguments[i])}return this}if(object===this){console.error("THREE.Object3D.add:",object,"can't be added as a child of itself.");return this}if(object instanceof THREE.Object3D){if(object.parent!==undefined){object.parent.remove(object)}object.parent=this;object.dispatchEvent({type:"added"});this.children.push(object)}else{console.error("THREE.Object3D.add:",object,"is not an instance of THREE.Object3D.")}return this},remove:function(object){if(arguments.length>1){for(var i=0;i<arguments.length;i++){this.remove(arguments[i])}}var index=this.children.indexOf(object);if(index!==-1){object.parent=undefined;object.dispatchEvent({type:"removed"});this.children.splice(index,1)}},getChildByName:function(name,recursive){console.warn("THREE.Object3D: .getChildByName() has been renamed to .getObjectByName().");return this.getObjectByName(name,recursive)},getObjectById:function(id,recursive){if(this.id===id)return this;for(var i=0,l=this.children.length;i<l;i++){var child=this.children[i];var object=child.getObjectById(id,recursive);if(object!==undefined){return object}}return undefined},getObjectByName:function(name,recursive){if(this.name===name)return this;for(var i=0,l=this.children.length;i<l;i++){var child=this.children[i];var object=child.getObjectByName(name,recursive);if(object!==undefined){return object}}return undefined},getWorldPosition:function(optionalTarget){var result=optionalTarget||new THREE.Vector3;this.updateMatrixWorld(true);return result.setFromMatrixPosition(this.matrixWorld)},getWorldQuaternion:function(){var position=new THREE.Vector3;var scale=new THREE.Vector3;return function(optionalTarget){var result=optionalTarget||new THREE.Quaternion;this.updateMatrixWorld(true);this.matrixWorld.decompose(position,result,scale);return result}}(),getWorldRotation:function(){var quaternion=new THREE.Quaternion;return function(optionalTarget){var result=optionalTarget||new THREE.Euler;this.getWorldQuaternion(quaternion);return result.setFromQuaternion(quaternion,this.rotation.order,false)}}(),getWorldScale:function(){var position=new THREE.Vector3;var quaternion=new THREE.Quaternion;return function(optionalTarget){var result=optionalTarget||new THREE.Vector3;this.updateMatrixWorld(true);this.matrixWorld.decompose(position,quaternion,result);return result}}(),getWorldDirection:function(){var quaternion=new THREE.Quaternion;return function(optionalTarget){var result=optionalTarget||new THREE.Vector3;this.getWorldQuaternion(quaternion);return result.set(0,0,1).applyQuaternion(quaternion)}}(),raycast:function(){},traverse:function(callback){callback(this);for(var i=0,l=this.children.length;i<l;i++){this.children[i].traverse(callback)}},traverseVisible:function(callback){if(this.visible===false)return;callback(this);for(var i=0,l=this.children.length;i<l;i++){this.children[i].traverseVisible(callback)}},updateMatrix:function(){this.matrix.compose(this.position,this.quaternion,this.scale);this.matrixWorldNeedsUpdate=true},updateMatrixWorld:function(force){if(this.matrixAutoUpdate===true)this.updateMatrix();if(this.matrixWorldNeedsUpdate===true||force===true){if(this.parent===undefined){this.matrixWorld.copy(this.matrix)}else{this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)}this.matrixWorldNeedsUpdate=false;force=true}for(var i=0,l=this.children.length;i<l;i++){this.children[i].updateMatrixWorld(force)}},toJSON:function(){var output={metadata:{version:4.3,type:"Object",generator:"ObjectExporter"}};var geometries={};var parseGeometry=function(geometry){if(output.geometries===undefined){output.geometries=[]}if(geometries[geometry.uuid]===undefined){var json=geometry.toJSON();delete json.metadata;geometries[geometry.uuid]=json;output.geometries.push(json)}return geometry.uuid};var materials={};var parseMaterial=function(material){if(output.materials===undefined){output.materials=[]}if(materials[material.uuid]===undefined){var json=material.toJSON();delete json.metadata;materials[material.uuid]=json;output.materials.push(json)}return material.uuid};var parseObject=function(object){var data={};data.uuid=object.uuid;data.type=object.type;if(object.name!=="")data.name=object.name;if(JSON.stringify(object.userData)!=="{}")data.userData=object.userData;if(object.visible!==true)data.visible=object.visible;if(object instanceof THREE.PerspectiveCamera){data.fov=object.fov;data.aspect=object.aspect;data.near=object.near;data.far=object.far}else if(object instanceof THREE.OrthographicCamera){data.left=object.left;data.right=object.right;data.top=object.top;data.bottom=object.bottom;data.near=object.near;data.far=object.far}else if(object instanceof THREE.AmbientLight){data.color=object.color.getHex()}else if(object instanceof THREE.DirectionalLight){data.color=object.color.getHex();data.intensity=object.intensity}else if(object instanceof THREE.PointLight){data.color=object.color.getHex();data.intensity=object.intensity;data.distance=object.distance}else if(object instanceof THREE.SpotLight){data.color=object.color.getHex();data.intensity=object.intensity;data.distance=object.distance;data.angle=object.angle;data.exponent=object.exponent}else if(object instanceof THREE.HemisphereLight){data.color=object.color.getHex();data.groundColor=object.groundColor.getHex()}else if(object instanceof THREE.Mesh){data.geometry=parseGeometry(object.geometry);data.material=parseMaterial(object.material)}else if(object instanceof THREE.Line){data.geometry=parseGeometry(object.geometry);data.material=parseMaterial(object.material)}else if(object instanceof THREE.Sprite){data.material=parseMaterial(object.material)}data.matrix=object.matrix.toArray();if(object.children.length>0){data.children=[];for(var i=0;i<object.children.length;i++){data.children.push(parseObject(object.children[i]))}}return data};output.object=parseObject(this);return output},clone:function(object,recursive){if(object===undefined)object=new THREE.Object3D;if(recursive===undefined)recursive=true;object.name=this.name;object.up.copy(this.up);object.position.copy(this.position);object.quaternion.copy(this.quaternion);object.scale.copy(this.scale);object.renderDepth=this.renderDepth;object.rotationAutoUpdate=this.rotationAutoUpdate;object.matrix.copy(this.matrix);object.matrixWorld.copy(this.matrixWorld);object.matrixAutoUpdate=this.matrixAutoUpdate;object.matrixWorldNeedsUpdate=this.matrixWorldNeedsUpdate;object.visible=this.visible;object.castShadow=this.castShadow;object.receiveShadow=this.receiveShadow;object.frustumCulled=this.frustumCulled;object.userData=JSON.parse(JSON.stringify(this.userData));if(recursive===true){for(var i=0;i<this.children.length;i++){var child=this.children[i];object.add(child.clone())}}return object}};THREE.EventDispatcher.prototype.apply(THREE.Object3D.prototype);THREE.Object3DIdCount=0;THREE.Projector=function(){console.warn("THREE.Projector has been moved to /examples/renderers/Projector.js.");this.projectVector=function(vector,camera){console.warn("THREE.Projector: .projectVector() is now vector.project().");vector.project(camera)};this.unprojectVector=function(vector,camera){console.warn("THREE.Projector: .unprojectVector() is now vector.unproject().");vector.unproject(camera)};this.pickingRay=function(vector,camera){console.error("THREE.Projector: .pickingRay() has been removed.")}};THREE.Face3=function(a,b,c,normal,color,materialIndex){this.a=a;this.b=b;this.c=c;this.normal=normal instanceof THREE.Vector3?normal:new THREE.Vector3;this.vertexNormals=normal instanceof Array?normal:[];this.color=color instanceof THREE.Color?color:new THREE.Color;this.vertexColors=color instanceof Array?color:[];this.vertexTangents=[];this.materialIndex=materialIndex!==undefined?materialIndex:0};THREE.Face3.prototype={constructor:THREE.Face3,clone:function(){var face=new THREE.Face3(this.a,this.b,this.c);face.normal.copy(this.normal);face.color.copy(this.color);face.materialIndex=this.materialIndex;for(var i=0,il=this.vertexNormals.length;i<il;i++){face.vertexNormals[i]=this.vertexNormals[i].clone()}for(var i=0,il=this.vertexColors.length;i<il;i++){face.vertexColors[i]=this.vertexColors[i].clone()}for(var i=0,il=this.vertexTangents.length;i<il;i++){face.vertexTangents[i]=this.vertexTangents[i].clone()}return face}};THREE.Face4=function(a,b,c,d,normal,color,materialIndex){console.warn("THREE.Face4 has been removed. A THREE.Face3 will be created instead.");return new THREE.Face3(a,b,c,normal,color,materialIndex)};THREE.BufferAttribute=function(array,itemSize){this.array=array;this.itemSize=itemSize;this.needsUpdate=false};THREE.BufferAttribute.prototype={constructor:THREE.BufferAttribute,get length(){return this.array.length},copyAt:function(index1,attribute,index2){index1*=this.itemSize;index2*=attribute.itemSize;for(var i=0,l=this.itemSize;i<l;i++){this.array[index1+i]=attribute.array[index2+i]}},set:function(value){this.array.set(value);return this},setX:function(index,x){this.array[index*this.itemSize]=x;return this},setY:function(index,y){this.array[index*this.itemSize+1]=y;return this},setZ:function(index,z){this.array[index*this.itemSize+2]=z;return this},setXY:function(index,x,y){index*=this.itemSize;this.array[index]=x;this.array[index+1]=y;return this},setXYZ:function(index,x,y,z){index*=this.itemSize;this.array[index]=x;this.array[index+1]=y;this.array[index+2]=z;return this},setXYZW:function(index,x,y,z,w){index*=this.itemSize;this.array[index]=x;this.array[index+1]=y;this.array[index+2]=z;this.array[index+3]=w;return this},clone:function(){return new THREE.BufferAttribute(new this.array.constructor(this.array),this.itemSize)}};THREE.Int8Attribute=function(data,itemSize){console.warn("THREE.Int8Attribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead.");return new THREE.BufferAttribute(data,itemSize)};THREE.Uint8Attribute=function(data,itemSize){console.warn("THREE.Uint8Attribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead.");return new THREE.BufferAttribute(data,itemSize)};THREE.Uint8ClampedAttribute=function(data,itemSize){console.warn("THREE.Uint8ClampedAttribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead.");return new THREE.BufferAttribute(data,itemSize)};THREE.Int16Attribute=function(data,itemSize){console.warn("THREE.Int16Attribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead.");return new THREE.BufferAttribute(data,itemSize)};THREE.Uint16Attribute=function(data,itemSize){console.warn("THREE.Uint16Attribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead.");return new THREE.BufferAttribute(data,itemSize)};THREE.Int32Attribute=function(data,itemSize){console.warn("THREE.Int32Attribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead.");return new THREE.BufferAttribute(data,itemSize)};THREE.Uint32Attribute=function(data,itemSize){console.warn("THREE.Uint32Attribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead.");return new THREE.BufferAttribute(data,itemSize)};THREE.Float32Attribute=function(data,itemSize){console.warn("THREE.Float32Attribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead.");return new THREE.BufferAttribute(data,itemSize)};THREE.Float64Attribute=function(data,itemSize){console.warn("THREE.Float64Attribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead.");return new THREE.BufferAttribute(data,itemSize)};THREE.BufferGeometry=function(){Object.defineProperty(this,"id",{value:THREE.GeometryIdCount++});this.uuid=THREE.Math.generateUUID();this.name="";this.type="BufferGeometry";this.attributes={};this.attributesKeys=[];this.drawcalls=[];this.offsets=this.drawcalls;this.boundingBox=null;this.boundingSphere=null};THREE.BufferGeometry.prototype={constructor:THREE.BufferGeometry,addAttribute:function(name,attribute){if(attribute instanceof THREE.BufferAttribute===false){console.warn("THREE.BufferGeometry: .addAttribute() now expects ( name, attribute ).");this.attributes[name]={array:arguments[1],itemSize:arguments[2]};return}this.attributes[name]=attribute;this.attributesKeys=Object.keys(this.attributes)},getAttribute:function(name){return this.attributes[name]},addDrawCall:function(start,count,indexOffset){this.drawcalls.push({start:start,count:count,index:indexOffset!==undefined?indexOffset:0})},applyMatrix:function(matrix){var position=this.attributes.position;if(position!==undefined){matrix.applyToVector3Array(position.array);position.needsUpdate=true}var normal=this.attributes.normal;if(normal!==undefined){var normalMatrix=(new THREE.Matrix3).getNormalMatrix(matrix);normalMatrix.applyToVector3Array(normal.array);normal.needsUpdate=true}},center:function(){},fromGeometry:function(geometry,settings){settings=settings||{vertexColors:THREE.NoColors};var vertices=geometry.vertices;var faces=geometry.faces;var faceVertexUvs=geometry.faceVertexUvs;var vertexColors=settings.vertexColors;var hasFaceVertexUv=faceVertexUvs[0].length>0;var hasFaceVertexNormals=faces[0].vertexNormals.length==3;var positions=new Float32Array(faces.length*3*3);this.addAttribute("position",new THREE.BufferAttribute(positions,3));var normals=new Float32Array(faces.length*3*3);this.addAttribute("normal",new THREE.BufferAttribute(normals,3));if(vertexColors!==THREE.NoColors){var colors=new Float32Array(faces.length*3*3);this.addAttribute("color",new THREE.BufferAttribute(colors,3))}if(hasFaceVertexUv===true){var uvs=new Float32Array(faces.length*3*2);this.addAttribute("uv",new THREE.BufferAttribute(uvs,2))}for(var i=0,i2=0,i3=0;i<faces.length;i++,i2+=6,i3+=9){var face=faces[i];var a=vertices[face.a];var b=vertices[face.b];var c=vertices[face.c];positions[i3]=a.x;positions[i3+1]=a.y;positions[i3+2]=a.z;positions[i3+3]=b.x;positions[i3+4]=b.y;positions[i3+5]=b.z;positions[i3+6]=c.x;positions[i3+7]=c.y;positions[i3+8]=c.z;if(hasFaceVertexNormals===true){var na=face.vertexNormals[0];var nb=face.vertexNormals[1];var nc=face.vertexNormals[2];normals[i3]=na.x;normals[i3+1]=na.y;normals[i3+2]=na.z;normals[i3+3]=nb.x;normals[i3+4]=nb.y;normals[i3+5]=nb.z;normals[i3+6]=nc.x;normals[i3+7]=nc.y;normals[i3+8]=nc.z}else{var n=face.normal;normals[i3]=n.x;normals[i3+1]=n.y;normals[i3+2]=n.z;normals[i3+3]=n.x;normals[i3+4]=n.y;normals[i3+5]=n.z;normals[i3+6]=n.x;normals[i3+7]=n.y;normals[i3+8]=n.z}if(vertexColors===THREE.FaceColors){var fc=face.color;colors[i3]=fc.r;colors[i3+1]=fc.g;colors[i3+2]=fc.b;colors[i3+3]=fc.r;colors[i3+4]=fc.g;colors[i3+5]=fc.b;colors[i3+6]=fc.r;colors[i3+7]=fc.g;colors[i3+8]=fc.b}else if(vertexColors===THREE.VertexColors){var vca=face.vertexColors[0];var vcb=face.vertexColors[1];var vcc=face.vertexColors[2];colors[i3]=vca.r;colors[i3+1]=vca.g;colors[i3+2]=vca.b;colors[i3+3]=vcb.r;colors[i3+4]=vcb.g;colors[i3+5]=vcb.b;colors[i3+6]=vcc.r;colors[i3+7]=vcc.g;colors[i3+8]=vcc.b}if(hasFaceVertexUv===true){var uva=faceVertexUvs[0][i][0];var uvb=faceVertexUvs[0][i][1];var uvc=faceVertexUvs[0][i][2];uvs[i2]=uva.x;uvs[i2+1]=uva.y;uvs[i2+2]=uvb.x;uvs[i2+3]=uvb.y;uvs[i2+4]=uvc.x;uvs[i2+5]=uvc.y}}this.computeBoundingSphere();return this},computeBoundingBox:function(){var vector=new THREE.Vector3;return function(){if(this.boundingBox===null){this.boundingBox=new THREE.Box3}var positions=this.attributes.position.array;if(positions){var bb=this.boundingBox;bb.makeEmpty();for(var i=0,il=positions.length;i<il;i+=3){vector.set(positions[i],positions[i+1],positions[i+2]);bb.expandByPoint(vector)}}if(positions===undefined||positions.length===0){this.boundingBox.min.set(0,0,0);this.boundingBox.max.set(0,0,0)}if(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z)){console.error('THREE.BufferGeometry.computeBoundingBox: Computed min/max have NaN values. The "position" attribute is likely to have NaN values.')}}}(),computeBoundingSphere:function(){var box=new THREE.Box3;var vector=new THREE.Vector3;return function(){if(this.boundingSphere===null){this.boundingSphere=new THREE.Sphere}var positions=this.attributes.position.array;if(positions){box.makeEmpty();var center=this.boundingSphere.center;for(var i=0,il=positions.length;i<il;i+=3){vector.set(positions[i],positions[i+1],positions[i+2]);box.expandByPoint(vector)}box.center(center);var maxRadiusSq=0;for(var i=0,il=positions.length;i<il;i+=3){vector.set(positions[i],positions[i+1],positions[i+2]);maxRadiusSq=Math.max(maxRadiusSq,center.distanceToSquared(vector))}this.boundingSphere.radius=Math.sqrt(maxRadiusSq);if(isNaN(this.boundingSphere.radius)){console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.')}}}}(),computeFaceNormals:function(){},computeVertexNormals:function(){var attributes=this.attributes;if(attributes.position){var positions=attributes.position.array;if(attributes.normal===undefined){this.addAttribute("normal",new THREE.BufferAttribute(new Float32Array(positions.length),3))}else{var normals=attributes.normal.array;for(var i=0,il=normals.length;i<il;i++){normals[i]=0}}var normals=attributes.normal.array;var vA,vB,vC,pA=new THREE.Vector3,pB=new THREE.Vector3,pC=new THREE.Vector3,cb=new THREE.Vector3,ab=new THREE.Vector3;if(attributes.index){var indices=attributes.index.array;var offsets=this.offsets.length>0?this.offsets:[{start:0,count:indices.length,index:0}];for(var j=0,jl=offsets.length;j<jl;++j){var start=offsets[j].start;var count=offsets[j].count;var index=offsets[j].index;for(var i=start,il=start+count;i<il;i+=3){vA=(index+indices[i])*3;vB=(index+indices[i+1])*3;vC=(index+indices[i+2])*3;pA.fromArray(positions,vA);pB.fromArray(positions,vB);pC.fromArray(positions,vC);cb.subVectors(pC,pB);ab.subVectors(pA,pB);cb.cross(ab);normals[vA]+=cb.x;normals[vA+1]+=cb.y;normals[vA+2]+=cb.z;normals[vB]+=cb.x;normals[vB+1]+=cb.y;normals[vB+2]+=cb.z;normals[vC]+=cb.x;normals[vC+1]+=cb.y;normals[vC+2]+=cb.z}}}else{for(var i=0,il=positions.length;i<il;i+=9){pA.fromArray(positions,i);pB.fromArray(positions,i+3);pC.fromArray(positions,i+6);cb.subVectors(pC,pB);ab.subVectors(pA,pB);cb.cross(ab);normals[i]=cb.x;normals[i+1]=cb.y;normals[i+2]=cb.z;normals[i+3]=cb.x;normals[i+4]=cb.y;normals[i+5]=cb.z;normals[i+6]=cb.x;normals[i+7]=cb.y;normals[i+8]=cb.z}}this.normalizeNormals();attributes.normal.needsUpdate=true}},computeTangents:function(){if(this.attributes.index===undefined||this.attributes.position===undefined||this.attributes.normal===undefined||this.attributes.uv===undefined){console.warn("Missing required attributes (index, position, normal or uv) in BufferGeometry.computeTangents()");return}var indices=this.attributes.index.array;var positions=this.attributes.position.array;var normals=this.attributes.normal.array;var uvs=this.attributes.uv.array;var nVertices=positions.length/3;if(this.attributes.tangent===undefined){this.addAttribute("tangent",new THREE.BufferAttribute(new Float32Array(4*nVertices),4))}var tangents=this.attributes.tangent.array;var tan1=[],tan2=[];for(var k=0;k<nVertices;k++){tan1[k]=new THREE.Vector3;tan2[k]=new THREE.Vector3}var vA=new THREE.Vector3,vB=new THREE.Vector3,vC=new THREE.Vector3,uvA=new THREE.Vector2,uvB=new THREE.Vector2,uvC=new THREE.Vector2,x1,x2,y1,y2,z1,z2,s1,s2,t1,t2,r;var sdir=new THREE.Vector3,tdir=new THREE.Vector3;function handleTriangle(a,b,c){vA.fromArray(positions,a*3);vB.fromArray(positions,b*3);vC.fromArray(positions,c*3);uvA.fromArray(uvs,a*2);uvB.fromArray(uvs,b*2);uvC.fromArray(uvs,c*2);x1=vB.x-vA.x;x2=vC.x-vA.x;y1=vB.y-vA.y;y2=vC.y-vA.y;z1=vB.z-vA.z;z2=vC.z-vA.z;s1=uvB.x-uvA.x;s2=uvC.x-uvA.x;t1=uvB.y-uvA.y;t2=uvC.y-uvA.y;r=1/(s1*t2-s2*t1);sdir.set((t2*x1-t1*x2)*r,(t2*y1-t1*y2)*r,(t2*z1-t1*z2)*r);tdir.set((s1*x2-s2*x1)*r,(s1*y2-s2*y1)*r,(s1*z2-s2*z1)*r);tan1[a].add(sdir);tan1[b].add(sdir);tan1[c].add(sdir);tan2[a].add(tdir);tan2[b].add(tdir);tan2[c].add(tdir)}var i,il;var j,jl;var iA,iB,iC;if(this.drawcalls.length===0){this.addDrawCall(0,indices.length,0)}var drawcalls=this.drawcalls;for(j=0,jl=drawcalls.length;j<jl;++j){var start=drawcalls[j].start;var count=drawcalls[j].count;var index=drawcalls[j].index;for(i=start,il=start+count;i<il;i+=3){iA=index+indices[i];iB=index+indices[i+1];iC=index+indices[i+2];handleTriangle(iA,iB,iC)}}var tmp=new THREE.Vector3,tmp2=new THREE.Vector3;var n=new THREE.Vector3,n2=new THREE.Vector3;var w,t,test;function handleVertex(v){n.fromArray(normals,v*3);n2.copy(n);t=tan1[v];tmp.copy(t);tmp.sub(n.multiplyScalar(n.dot(t))).normalize();tmp2.crossVectors(n2,t);test=tmp2.dot(tan2[v]);w=test<0?-1:1;tangents[v*4]=tmp.x;tangents[v*4+1]=tmp.y;tangents[v*4+2]=tmp.z;tangents[v*4+3]=w}for(j=0,jl=drawcalls.length;j<jl;++j){var start=drawcalls[j].start;var count=drawcalls[j].count;var index=drawcalls[j].index;for(i=start,il=start+count;i<il;i+=3){iA=index+indices[i];iB=index+indices[i+1];iC=index+indices[i+2];handleVertex(iA);handleVertex(iB);handleVertex(iC)}}},computeOffsets:function(indexBufferSize){var size=indexBufferSize;if(indexBufferSize===undefined)size=65535;var s=Date.now();var indices=this.attributes.index.array;var vertices=this.attributes.position.array;var verticesCount=vertices.length/3;var facesCount=indices.length/3;var sortedIndices=new Uint16Array(indices.length);var indexPtr=0;var vertexPtr=0;var offsets=[{start:0,count:0,index:0}];var offset=offsets[0];var duplicatedVertices=0;var newVerticeMaps=0;var faceVertices=new Int32Array(6);var vertexMap=new Int32Array(vertices.length);var revVertexMap=new Int32Array(vertices.length);for(var j=0;j<vertices.length;j++){vertexMap[j]=-1;revVertexMap[j]=-1}for(var findex=0;findex<facesCount;findex++){newVerticeMaps=0;for(var vo=0;vo<3;vo++){var vid=indices[findex*3+vo];if(vertexMap[vid]==-1){faceVertices[vo*2]=vid;faceVertices[vo*2+1]=-1;newVerticeMaps++}else if(vertexMap[vid]<offset.index){faceVertices[vo*2]=vid;faceVertices[vo*2+1]=-1;duplicatedVertices++}else{faceVertices[vo*2]=vid;faceVertices[vo*2+1]=vertexMap[vid]}}var faceMax=vertexPtr+newVerticeMaps;if(faceMax>offset.index+size){var new_offset={start:indexPtr,count:0,index:vertexPtr};offsets.push(new_offset);offset=new_offset;for(var v=0;v<6;v+=2){var new_vid=faceVertices[v+1];if(new_vid>-1&&new_vid<offset.index)faceVertices[v+1]=-1
}}for(var v=0;v<6;v+=2){var vid=faceVertices[v];var new_vid=faceVertices[v+1];if(new_vid===-1)new_vid=vertexPtr++;vertexMap[vid]=new_vid;revVertexMap[new_vid]=vid;sortedIndices[indexPtr++]=new_vid-offset.index;offset.count++}}this.reorderBuffers(sortedIndices,revVertexMap,vertexPtr);this.offsets=offsets;return offsets},merge:function(){console.log("BufferGeometry.merge(): TODO")},normalizeNormals:function(){var normals=this.attributes.normal.array;var x,y,z,n;for(var i=0,il=normals.length;i<il;i+=3){x=normals[i];y=normals[i+1];z=normals[i+2];n=1/Math.sqrt(x*x+y*y+z*z);normals[i]*=n;normals[i+1]*=n;normals[i+2]*=n}},reorderBuffers:function(indexBuffer,indexMap,vertexCount){var sortedAttributes={};for(var attr in this.attributes){if(attr=="index")continue;var sourceArray=this.attributes[attr].array;sortedAttributes[attr]=new sourceArray.constructor(this.attributes[attr].itemSize*vertexCount)}for(var new_vid=0;new_vid<vertexCount;new_vid++){var vid=indexMap[new_vid];for(var attr in this.attributes){if(attr=="index")continue;var attrArray=this.attributes[attr].array;var attrSize=this.attributes[attr].itemSize;var sortedAttr=sortedAttributes[attr];for(var k=0;k<attrSize;k++)sortedAttr[new_vid*attrSize+k]=attrArray[vid*attrSize+k]}}this.attributes["index"].array=indexBuffer;for(var attr in this.attributes){if(attr=="index")continue;this.attributes[attr].array=sortedAttributes[attr];this.attributes[attr].numItems=this.attributes[attr].itemSize*vertexCount}},toJSON:function(){var output={metadata:{version:4,type:"BufferGeometry",generator:"BufferGeometryExporter"},uuid:this.uuid,type:this.type,data:{attributes:{}}};var attributes=this.attributes;var offsets=this.offsets;var boundingSphere=this.boundingSphere;for(var key in attributes){var attribute=attributes[key];var array=[],typeArray=attribute.array;for(var i=0,l=typeArray.length;i<l;i++){array[i]=typeArray[i]}output.data.attributes[key]={itemSize:attribute.itemSize,type:attribute.array.constructor.name,array:array}}if(offsets.length>0){output.data.offsets=JSON.parse(JSON.stringify(offsets))}if(boundingSphere!==null){output.data.boundingSphere={center:boundingSphere.center.toArray(),radius:boundingSphere.radius}}return output},clone:function(){var geometry=new THREE.BufferGeometry;for(var attr in this.attributes){var sourceAttr=this.attributes[attr];geometry.addAttribute(attr,sourceAttr.clone())}for(var i=0,il=this.offsets.length;i<il;i++){var offset=this.offsets[i];geometry.offsets.push({start:offset.start,index:offset.index,count:offset.count})}return geometry},dispose:function(){this.dispatchEvent({type:"dispose"})}};THREE.EventDispatcher.prototype.apply(THREE.BufferGeometry.prototype);THREE.Geometry=function(){Object.defineProperty(this,"id",{value:THREE.GeometryIdCount++});this.uuid=THREE.Math.generateUUID();this.name="";this.type="Geometry";this.vertices=[];this.colors=[];this.faces=[];this.faceVertexUvs=[[]];this.morphTargets=[];this.morphColors=[];this.morphNormals=[];this.skinWeights=[];this.skinIndices=[];this.lineDistances=[];this.boundingBox=null;this.boundingSphere=null;this.hasTangents=false;this.dynamic=true;this.verticesNeedUpdate=false;this.elementsNeedUpdate=false;this.uvsNeedUpdate=false;this.normalsNeedUpdate=false;this.tangentsNeedUpdate=false;this.colorsNeedUpdate=false;this.lineDistancesNeedUpdate=false;this.groupsNeedUpdate=false};THREE.Geometry.prototype={constructor:THREE.Geometry,applyMatrix:function(matrix){var normalMatrix=(new THREE.Matrix3).getNormalMatrix(matrix);for(var i=0,il=this.vertices.length;i<il;i++){var vertex=this.vertices[i];vertex.applyMatrix4(matrix)}for(var i=0,il=this.faces.length;i<il;i++){var face=this.faces[i];face.normal.applyMatrix3(normalMatrix).normalize();for(var j=0,jl=face.vertexNormals.length;j<jl;j++){face.vertexNormals[j].applyMatrix3(normalMatrix).normalize()}}if(this.boundingBox instanceof THREE.Box3){this.computeBoundingBox()}if(this.boundingSphere instanceof THREE.Sphere){this.computeBoundingSphere()}},fromBufferGeometry:function(geometry){var scope=this;var attributes=geometry.attributes;var vertices=attributes.position.array;var indices=attributes.index!==undefined?attributes.index.array:undefined;var normals=attributes.normal!==undefined?attributes.normal.array:undefined;var colors=attributes.color!==undefined?attributes.color.array:undefined;var uvs=attributes.uv!==undefined?attributes.uv.array:undefined;var tempNormals=[];var tempUVs=[];for(var i=0,j=0;i<vertices.length;i+=3,j+=2){scope.vertices.push(new THREE.Vector3(vertices[i],vertices[i+1],vertices[i+2]));if(normals!==undefined){tempNormals.push(new THREE.Vector3(normals[i],normals[i+1],normals[i+2]))}if(colors!==undefined){scope.colors.push(new THREE.Color(colors[i],colors[i+1],colors[i+2]))}if(uvs!==undefined){tempUVs.push(new THREE.Vector2(uvs[j],uvs[j+1]))}}var addFace=function(a,b,c){var vertexNormals=normals!==undefined?[tempNormals[a].clone(),tempNormals[b].clone(),tempNormals[c].clone()]:[];var vertexColors=colors!==undefined?[scope.colors[a].clone(),scope.colors[b].clone(),scope.colors[c].clone()]:[];scope.faces.push(new THREE.Face3(a,b,c,vertexNormals,vertexColors));scope.faceVertexUvs[0].push([tempUVs[a],tempUVs[b],tempUVs[c]])};if(indices!==undefined){for(var i=0;i<indices.length;i+=3){addFace(indices[i],indices[i+1],indices[i+2])}}else{for(var i=0;i<vertices.length/3;i+=3){addFace(i,i+1,i+2)}}this.computeFaceNormals();if(geometry.boundingBox!==null){this.boundingBox=geometry.boundingBox.clone()}if(geometry.boundingSphere!==null){this.boundingSphere=geometry.boundingSphere.clone()}return this},center:function(){this.computeBoundingBox();var offset=new THREE.Vector3;offset.addVectors(this.boundingBox.min,this.boundingBox.max);offset.multiplyScalar(-.5);this.applyMatrix((new THREE.Matrix4).makeTranslation(offset.x,offset.y,offset.z));this.computeBoundingBox();return offset},computeFaceNormals:function(){var cb=new THREE.Vector3,ab=new THREE.Vector3;for(var f=0,fl=this.faces.length;f<fl;f++){var face=this.faces[f];var vA=this.vertices[face.a];var vB=this.vertices[face.b];var vC=this.vertices[face.c];cb.subVectors(vC,vB);ab.subVectors(vA,vB);cb.cross(ab);cb.normalize();face.normal.copy(cb)}},computeVertexNormals:function(areaWeighted){var v,vl,f,fl,face,vertices;vertices=new Array(this.vertices.length);for(v=0,vl=this.vertices.length;v<vl;v++){vertices[v]=new THREE.Vector3}if(areaWeighted){var vA,vB,vC,vD;var cb=new THREE.Vector3,ab=new THREE.Vector3,db=new THREE.Vector3,dc=new THREE.Vector3,bc=new THREE.Vector3;for(f=0,fl=this.faces.length;f<fl;f++){face=this.faces[f];vA=this.vertices[face.a];vB=this.vertices[face.b];vC=this.vertices[face.c];cb.subVectors(vC,vB);ab.subVectors(vA,vB);cb.cross(ab);vertices[face.a].add(cb);vertices[face.b].add(cb);vertices[face.c].add(cb)}}else{for(f=0,fl=this.faces.length;f<fl;f++){face=this.faces[f];vertices[face.a].add(face.normal);vertices[face.b].add(face.normal);vertices[face.c].add(face.normal)}}for(v=0,vl=this.vertices.length;v<vl;v++){vertices[v].normalize()}for(f=0,fl=this.faces.length;f<fl;f++){face=this.faces[f];face.vertexNormals[0]=vertices[face.a].clone();face.vertexNormals[1]=vertices[face.b].clone();face.vertexNormals[2]=vertices[face.c].clone()}},computeMorphNormals:function(){var i,il,f,fl,face;for(f=0,fl=this.faces.length;f<fl;f++){face=this.faces[f];if(!face.__originalFaceNormal){face.__originalFaceNormal=face.normal.clone()}else{face.__originalFaceNormal.copy(face.normal)}if(!face.__originalVertexNormals)face.__originalVertexNormals=[];for(i=0,il=face.vertexNormals.length;i<il;i++){if(!face.__originalVertexNormals[i]){face.__originalVertexNormals[i]=face.vertexNormals[i].clone()}else{face.__originalVertexNormals[i].copy(face.vertexNormals[i])}}}var tmpGeo=new THREE.Geometry;tmpGeo.faces=this.faces;for(i=0,il=this.morphTargets.length;i<il;i++){if(!this.morphNormals[i]){this.morphNormals[i]={};this.morphNormals[i].faceNormals=[];this.morphNormals[i].vertexNormals=[];var dstNormalsFace=this.morphNormals[i].faceNormals;var dstNormalsVertex=this.morphNormals[i].vertexNormals;var faceNormal,vertexNormals;for(f=0,fl=this.faces.length;f<fl;f++){faceNormal=new THREE.Vector3;vertexNormals={a:new THREE.Vector3,b:new THREE.Vector3,c:new THREE.Vector3};dstNormalsFace.push(faceNormal);dstNormalsVertex.push(vertexNormals)}}var morphNormals=this.morphNormals[i];tmpGeo.vertices=this.morphTargets[i].vertices;tmpGeo.computeFaceNormals();tmpGeo.computeVertexNormals();var faceNormal,vertexNormals;for(f=0,fl=this.faces.length;f<fl;f++){face=this.faces[f];faceNormal=morphNormals.faceNormals[f];vertexNormals=morphNormals.vertexNormals[f];faceNormal.copy(face.normal);vertexNormals.a.copy(face.vertexNormals[0]);vertexNormals.b.copy(face.vertexNormals[1]);vertexNormals.c.copy(face.vertexNormals[2])}}for(f=0,fl=this.faces.length;f<fl;f++){face=this.faces[f];face.normal=face.__originalFaceNormal;face.vertexNormals=face.__originalVertexNormals}},computeTangents:function(){var f,fl,v,vl,i,il,vertexIndex,face,uv,vA,vB,vC,uvA,uvB,uvC,x1,x2,y1,y2,z1,z2,s1,s2,t1,t2,r,t,test,tan1=[],tan2=[],sdir=new THREE.Vector3,tdir=new THREE.Vector3,tmp=new THREE.Vector3,tmp2=new THREE.Vector3,n=new THREE.Vector3,w;for(v=0,vl=this.vertices.length;v<vl;v++){tan1[v]=new THREE.Vector3;tan2[v]=new THREE.Vector3}function handleTriangle(context,a,b,c,ua,ub,uc){vA=context.vertices[a];vB=context.vertices[b];vC=context.vertices[c];uvA=uv[ua];uvB=uv[ub];uvC=uv[uc];x1=vB.x-vA.x;x2=vC.x-vA.x;y1=vB.y-vA.y;y2=vC.y-vA.y;z1=vB.z-vA.z;z2=vC.z-vA.z;s1=uvB.x-uvA.x;s2=uvC.x-uvA.x;t1=uvB.y-uvA.y;t2=uvC.y-uvA.y;r=1/(s1*t2-s2*t1);sdir.set((t2*x1-t1*x2)*r,(t2*y1-t1*y2)*r,(t2*z1-t1*z2)*r);tdir.set((s1*x2-s2*x1)*r,(s1*y2-s2*y1)*r,(s1*z2-s2*z1)*r);tan1[a].add(sdir);tan1[b].add(sdir);tan1[c].add(sdir);tan2[a].add(tdir);tan2[b].add(tdir);tan2[c].add(tdir)}for(f=0,fl=this.faces.length;f<fl;f++){face=this.faces[f];uv=this.faceVertexUvs[0][f];handleTriangle(this,face.a,face.b,face.c,0,1,2)}var faceIndex=["a","b","c","d"];for(f=0,fl=this.faces.length;f<fl;f++){face=this.faces[f];for(i=0;i<Math.min(face.vertexNormals.length,3);i++){n.copy(face.vertexNormals[i]);vertexIndex=face[faceIndex[i]];t=tan1[vertexIndex];tmp.copy(t);tmp.sub(n.multiplyScalar(n.dot(t))).normalize();tmp2.crossVectors(face.vertexNormals[i],t);test=tmp2.dot(tan2[vertexIndex]);w=test<0?-1:1;face.vertexTangents[i]=new THREE.Vector4(tmp.x,tmp.y,tmp.z,w)}}this.hasTangents=true},computeLineDistances:function(){var d=0;var vertices=this.vertices;for(var i=0,il=vertices.length;i<il;i++){if(i>0){d+=vertices[i].distanceTo(vertices[i-1])}this.lineDistances[i]=d}},computeBoundingBox:function(){if(this.boundingBox===null){this.boundingBox=new THREE.Box3}this.boundingBox.setFromPoints(this.vertices)},computeBoundingSphere:function(){if(this.boundingSphere===null){this.boundingSphere=new THREE.Sphere}this.boundingSphere.setFromPoints(this.vertices)},merge:function(geometry,matrix,materialIndexOffset){if(geometry instanceof THREE.Geometry===false){console.error("THREE.Geometry.merge(): geometry not an instance of THREE.Geometry.",geometry);return}var normalMatrix,vertexOffset=this.vertices.length,vertices1=this.vertices,vertices2=geometry.vertices,faces1=this.faces,faces2=geometry.faces,uvs1=this.faceVertexUvs[0],uvs2=geometry.faceVertexUvs[0];if(materialIndexOffset===undefined)materialIndexOffset=0;if(matrix!==undefined){normalMatrix=(new THREE.Matrix3).getNormalMatrix(matrix)}for(var i=0,il=vertices2.length;i<il;i++){var vertex=vertices2[i];var vertexCopy=vertex.clone();if(matrix!==undefined)vertexCopy.applyMatrix4(matrix);vertices1.push(vertexCopy)}for(i=0,il=faces2.length;i<il;i++){var face=faces2[i],faceCopy,normal,color,faceVertexNormals=face.vertexNormals,faceVertexColors=face.vertexColors;faceCopy=new THREE.Face3(face.a+vertexOffset,face.b+vertexOffset,face.c+vertexOffset);faceCopy.normal.copy(face.normal);if(normalMatrix!==undefined){faceCopy.normal.applyMatrix3(normalMatrix).normalize()}for(var j=0,jl=faceVertexNormals.length;j<jl;j++){normal=faceVertexNormals[j].clone();if(normalMatrix!==undefined){normal.applyMatrix3(normalMatrix).normalize()}faceCopy.vertexNormals.push(normal)}faceCopy.color.copy(face.color);for(var j=0,jl=faceVertexColors.length;j<jl;j++){color=faceVertexColors[j];faceCopy.vertexColors.push(color.clone())}faceCopy.materialIndex=face.materialIndex+materialIndexOffset;faces1.push(faceCopy)}for(i=0,il=uvs2.length;i<il;i++){var uv=uvs2[i],uvCopy=[];if(uv===undefined){continue}for(var j=0,jl=uv.length;j<jl;j++){uvCopy.push(new THREE.Vector2(uv[j].x,uv[j].y))}uvs1.push(uvCopy)}},mergeVertices:function(){var verticesMap={};var unique=[],changes=[];var v,key;var precisionPoints=4;var precision=Math.pow(10,precisionPoints);var i,il,face;var indices,k,j,jl,u;for(i=0,il=this.vertices.length;i<il;i++){v=this.vertices[i];key=Math.round(v.x*precision)+"_"+Math.round(v.y*precision)+"_"+Math.round(v.z*precision);if(verticesMap[key]===undefined){verticesMap[key]=i;unique.push(this.vertices[i]);changes[i]=unique.length-1}else{changes[i]=changes[verticesMap[key]]}}var faceIndicesToRemove=[];for(i=0,il=this.faces.length;i<il;i++){face=this.faces[i];face.a=changes[face.a];face.b=changes[face.b];face.c=changes[face.c];indices=[face.a,face.b,face.c];var dupIndex=-1;for(var n=0;n<3;n++){if(indices[n]==indices[(n+1)%3]){dupIndex=n;faceIndicesToRemove.push(i);break}}}for(i=faceIndicesToRemove.length-1;i>=0;i--){var idx=faceIndicesToRemove[i];this.faces.splice(idx,1);for(j=0,jl=this.faceVertexUvs.length;j<jl;j++){this.faceVertexUvs[j].splice(idx,1)}}var diff=this.vertices.length-unique.length;this.vertices=unique;return diff},toJSON:function(){var output={metadata:{version:4,type:"BufferGeometry",generator:"BufferGeometryExporter"},uuid:this.uuid,type:this.type};if(this.name!=="")output.name=this.name;if(this.parameters!==undefined){var parameters=this.parameters;for(var key in parameters){if(parameters[key]!==undefined)output[key]=parameters[key]}return output}var vertices=[];for(var i=0;i<this.vertices.length;i++){var vertex=this.vertices[i];vertices.push(vertex.x,vertex.y,vertex.z)}var faces=[];var normals=[];var normalsHash={};var colors=[];var colorsHash={};var uvs=[];var uvsHash={};for(var i=0;i<this.faces.length;i++){var face=this.faces[i];var hasMaterial=false;var hasFaceUv=false;var hasFaceVertexUv=this.faceVertexUvs[0][i]!==undefined;var hasFaceNormal=face.normal.length()>0;var hasFaceVertexNormal=face.vertexNormals.length>0;var hasFaceColor=face.color.r!==1||face.color.g!==1||face.color.b!==1;var hasFaceVertexColor=face.vertexColors.length>0;var faceType=0;faceType=setBit(faceType,0,0);faceType=setBit(faceType,1,hasMaterial);faceType=setBit(faceType,2,hasFaceUv);faceType=setBit(faceType,3,hasFaceVertexUv);faceType=setBit(faceType,4,hasFaceNormal);faceType=setBit(faceType,5,hasFaceVertexNormal);faceType=setBit(faceType,6,hasFaceColor);faceType=setBit(faceType,7,hasFaceVertexColor);faces.push(faceType);faces.push(face.a,face.b,face.c);if(hasFaceVertexUv){var faceVertexUvs=this.faceVertexUvs[0][i];faces.push(getUvIndex(faceVertexUvs[0]),getUvIndex(faceVertexUvs[1]),getUvIndex(faceVertexUvs[2]))}if(hasFaceNormal){faces.push(getNormalIndex(face.normal))}if(hasFaceVertexNormal){var vertexNormals=face.vertexNormals;faces.push(getNormalIndex(vertexNormals[0]),getNormalIndex(vertexNormals[1]),getNormalIndex(vertexNormals[2]))}if(hasFaceColor){faces.push(getColorIndex(face.color))}if(hasFaceVertexColor){var vertexColors=face.vertexColors;faces.push(getColorIndex(vertexColors[0]),getColorIndex(vertexColors[1]),getColorIndex(vertexColors[2]))}}function setBit(value,position,enabled){return enabled?value|1<<position:value&~(1<<position)}function getNormalIndex(normal){var hash=normal.x.toString()+normal.y.toString()+normal.z.toString();if(normalsHash[hash]!==undefined){return normalsHash[hash]}normalsHash[hash]=normals.length/3;normals.push(normal.x,normal.y,normal.z);return normalsHash[hash]}function getColorIndex(color){var hash=color.r.toString()+color.g.toString()+color.b.toString();if(colorsHash[hash]!==undefined){return colorsHash[hash]}colorsHash[hash]=colors.length;colors.push(color.getHex());return colorsHash[hash]}function getUvIndex(uv){var hash=uv.x.toString()+uv.y.toString();if(uvsHash[hash]!==undefined){return uvsHash[hash]}uvsHash[hash]=uvs.length/2;uvs.push(uv.x,uv.y);return uvsHash[hash]}output.data={};output.data.vertices=vertices;output.data.normals=normals;if(colors.length>0)output.data.colors=colors;if(uvs.length>0)output.data.uvs=[uvs];output.data.faces=faces;return output},clone:function(){var geometry=new THREE.Geometry;var vertices=this.vertices;for(var i=0,il=vertices.length;i<il;i++){geometry.vertices.push(vertices[i].clone())}var faces=this.faces;for(var i=0,il=faces.length;i<il;i++){geometry.faces.push(faces[i].clone())}var uvs=this.faceVertexUvs[0];for(var i=0,il=uvs.length;i<il;i++){var uv=uvs[i],uvCopy=[];for(var j=0,jl=uv.length;j<jl;j++){uvCopy.push(new THREE.Vector2(uv[j].x,uv[j].y))}geometry.faceVertexUvs[0].push(uvCopy)}return geometry},dispose:function(){this.dispatchEvent({type:"dispose"})}};THREE.EventDispatcher.prototype.apply(THREE.Geometry.prototype);THREE.GeometryIdCount=0;THREE.Camera=function(){THREE.Object3D.call(this);this.type="Camera";this.matrixWorldInverse=new THREE.Matrix4;this.projectionMatrix=new THREE.Matrix4};THREE.Camera.prototype=Object.create(THREE.Object3D.prototype);THREE.Camera.prototype.getWorldDirection=function(){var quaternion=new THREE.Quaternion;return function(optionalTarget){var result=optionalTarget||new THREE.Vector3;this.getWorldQuaternion(quaternion);return result.set(0,0,-1).applyQuaternion(quaternion)}}();THREE.Camera.prototype.lookAt=function(){var m1=new THREE.Matrix4;return function(vector){m1.lookAt(this.position,vector,this.up);this.quaternion.setFromRotationMatrix(m1)}}();THREE.Camera.prototype.clone=function(camera){if(camera===undefined)camera=new THREE.Camera;THREE.Object3D.prototype.clone.call(this,camera);camera.matrixWorldInverse.copy(this.matrixWorldInverse);camera.projectionMatrix.copy(this.projectionMatrix);return camera};THREE.CubeCamera=function(near,far,cubeResolution){THREE.Object3D.call(this);this.type="CubeCamera";var fov=90,aspect=1;var cameraPX=new THREE.PerspectiveCamera(fov,aspect,near,far);cameraPX.up.set(0,-1,0);cameraPX.lookAt(new THREE.Vector3(1,0,0));this.add(cameraPX);var cameraNX=new THREE.PerspectiveCamera(fov,aspect,near,far);cameraNX.up.set(0,-1,0);cameraNX.lookAt(new THREE.Vector3(-1,0,0));this.add(cameraNX);var cameraPY=new THREE.PerspectiveCamera(fov,aspect,near,far);cameraPY.up.set(0,0,1);cameraPY.lookAt(new THREE.Vector3(0,1,0));this.add(cameraPY);var cameraNY=new THREE.PerspectiveCamera(fov,aspect,near,far);cameraNY.up.set(0,0,-1);cameraNY.lookAt(new THREE.Vector3(0,-1,0));this.add(cameraNY);var cameraPZ=new THREE.PerspectiveCamera(fov,aspect,near,far);cameraPZ.up.set(0,-1,0);cameraPZ.lookAt(new THREE.Vector3(0,0,1));this.add(cameraPZ);var cameraNZ=new THREE.PerspectiveCamera(fov,aspect,near,far);cameraNZ.up.set(0,-1,0);cameraNZ.lookAt(new THREE.Vector3(0,0,-1));this.add(cameraNZ);this.renderTarget=new THREE.WebGLRenderTargetCube(cubeResolution,cubeResolution,{format:THREE.RGBFormat,magFilter:THREE.LinearFilter,minFilter:THREE.LinearFilter});this.updateCubeMap=function(renderer,scene){var renderTarget=this.renderTarget;var generateMipmaps=renderTarget.generateMipmaps;renderTarget.generateMipmaps=false;renderTarget.activeCubeFace=0;renderer.render(scene,cameraPX,renderTarget);renderTarget.activeCubeFace=1;renderer.render(scene,cameraNX,renderTarget);renderTarget.activeCubeFace=2;renderer.render(scene,cameraPY,renderTarget);renderTarget.activeCubeFace=3;renderer.render(scene,cameraNY,renderTarget);renderTarget.activeCubeFace=4;renderer.render(scene,cameraPZ,renderTarget);renderTarget.generateMipmaps=generateMipmaps;renderTarget.activeCubeFace=5;renderer.render(scene,cameraNZ,renderTarget)}};THREE.CubeCamera.prototype=Object.create(THREE.Object3D.prototype);THREE.OrthographicCamera=function(left,right,top,bottom,near,far){THREE.Camera.call(this);this.type="OrthographicCamera";this.zoom=1;this.left=left;this.right=right;this.top=top;this.bottom=bottom;this.near=near!==undefined?near:.1;this.far=far!==undefined?far:2e3;this.updateProjectionMatrix()};THREE.OrthographicCamera.prototype=Object.create(THREE.Camera.prototype);THREE.OrthographicCamera.prototype.updateProjectionMatrix=function(){var dx=(this.right-this.left)/(2*this.zoom);var dy=(this.top-this.bottom)/(2*this.zoom);var cx=(this.right+this.left)/2;var cy=(this.top+this.bottom)/2;this.projectionMatrix.makeOrthographic(cx-dx,cx+dx,cy+dy,cy-dy,this.near,this.far)};THREE.OrthographicCamera.prototype.clone=function(){var camera=new THREE.OrthographicCamera;THREE.Camera.prototype.clone.call(this,camera);camera.zoom=this.zoom;camera.left=this.left;camera.right=this.right;camera.top=this.top;camera.bottom=this.bottom;camera.near=this.near;camera.far=this.far;camera.projectionMatrix.copy(this.projectionMatrix);return camera};THREE.PerspectiveCamera=function(fov,aspect,near,far){THREE.Camera.call(this);this.type="PerspectiveCamera";this.zoom=1;this.fov=fov!==undefined?fov:50;this.aspect=aspect!==undefined?aspect:1;this.near=near!==undefined?near:.1;this.far=far!==undefined?far:2e3;this.updateProjectionMatrix()};THREE.PerspectiveCamera.prototype=Object.create(THREE.Camera.prototype);THREE.PerspectiveCamera.prototype.setLens=function(focalLength,frameHeight){if(frameHeight===undefined)frameHeight=24;this.fov=2*THREE.Math.radToDeg(Math.atan(frameHeight/(focalLength*2)));this.updateProjectionMatrix()};THREE.PerspectiveCamera.prototype.setViewOffset=function(fullWidth,fullHeight,x,y,width,height){this.fullWidth=fullWidth;this.fullHeight=fullHeight;this.x=x;this.y=y;this.width=width;this.height=height;this.updateProjectionMatrix()};THREE.PerspectiveCamera.prototype.updateProjectionMatrix=function(){var fov=THREE.Math.radToDeg(2*Math.atan(Math.tan(THREE.Math.degToRad(this.fov)*.5)/this.zoom));if(this.fullWidth){var aspect=this.fullWidth/this.fullHeight;var top=Math.tan(THREE.Math.degToRad(fov*.5))*this.near;var bottom=-top;var left=aspect*bottom;var right=aspect*top;var width=Math.abs(right-left);var height=Math.abs(top-bottom);this.projectionMatrix.makeFrustum(left+this.x*width/this.fullWidth,left+(this.x+this.width)*width/this.fullWidth,top-(this.y+this.height)*height/this.fullHeight,top-this.y*height/this.fullHeight,this.near,this.far)}else{this.projectionMatrix.makePerspective(fov,this.aspect,this.near,this.far)}};THREE.PerspectiveCamera.prototype.clone=function(){var camera=new THREE.PerspectiveCamera;THREE.Camera.prototype.clone.call(this,camera);camera.zoom=this.zoom;camera.fov=this.fov;camera.aspect=this.aspect;camera.near=this.near;camera.far=this.far;camera.projectionMatrix.copy(this.projectionMatrix);return camera};THREE.Light=function(color){THREE.Object3D.call(this);this.type="Light";this.color=new THREE.Color(color)};THREE.Light.prototype=Object.create(THREE.Object3D.prototype);THREE.Light.prototype.clone=function(light){if(light===undefined)light=new THREE.Light;THREE.Object3D.prototype.clone.call(this,light);light.color.copy(this.color);return light};THREE.AmbientLight=function(color){THREE.Light.call(this,color);this.type="AmbientLight"};THREE.AmbientLight.prototype=Object.create(THREE.Light.prototype);THREE.AmbientLight.prototype.clone=function(){var light=new THREE.AmbientLight;THREE.Light.prototype.clone.call(this,light);return light};THREE.AreaLight=function(color,intensity){THREE.Light.call(this,color);this.type="AreaLight";this.normal=new THREE.Vector3(0,-1,0);this.right=new THREE.Vector3(1,0,0);this.intensity=intensity!==undefined?intensity:1;this.width=1;this.height=1;this.constantAttenuation=1.5;this.linearAttenuation=.5;this.quadraticAttenuation=.1};THREE.AreaLight.prototype=Object.create(THREE.Light.prototype);THREE.DirectionalLight=function(color,intensity){THREE.Light.call(this,color);this.type="DirectionalLight";this.position.set(0,1,0);this.target=new THREE.Object3D;this.intensity=intensity!==undefined?intensity:1;this.castShadow=false;this.onlyShadow=false;this.shadowCameraNear=50;this.shadowCameraFar=5e3;this.shadowCameraLeft=-500;this.shadowCameraRight=500;this.shadowCameraTop=500;this.shadowCameraBottom=-500;this.shadowCameraVisible=false;this.shadowBias=0;this.shadowDarkness=.5;this.shadowMapWidth=512;this.shadowMapHeight=512;this.shadowCascade=false;this.shadowCascadeOffset=new THREE.Vector3(0,0,-1e3);this.shadowCascadeCount=2;this.shadowCascadeBias=[0,0,0];this.shadowCascadeWidth=[512,512,512];this.shadowCascadeHeight=[512,512,512];this.shadowCascadeNearZ=[-1,.99,.998];this.shadowCascadeFarZ=[.99,.998,1];this.shadowCascadeArray=[];this.shadowMap=null;this.shadowMapSize=null;this.shadowCamera=null;this.shadowMatrix=null};THREE.DirectionalLight.prototype=Object.create(THREE.Light.prototype);THREE.DirectionalLight.prototype.clone=function(){var light=new THREE.DirectionalLight;THREE.Light.prototype.clone.call(this,light);light.target=this.target.clone();light.intensity=this.intensity;light.castShadow=this.castShadow;light.onlyShadow=this.onlyShadow;light.shadowCameraNear=this.shadowCameraNear;light.shadowCameraFar=this.shadowCameraFar;light.shadowCameraLeft=this.shadowCameraLeft;light.shadowCameraRight=this.shadowCameraRight;light.shadowCameraTop=this.shadowCameraTop;light.shadowCameraBottom=this.shadowCameraBottom;light.shadowCameraVisible=this.shadowCameraVisible;light.shadowBias=this.shadowBias;light.shadowDarkness=this.shadowDarkness;light.shadowMapWidth=this.shadowMapWidth;light.shadowMapHeight=this.shadowMapHeight;light.shadowCascade=this.shadowCascade;light.shadowCascadeOffset.copy(this.shadowCascadeOffset);light.shadowCascadeCount=this.shadowCascadeCount;light.shadowCascadeBias=this.shadowCascadeBias.slice(0);light.shadowCascadeWidth=this.shadowCascadeWidth.slice(0);light.shadowCascadeHeight=this.shadowCascadeHeight.slice(0);light.shadowCascadeNearZ=this.shadowCascadeNearZ.slice(0);light.shadowCascadeFarZ=this.shadowCascadeFarZ.slice(0);return light};THREE.HemisphereLight=function(skyColor,groundColor,intensity){THREE.Light.call(this,skyColor);this.type="HemisphereLight";this.position.set(0,100,0);this.groundColor=new THREE.Color(groundColor);this.intensity=intensity!==undefined?intensity:1};THREE.HemisphereLight.prototype=Object.create(THREE.Light.prototype);THREE.HemisphereLight.prototype.clone=function(){var light=new THREE.HemisphereLight;THREE.Light.prototype.clone.call(this,light);light.groundColor.copy(this.groundColor);light.intensity=this.intensity;return light};THREE.PointLight=function(color,intensity,distance){THREE.Light.call(this,color);this.type="PointLight";this.intensity=intensity!==undefined?intensity:1;this.distance=distance!==undefined?distance:0};THREE.PointLight.prototype=Object.create(THREE.Light.prototype);THREE.PointLight.prototype.clone=function(){var light=new THREE.PointLight;THREE.Light.prototype.clone.call(this,light);light.intensity=this.intensity;light.distance=this.distance;return light};THREE.SpotLight=function(color,intensity,distance,angle,exponent){THREE.Light.call(this,color);this.type="SpotLight";this.position.set(0,1,0);this.target=new THREE.Object3D;this.intensity=intensity!==undefined?intensity:1;this.distance=distance!==undefined?distance:0;this.angle=angle!==undefined?angle:Math.PI/3;this.exponent=exponent!==undefined?exponent:10;this.castShadow=false;this.onlyShadow=false;this.shadowCameraNear=50;this.shadowCameraFar=5e3;this.shadowCameraFov=50;this.shadowCameraVisible=false;this.shadowBias=0;this.shadowDarkness=.5;this.shadowMapWidth=512;this.shadowMapHeight=512;this.shadowMap=null;this.shadowMapSize=null;this.shadowCamera=null;this.shadowMatrix=null};THREE.SpotLight.prototype=Object.create(THREE.Light.prototype);THREE.SpotLight.prototype.clone=function(){var light=new THREE.SpotLight;THREE.Light.prototype.clone.call(this,light);light.target=this.target.clone();light.intensity=this.intensity;light.distance=this.distance;light.angle=this.angle;light.exponent=this.exponent;light.castShadow=this.castShadow;light.onlyShadow=this.onlyShadow;light.shadowCameraNear=this.shadowCameraNear;light.shadowCameraFar=this.shadowCameraFar;light.shadowCameraFov=this.shadowCameraFov;light.shadowCameraVisible=this.shadowCameraVisible;light.shadowBias=this.shadowBias;light.shadowDarkness=this.shadowDarkness;light.shadowMapWidth=this.shadowMapWidth;light.shadowMapHeight=this.shadowMapHeight;return light};THREE.Cache=function(){this.files={}};THREE.Cache.prototype={constructor:THREE.Cache,add:function(key,file){this.files[key]=file},get:function(key){return this.files[key]},remove:function(key){delete this.files[key]},clear:function(){this.files={}}};THREE.Loader=function(showStatus){this.showStatus=showStatus;this.statusDomElement=showStatus?THREE.Loader.prototype.addStatusElement():null;this.imageLoader=new THREE.ImageLoader;this.onLoadStart=function(){};this.onLoadProgress=function(){};this.onLoadComplete=function(){}};THREE.Loader.prototype={constructor:THREE.Loader,crossOrigin:undefined,addStatusElement:function(){var e=document.createElement("div");e.style.position="absolute";e.style.right="0px";e.style.top="0px";e.style.fontSize="0.8em";e.style.textAlign="left";e.style.background="rgba(0,0,0,0.25)";e.style.color="#fff";e.style.width="120px";e.style.padding="0.5em 0.5em 0.5em 0.5em";e.style.zIndex=1e3;e.innerHTML="Loading ...";return e},updateProgress:function(progress){var message="Loaded ";if(progress.total){message+=(100*progress.loaded/progress.total).toFixed(0)+"%"}else{message+=(progress.loaded/1024).toFixed(2)+" KB"}this.statusDomElement.innerHTML=message},extractUrlBase:function(url){var parts=url.split("/");if(parts.length===1)return"./";parts.pop();return parts.join("/")+"/"},initMaterials:function(materials,texturePath){var array=[];for(var i=0;i<materials.length;++i){array[i]=this.createMaterial(materials[i],texturePath)}return array},needsTangents:function(materials){for(var i=0,il=materials.length;i<il;i++){var m=materials[i];if(m instanceof THREE.ShaderMaterial)return true}return false},createMaterial:function(m,texturePath){var scope=this;function nearest_pow2(n){var l=Math.log(n)/Math.LN2;return Math.pow(2,Math.round(l))}function create_texture(where,name,sourceFile,repeat,offset,wrap,anisotropy){var fullPath=texturePath+sourceFile;var texture;var loader=THREE.Loader.Handlers.get(fullPath);if(loader!==null){texture=loader.load(fullPath)}else{texture=new THREE.Texture;loader=scope.imageLoader;loader.crossOrigin=scope.crossOrigin;loader.load(fullPath,function(image){if(THREE.Math.isPowerOfTwo(image.width)===false||THREE.Math.isPowerOfTwo(image.height)===false){var width=nearest_pow2(image.width);var height=nearest_pow2(image.height);var canvas=document.createElement("canvas");canvas.width=width;canvas.height=height;var context=canvas.getContext("2d");context.drawImage(image,0,0,width,height);texture.image=canvas}else{texture.image=image}texture.needsUpdate=true})}texture.sourceFile=sourceFile;if(repeat){texture.repeat.set(repeat[0],repeat[1]);if(repeat[0]!==1)texture.wrapS=THREE.RepeatWrapping;if(repeat[1]!==1)texture.wrapT=THREE.RepeatWrapping}if(offset){texture.offset.set(offset[0],offset[1])}if(wrap){var wrapMap={repeat:THREE.RepeatWrapping,mirror:THREE.MirroredRepeatWrapping};if(wrapMap[wrap[0]]!==undefined)texture.wrapS=wrapMap[wrap[0]];if(wrapMap[wrap[1]]!==undefined)texture.wrapT=wrapMap[wrap[1]]}if(anisotropy){texture.anisotropy=anisotropy}where[name]=texture}function rgb2hex(rgb){return(rgb[0]*255<<16)+(rgb[1]*255<<8)+rgb[2]*255}var mtype="MeshLambertMaterial";var mpars={color:15658734,opacity:1,map:null,lightMap:null,normalMap:null,bumpMap:null,wireframe:false};if(m.shading){var shading=m.shading.toLowerCase();if(shading==="phong")mtype="MeshPhongMaterial";else if(shading==="basic")mtype="MeshBasicMaterial"}if(m.blending!==undefined&&THREE[m.blending]!==undefined){mpars.blending=THREE[m.blending]}if(m.transparent!==undefined||m.opacity<1){mpars.transparent=m.transparent
}if(m.depthTest!==undefined){mpars.depthTest=m.depthTest}if(m.depthWrite!==undefined){mpars.depthWrite=m.depthWrite}if(m.visible!==undefined){mpars.visible=m.visible}if(m.flipSided!==undefined){mpars.side=THREE.BackSide}if(m.doubleSided!==undefined){mpars.side=THREE.DoubleSide}if(m.wireframe!==undefined){mpars.wireframe=m.wireframe}if(m.vertexColors!==undefined){if(m.vertexColors==="face"){mpars.vertexColors=THREE.FaceColors}else if(m.vertexColors){mpars.vertexColors=THREE.VertexColors}}if(m.colorDiffuse){mpars.color=rgb2hex(m.colorDiffuse)}else if(m.DbgColor){mpars.color=m.DbgColor}if(m.colorSpecular){mpars.specular=rgb2hex(m.colorSpecular)}if(m.colorAmbient){mpars.ambient=rgb2hex(m.colorAmbient)}if(m.colorEmissive){mpars.emissive=rgb2hex(m.colorEmissive)}if(m.transparency){mpars.opacity=m.transparency}if(m.specularCoef){mpars.shininess=m.specularCoef}if(m.mapDiffuse&&texturePath){create_texture(mpars,"map",m.mapDiffuse,m.mapDiffuseRepeat,m.mapDiffuseOffset,m.mapDiffuseWrap,m.mapDiffuseAnisotropy)}if(m.mapLight&&texturePath){create_texture(mpars,"lightMap",m.mapLight,m.mapLightRepeat,m.mapLightOffset,m.mapLightWrap,m.mapLightAnisotropy)}if(m.mapBump&&texturePath){create_texture(mpars,"bumpMap",m.mapBump,m.mapBumpRepeat,m.mapBumpOffset,m.mapBumpWrap,m.mapBumpAnisotropy)}if(m.mapNormal&&texturePath){create_texture(mpars,"normalMap",m.mapNormal,m.mapNormalRepeat,m.mapNormalOffset,m.mapNormalWrap,m.mapNormalAnisotropy)}if(m.mapSpecular&&texturePath){create_texture(mpars,"specularMap",m.mapSpecular,m.mapSpecularRepeat,m.mapSpecularOffset,m.mapSpecularWrap,m.mapSpecularAnisotropy)}if(m.mapAlpha&&texturePath){create_texture(mpars,"alphaMap",m.mapAlpha,m.mapAlphaRepeat,m.mapAlphaOffset,m.mapAlphaWrap,m.mapAlphaAnisotropy)}if(m.mapBumpScale){mpars.bumpScale=m.mapBumpScale}if(m.mapNormal){var shader=THREE.ShaderLib["normalmap"];var uniforms=THREE.UniformsUtils.clone(shader.uniforms);uniforms["tNormal"].value=mpars.normalMap;if(m.mapNormalFactor){uniforms["uNormalScale"].value.set(m.mapNormalFactor,m.mapNormalFactor)}if(mpars.map){uniforms["tDiffuse"].value=mpars.map;uniforms["enableDiffuse"].value=true}if(mpars.specularMap){uniforms["tSpecular"].value=mpars.specularMap;uniforms["enableSpecular"].value=true}if(mpars.lightMap){uniforms["tAO"].value=mpars.lightMap;uniforms["enableAO"].value=true}uniforms["diffuse"].value.setHex(mpars.color);uniforms["specular"].value.setHex(mpars.specular);uniforms["ambient"].value.setHex(mpars.ambient);uniforms["shininess"].value=mpars.shininess;if(mpars.opacity!==undefined){uniforms["opacity"].value=mpars.opacity}var parameters={fragmentShader:shader.fragmentShader,vertexShader:shader.vertexShader,uniforms:uniforms,lights:true,fog:true};var material=new THREE.ShaderMaterial(parameters);if(mpars.transparent){material.transparent=true}}else{var material=new THREE[mtype](mpars)}if(m.DbgName!==undefined)material.name=m.DbgName;return material}};THREE.Loader.Handlers={handlers:[],add:function(regex,loader){this.handlers.push(regex,loader)},get:function(file){for(var i=0,l=this.handlers.length;i<l;i+=2){var regex=this.handlers[i];var loader=this.handlers[i+1];if(regex.test(file)){return loader}}return null}};THREE.XHRLoader=function(manager){this.cache=new THREE.Cache;this.manager=manager!==undefined?manager:THREE.DefaultLoadingManager};THREE.XHRLoader.prototype={constructor:THREE.XHRLoader,load:function(url,onLoad,onProgress,onError){var scope=this;var cached=scope.cache.get(url);if(cached!==undefined){if(onLoad)onLoad(cached);return}var request=new XMLHttpRequest;request.open("GET",url,true);request.addEventListener("load",function(event){scope.cache.add(url,this.response);if(onLoad)onLoad(this.response);scope.manager.itemEnd(url)},false);if(onProgress!==undefined){request.addEventListener("progress",function(event){onProgress(event)},false)}if(onError!==undefined){request.addEventListener("error",function(event){onError(event)},false)}if(this.crossOrigin!==undefined)request.crossOrigin=this.crossOrigin;if(this.responseType!==undefined)request.responseType=this.responseType;request.send(null);scope.manager.itemStart(url)},setResponseType:function(value){this.responseType=value},setCrossOrigin:function(value){this.crossOrigin=value}};THREE.ImageLoader=function(manager){this.cache=new THREE.Cache;this.manager=manager!==undefined?manager:THREE.DefaultLoadingManager};THREE.ImageLoader.prototype={constructor:THREE.ImageLoader,load:function(url,onLoad,onProgress,onError){var scope=this;var cached=scope.cache.get(url);if(cached!==undefined){onLoad(cached);return}var image=document.createElement("img");if(onLoad!==undefined){image.addEventListener("load",function(event){scope.cache.add(url,this);onLoad(this);scope.manager.itemEnd(url)},false)}if(onProgress!==undefined){image.addEventListener("progress",function(event){onProgress(event)},false)}if(onError!==undefined){image.addEventListener("error",function(event){onError(event)},false)}if(this.crossOrigin!==undefined)image.crossOrigin=this.crossOrigin;image.src=url;scope.manager.itemStart(url);return image},setCrossOrigin:function(value){this.crossOrigin=value}};THREE.JSONLoader=function(showStatus){THREE.Loader.call(this,showStatus);this.withCredentials=false};THREE.JSONLoader.prototype=Object.create(THREE.Loader.prototype);THREE.JSONLoader.prototype.load=function(url,callback,texturePath){var scope=this;texturePath=texturePath&&typeof texturePath==="string"?texturePath:this.extractUrlBase(url);this.onLoadStart();this.loadAjaxJSON(this,url,callback,texturePath)};THREE.JSONLoader.prototype.loadAjaxJSON=function(context,url,callback,texturePath,callbackProgress){var xhr=new XMLHttpRequest;var length=0;xhr.onreadystatechange=function(){if(xhr.readyState===xhr.DONE){if(xhr.status===200||xhr.status===0){if(xhr.responseText){var json=JSON.parse(xhr.responseText);if(json.metadata!==undefined&&json.metadata.type==="scene"){console.error('THREE.JSONLoader: "'+url+'" seems to be a Scene. Use THREE.SceneLoader instead.');return}var result=context.parse(json,texturePath);callback(result.geometry,result.materials)}else{console.error('THREE.JSONLoader: "'+url+'" seems to be unreachable or the file is empty.')}context.onLoadComplete()}else{console.error("THREE.JSONLoader: Couldn't load \""+url+'" ('+xhr.status+")")}}else if(xhr.readyState===xhr.LOADING){if(callbackProgress){if(length===0){length=xhr.getResponseHeader("Content-Length")}callbackProgress({total:length,loaded:xhr.responseText.length})}}else if(xhr.readyState===xhr.HEADERS_RECEIVED){if(callbackProgress!==undefined){length=xhr.getResponseHeader("Content-Length")}}};xhr.open("GET",url,true);xhr.withCredentials=this.withCredentials;xhr.send(null)};THREE.JSONLoader.prototype.parse=function(json,texturePath){var scope=this,geometry=new THREE.Geometry,scale=json.scale!==undefined?1/json.scale:1;parseModel(scale);parseSkin();parseMorphing(scale);geometry.computeFaceNormals();geometry.computeBoundingSphere();function parseModel(scale){function isBitSet(value,position){return value&1<<position}var i,j,fi,offset,zLength,colorIndex,normalIndex,uvIndex,materialIndex,type,isQuad,hasMaterial,hasFaceVertexUv,hasFaceNormal,hasFaceVertexNormal,hasFaceColor,hasFaceVertexColor,vertex,face,faceA,faceB,color,hex,normal,uvLayer,uv,u,v,faces=json.faces,vertices=json.vertices,normals=json.normals,colors=json.colors,nUvLayers=0;if(json.uvs!==undefined){for(i=0;i<json.uvs.length;i++){if(json.uvs[i].length)nUvLayers++}for(i=0;i<nUvLayers;i++){geometry.faceVertexUvs[i]=[]}}offset=0;zLength=vertices.length;while(offset<zLength){vertex=new THREE.Vector3;vertex.x=vertices[offset++]*scale;vertex.y=vertices[offset++]*scale;vertex.z=vertices[offset++]*scale;geometry.vertices.push(vertex)}offset=0;zLength=faces.length;while(offset<zLength){type=faces[offset++];isQuad=isBitSet(type,0);hasMaterial=isBitSet(type,1);hasFaceVertexUv=isBitSet(type,3);hasFaceNormal=isBitSet(type,4);hasFaceVertexNormal=isBitSet(type,5);hasFaceColor=isBitSet(type,6);hasFaceVertexColor=isBitSet(type,7);if(isQuad){faceA=new THREE.Face3;faceA.a=faces[offset];faceA.b=faces[offset+1];faceA.c=faces[offset+3];faceB=new THREE.Face3;faceB.a=faces[offset+1];faceB.b=faces[offset+2];faceB.c=faces[offset+3];offset+=4;if(hasMaterial){materialIndex=faces[offset++];faceA.materialIndex=materialIndex;faceB.materialIndex=materialIndex}fi=geometry.faces.length;if(hasFaceVertexUv){for(i=0;i<nUvLayers;i++){uvLayer=json.uvs[i];geometry.faceVertexUvs[i][fi]=[];geometry.faceVertexUvs[i][fi+1]=[];for(j=0;j<4;j++){uvIndex=faces[offset++];u=uvLayer[uvIndex*2];v=uvLayer[uvIndex*2+1];uv=new THREE.Vector2(u,v);if(j!==2)geometry.faceVertexUvs[i][fi].push(uv);if(j!==0)geometry.faceVertexUvs[i][fi+1].push(uv)}}}if(hasFaceNormal){normalIndex=faces[offset++]*3;faceA.normal.set(normals[normalIndex++],normals[normalIndex++],normals[normalIndex]);faceB.normal.copy(faceA.normal)}if(hasFaceVertexNormal){for(i=0;i<4;i++){normalIndex=faces[offset++]*3;normal=new THREE.Vector3(normals[normalIndex++],normals[normalIndex++],normals[normalIndex]);if(i!==2)faceA.vertexNormals.push(normal);if(i!==0)faceB.vertexNormals.push(normal)}}if(hasFaceColor){colorIndex=faces[offset++];hex=colors[colorIndex];faceA.color.setHex(hex);faceB.color.setHex(hex)}if(hasFaceVertexColor){for(i=0;i<4;i++){colorIndex=faces[offset++];hex=colors[colorIndex];if(i!==2)faceA.vertexColors.push(new THREE.Color(hex));if(i!==0)faceB.vertexColors.push(new THREE.Color(hex))}}geometry.faces.push(faceA);geometry.faces.push(faceB)}else{face=new THREE.Face3;face.a=faces[offset++];face.b=faces[offset++];face.c=faces[offset++];if(hasMaterial){materialIndex=faces[offset++];face.materialIndex=materialIndex}fi=geometry.faces.length;if(hasFaceVertexUv){for(i=0;i<nUvLayers;i++){uvLayer=json.uvs[i];geometry.faceVertexUvs[i][fi]=[];for(j=0;j<3;j++){uvIndex=faces[offset++];u=uvLayer[uvIndex*2];v=uvLayer[uvIndex*2+1];uv=new THREE.Vector2(u,v);geometry.faceVertexUvs[i][fi].push(uv)}}}if(hasFaceNormal){normalIndex=faces[offset++]*3;face.normal.set(normals[normalIndex++],normals[normalIndex++],normals[normalIndex])}if(hasFaceVertexNormal){for(i=0;i<3;i++){normalIndex=faces[offset++]*3;normal=new THREE.Vector3(normals[normalIndex++],normals[normalIndex++],normals[normalIndex]);face.vertexNormals.push(normal)}}if(hasFaceColor){colorIndex=faces[offset++];face.color.setHex(colors[colorIndex])}if(hasFaceVertexColor){for(i=0;i<3;i++){colorIndex=faces[offset++];face.vertexColors.push(new THREE.Color(colors[colorIndex]))}}geometry.faces.push(face)}}}function parseSkin(){var influencesPerVertex=json.influencesPerVertex!==undefined?json.influencesPerVertex:2;if(json.skinWeights){for(var i=0,l=json.skinWeights.length;i<l;i+=influencesPerVertex){var x=json.skinWeights[i];var y=influencesPerVertex>1?json.skinWeights[i+1]:0;var z=influencesPerVertex>2?json.skinWeights[i+2]:0;var w=influencesPerVertex>3?json.skinWeights[i+3]:0;geometry.skinWeights.push(new THREE.Vector4(x,y,z,w))}}if(json.skinIndices){for(var i=0,l=json.skinIndices.length;i<l;i+=influencesPerVertex){var a=json.skinIndices[i];var b=influencesPerVertex>1?json.skinIndices[i+1]:0;var c=influencesPerVertex>2?json.skinIndices[i+2]:0;var d=influencesPerVertex>3?json.skinIndices[i+3]:0;geometry.skinIndices.push(new THREE.Vector4(a,b,c,d))}}geometry.bones=json.bones;if(geometry.bones&&geometry.bones.length>0&&(geometry.skinWeights.length!==geometry.skinIndices.length||geometry.skinIndices.length!==geometry.vertices.length)){console.warn("When skinning, number of vertices ("+geometry.vertices.length+"), skinIndices ("+geometry.skinIndices.length+"), and skinWeights ("+geometry.skinWeights.length+") should match.")}geometry.animation=json.animation;geometry.animations=json.animations}function parseMorphing(scale){if(json.morphTargets!==undefined){var i,l,v,vl,dstVertices,srcVertices;for(i=0,l=json.morphTargets.length;i<l;i++){geometry.morphTargets[i]={};geometry.morphTargets[i].name=json.morphTargets[i].name;geometry.morphTargets[i].vertices=[];dstVertices=geometry.morphTargets[i].vertices;srcVertices=json.morphTargets[i].vertices;for(v=0,vl=srcVertices.length;v<vl;v+=3){var vertex=new THREE.Vector3;vertex.x=srcVertices[v]*scale;vertex.y=srcVertices[v+1]*scale;vertex.z=srcVertices[v+2]*scale;dstVertices.push(vertex)}}}if(json.morphColors!==undefined){var i,l,c,cl,dstColors,srcColors,color;for(i=0,l=json.morphColors.length;i<l;i++){geometry.morphColors[i]={};geometry.morphColors[i].name=json.morphColors[i].name;geometry.morphColors[i].colors=[];dstColors=geometry.morphColors[i].colors;srcColors=json.morphColors[i].colors;for(c=0,cl=srcColors.length;c<cl;c+=3){color=new THREE.Color(16755200);color.setRGB(srcColors[c],srcColors[c+1],srcColors[c+2]);dstColors.push(color)}}}}if(json.materials===undefined||json.materials.length===0){return{geometry:geometry}}else{var materials=this.initMaterials(json.materials,texturePath);if(this.needsTangents(materials)){geometry.computeTangents()}return{geometry:geometry,materials:materials}}};THREE.LoadingManager=function(onLoad,onProgress,onError){var scope=this;var loaded=0,total=0;this.onLoad=onLoad;this.onProgress=onProgress;this.onError=onError;this.itemStart=function(url){total++};this.itemEnd=function(url){loaded++;if(scope.onProgress!==undefined){scope.onProgress(url,loaded,total)}if(loaded===total&&scope.onLoad!==undefined){scope.onLoad()}}};THREE.DefaultLoadingManager=new THREE.LoadingManager;THREE.BufferGeometryLoader=function(manager){this.manager=manager!==undefined?manager:THREE.DefaultLoadingManager};THREE.BufferGeometryLoader.prototype={constructor:THREE.BufferGeometryLoader,load:function(url,onLoad,onProgress,onError){var scope=this;var loader=new THREE.XHRLoader;loader.setCrossOrigin(this.crossOrigin);loader.load(url,function(text){onLoad(scope.parse(JSON.parse(text)))},onProgress,onError)},setCrossOrigin:function(value){this.crossOrigin=value},parse:function(json){var geometry=new THREE.BufferGeometry;var attributes=json.attributes;for(var key in attributes){var attribute=attributes[key];var typedArray=new self[attribute.type](attribute.array);geometry.addAttribute(key,new THREE.BufferAttribute(typedArray,attribute.itemSize))}var offsets=json.offsets;if(offsets!==undefined){geometry.offsets=JSON.parse(JSON.stringify(offsets))}var boundingSphere=json.boundingSphere;if(boundingSphere!==undefined){var center=new THREE.Vector3;if(boundingSphere.center!==undefined){center.fromArray(boundingSphere.center)}geometry.boundingSphere=new THREE.Sphere(center,boundingSphere.radius)}return geometry}};THREE.MaterialLoader=function(manager){this.manager=manager!==undefined?manager:THREE.DefaultLoadingManager};THREE.MaterialLoader.prototype={constructor:THREE.MaterialLoader,load:function(url,onLoad,onProgress,onError){var scope=this;var loader=new THREE.XHRLoader;loader.setCrossOrigin(this.crossOrigin);loader.load(url,function(text){onLoad(scope.parse(JSON.parse(text)))},onProgress,onError)},setCrossOrigin:function(value){this.crossOrigin=value},parse:function(json){var material=new THREE[json.type];if(json.color!==undefined)material.color.setHex(json.color);if(json.ambient!==undefined)material.ambient.setHex(json.ambient);if(json.emissive!==undefined)material.emissive.setHex(json.emissive);if(json.specular!==undefined)material.specular.setHex(json.specular);if(json.shininess!==undefined)material.shininess=json.shininess;if(json.uniforms!==undefined)material.uniforms=json.uniforms;if(json.vertexShader!==undefined)material.vertexShader=json.vertexShader;if(json.fragmentShader!==undefined)material.fragmentShader=json.fragmentShader;if(json.vertexColors!==undefined)material.vertexColors=json.vertexColors;if(json.shading!==undefined)material.shading=json.shading;if(json.blending!==undefined)material.blending=json.blending;if(json.side!==undefined)material.side=json.side;if(json.opacity!==undefined)material.opacity=json.opacity;if(json.transparent!==undefined)material.transparent=json.transparent;if(json.wireframe!==undefined)material.wireframe=json.wireframe;if(json.materials!==undefined){for(var i=0,l=json.materials.length;i<l;i++){material.materials.push(this.parse(json.materials[i]))}}return material}};THREE.ObjectLoader=function(manager){this.manager=manager!==undefined?manager:THREE.DefaultLoadingManager};THREE.ObjectLoader.prototype={constructor:THREE.ObjectLoader,load:function(url,onLoad,onProgress,onError){var scope=this;var loader=new THREE.XHRLoader(scope.manager);loader.setCrossOrigin(this.crossOrigin);loader.load(url,function(text){onLoad(scope.parse(JSON.parse(text)))},onProgress,onError)},setCrossOrigin:function(value){this.crossOrigin=value},parse:function(json){var geometries=this.parseGeometries(json.geometries);var materials=this.parseMaterials(json.materials);var object=this.parseObject(json.object,geometries,materials);return object},parseGeometries:function(json){var geometries={};if(json!==undefined){var geometryLoader=new THREE.JSONLoader;var bufferGeometryLoader=new THREE.BufferGeometryLoader;for(var i=0,l=json.length;i<l;i++){var geometry;var data=json[i];switch(data.type){case"PlaneGeometry":geometry=new THREE.PlaneGeometry(data.width,data.height,data.widthSegments,data.heightSegments);break;case"BoxGeometry":case"CubeGeometry":geometry=new THREE.BoxGeometry(data.width,data.height,data.depth,data.widthSegments,data.heightSegments,data.depthSegments);break;case"CircleGeometry":geometry=new THREE.CircleGeometry(data.radius,data.segments);break;case"CylinderGeometry":geometry=new THREE.CylinderGeometry(data.radiusTop,data.radiusBottom,data.height,data.radialSegments,data.heightSegments,data.openEnded);break;case"SphereGeometry":geometry=new THREE.SphereGeometry(data.radius,data.widthSegments,data.heightSegments,data.phiStart,data.phiLength,data.thetaStart,data.thetaLength);break;case"IcosahedronGeometry":geometry=new THREE.IcosahedronGeometry(data.radius,data.detail);break;case"TorusGeometry":geometry=new THREE.TorusGeometry(data.radius,data.tube,data.radialSegments,data.tubularSegments,data.arc);break;case"TorusKnotGeometry":geometry=new THREE.TorusKnotGeometry(data.radius,data.tube,data.radialSegments,data.tubularSegments,data.p,data.q,data.heightScale);break;case"BufferGeometry":geometry=bufferGeometryLoader.parse(data.data);break;case"Geometry":geometry=geometryLoader.parse(data.data).geometry;break}geometry.uuid=data.uuid;if(data.name!==undefined)geometry.name=data.name;geometries[data.uuid]=geometry}}return geometries},parseMaterials:function(json){var materials={};if(json!==undefined){var loader=new THREE.MaterialLoader;for(var i=0,l=json.length;i<l;i++){var data=json[i];var material=loader.parse(data);material.uuid=data.uuid;if(data.name!==undefined)material.name=data.name;materials[data.uuid]=material}}return materials},parseObject:function(){var matrix=new THREE.Matrix4;return function(data,geometries,materials){var object;switch(data.type){case"Scene":object=new THREE.Scene;break;case"PerspectiveCamera":object=new THREE.PerspectiveCamera(data.fov,data.aspect,data.near,data.far);break;case"OrthographicCamera":object=new THREE.OrthographicCamera(data.left,data.right,data.top,data.bottom,data.near,data.far);break;case"AmbientLight":object=new THREE.AmbientLight(data.color);break;case"DirectionalLight":object=new THREE.DirectionalLight(data.color,data.intensity);break;case"PointLight":object=new THREE.PointLight(data.color,data.intensity,data.distance);break;case"SpotLight":object=new THREE.SpotLight(data.color,data.intensity,data.distance,data.angle,data.exponent);break;case"HemisphereLight":object=new THREE.HemisphereLight(data.color,data.groundColor,data.intensity);break;case"Mesh":var geometry=geometries[data.geometry];var material=materials[data.material];if(geometry===undefined){console.warn("THREE.ObjectLoader: Undefined geometry",data.geometry)}if(material===undefined){console.warn("THREE.ObjectLoader: Undefined material",data.material)}object=new THREE.Mesh(geometry,material);break;case"Line":var geometry=geometries[data.geometry];var material=materials[data.material];if(geometry===undefined){console.warn("THREE.ObjectLoader: Undefined geometry",data.geometry)}if(material===undefined){console.warn("THREE.ObjectLoader: Undefined material",data.material)}object=new THREE.Line(geometry,material);break;case"Sprite":var material=materials[data.material];if(material===undefined){console.warn("THREE.ObjectLoader: Undefined material",data.material)}object=new THREE.Sprite(material);break;case"Group":object=new THREE.Group;break;default:object=new THREE.Object3D}object.uuid=data.uuid;if(data.name!==undefined)object.name=data.name;if(data.matrix!==undefined){matrix.fromArray(data.matrix);matrix.decompose(object.position,object.quaternion,object.scale)}else{if(data.position!==undefined)object.position.fromArray(data.position);if(data.rotation!==undefined)object.rotation.fromArray(data.rotation);if(data.scale!==undefined)object.scale.fromArray(data.scale)}if(data.visible!==undefined)object.visible=data.visible;if(data.userData!==undefined)object.userData=data.userData;if(data.children!==undefined){for(var child in data.children){object.add(this.parseObject(data.children[child],geometries,materials))}}return object}}()};THREE.TextureLoader=function(manager){this.manager=manager!==undefined?manager:THREE.DefaultLoadingManager};THREE.TextureLoader.prototype={constructor:THREE.TextureLoader,load:function(url,onLoad,onProgress,onError){var scope=this;var loader=new THREE.ImageLoader(scope.manager);loader.setCrossOrigin(this.crossOrigin);loader.load(url,function(image){var texture=new THREE.Texture(image);texture.needsUpdate=true;if(onLoad!==undefined){onLoad(texture)}},onProgress,onError)},setCrossOrigin:function(value){this.crossOrigin=value}};THREE.CompressedTextureLoader=function(){this._parser=null};THREE.CompressedTextureLoader.prototype={constructor:THREE.CompressedTextureLoader,load:function(url,onLoad,onError){var scope=this;var images=[];var texture=new THREE.CompressedTexture;texture.image=images;var loader=new THREE.XHRLoader;loader.setResponseType("arraybuffer");if(url instanceof Array){var loaded=0;var loadTexture=function(i){loader.load(url[i],function(buffer){var texDatas=scope._parser(buffer,true);images[i]={width:texDatas.width,height:texDatas.height,format:texDatas.format,mipmaps:texDatas.mipmaps};loaded+=1;if(loaded===6){if(texDatas.mipmapCount==1)texture.minFilter=THREE.LinearFilter;texture.format=texDatas.format;texture.needsUpdate=true;if(onLoad)onLoad(texture)}})};for(var i=0,il=url.length;i<il;++i){loadTexture(i)}}else{loader.load(url,function(buffer){var texDatas=scope._parser(buffer,true);if(texDatas.isCubemap){var faces=texDatas.mipmaps.length/texDatas.mipmapCount;for(var f=0;f<faces;f++){images[f]={mipmaps:[]};for(var i=0;i<texDatas.mipmapCount;i++){images[f].mipmaps.push(texDatas.mipmaps[f*texDatas.mipmapCount+i]);images[f].format=texDatas.format;images[f].width=texDatas.width;images[f].height=texDatas.height}}}else{texture.image.width=texDatas.width;texture.image.height=texDatas.height;texture.mipmaps=texDatas.mipmaps}if(texDatas.mipmapCount===1){texture.minFilter=THREE.LinearFilter}texture.format=texDatas.format;texture.needsUpdate=true;if(onLoad)onLoad(texture)})}return texture}};THREE.Material=function(){Object.defineProperty(this,"id",{value:THREE.MaterialIdCount++});this.uuid=THREE.Math.generateUUID();this.name="";this.type="Material";this.side=THREE.FrontSide;this.opacity=1;this.transparent=false;this.blending=THREE.NormalBlending;this.blendSrc=THREE.SrcAlphaFactor;this.blendDst=THREE.OneMinusSrcAlphaFactor;this.blendEquation=THREE.AddEquation;this.depthTest=true;this.depthWrite=true;this.polygonOffset=false;this.polygonOffsetFactor=0;this.polygonOffsetUnits=0;this.alphaTest=0;this.overdraw=0;this.visible=true;this.needsUpdate=true};THREE.Material.prototype={constructor:THREE.Material,setValues:function(values){if(values===undefined)return;for(var key in values){var newValue=values[key];if(newValue===undefined){console.warn("THREE.Material: '"+key+"' parameter is undefined.");continue}if(key in this){var currentValue=this[key];if(currentValue instanceof THREE.Color){currentValue.set(newValue)}else if(currentValue instanceof THREE.Vector3&&newValue instanceof THREE.Vector3){currentValue.copy(newValue)}else if(key=="overdraw"){this[key]=Number(newValue)}else{this[key]=newValue}}}},toJSON:function(){var output={metadata:{version:4.2,type:"material",generator:"MaterialExporter"},uuid:this.uuid,type:this.type};if(this.name!=="")output.name=this.name;if(this instanceof THREE.MeshBasicMaterial){output.color=this.color.getHex();if(this.vertexColors!==THREE.NoColors)output.vertexColors=this.vertexColors;if(this.blending!==THREE.NormalBlending)output.blending=this.blending;if(this.side!==THREE.FrontSide)output.side=this.side}else if(this instanceof THREE.MeshLambertMaterial){output.color=this.color.getHex();output.ambient=this.ambient.getHex();output.emissive=this.emissive.getHex();if(this.vertexColors!==THREE.NoColors)output.vertexColors=this.vertexColors;if(this.blending!==THREE.NormalBlending)output.blending=this.blending;if(this.side!==THREE.FrontSide)output.side=this.side}else if(this instanceof THREE.MeshPhongMaterial){output.color=this.color.getHex();output.ambient=this.ambient.getHex();output.emissive=this.emissive.getHex();output.specular=this.specular.getHex();output.shininess=this.shininess;if(this.vertexColors!==THREE.NoColors)output.vertexColors=this.vertexColors;if(this.blending!==THREE.NormalBlending)output.blending=this.blending;if(this.side!==THREE.FrontSide)output.side=this.side}else if(this instanceof THREE.MeshNormalMaterial){if(this.shading!==THREE.FlatShading)output.shading=this.shading;if(this.blending!==THREE.NormalBlending)output.blending=this.blending;if(this.side!==THREE.FrontSide)output.side=this.side}else if(this instanceof THREE.MeshDepthMaterial){if(this.blending!==THREE.NormalBlending)output.blending=this.blending;if(this.side!==THREE.FrontSide)output.side=this.side}else if(this instanceof THREE.ShaderMaterial){output.uniforms=this.uniforms;output.vertexShader=this.vertexShader;output.fragmentShader=this.fragmentShader}else if(this instanceof THREE.SpriteMaterial){output.color=this.color.getHex()}if(this.opacity<1)output.opacity=this.opacity;if(this.transparent!==false)output.transparent=this.transparent;if(this.wireframe!==false)output.wireframe=this.wireframe;return output},clone:function(material){if(material===undefined)material=new THREE.Material;material.name=this.name;material.side=this.side;material.opacity=this.opacity;material.transparent=this.transparent;material.blending=this.blending;material.blendSrc=this.blendSrc;material.blendDst=this.blendDst;material.blendEquation=this.blendEquation;material.depthTest=this.depthTest;material.depthWrite=this.depthWrite;material.polygonOffset=this.polygonOffset;material.polygonOffsetFactor=this.polygonOffsetFactor;material.polygonOffsetUnits=this.polygonOffsetUnits;material.alphaTest=this.alphaTest;material.overdraw=this.overdraw;material.visible=this.visible;return material},dispose:function(){this.dispatchEvent({type:"dispose"})}};THREE.EventDispatcher.prototype.apply(THREE.Material.prototype);THREE.MaterialIdCount=0;THREE.LineBasicMaterial=function(parameters){THREE.Material.call(this);this.type="LineBasicMaterial";this.color=new THREE.Color(16777215);this.linewidth=1;this.linecap="round";this.linejoin="round";this.vertexColors=THREE.NoColors;this.fog=true;this.setValues(parameters)};THREE.LineBasicMaterial.prototype=Object.create(THREE.Material.prototype);THREE.LineBasicMaterial.prototype.clone=function(){var material=new THREE.LineBasicMaterial;THREE.Material.prototype.clone.call(this,material);material.color.copy(this.color);material.linewidth=this.linewidth;material.linecap=this.linecap;material.linejoin=this.linejoin;material.vertexColors=this.vertexColors;material.fog=this.fog;return material};THREE.LineDashedMaterial=function(parameters){THREE.Material.call(this);this.type="LineDashedMaterial";this.color=new THREE.Color(16777215);this.linewidth=1;this.scale=1;this.dashSize=3;this.gapSize=1;this.vertexColors=false;this.fog=true;this.setValues(parameters)};THREE.LineDashedMaterial.prototype=Object.create(THREE.Material.prototype);THREE.LineDashedMaterial.prototype.clone=function(){var material=new THREE.LineDashedMaterial;THREE.Material.prototype.clone.call(this,material);material.color.copy(this.color);material.linewidth=this.linewidth;material.scale=this.scale;material.dashSize=this.dashSize;material.gapSize=this.gapSize;material.vertexColors=this.vertexColors;material.fog=this.fog;return material};THREE.MeshBasicMaterial=function(parameters){THREE.Material.call(this);this.type="MeshBasicMaterial";this.color=new THREE.Color(16777215);this.map=null;this.lightMap=null;this.specularMap=null;this.alphaMap=null;this.envMap=null;this.combine=THREE.MultiplyOperation;this.reflectivity=1;this.refractionRatio=.98;this.fog=true;this.shading=THREE.SmoothShading;this.wireframe=false;this.wireframeLinewidth=1;this.wireframeLinecap="round";this.wireframeLinejoin="round";this.vertexColors=THREE.NoColors;this.skinning=false;this.morphTargets=false;this.setValues(parameters)};THREE.MeshBasicMaterial.prototype=Object.create(THREE.Material.prototype);THREE.MeshBasicMaterial.prototype.clone=function(){var material=new THREE.MeshBasicMaterial;THREE.Material.prototype.clone.call(this,material);material.color.copy(this.color);material.map=this.map;material.lightMap=this.lightMap;material.specularMap=this.specularMap;material.alphaMap=this.alphaMap;material.envMap=this.envMap;material.combine=this.combine;material.reflectivity=this.reflectivity;material.refractionRatio=this.refractionRatio;material.fog=this.fog;material.shading=this.shading;material.wireframe=this.wireframe;material.wireframeLinewidth=this.wireframeLinewidth;material.wireframeLinecap=this.wireframeLinecap;material.wireframeLinejoin=this.wireframeLinejoin;material.vertexColors=this.vertexColors;material.skinning=this.skinning;material.morphTargets=this.morphTargets;return material};THREE.MeshLambertMaterial=function(parameters){THREE.Material.call(this);this.type="MeshLambertMaterial";this.color=new THREE.Color(16777215);this.ambient=new THREE.Color(16777215);this.emissive=new THREE.Color(0);this.wrapAround=false;this.wrapRGB=new THREE.Vector3(1,1,1);this.map=null;this.lightMap=null;this.specularMap=null;this.alphaMap=null;this.envMap=null;this.combine=THREE.MultiplyOperation;this.reflectivity=1;this.refractionRatio=.98;this.fog=true;this.shading=THREE.SmoothShading;this.wireframe=false;this.wireframeLinewidth=1;this.wireframeLinecap="round";this.wireframeLinejoin="round";this.vertexColors=THREE.NoColors;this.skinning=false;this.morphTargets=false;this.morphNormals=false;this.setValues(parameters)};THREE.MeshLambertMaterial.prototype=Object.create(THREE.Material.prototype);THREE.MeshLambertMaterial.prototype.clone=function(){var material=new THREE.MeshLambertMaterial;THREE.Material.prototype.clone.call(this,material);material.color.copy(this.color);material.ambient.copy(this.ambient);material.emissive.copy(this.emissive);material.wrapAround=this.wrapAround;material.wrapRGB.copy(this.wrapRGB);material.map=this.map;material.lightMap=this.lightMap;material.specularMap=this.specularMap;material.alphaMap=this.alphaMap;material.envMap=this.envMap;material.combine=this.combine;material.reflectivity=this.reflectivity;material.refractionRatio=this.refractionRatio;material.fog=this.fog;material.shading=this.shading;material.wireframe=this.wireframe;material.wireframeLinewidth=this.wireframeLinewidth;material.wireframeLinecap=this.wireframeLinecap;material.wireframeLinejoin=this.wireframeLinejoin;material.vertexColors=this.vertexColors;material.skinning=this.skinning;material.morphTargets=this.morphTargets;material.morphNormals=this.morphNormals;return material};THREE.MeshPhongMaterial=function(parameters){THREE.Material.call(this);this.type="MeshPhongMaterial";this.color=new THREE.Color(16777215);
this.ambient=new THREE.Color(16777215);this.emissive=new THREE.Color(0);this.specular=new THREE.Color(1118481);this.shininess=30;this.metal=false;this.wrapAround=false;this.wrapRGB=new THREE.Vector3(1,1,1);this.map=null;this.lightMap=null;this.bumpMap=null;this.bumpScale=1;this.normalMap=null;this.normalScale=new THREE.Vector2(1,1);this.specularMap=null;this.alphaMap=null;this.envMap=null;this.combine=THREE.MultiplyOperation;this.reflectivity=1;this.refractionRatio=.98;this.fog=true;this.shading=THREE.SmoothShading;this.wireframe=false;this.wireframeLinewidth=1;this.wireframeLinecap="round";this.wireframeLinejoin="round";this.vertexColors=THREE.NoColors;this.skinning=false;this.morphTargets=false;this.morphNormals=false;this.setValues(parameters)};THREE.MeshPhongMaterial.prototype=Object.create(THREE.Material.prototype);THREE.MeshPhongMaterial.prototype.clone=function(){var material=new THREE.MeshPhongMaterial;THREE.Material.prototype.clone.call(this,material);material.color.copy(this.color);material.ambient.copy(this.ambient);material.emissive.copy(this.emissive);material.specular.copy(this.specular);material.shininess=this.shininess;material.metal=this.metal;material.wrapAround=this.wrapAround;material.wrapRGB.copy(this.wrapRGB);material.map=this.map;material.lightMap=this.lightMap;material.bumpMap=this.bumpMap;material.bumpScale=this.bumpScale;material.normalMap=this.normalMap;material.normalScale.copy(this.normalScale);material.specularMap=this.specularMap;material.alphaMap=this.alphaMap;material.envMap=this.envMap;material.combine=this.combine;material.reflectivity=this.reflectivity;material.refractionRatio=this.refractionRatio;material.fog=this.fog;material.shading=this.shading;material.wireframe=this.wireframe;material.wireframeLinewidth=this.wireframeLinewidth;material.wireframeLinecap=this.wireframeLinecap;material.wireframeLinejoin=this.wireframeLinejoin;material.vertexColors=this.vertexColors;material.skinning=this.skinning;material.morphTargets=this.morphTargets;material.morphNormals=this.morphNormals;return material};THREE.MeshDepthMaterial=function(parameters){THREE.Material.call(this);this.type="MeshDepthMaterial";this.morphTargets=false;this.wireframe=false;this.wireframeLinewidth=1;this.setValues(parameters)};THREE.MeshDepthMaterial.prototype=Object.create(THREE.Material.prototype);THREE.MeshDepthMaterial.prototype.clone=function(){var material=new THREE.MeshDepthMaterial;THREE.Material.prototype.clone.call(this,material);material.wireframe=this.wireframe;material.wireframeLinewidth=this.wireframeLinewidth;return material};THREE.MeshNormalMaterial=function(parameters){THREE.Material.call(this,parameters);this.type="MeshNormalMaterial";this.shading=THREE.FlatShading;this.wireframe=false;this.wireframeLinewidth=1;this.morphTargets=false;this.setValues(parameters)};THREE.MeshNormalMaterial.prototype=Object.create(THREE.Material.prototype);THREE.MeshNormalMaterial.prototype.clone=function(){var material=new THREE.MeshNormalMaterial;THREE.Material.prototype.clone.call(this,material);material.shading=this.shading;material.wireframe=this.wireframe;material.wireframeLinewidth=this.wireframeLinewidth;return material};THREE.MeshFaceMaterial=function(materials){this.uuid=THREE.Math.generateUUID();this.type="MeshFaceMaterial";this.materials=materials instanceof Array?materials:[]};THREE.MeshFaceMaterial.prototype={constructor:THREE.MeshFaceMaterial,toJSON:function(){var output={metadata:{version:4.2,type:"material",generator:"MaterialExporter"},uuid:this.uuid,type:this.type,materials:[]};for(var i=0,l=this.materials.length;i<l;i++){output.materials.push(this.materials[i].toJSON())}return output},clone:function(){var material=new THREE.MeshFaceMaterial;for(var i=0;i<this.materials.length;i++){material.materials.push(this.materials[i].clone())}return material}};THREE.PointCloudMaterial=function(parameters){THREE.Material.call(this);this.type="PointCloudMaterial";this.color=new THREE.Color(16777215);this.map=null;this.size=1;this.sizeAttenuation=true;this.vertexColors=THREE.NoColors;this.fog=true;this.setValues(parameters)};THREE.PointCloudMaterial.prototype=Object.create(THREE.Material.prototype);THREE.PointCloudMaterial.prototype.clone=function(){var material=new THREE.PointCloudMaterial;THREE.Material.prototype.clone.call(this,material);material.color.copy(this.color);material.map=this.map;material.size=this.size;material.sizeAttenuation=this.sizeAttenuation;material.vertexColors=this.vertexColors;material.fog=this.fog;return material};THREE.ParticleBasicMaterial=function(parameters){console.warn("THREE.ParticleBasicMaterial has been renamed to THREE.PointCloudMaterial.");return new THREE.PointCloudMaterial(parameters)};THREE.ParticleSystemMaterial=function(parameters){console.warn("THREE.ParticleSystemMaterial has been renamed to THREE.PointCloudMaterial.");return new THREE.PointCloudMaterial(parameters)};THREE.ShaderMaterial=function(parameters){THREE.Material.call(this);this.type="ShaderMaterial";this.defines={};this.uniforms={};this.attributes=null;this.vertexShader="void main() {\n	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}";this.fragmentShader="void main() {\n	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}";this.shading=THREE.SmoothShading;this.linewidth=1;this.wireframe=false;this.wireframeLinewidth=1;this.fog=false;this.lights=false;this.vertexColors=THREE.NoColors;this.skinning=false;this.morphTargets=false;this.morphNormals=false;this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]};this.index0AttributeName=undefined;this.setValues(parameters)};THREE.ShaderMaterial.prototype=Object.create(THREE.Material.prototype);THREE.ShaderMaterial.prototype.clone=function(){var material=new THREE.ShaderMaterial;THREE.Material.prototype.clone.call(this,material);material.fragmentShader=this.fragmentShader;material.vertexShader=this.vertexShader;material.uniforms=THREE.UniformsUtils.clone(this.uniforms);material.attributes=this.attributes;material.defines=this.defines;material.shading=this.shading;material.wireframe=this.wireframe;material.wireframeLinewidth=this.wireframeLinewidth;material.fog=this.fog;material.lights=this.lights;material.vertexColors=this.vertexColors;material.skinning=this.skinning;material.morphTargets=this.morphTargets;material.morphNormals=this.morphNormals;return material};THREE.RawShaderMaterial=function(parameters){THREE.ShaderMaterial.call(this,parameters);this.type="RawShaderMaterial"};THREE.RawShaderMaterial.prototype=Object.create(THREE.ShaderMaterial.prototype);THREE.RawShaderMaterial.prototype.clone=function(){var material=new THREE.RawShaderMaterial;THREE.ShaderMaterial.prototype.clone.call(this,material);return material};THREE.SpriteMaterial=function(parameters){THREE.Material.call(this);this.type="SpriteMaterial";this.color=new THREE.Color(16777215);this.map=null;this.rotation=0;this.fog=false;this.setValues(parameters)};THREE.SpriteMaterial.prototype=Object.create(THREE.Material.prototype);THREE.SpriteMaterial.prototype.clone=function(){var material=new THREE.SpriteMaterial;THREE.Material.prototype.clone.call(this,material);material.color.copy(this.color);material.map=this.map;material.rotation=this.rotation;material.fog=this.fog;return material};THREE.Texture=function(image,mapping,wrapS,wrapT,magFilter,minFilter,format,type,anisotropy){Object.defineProperty(this,"id",{value:THREE.TextureIdCount++});this.uuid=THREE.Math.generateUUID();this.name="";this.image=image!==undefined?image:THREE.Texture.DEFAULT_IMAGE;this.mipmaps=[];this.mapping=mapping!==undefined?mapping:THREE.Texture.DEFAULT_MAPPING;this.wrapS=wrapS!==undefined?wrapS:THREE.ClampToEdgeWrapping;this.wrapT=wrapT!==undefined?wrapT:THREE.ClampToEdgeWrapping;this.magFilter=magFilter!==undefined?magFilter:THREE.LinearFilter;this.minFilter=minFilter!==undefined?minFilter:THREE.LinearMipMapLinearFilter;this.anisotropy=anisotropy!==undefined?anisotropy:1;this.format=format!==undefined?format:THREE.RGBAFormat;this.type=type!==undefined?type:THREE.UnsignedByteType;this.offset=new THREE.Vector2(0,0);this.repeat=new THREE.Vector2(1,1);this.generateMipmaps=true;this.premultiplyAlpha=false;this.flipY=true;this.unpackAlignment=4;this._needsUpdate=false;this.onUpdate=null};THREE.Texture.DEFAULT_IMAGE=undefined;THREE.Texture.DEFAULT_MAPPING=new THREE.UVMapping;THREE.Texture.prototype={constructor:THREE.Texture,get needsUpdate(){return this._needsUpdate},set needsUpdate(value){if(value===true)this.update();this._needsUpdate=value},clone:function(texture){if(texture===undefined)texture=new THREE.Texture;texture.image=this.image;texture.mipmaps=this.mipmaps.slice(0);texture.mapping=this.mapping;texture.wrapS=this.wrapS;texture.wrapT=this.wrapT;texture.magFilter=this.magFilter;texture.minFilter=this.minFilter;texture.anisotropy=this.anisotropy;texture.format=this.format;texture.type=this.type;texture.offset.copy(this.offset);texture.repeat.copy(this.repeat);texture.generateMipmaps=this.generateMipmaps;texture.premultiplyAlpha=this.premultiplyAlpha;texture.flipY=this.flipY;texture.unpackAlignment=this.unpackAlignment;return texture},update:function(){this.dispatchEvent({type:"update"})},dispose:function(){this.dispatchEvent({type:"dispose"})}};THREE.EventDispatcher.prototype.apply(THREE.Texture.prototype);THREE.TextureIdCount=0;THREE.CubeTexture=function(images,mapping,wrapS,wrapT,magFilter,minFilter,format,type,anisotropy){THREE.Texture.call(this,images,mapping,wrapS,wrapT,magFilter,minFilter,format,type,anisotropy);this.images=images};THREE.CubeTexture.prototype=Object.create(THREE.Texture.prototype);THREE.CubeTexture.clone=function(texture){if(texture===undefined)texture=new THREE.CubeTexture;THREE.Texture.prototype.clone.call(this,texture);texture.images=this.images;return texture};THREE.CompressedTexture=function(mipmaps,width,height,format,type,mapping,wrapS,wrapT,magFilter,minFilter,anisotropy){THREE.Texture.call(this,null,mapping,wrapS,wrapT,magFilter,minFilter,format,type,anisotropy);this.image={width:width,height:height};this.mipmaps=mipmaps;this.flipY=false;this.generateMipmaps=false};THREE.CompressedTexture.prototype=Object.create(THREE.Texture.prototype);THREE.CompressedTexture.prototype.clone=function(){var texture=new THREE.CompressedTexture;THREE.Texture.prototype.clone.call(this,texture);return texture};THREE.DataTexture=function(data,width,height,format,type,mapping,wrapS,wrapT,magFilter,minFilter,anisotropy){THREE.Texture.call(this,null,mapping,wrapS,wrapT,magFilter,minFilter,format,type,anisotropy);this.image={data:data,width:width,height:height}};THREE.DataTexture.prototype=Object.create(THREE.Texture.prototype);THREE.DataTexture.prototype.clone=function(){var texture=new THREE.DataTexture;THREE.Texture.prototype.clone.call(this,texture);return texture};THREE.VideoTexture=function(video,mapping,wrapS,wrapT,magFilter,minFilter,format,type,anisotropy){THREE.Texture.call(this,video,mapping,wrapS,wrapT,magFilter,minFilter,format,type,anisotropy);this.generateMipmaps=false;var scope=this;var update=function(){requestAnimationFrame(update);if(video.readyState===video.HAVE_ENOUGH_DATA){scope.needsUpdate=true}};update()};THREE.VideoTexture.prototype=Object.create(THREE.Texture.prototype);THREE.Group=function(){THREE.Object3D.call(this);this.type="Group"};THREE.Group.prototype=Object.create(THREE.Object3D.prototype);THREE.PointCloud=function(geometry,material){THREE.Object3D.call(this);this.type="PointCloud";this.geometry=geometry!==undefined?geometry:new THREE.Geometry;this.material=material!==undefined?material:new THREE.PointCloudMaterial({color:Math.random()*16777215});this.sortParticles=false};THREE.PointCloud.prototype=Object.create(THREE.Object3D.prototype);THREE.PointCloud.prototype.raycast=function(){var inverseMatrix=new THREE.Matrix4;var ray=new THREE.Ray;return function(raycaster,intersects){var object=this;var geometry=object.geometry;var threshold=raycaster.params.PointCloud.threshold;inverseMatrix.getInverse(this.matrixWorld);ray.copy(raycaster.ray).applyMatrix4(inverseMatrix);if(geometry.boundingBox!==null){if(ray.isIntersectionBox(geometry.boundingBox)===false){return}}var localThreshold=threshold/((this.scale.x+this.scale.y+this.scale.z)/3);var position=new THREE.Vector3;var testPoint=function(point,index){var rayPointDistance=ray.distanceToPoint(point);if(rayPointDistance<localThreshold){var intersectPoint=ray.closestPointToPoint(point);intersectPoint.applyMatrix4(object.matrixWorld);var distance=raycaster.ray.origin.distanceTo(intersectPoint);intersects.push({distance:distance,distanceToRay:rayPointDistance,point:intersectPoint.clone(),index:index,face:null,object:object})}};if(geometry instanceof THREE.BufferGeometry){var attributes=geometry.attributes;var positions=attributes.position.array;if(attributes.index!==undefined){var indices=attributes.index.array;var offsets=geometry.offsets;if(offsets.length===0){var offset={start:0,count:indices.length,index:0};offsets=[offset]}for(var oi=0,ol=offsets.length;oi<ol;++oi){var start=offsets[oi].start;var count=offsets[oi].count;var index=offsets[oi].index;for(var i=start,il=start+count;i<il;i++){var a=index+indices[i];position.fromArray(positions,a*3);testPoint(position,a)}}}else{var pointCount=positions.length/3;for(var i=0;i<pointCount;i++){position.set(positions[3*i],positions[3*i+1],positions[3*i+2]);testPoint(position,i)}}}else{var vertices=this.geometry.vertices;for(var i=0;i<vertices.length;i++){testPoint(vertices[i],i)}}}}();THREE.PointCloud.prototype.clone=function(object){if(object===undefined)object=new THREE.PointCloud(this.geometry,this.material);object.sortParticles=this.sortParticles;THREE.Object3D.prototype.clone.call(this,object);return object};THREE.ParticleSystem=function(geometry,material){console.warn("THREE.ParticleSystem has been renamed to THREE.PointCloud.");return new THREE.PointCloud(geometry,material)};THREE.Line=function(geometry,material,mode){THREE.Object3D.call(this);this.type="Line";this.geometry=geometry!==undefined?geometry:new THREE.Geometry;this.material=material!==undefined?material:new THREE.LineBasicMaterial({color:Math.random()*16777215});this.mode=mode!==undefined?mode:THREE.LineStrip};THREE.LineStrip=0;THREE.LinePieces=1;THREE.Line.prototype=Object.create(THREE.Object3D.prototype);THREE.Line.prototype.raycast=function(){var inverseMatrix=new THREE.Matrix4;var ray=new THREE.Ray;var sphere=new THREE.Sphere;return function(raycaster,intersects){var precision=raycaster.linePrecision;var precisionSq=precision*precision;var geometry=this.geometry;if(geometry.boundingSphere===null)geometry.computeBoundingSphere();sphere.copy(geometry.boundingSphere);sphere.applyMatrix4(this.matrixWorld);if(raycaster.ray.isIntersectionSphere(sphere)===false){return}inverseMatrix.getInverse(this.matrixWorld);ray.copy(raycaster.ray).applyMatrix4(inverseMatrix);if(geometry instanceof THREE.Geometry){var vertices=geometry.vertices;var nbVertices=vertices.length;var interSegment=new THREE.Vector3;var interRay=new THREE.Vector3;var step=this.mode===THREE.LineStrip?1:2;for(var i=0;i<nbVertices-1;i=i+step){var distSq=ray.distanceSqToSegment(vertices[i],vertices[i+1],interRay,interSegment);if(distSq>precisionSq)continue;var distance=ray.origin.distanceTo(interRay);if(distance<raycaster.near||distance>raycaster.far)continue;intersects.push({distance:distance,point:interSegment.clone().applyMatrix4(this.matrixWorld),face:null,faceIndex:null,object:this})}}}}();THREE.Line.prototype.clone=function(object){if(object===undefined)object=new THREE.Line(this.geometry,this.material,this.mode);THREE.Object3D.prototype.clone.call(this,object);return object};THREE.Mesh=function(geometry,material){THREE.Object3D.call(this);this.type="Mesh";this.geometry=geometry!==undefined?geometry:new THREE.Geometry;this.material=material!==undefined?material:new THREE.MeshBasicMaterial({color:Math.random()*16777215});this.updateMorphTargets()};THREE.Mesh.prototype=Object.create(THREE.Object3D.prototype);THREE.Mesh.prototype.updateMorphTargets=function(){if(this.geometry.morphTargets!==undefined&&this.geometry.morphTargets.length>0){this.morphTargetBase=-1;this.morphTargetForcedOrder=[];this.morphTargetInfluences=[];this.morphTargetDictionary={};for(var m=0,ml=this.geometry.morphTargets.length;m<ml;m++){this.morphTargetInfluences.push(0);this.morphTargetDictionary[this.geometry.morphTargets[m].name]=m}}};THREE.Mesh.prototype.getMorphTargetIndexByName=function(name){if(this.morphTargetDictionary[name]!==undefined){return this.morphTargetDictionary[name]}console.log("THREE.Mesh.getMorphTargetIndexByName: morph target "+name+" does not exist. Returning 0.");return 0};THREE.Mesh.prototype.raycast=function(){var inverseMatrix=new THREE.Matrix4;var ray=new THREE.Ray;var sphere=new THREE.Sphere;var vA=new THREE.Vector3;var vB=new THREE.Vector3;var vC=new THREE.Vector3;return function(raycaster,intersects){var geometry=this.geometry;if(geometry.boundingSphere===null)geometry.computeBoundingSphere();sphere.copy(geometry.boundingSphere);sphere.applyMatrix4(this.matrixWorld);if(raycaster.ray.isIntersectionSphere(sphere)===false){return}inverseMatrix.getInverse(this.matrixWorld);ray.copy(raycaster.ray).applyMatrix4(inverseMatrix);if(geometry.boundingBox!==null){if(ray.isIntersectionBox(geometry.boundingBox)===false){return}}if(geometry instanceof THREE.BufferGeometry){var material=this.material;if(material===undefined)return;var attributes=geometry.attributes;var a,b,c;var precision=raycaster.precision;if(attributes.index!==undefined){var indices=attributes.index.array;var positions=attributes.position.array;var offsets=geometry.offsets;if(offsets.length===0){offsets=[{start:0,count:indices.length,index:0}]}for(var oi=0,ol=offsets.length;oi<ol;++oi){var start=offsets[oi].start;var count=offsets[oi].count;var index=offsets[oi].index;for(var i=start,il=start+count;i<il;i+=3){a=index+indices[i];b=index+indices[i+1];c=index+indices[i+2];vA.fromArray(positions,a*3);vB.fromArray(positions,b*3);vC.fromArray(positions,c*3);if(material.side===THREE.BackSide){var intersectionPoint=ray.intersectTriangle(vC,vB,vA,true)}else{var intersectionPoint=ray.intersectTriangle(vA,vB,vC,material.side!==THREE.DoubleSide)}if(intersectionPoint===null)continue;intersectionPoint.applyMatrix4(this.matrixWorld);var distance=raycaster.ray.origin.distanceTo(intersectionPoint);if(distance<precision||distance<raycaster.near||distance>raycaster.far)continue;intersects.push({distance:distance,point:intersectionPoint,face:new THREE.Face3(a,b,c,THREE.Triangle.normal(vA,vB,vC)),faceIndex:null,object:this})}}}else{var positions=attributes.position.array;for(var i=0,j=0,il=positions.length;i<il;i+=3,j+=9){a=i;b=i+1;c=i+2;vA.fromArray(positions,j);vB.fromArray(positions,j+3);vC.fromArray(positions,j+6);if(material.side===THREE.BackSide){var intersectionPoint=ray.intersectTriangle(vC,vB,vA,true)}else{var intersectionPoint=ray.intersectTriangle(vA,vB,vC,material.side!==THREE.DoubleSide)}if(intersectionPoint===null)continue;intersectionPoint.applyMatrix4(this.matrixWorld);var distance=raycaster.ray.origin.distanceTo(intersectionPoint);if(distance<precision||distance<raycaster.near||distance>raycaster.far)continue;intersects.push({distance:distance,point:intersectionPoint,face:new THREE.Face3(a,b,c,THREE.Triangle.normal(vA,vB,vC)),faceIndex:null,object:this})}}}else if(geometry instanceof THREE.Geometry){var isFaceMaterial=this.material instanceof THREE.MeshFaceMaterial;var objectMaterials=isFaceMaterial===true?this.material.materials:null;var a,b,c,d;var precision=raycaster.precision;var vertices=geometry.vertices;for(var f=0,fl=geometry.faces.length;f<fl;f++){var face=geometry.faces[f];var material=isFaceMaterial===true?objectMaterials[face.materialIndex]:this.material;if(material===undefined)continue;a=vertices[face.a];b=vertices[face.b];c=vertices[face.c];if(material.morphTargets===true){var morphTargets=geometry.morphTargets;var morphInfluences=this.morphTargetInfluences;vA.set(0,0,0);vB.set(0,0,0);vC.set(0,0,0);for(var t=0,tl=morphTargets.length;t<tl;t++){var influence=morphInfluences[t];if(influence===0)continue;var targets=morphTargets[t].vertices;vA.x+=(targets[face.a].x-a.x)*influence;vA.y+=(targets[face.a].y-a.y)*influence;vA.z+=(targets[face.a].z-a.z)*influence;vB.x+=(targets[face.b].x-b.x)*influence;vB.y+=(targets[face.b].y-b.y)*influence;vB.z+=(targets[face.b].z-b.z)*influence;vC.x+=(targets[face.c].x-c.x)*influence;vC.y+=(targets[face.c].y-c.y)*influence;vC.z+=(targets[face.c].z-c.z)*influence}vA.add(a);vB.add(b);vC.add(c);a=vA;b=vB;c=vC}if(material.side===THREE.BackSide){var intersectionPoint=ray.intersectTriangle(c,b,a,true)}else{var intersectionPoint=ray.intersectTriangle(a,b,c,material.side!==THREE.DoubleSide)}if(intersectionPoint===null)continue;intersectionPoint.applyMatrix4(this.matrixWorld);var distance=raycaster.ray.origin.distanceTo(intersectionPoint);if(distance<precision||distance<raycaster.near||distance>raycaster.far)continue;intersects.push({distance:distance,point:intersectionPoint,face:face,faceIndex:f,object:this})}}}}();THREE.Mesh.prototype.clone=function(object,recursive){if(object===undefined)object=new THREE.Mesh(this.geometry,this.material);THREE.Object3D.prototype.clone.call(this,object,recursive);return object};THREE.Bone=function(belongsToSkin){THREE.Object3D.call(this);this.skin=belongsToSkin};THREE.Bone.prototype=Object.create(THREE.Object3D.prototype);THREE.Skeleton=function(bones,boneInverses,useVertexTexture){this.useVertexTexture=useVertexTexture!==undefined?useVertexTexture:true;this.identityMatrix=new THREE.Matrix4;bones=bones||[];this.bones=bones.slice(0);if(this.useVertexTexture){var size;if(this.bones.length>256)size=64;else if(this.bones.length>64)size=32;else if(this.bones.length>16)size=16;else size=8;this.boneTextureWidth=size;this.boneTextureHeight=size;this.boneMatrices=new Float32Array(this.boneTextureWidth*this.boneTextureHeight*4);this.boneTexture=new THREE.DataTexture(this.boneMatrices,this.boneTextureWidth,this.boneTextureHeight,THREE.RGBAFormat,THREE.FloatType);this.boneTexture.minFilter=THREE.NearestFilter;this.boneTexture.magFilter=THREE.NearestFilter;this.boneTexture.generateMipmaps=false;this.boneTexture.flipY=false}else{this.boneMatrices=new Float32Array(16*this.bones.length)}if(boneInverses===undefined){this.calculateInverses()}else{if(this.bones.length===boneInverses.length){this.boneInverses=boneInverses.slice(0)}else{console.warn("THREE.Skeleton bonInverses is the wrong length.");this.boneInverses=[];for(var b=0,bl=this.bones.length;b<bl;b++){this.boneInverses.push(new THREE.Matrix4)}}}};THREE.Skeleton.prototype.calculateInverses=function(){this.boneInverses=[];for(var b=0,bl=this.bones.length;b<bl;b++){var inverse=new THREE.Matrix4;if(this.bones[b]){inverse.getInverse(this.bones[b].matrixWorld)}this.boneInverses.push(inverse)}};THREE.Skeleton.prototype.pose=function(){var bone;for(var b=0,bl=this.bones.length;b<bl;b++){bone=this.bones[b];if(bone){bone.matrixWorld.getInverse(this.boneInverses[b])}}for(var b=0,bl=this.bones.length;b<bl;b++){bone=this.bones[b];if(bone){if(bone.parent){bone.matrix.getInverse(bone.parent.matrixWorld);bone.matrix.multiply(bone.matrixWorld)}else{bone.matrix.copy(bone.matrixWorld)}bone.matrix.decompose(bone.position,bone.quaternion,bone.scale)}}};THREE.Skeleton.prototype.update=function(){var offsetMatrix=new THREE.Matrix4;return function(){for(var b=0,bl=this.bones.length;b<bl;b++){var matrix=this.bones[b]?this.bones[b].matrixWorld:this.identityMatrix;offsetMatrix.multiplyMatrices(matrix,this.boneInverses[b]);offsetMatrix.flattenToArrayOffset(this.boneMatrices,b*16)}if(this.useVertexTexture){this.boneTexture.needsUpdate=true}}}();THREE.SkinnedMesh=function(geometry,material,useVertexTexture){THREE.Mesh.call(this,geometry,material);this.type="SkinnedMesh";this.bindMode="attached";this.bindMatrix=new THREE.Matrix4;this.bindMatrixInverse=new THREE.Matrix4;var bones=[];if(this.geometry&&this.geometry.bones!==undefined){var bone,gbone,p,q,s;for(var b=0,bl=this.geometry.bones.length;b<bl;++b){gbone=this.geometry.bones[b];p=gbone.pos;q=gbone.rotq;s=gbone.scl;bone=new THREE.Bone(this);bones.push(bone);bone.name=gbone.name;bone.position.set(p[0],p[1],p[2]);bone.quaternion.set(q[0],q[1],q[2],q[3]);if(s!==undefined){bone.scale.set(s[0],s[1],s[2])}else{bone.scale.set(1,1,1)}}for(var b=0,bl=this.geometry.bones.length;b<bl;++b){gbone=this.geometry.bones[b];if(gbone.parent!==-1){bones[gbone.parent].add(bones[b])}else{this.add(bones[b])}}}this.normalizeSkinWeights();this.updateMatrixWorld(true);this.bind(new THREE.Skeleton(bones,undefined,useVertexTexture))};THREE.SkinnedMesh.prototype=Object.create(THREE.Mesh.prototype);THREE.SkinnedMesh.prototype.bind=function(skeleton,bindMatrix){this.skeleton=skeleton;if(bindMatrix===undefined){this.updateMatrixWorld(true);bindMatrix=this.matrixWorld}this.bindMatrix.copy(bindMatrix);this.bindMatrixInverse.getInverse(bindMatrix)};THREE.SkinnedMesh.prototype.pose=function(){this.skeleton.pose()};THREE.SkinnedMesh.prototype.normalizeSkinWeights=function(){if(this.geometry instanceof THREE.Geometry){for(var i=0;i<this.geometry.skinIndices.length;i++){var sw=this.geometry.skinWeights[i];var scale=1/sw.lengthManhattan();if(scale!==Infinity){sw.multiplyScalar(scale)}else{sw.set(1)}}}else{}};THREE.SkinnedMesh.prototype.updateMatrixWorld=function(force){THREE.Mesh.prototype.updateMatrixWorld.call(this,true);if(this.bindMode==="attached"){this.bindMatrixInverse.getInverse(this.matrixWorld)}else if(this.bindMode==="detached"){this.bindMatrixInverse.getInverse(this.bindMatrix)}else{console.warn("THREE.SkinnedMesh unreckognized bindMode: "+this.bindMode)}};THREE.SkinnedMesh.prototype.clone=function(object){if(object===undefined){object=new THREE.SkinnedMesh(this.geometry,this.material,this.useVertexTexture)}THREE.Mesh.prototype.clone.call(this,object);return object};THREE.MorphAnimMesh=function(geometry,material){THREE.Mesh.call(this,geometry,material);this.type="MorphAnimMesh";this.duration=1e3;this.mirroredLoop=false;this.time=0;this.lastKeyframe=0;this.currentKeyframe=0;this.direction=1;this.directionBackwards=false;this.setFrameRange(0,this.geometry.morphTargets.length-1)};THREE.MorphAnimMesh.prototype=Object.create(THREE.Mesh.prototype);THREE.MorphAnimMesh.prototype.setFrameRange=function(start,end){this.startKeyframe=start;this.endKeyframe=end;this.length=this.endKeyframe-this.startKeyframe+1};THREE.MorphAnimMesh.prototype.setDirectionForward=function(){this.direction=1;this.directionBackwards=false};THREE.MorphAnimMesh.prototype.setDirectionBackward=function(){this.direction=-1;this.directionBackwards=true};THREE.MorphAnimMesh.prototype.parseAnimations=function(){var geometry=this.geometry;if(!geometry.animations)geometry.animations={};var firstAnimation,animations=geometry.animations;var pattern=/([a-z]+)_?(\d+)/;for(var i=0,il=geometry.morphTargets.length;i<il;i++){var morph=geometry.morphTargets[i];var parts=morph.name.match(pattern);if(parts&&parts.length>1){var label=parts[1];var num=parts[2];if(!animations[label])animations[label]={start:Infinity,end:-Infinity};var animation=animations[label];if(i<animation.start)animation.start=i;if(i>animation.end)animation.end=i;if(!firstAnimation)firstAnimation=label}}geometry.firstAnimation=firstAnimation};THREE.MorphAnimMesh.prototype.setAnimationLabel=function(label,start,end){if(!this.geometry.animations)this.geometry.animations={};this.geometry.animations[label]={start:start,end:end}};THREE.MorphAnimMesh.prototype.playAnimation=function(label,fps){var animation=this.geometry.animations[label];if(animation){this.setFrameRange(animation.start,animation.end);this.duration=1e3*((animation.end-animation.start)/fps);this.time=0}else{console.warn("animation["+label+"] undefined")}};THREE.MorphAnimMesh.prototype.updateAnimation=function(delta){var frameTime=this.duration/this.length;this.time+=this.direction*delta;if(this.mirroredLoop){if(this.time>this.duration||this.time<0){this.direction*=-1;if(this.time>this.duration){this.time=this.duration;this.directionBackwards=true}if(this.time<0){this.time=0;this.directionBackwards=false}}}else{this.time=this.time%this.duration;if(this.time<0)this.time+=this.duration}var keyframe=this.startKeyframe+THREE.Math.clamp(Math.floor(this.time/frameTime),0,this.length-1);if(keyframe!==this.currentKeyframe){this.morphTargetInfluences[this.lastKeyframe]=0;this.morphTargetInfluences[this.currentKeyframe]=1;this.morphTargetInfluences[keyframe]=0;this.lastKeyframe=this.currentKeyframe;this.currentKeyframe=keyframe}var mix=this.time%frameTime/frameTime;if(this.directionBackwards){mix=1-mix}this.morphTargetInfluences[this.currentKeyframe]=mix;this.morphTargetInfluences[this.lastKeyframe]=1-mix};THREE.MorphAnimMesh.prototype.interpolateTargets=function(a,b,t){var influences=this.morphTargetInfluences;for(var i=0,l=influences.length;i<l;i++){influences[i]=0}if(a>-1)influences[a]=1-t;if(b>-1)influences[b]=t};THREE.MorphAnimMesh.prototype.clone=function(object){if(object===undefined)object=new THREE.MorphAnimMesh(this.geometry,this.material);object.duration=this.duration;object.mirroredLoop=this.mirroredLoop;object.time=this.time;object.lastKeyframe=this.lastKeyframe;object.currentKeyframe=this.currentKeyframe;object.direction=this.direction;object.directionBackwards=this.directionBackwards;THREE.Mesh.prototype.clone.call(this,object);return object};THREE.LOD=function(){THREE.Object3D.call(this);this.objects=[]};THREE.LOD.prototype=Object.create(THREE.Object3D.prototype);THREE.LOD.prototype.addLevel=function(object,distance){if(distance===undefined)distance=0;distance=Math.abs(distance);for(var l=0;l<this.objects.length;l++){if(distance<this.objects[l].distance){break}}this.objects.splice(l,0,{distance:distance,object:object});this.add(object)};THREE.LOD.prototype.getObjectForDistance=function(distance){for(var i=1,l=this.objects.length;i<l;i++){if(distance<this.objects[i].distance){break}}return this.objects[i-1].object};THREE.LOD.prototype.raycast=function(){var matrixPosition=new THREE.Vector3;return function(raycaster,intersects){matrixPosition.setFromMatrixPosition(this.matrixWorld);var distance=raycaster.ray.origin.distanceTo(matrixPosition);this.getObjectForDistance(distance).raycast(raycaster,intersects)}}();THREE.LOD.prototype.update=function(){var v1=new THREE.Vector3;var v2=new THREE.Vector3;return function(camera){if(this.objects.length>1){v1.setFromMatrixPosition(camera.matrixWorld);v2.setFromMatrixPosition(this.matrixWorld);var distance=v1.distanceTo(v2);this.objects[0].object.visible=true;for(var i=1,l=this.objects.length;i<l;i++){if(distance>=this.objects[i].distance){this.objects[i-1].object.visible=false;this.objects[i].object.visible=true}else{break}}for(;i<l;i++){this.objects[i].object.visible=false}}}}();THREE.LOD.prototype.clone=function(object){if(object===undefined)object=new THREE.LOD;THREE.Object3D.prototype.clone.call(this,object);for(var i=0,l=this.objects.length;i<l;i++){var x=this.objects[i].object.clone();x.visible=i===0;object.addLevel(x,this.objects[i].distance)}return object};THREE.Sprite=function(){var indices=new Uint16Array([0,1,2,0,2,3]);var vertices=new Float32Array([-.5,-.5,0,.5,-.5,0,.5,.5,0,-.5,.5,0]);var uvs=new Float32Array([0,0,1,0,1,1,0,1]);var geometry=new THREE.BufferGeometry;geometry.addAttribute("index",new THREE.BufferAttribute(indices,1));geometry.addAttribute("position",new THREE.BufferAttribute(vertices,3));geometry.addAttribute("uv",new THREE.BufferAttribute(uvs,2));return function(material){THREE.Object3D.call(this);this.type="Sprite";this.geometry=geometry;this.material=material!==undefined?material:new THREE.SpriteMaterial}}();THREE.Sprite.prototype=Object.create(THREE.Object3D.prototype);THREE.Sprite.prototype.raycast=function(){var matrixPosition=new THREE.Vector3;return function(raycaster,intersects){matrixPosition.setFromMatrixPosition(this.matrixWorld);var distance=raycaster.ray.distanceToPoint(matrixPosition);if(distance>this.scale.x){return
}intersects.push({distance:distance,point:this.position,face:null,object:this})}}();THREE.Sprite.prototype.clone=function(object){if(object===undefined)object=new THREE.Sprite(this.material);THREE.Object3D.prototype.clone.call(this,object);return object};THREE.Particle=THREE.Sprite;THREE.LensFlare=function(texture,size,distance,blending,color){THREE.Object3D.call(this);this.lensFlares=[];this.positionScreen=new THREE.Vector3;this.customUpdateCallback=undefined;if(texture!==undefined){this.add(texture,size,distance,blending,color)}};THREE.LensFlare.prototype=Object.create(THREE.Object3D.prototype);THREE.LensFlare.prototype.add=function(texture,size,distance,blending,color,opacity){if(size===undefined)size=-1;if(distance===undefined)distance=0;if(opacity===undefined)opacity=1;if(color===undefined)color=new THREE.Color(16777215);if(blending===undefined)blending=THREE.NormalBlending;distance=Math.min(distance,Math.max(0,distance));this.lensFlares.push({texture:texture,size:size,distance:distance,x:0,y:0,z:0,scale:1,rotation:1,opacity:opacity,color:color,blending:blending})};THREE.LensFlare.prototype.updateLensFlares=function(){var f,fl=this.lensFlares.length;var flare;var vecX=-this.positionScreen.x*2;var vecY=-this.positionScreen.y*2;for(f=0;f<fl;f++){flare=this.lensFlares[f];flare.x=this.positionScreen.x+vecX*flare.distance;flare.y=this.positionScreen.y+vecY*flare.distance;flare.wantedRotation=flare.x*Math.PI*.25;flare.rotation+=(flare.wantedRotation-flare.rotation)*.25}};THREE.Scene=function(){THREE.Object3D.call(this);this.type="Scene";this.fog=null;this.overrideMaterial=null;this.autoUpdate=true};THREE.Scene.prototype=Object.create(THREE.Object3D.prototype);THREE.Scene.prototype.clone=function(object){if(object===undefined)object=new THREE.Scene;THREE.Object3D.prototype.clone.call(this,object);if(this.fog!==null)object.fog=this.fog.clone();if(this.overrideMaterial!==null)object.overrideMaterial=this.overrideMaterial.clone();object.autoUpdate=this.autoUpdate;object.matrixAutoUpdate=this.matrixAutoUpdate;return object};THREE.Fog=function(color,near,far){this.name="";this.color=new THREE.Color(color);this.near=near!==undefined?near:1;this.far=far!==undefined?far:1e3};THREE.Fog.prototype.clone=function(){return new THREE.Fog(this.color.getHex(),this.near,this.far)};THREE.FogExp2=function(color,density){this.name="";this.color=new THREE.Color(color);this.density=density!==undefined?density:25e-5};THREE.FogExp2.prototype.clone=function(){return new THREE.FogExp2(this.color.getHex(),this.density)};THREE.ShaderChunk={};THREE.ShaderChunk["alphatest_fragment"]="#ifdef ALPHATEST\n\n	if ( gl_FragColor.a < ALPHATEST ) discard;\n\n#endif\n";THREE.ShaderChunk["lights_lambert_vertex"]="vLightFront = vec3( 0.0 );\n\n#ifdef DOUBLE_SIDED\n\n	vLightBack = vec3( 0.0 );\n\n#endif\n\ntransformedNormal = normalize( transformedNormal );\n\n#if MAX_DIR_LIGHTS > 0\n\nfor( int i = 0; i < MAX_DIR_LIGHTS; i ++ ) {\n\n	vec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );\n	vec3 dirVector = normalize( lDirection.xyz );\n\n	float dotProduct = dot( transformedNormal, dirVector );\n	vec3 directionalLightWeighting = vec3( max( dotProduct, 0.0 ) );\n\n	#ifdef DOUBLE_SIDED\n\n		vec3 directionalLightWeightingBack = vec3( max( -dotProduct, 0.0 ) );\n\n		#ifdef WRAP_AROUND\n\n			vec3 directionalLightWeightingHalfBack = vec3( max( -0.5 * dotProduct + 0.5, 0.0 ) );\n\n		#endif\n\n	#endif\n\n	#ifdef WRAP_AROUND\n\n		vec3 directionalLightWeightingHalf = vec3( max( 0.5 * dotProduct + 0.5, 0.0 ) );\n		directionalLightWeighting = mix( directionalLightWeighting, directionalLightWeightingHalf, wrapRGB );\n\n		#ifdef DOUBLE_SIDED\n\n			directionalLightWeightingBack = mix( directionalLightWeightingBack, directionalLightWeightingHalfBack, wrapRGB );\n\n		#endif\n\n	#endif\n\n	vLightFront += directionalLightColor[ i ] * directionalLightWeighting;\n\n	#ifdef DOUBLE_SIDED\n\n		vLightBack += directionalLightColor[ i ] * directionalLightWeightingBack;\n\n	#endif\n\n}\n\n#endif\n\n#if MAX_POINT_LIGHTS > 0\n\n	for( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {\n\n		vec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );\n		vec3 lVector = lPosition.xyz - mvPosition.xyz;\n\n		float lDistance = 1.0;\n		if ( pointLightDistance[ i ] > 0.0 )\n			lDistance = 1.0 - min( ( length( lVector ) / pointLightDistance[ i ] ), 1.0 );\n\n		lVector = normalize( lVector );\n		float dotProduct = dot( transformedNormal, lVector );\n\n		vec3 pointLightWeighting = vec3( max( dotProduct, 0.0 ) );\n\n		#ifdef DOUBLE_SIDED\n\n			vec3 pointLightWeightingBack = vec3( max( -dotProduct, 0.0 ) );\n\n			#ifdef WRAP_AROUND\n\n				vec3 pointLightWeightingHalfBack = vec3( max( -0.5 * dotProduct + 0.5, 0.0 ) );\n\n			#endif\n\n		#endif\n\n		#ifdef WRAP_AROUND\n\n			vec3 pointLightWeightingHalf = vec3( max( 0.5 * dotProduct + 0.5, 0.0 ) );\n			pointLightWeighting = mix( pointLightWeighting, pointLightWeightingHalf, wrapRGB );\n\n			#ifdef DOUBLE_SIDED\n\n				pointLightWeightingBack = mix( pointLightWeightingBack, pointLightWeightingHalfBack, wrapRGB );\n\n			#endif\n\n		#endif\n\n		vLightFront += pointLightColor[ i ] * pointLightWeighting * lDistance;\n\n		#ifdef DOUBLE_SIDED\n\n			vLightBack += pointLightColor[ i ] * pointLightWeightingBack * lDistance;\n\n		#endif\n\n	}\n\n#endif\n\n#if MAX_SPOT_LIGHTS > 0\n\n	for( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {\n\n		vec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );\n		vec3 lVector = lPosition.xyz - mvPosition.xyz;\n\n		float spotEffect = dot( spotLightDirection[ i ], normalize( spotLightPosition[ i ] - worldPosition.xyz ) );\n\n		if ( spotEffect > spotLightAngleCos[ i ] ) {\n\n			spotEffect = max( pow( max( spotEffect, 0.0 ), spotLightExponent[ i ] ), 0.0 );\n\n			float lDistance = 1.0;\n			if ( spotLightDistance[ i ] > 0.0 )\n				lDistance = 1.0 - min( ( length( lVector ) / spotLightDistance[ i ] ), 1.0 );\n\n			lVector = normalize( lVector );\n\n			float dotProduct = dot( transformedNormal, lVector );\n			vec3 spotLightWeighting = vec3( max( dotProduct, 0.0 ) );\n\n			#ifdef DOUBLE_SIDED\n\n				vec3 spotLightWeightingBack = vec3( max( -dotProduct, 0.0 ) );\n\n				#ifdef WRAP_AROUND\n\n					vec3 spotLightWeightingHalfBack = vec3( max( -0.5 * dotProduct + 0.5, 0.0 ) );\n\n				#endif\n\n			#endif\n\n			#ifdef WRAP_AROUND\n\n				vec3 spotLightWeightingHalf = vec3( max( 0.5 * dotProduct + 0.5, 0.0 ) );\n				spotLightWeighting = mix( spotLightWeighting, spotLightWeightingHalf, wrapRGB );\n\n				#ifdef DOUBLE_SIDED\n\n					spotLightWeightingBack = mix( spotLightWeightingBack, spotLightWeightingHalfBack, wrapRGB );\n\n				#endif\n\n			#endif\n\n			vLightFront += spotLightColor[ i ] * spotLightWeighting * lDistance * spotEffect;\n\n			#ifdef DOUBLE_SIDED\n\n				vLightBack += spotLightColor[ i ] * spotLightWeightingBack * lDistance * spotEffect;\n\n			#endif\n\n		}\n\n	}\n\n#endif\n\n#if MAX_HEMI_LIGHTS > 0\n\n	for( int i = 0; i < MAX_HEMI_LIGHTS; i ++ ) {\n\n		vec4 lDirection = viewMatrix * vec4( hemisphereLightDirection[ i ], 0.0 );\n		vec3 lVector = normalize( lDirection.xyz );\n\n		float dotProduct = dot( transformedNormal, lVector );\n\n		float hemiDiffuseWeight = 0.5 * dotProduct + 0.5;\n		float hemiDiffuseWeightBack = -0.5 * dotProduct + 0.5;\n\n		vLightFront += mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeight );\n\n		#ifdef DOUBLE_SIDED\n\n			vLightBack += mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeightBack );\n\n		#endif\n\n	}\n\n#endif\n\nvLightFront = vLightFront * diffuse + ambient * ambientLightColor + emissive;\n\n#ifdef DOUBLE_SIDED\n\n	vLightBack = vLightBack * diffuse + ambient * ambientLightColor + emissive;\n\n#endif";THREE.ShaderChunk["map_particle_pars_fragment"]="#ifdef USE_MAP\n\n	uniform sampler2D map;\n\n#endif";THREE.ShaderChunk["default_vertex"]="vec4 mvPosition;\n\n#ifdef USE_SKINNING\n\n	mvPosition = modelViewMatrix * skinned;\n\n#endif\n\n#if !defined( USE_SKINNING ) && defined( USE_MORPHTARGETS )\n\n	mvPosition = modelViewMatrix * vec4( morphed, 1.0 );\n\n#endif\n\n#if !defined( USE_SKINNING ) && ! defined( USE_MORPHTARGETS )\n\n	mvPosition = modelViewMatrix * vec4( position, 1.0 );\n\n#endif\n\ngl_Position = projectionMatrix * mvPosition;";THREE.ShaderChunk["map_pars_fragment"]="#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP )\n\n	varying vec2 vUv;\n\n#endif\n\n#ifdef USE_MAP\n\n	uniform sampler2D map;\n\n#endif";THREE.ShaderChunk["skinnormal_vertex"]="#ifdef USE_SKINNING\n\n	mat4 skinMatrix = mat4( 0.0 );\n	skinMatrix += skinWeight.x * boneMatX;\n	skinMatrix += skinWeight.y * boneMatY;\n	skinMatrix += skinWeight.z * boneMatZ;\n	skinMatrix += skinWeight.w * boneMatW;\n	skinMatrix  = bindMatrixInverse * skinMatrix * bindMatrix;\n\n	#ifdef USE_MORPHNORMALS\n\n	vec4 skinnedNormal = skinMatrix * vec4( morphedNormal, 0.0 );\n\n	#else\n\n	vec4 skinnedNormal = skinMatrix * vec4( normal, 0.0 );\n\n	#endif\n\n#endif\n";THREE.ShaderChunk["logdepthbuf_pars_vertex"]="#ifdef USE_LOGDEPTHBUF\n\n	#ifdef USE_LOGDEPTHBUF_EXT\n\n		varying float vFragDepth;\n\n	#endif\n\n	uniform float logDepthBufFC;\n\n#endif";THREE.ShaderChunk["lightmap_pars_vertex"]="#ifdef USE_LIGHTMAP\n\n	varying vec2 vUv2;\n\n#endif";THREE.ShaderChunk["lights_phong_fragment"]="vec3 normal = normalize( vNormal );\nvec3 viewPosition = normalize( vViewPosition );\n\n#ifdef DOUBLE_SIDED\n\n	normal = normal * ( -1.0 + 2.0 * float( gl_FrontFacing ) );\n\n#endif\n\n#ifdef USE_NORMALMAP\n\n	normal = perturbNormal2Arb( -vViewPosition, normal );\n\n#elif defined( USE_BUMPMAP )\n\n	normal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd() );\n\n#endif\n\n#if MAX_POINT_LIGHTS > 0\n\n	vec3 pointDiffuse = vec3( 0.0 );\n	vec3 pointSpecular = vec3( 0.0 );\n\n	for ( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {\n\n		vec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );\n		vec3 lVector = lPosition.xyz + vViewPosition.xyz;\n\n		float lDistance = 1.0;\n		if ( pointLightDistance[ i ] > 0.0 )\n			lDistance = 1.0 - min( ( length( lVector ) / pointLightDistance[ i ] ), 1.0 );\n\n		lVector = normalize( lVector );\n\n				// diffuse\n\n		float dotProduct = dot( normal, lVector );\n\n		#ifdef WRAP_AROUND\n\n			float pointDiffuseWeightFull = max( dotProduct, 0.0 );\n			float pointDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );\n\n			vec3 pointDiffuseWeight = mix( vec3( pointDiffuseWeightFull ), vec3( pointDiffuseWeightHalf ), wrapRGB );\n\n		#else\n\n			float pointDiffuseWeight = max( dotProduct, 0.0 );\n\n		#endif\n\n		pointDiffuse += diffuse * pointLightColor[ i ] * pointDiffuseWeight * lDistance;\n\n				// specular\n\n		vec3 pointHalfVector = normalize( lVector + viewPosition );\n		float pointDotNormalHalf = max( dot( normal, pointHalfVector ), 0.0 );\n		float pointSpecularWeight = specularStrength * max( pow( pointDotNormalHalf, shininess ), 0.0 );\n\n		float specularNormalization = ( shininess + 2.0 ) / 8.0;\n\n		vec3 schlick = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( lVector, pointHalfVector ), 0.0 ), 5.0 );\n		pointSpecular += schlick * pointLightColor[ i ] * pointSpecularWeight * pointDiffuseWeight * lDistance * specularNormalization;\n\n	}\n\n#endif\n\n#if MAX_SPOT_LIGHTS > 0\n\n	vec3 spotDiffuse = vec3( 0.0 );\n	vec3 spotSpecular = vec3( 0.0 );\n\n	for ( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {\n\n		vec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );\n		vec3 lVector = lPosition.xyz + vViewPosition.xyz;\n\n		float lDistance = 1.0;\n		if ( spotLightDistance[ i ] > 0.0 )\n			lDistance = 1.0 - min( ( length( lVector ) / spotLightDistance[ i ] ), 1.0 );\n\n		lVector = normalize( lVector );\n\n		float spotEffect = dot( spotLightDirection[ i ], normalize( spotLightPosition[ i ] - vWorldPosition ) );\n\n		if ( spotEffect > spotLightAngleCos[ i ] ) {\n\n			spotEffect = max( pow( max( spotEffect, 0.0 ), spotLightExponent[ i ] ), 0.0 );\n\n					// diffuse\n\n			float dotProduct = dot( normal, lVector );\n\n			#ifdef WRAP_AROUND\n\n				float spotDiffuseWeightFull = max( dotProduct, 0.0 );\n				float spotDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );\n\n				vec3 spotDiffuseWeight = mix( vec3( spotDiffuseWeightFull ), vec3( spotDiffuseWeightHalf ), wrapRGB );\n\n			#else\n\n				float spotDiffuseWeight = max( dotProduct, 0.0 );\n\n			#endif\n\n			spotDiffuse += diffuse * spotLightColor[ i ] * spotDiffuseWeight * lDistance * spotEffect;\n\n					// specular\n\n			vec3 spotHalfVector = normalize( lVector + viewPosition );\n			float spotDotNormalHalf = max( dot( normal, spotHalfVector ), 0.0 );\n			float spotSpecularWeight = specularStrength * max( pow( spotDotNormalHalf, shininess ), 0.0 );\n\n			float specularNormalization = ( shininess + 2.0 ) / 8.0;\n\n			vec3 schlick = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( lVector, spotHalfVector ), 0.0 ), 5.0 );\n			spotSpecular += schlick * spotLightColor[ i ] * spotSpecularWeight * spotDiffuseWeight * lDistance * specularNormalization * spotEffect;\n\n		}\n\n	}\n\n#endif\n\n#if MAX_DIR_LIGHTS > 0\n\n	vec3 dirDiffuse = vec3( 0.0 );\n	vec3 dirSpecular = vec3( 0.0 );\n\n	for( int i = 0; i < MAX_DIR_LIGHTS; i ++ ) {\n\n		vec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );\n		vec3 dirVector = normalize( lDirection.xyz );\n\n				// diffuse\n\n		float dotProduct = dot( normal, dirVector );\n\n		#ifdef WRAP_AROUND\n\n			float dirDiffuseWeightFull = max( dotProduct, 0.0 );\n			float dirDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );\n\n			vec3 dirDiffuseWeight = mix( vec3( dirDiffuseWeightFull ), vec3( dirDiffuseWeightHalf ), wrapRGB );\n\n		#else\n\n			float dirDiffuseWeight = max( dotProduct, 0.0 );\n\n		#endif\n\n		dirDiffuse += diffuse * directionalLightColor[ i ] * dirDiffuseWeight;\n\n		// specular\n\n		vec3 dirHalfVector = normalize( dirVector + viewPosition );\n		float dirDotNormalHalf = max( dot( normal, dirHalfVector ), 0.0 );\n		float dirSpecularWeight = specularStrength * max( pow( dirDotNormalHalf, shininess ), 0.0 );\n\n		/*\n		// fresnel term from skin shader\n		const float F0 = 0.128;\n\n		float base = 1.0 - dot( viewPosition, dirHalfVector );\n		float exponential = pow( base, 5.0 );\n\n		float fresnel = exponential + F0 * ( 1.0 - exponential );\n		*/\n\n		/*\n		// fresnel term from fresnel shader\n		const float mFresnelBias = 0.08;\n		const float mFresnelScale = 0.3;\n		const float mFresnelPower = 5.0;\n\n		float fresnel = mFresnelBias + mFresnelScale * pow( 1.0 + dot( normalize( -viewPosition ), normal ), mFresnelPower );\n		*/\n\n		float specularNormalization = ( shininess + 2.0 ) / 8.0;\n\n		// 		dirSpecular += specular * directionalLightColor[ i ] * dirSpecularWeight * dirDiffuseWeight * specularNormalization * fresnel;\n\n		vec3 schlick = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( dirVector, dirHalfVector ), 0.0 ), 5.0 );\n		dirSpecular += schlick * directionalLightColor[ i ] * dirSpecularWeight * dirDiffuseWeight * specularNormalization;\n\n\n	}\n\n#endif\n\n#if MAX_HEMI_LIGHTS > 0\n\n	vec3 hemiDiffuse = vec3( 0.0 );\n	vec3 hemiSpecular = vec3( 0.0 );\n\n	for( int i = 0; i < MAX_HEMI_LIGHTS; i ++ ) {\n\n		vec4 lDirection = viewMatrix * vec4( hemisphereLightDirection[ i ], 0.0 );\n		vec3 lVector = normalize( lDirection.xyz );\n\n		// diffuse\n\n		float dotProduct = dot( normal, lVector );\n		float hemiDiffuseWeight = 0.5 * dotProduct + 0.5;\n\n		vec3 hemiColor = mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeight );\n\n		hemiDiffuse += diffuse * hemiColor;\n\n		// specular (sky light)\n\n		vec3 hemiHalfVectorSky = normalize( lVector + viewPosition );\n		float hemiDotNormalHalfSky = 0.5 * dot( normal, hemiHalfVectorSky ) + 0.5;\n		float hemiSpecularWeightSky = specularStrength * max( pow( max( hemiDotNormalHalfSky, 0.0 ), shininess ), 0.0 );\n\n		// specular (ground light)\n\n		vec3 lVectorGround = -lVector;\n\n		vec3 hemiHalfVectorGround = normalize( lVectorGround + viewPosition );\n		float hemiDotNormalHalfGround = 0.5 * dot( normal, hemiHalfVectorGround ) + 0.5;\n		float hemiSpecularWeightGround = specularStrength * max( pow( max( hemiDotNormalHalfGround, 0.0 ), shininess ), 0.0 );\n\n		float dotProductGround = dot( normal, lVectorGround );\n\n		float specularNormalization = ( shininess + 2.0 ) / 8.0;\n\n		vec3 schlickSky = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( lVector, hemiHalfVectorSky ), 0.0 ), 5.0 );\n		vec3 schlickGround = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( lVectorGround, hemiHalfVectorGround ), 0.0 ), 5.0 );\n		hemiSpecular += hemiColor * specularNormalization * ( schlickSky * hemiSpecularWeightSky * max( dotProduct, 0.0 ) + schlickGround * hemiSpecularWeightGround * max( dotProductGround, 0.0 ) );\n\n	}\n\n#endif\n\nvec3 totalDiffuse = vec3( 0.0 );\nvec3 totalSpecular = vec3( 0.0 );\n\n#if MAX_DIR_LIGHTS > 0\n\n	totalDiffuse += dirDiffuse;\n	totalSpecular += dirSpecular;\n\n#endif\n\n#if MAX_HEMI_LIGHTS > 0\n\n	totalDiffuse += hemiDiffuse;\n	totalSpecular += hemiSpecular;\n\n#endif\n\n#if MAX_POINT_LIGHTS > 0\n\n	totalDiffuse += pointDiffuse;\n	totalSpecular += pointSpecular;\n\n#endif\n\n#if MAX_SPOT_LIGHTS > 0\n\n	totalDiffuse += spotDiffuse;\n	totalSpecular += spotSpecular;\n\n#endif\n\n#ifdef METAL\n\n	gl_FragColor.xyz = gl_FragColor.xyz * ( emissive + totalDiffuse + ambientLightColor * ambient + totalSpecular );\n\n#else\n\n	gl_FragColor.xyz = gl_FragColor.xyz * ( emissive + totalDiffuse + ambientLightColor * ambient ) + totalSpecular;\n\n#endif";THREE.ShaderChunk["fog_pars_fragment"]="#ifdef USE_FOG\n\n	uniform vec3 fogColor;\n\n	#ifdef FOG_EXP2\n\n		uniform float fogDensity;\n\n	#else\n\n		uniform float fogNear;\n		uniform float fogFar;\n	#endif\n\n#endif";THREE.ShaderChunk["morphnormal_vertex"]="#ifdef USE_MORPHNORMALS\n\n	vec3 morphedNormal = vec3( 0.0 );\n\n	morphedNormal += ( morphNormal0 - normal ) * morphTargetInfluences[ 0 ];\n	morphedNormal += ( morphNormal1 - normal ) * morphTargetInfluences[ 1 ];\n	morphedNormal += ( morphNormal2 - normal ) * morphTargetInfluences[ 2 ];\n	morphedNormal += ( morphNormal3 - normal ) * morphTargetInfluences[ 3 ];\n\n	morphedNormal += normal;\n\n#endif";THREE.ShaderChunk["envmap_pars_fragment"]="#ifdef USE_ENVMAP\n\n	uniform float reflectivity;\n	uniform samplerCube envMap;\n	uniform float flipEnvMap;\n	uniform int combine;\n\n	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\n		uniform bool useRefract;\n		uniform float refractionRatio;\n\n	#else\n\n		varying vec3 vReflect;\n\n	#endif\n\n#endif";THREE.ShaderChunk["logdepthbuf_fragment"]="#if defined(USE_LOGDEPTHBUF) && defined(USE_LOGDEPTHBUF_EXT)\n\n	gl_FragDepthEXT = log2(vFragDepth) * logDepthBufFC * 0.5;\n\n#endif";THREE.ShaderChunk["normalmap_pars_fragment"]="#ifdef USE_NORMALMAP\n\n	uniform sampler2D normalMap;\n	uniform vec2 normalScale;\n\n			// Per-Pixel Tangent Space Normal Mapping\n			// http://hacksoflife.blogspot.ch/2009/11/per-pixel-tangent-space-normal-mapping.html\n\n	vec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm ) {\n\n		vec3 q0 = dFdx( eye_pos.xyz );\n		vec3 q1 = dFdy( eye_pos.xyz );\n		vec2 st0 = dFdx( vUv.st );\n		vec2 st1 = dFdy( vUv.st );\n\n		vec3 S = normalize( q0 * st1.t - q1 * st0.t );\n		vec3 T = normalize( -q0 * st1.s + q1 * st0.s );\n		vec3 N = normalize( surf_norm );\n\n		vec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n		mapN.xy = normalScale * mapN.xy;\n		mat3 tsn = mat3( S, T, N );\n		return normalize( tsn * mapN );\n\n	}\n\n#endif\n";THREE.ShaderChunk["lights_phong_pars_vertex"]="#if MAX_SPOT_LIGHTS > 0 || defined( USE_BUMPMAP ) || defined( USE_ENVMAP )\n\n	varying vec3 vWorldPosition;\n\n#endif\n";THREE.ShaderChunk["lightmap_pars_fragment"]="#ifdef USE_LIGHTMAP\n\n	varying vec2 vUv2;\n	uniform sampler2D lightMap;\n\n#endif";THREE.ShaderChunk["shadowmap_vertex"]="#ifdef USE_SHADOWMAP\n\n	for( int i = 0; i < MAX_SHADOWS; i ++ ) {\n\n		vShadowCoord[ i ] = shadowMatrix[ i ] * worldPosition;\n\n	}\n\n#endif";THREE.ShaderChunk["lights_phong_vertex"]="#if MAX_SPOT_LIGHTS > 0 || defined( USE_BUMPMAP ) || defined( USE_ENVMAP )\n\n	vWorldPosition = worldPosition.xyz;\n\n#endif";THREE.ShaderChunk["map_fragment"]="#ifdef USE_MAP\n\n	vec4 texelColor = texture2D( map, vUv );\n\n	#ifdef GAMMA_INPUT\n\n		texelColor.xyz *= texelColor.xyz;\n\n	#endif\n\n	gl_FragColor = gl_FragColor * texelColor;\n\n#endif";THREE.ShaderChunk["lightmap_vertex"]="#ifdef USE_LIGHTMAP\n\n	vUv2 = uv2;\n\n#endif";THREE.ShaderChunk["map_particle_fragment"]="#ifdef USE_MAP\n\n	gl_FragColor = gl_FragColor * texture2D( map, vec2( gl_PointCoord.x, 1.0 - gl_PointCoord.y ) );\n\n#endif";THREE.ShaderChunk["color_pars_fragment"]="#ifdef USE_COLOR\n\n	varying vec3 vColor;\n\n#endif\n";THREE.ShaderChunk["color_vertex"]="#ifdef USE_COLOR\n\n	#ifdef GAMMA_INPUT\n\n		vColor = color * color;\n\n	#else\n\n		vColor = color;\n\n	#endif\n\n#endif";THREE.ShaderChunk["skinning_vertex"]="#ifdef USE_SKINNING\n\n	#ifdef USE_MORPHTARGETS\n\n	vec4 skinVertex = bindMatrix * vec4( morphed, 1.0 );\n\n	#else\n\n	vec4 skinVertex = bindMatrix * vec4( position, 1.0 );\n\n	#endif\n\n	vec4 skinned = vec4( 0.0 );\n	skinned += boneMatX * skinVertex * skinWeight.x;\n	skinned += boneMatY * skinVertex * skinWeight.y;\n	skinned += boneMatZ * skinVertex * skinWeight.z;\n	skinned += boneMatW * skinVertex * skinWeight.w;\n	skinned  = bindMatrixInverse * skinned;\n\n#endif\n";THREE.ShaderChunk["envmap_pars_vertex"]="#if defined( USE_ENVMAP ) && ! defined( USE_BUMPMAP ) && ! defined( USE_NORMALMAP ) && ! defined( PHONG )\n\n	varying vec3 vReflect;\n\n	uniform float refractionRatio;\n	uniform bool useRefract;\n\n#endif\n";THREE.ShaderChunk["linear_to_gamma_fragment"]="#ifdef GAMMA_OUTPUT\n\n	gl_FragColor.xyz = sqrt( gl_FragColor.xyz );\n\n#endif";THREE.ShaderChunk["color_pars_vertex"]="#ifdef USE_COLOR\n\n	varying vec3 vColor;\n\n#endif";THREE.ShaderChunk["lights_lambert_pars_vertex"]="uniform vec3 ambient;\nuniform vec3 diffuse;\nuniform vec3 emissive;\n\nuniform vec3 ambientLightColor;\n\n#if MAX_DIR_LIGHTS > 0\n\n	uniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];\n	uniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];\n\n#endif\n\n#if MAX_HEMI_LIGHTS > 0\n\n	uniform vec3 hemisphereLightSkyColor[ MAX_HEMI_LIGHTS ];\n	uniform vec3 hemisphereLightGroundColor[ MAX_HEMI_LIGHTS ];\n	uniform vec3 hemisphereLightDirection[ MAX_HEMI_LIGHTS ];\n\n#endif\n\n#if MAX_POINT_LIGHTS > 0\n\n	uniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];\n	uniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];\n	uniform float pointLightDistance[ MAX_POINT_LIGHTS ];\n\n#endif\n\n#if MAX_SPOT_LIGHTS > 0\n\n	uniform vec3 spotLightColor[ MAX_SPOT_LIGHTS ];\n	uniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];\n	uniform vec3 spotLightDirection[ MAX_SPOT_LIGHTS ];\n	uniform float spotLightDistance[ MAX_SPOT_LIGHTS ];\n	uniform float spotLightAngleCos[ MAX_SPOT_LIGHTS ];\n	uniform float spotLightExponent[ MAX_SPOT_LIGHTS ];\n\n#endif\n\n#ifdef WRAP_AROUND\n\n	uniform vec3 wrapRGB;\n\n#endif\n";THREE.ShaderChunk["map_pars_vertex"]="#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP )\n\n	varying vec2 vUv;\n	uniform vec4 offsetRepeat;\n\n#endif\n";THREE.ShaderChunk["envmap_fragment"]="#ifdef USE_ENVMAP\n\n	vec3 reflectVec;\n\n	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\n		vec3 cameraToVertex = normalize( vWorldPosition - cameraPosition );\n\n		// http://en.wikibooks.org/wiki/GLSL_Programming/Applying_Matrix_Transformations\n		// Transforming Normal Vectors with the Inverse Transformation\n\n		vec3 worldNormal = normalize( vec3( vec4( normal, 0.0 ) * viewMatrix ) );\n\n		if ( useRefract ) {\n\n			reflectVec = refract( cameraToVertex, worldNormal, refractionRatio );\n\n		} else { \n\n			reflectVec = reflect( cameraToVertex, worldNormal );\n\n		}\n\n	#else\n\n		reflectVec = vReflect;\n\n	#endif\n\n	#ifdef DOUBLE_SIDED\n\n		float flipNormal = ( -1.0 + 2.0 * float( gl_FrontFacing ) );\n		vec4 cubeColor = textureCube( envMap, flipNormal * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\n	#else\n\n		vec4 cubeColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\n	#endif\n\n	#ifdef GAMMA_INPUT\n\n		cubeColor.xyz *= cubeColor.xyz;\n\n	#endif\n\n	if ( combine == 1 ) {\n\n		gl_FragColor.xyz = mix( gl_FragColor.xyz, cubeColor.xyz, specularStrength * reflectivity );\n\n	} else if ( combine == 2 ) {\n\n		gl_FragColor.xyz += cubeColor.xyz * specularStrength * reflectivity;\n\n	} else {\n\n		gl_FragColor.xyz = mix( gl_FragColor.xyz, gl_FragColor.xyz * cubeColor.xyz, specularStrength * reflectivity );\n\n	}\n\n#endif";THREE.ShaderChunk["specularmap_pars_fragment"]="#ifdef USE_SPECULARMAP\n\n	uniform sampler2D specularMap;\n\n#endif";THREE.ShaderChunk["logdepthbuf_vertex"]="#ifdef USE_LOGDEPTHBUF\n\n	gl_Position.z = log2(max(1e-6, gl_Position.w + 1.0)) * logDepthBufFC;\n\n	#ifdef USE_LOGDEPTHBUF_EXT\n\n		vFragDepth = 1.0 + gl_Position.w;\n\n#else\n\n		gl_Position.z = (gl_Position.z - 1.0) * gl_Position.w;\n\n	#endif\n\n#endif";THREE.ShaderChunk["morphtarget_pars_vertex"]="#ifdef USE_MORPHTARGETS\n\n	#ifndef USE_MORPHNORMALS\n\n	uniform float morphTargetInfluences[ 8 ];\n\n	#else\n\n	uniform float morphTargetInfluences[ 4 ];\n\n	#endif\n\n#endif";THREE.ShaderChunk["specularmap_fragment"]="float specularStrength;\n\n#ifdef USE_SPECULARMAP\n\n	vec4 texelSpecular = texture2D( specularMap, vUv );\n	specularStrength = texelSpecular.r;\n\n#else\n\n	specularStrength = 1.0;\n\n#endif";THREE.ShaderChunk["fog_fragment"]="#ifdef USE_FOG\n\n	#ifdef USE_LOGDEPTHBUF_EXT\n\n		float depth = gl_FragDepthEXT / gl_FragCoord.w;\n\n	#else\n\n		float depth = gl_FragCoord.z / gl_FragCoord.w;\n\n	#endif\n\n	#ifdef FOG_EXP2\n\n		const float LOG2 = 1.442695;\n		float fogFactor = exp2( - fogDensity * fogDensity * depth * depth * LOG2 );\n		fogFactor = 1.0 - clamp( fogFactor, 0.0, 1.0 );\n\n	#else\n\n		float fogFactor = smoothstep( fogNear, fogFar, depth );\n\n	#endif\n	\n	gl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );\n\n#endif";THREE.ShaderChunk["bumpmap_pars_fragment"]="#ifdef USE_BUMPMAP\n\n	uniform sampler2D bumpMap;\n	uniform float bumpScale;\n\n			// Derivative maps - bump mapping unparametrized surfaces by Morten Mikkelsen\n			//	http://mmikkelsen3d.blogspot.sk/2011/07/derivative-maps.html\n\n			// Evaluate the derivative of the height w.r.t. screen-space using forward differencing (listing 2)\n\n	vec2 dHdxy_fwd() {\n\n		vec2 dSTdx = dFdx( vUv );\n		vec2 dSTdy = dFdy( vUv );\n\n		float Hll = bumpScale * texture2D( bumpMap, vUv ).x;\n		float dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\n		float dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\n\n		return vec2( dBx, dBy );\n\n	}\n\n	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy ) {\n\n		vec3 vSigmaX = dFdx( surf_pos );\n		vec3 vSigmaY = dFdy( surf_pos );\n		vec3 vN = surf_norm;		// normalized\n\n		vec3 R1 = cross( vSigmaY, vN );\n		vec3 R2 = cross( vN, vSigmaX );\n\n		float fDet = dot( vSigmaX, R1 );\n\n		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n		return normalize( abs( fDet ) * surf_norm - vGrad );\n\n	}\n\n#endif";THREE.ShaderChunk["defaultnormal_vertex"]="vec3 objectNormal;\n\n#ifdef USE_SKINNING\n\n	objectNormal = skinnedNormal.xyz;\n\n#endif\n\n#if !defined( USE_SKINNING ) && defined( USE_MORPHNORMALS )\n\n	objectNormal = morphedNormal;\n\n#endif\n\n#if !defined( USE_SKINNING ) && ! defined( USE_MORPHNORMALS )\n\n	objectNormal = normal;\n\n#endif\n\n#ifdef FLIP_SIDED\n\n	objectNormal = -objectNormal;\n\n#endif\n\nvec3 transformedNormal = normalMatrix * objectNormal;";THREE.ShaderChunk["lights_phong_pars_fragment"]="uniform vec3 ambientLightColor;\n\n#if MAX_DIR_LIGHTS > 0\n\n	uniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];\n	uniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];\n\n#endif\n\n#if MAX_HEMI_LIGHTS > 0\n\n	uniform vec3 hemisphereLightSkyColor[ MAX_HEMI_LIGHTS ];\n	uniform vec3 hemisphereLightGroundColor[ MAX_HEMI_LIGHTS ];\n	uniform vec3 hemisphereLightDirection[ MAX_HEMI_LIGHTS ];\n\n#endif\n\n#if MAX_POINT_LIGHTS > 0\n\n	uniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];\n\n	uniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];\n	uniform float pointLightDistance[ MAX_POINT_LIGHTS ];\n\n#endif\n\n#if MAX_SPOT_LIGHTS > 0\n\n	uniform vec3 spotLightColor[ MAX_SPOT_LIGHTS ];\n	uniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];\n	uniform vec3 spotLightDirection[ MAX_SPOT_LIGHTS ];\n	uniform float spotLightAngleCos[ MAX_SPOT_LIGHTS ];\n	uniform float spotLightExponent[ MAX_SPOT_LIGHTS ];\n\n	uniform float spotLightDistance[ MAX_SPOT_LIGHTS ];\n\n#endif\n\n#if MAX_SPOT_LIGHTS > 0 || defined( USE_BUMPMAP ) || defined( USE_ENVMAP )\n\n	varying vec3 vWorldPosition;\n\n#endif\n\n#ifdef WRAP_AROUND\n\n	uniform vec3 wrapRGB;\n\n#endif\n\nvarying vec3 vViewPosition;\nvarying vec3 vNormal;";THREE.ShaderChunk["skinbase_vertex"]="#ifdef USE_SKINNING\n\n	mat4 boneMatX = getBoneMatrix( skinIndex.x );\n	mat4 boneMatY = getBoneMatrix( skinIndex.y );\n	mat4 boneMatZ = getBoneMatrix( skinIndex.z );\n	mat4 boneMatW = getBoneMatrix( skinIndex.w );\n\n#endif";THREE.ShaderChunk["map_vertex"]="#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP )\n\n	vUv = uv * offsetRepeat.zw + offsetRepeat.xy;\n\n#endif";THREE.ShaderChunk["lightmap_fragment"]="#ifdef USE_LIGHTMAP\n\n	gl_FragColor = gl_FragColor * texture2D( lightMap, vUv2 );\n\n#endif";THREE.ShaderChunk["shadowmap_pars_vertex"]="#ifdef USE_SHADOWMAP\n\n	varying vec4 vShadowCoord[ MAX_SHADOWS ];\n	uniform mat4 shadowMatrix[ MAX_SHADOWS ];\n\n#endif";THREE.ShaderChunk["color_fragment"]="#ifdef USE_COLOR\n\n	gl_FragColor = gl_FragColor * vec4( vColor, 1.0 );\n\n#endif";THREE.ShaderChunk["morphtarget_vertex"]="#ifdef USE_MORPHTARGETS\n\n	vec3 morphed = vec3( 0.0 );\n	morphed += ( morphTarget0 - position ) * morphTargetInfluences[ 0 ];\n	morphed += ( morphTarget1 - position ) * morphTargetInfluences[ 1 ];\n	morphed += ( morphTarget2 - position ) * morphTargetInfluences[ 2 ];\n	morphed += ( morphTarget3 - position ) * morphTargetInfluences[ 3 ];\n\n	#ifndef USE_MORPHNORMALS\n\n	morphed += ( morphTarget4 - position ) * morphTargetInfluences[ 4 ];\n	morphed += ( morphTarget5 - position ) * morphTargetInfluences[ 5 ];\n	morphed += ( morphTarget6 - position ) * morphTargetInfluences[ 6 ];\n	morphed += ( morphTarget7 - position ) * morphTargetInfluences[ 7 ];\n\n	#endif\n\n	morphed += position;\n\n#endif";THREE.ShaderChunk["envmap_vertex"]="#if defined( USE_ENVMAP ) && ! defined( USE_BUMPMAP ) && ! defined( USE_NORMALMAP ) && ! defined( PHONG )\n\n	vec3 worldNormal = mat3( modelMatrix[ 0 ].xyz, modelMatrix[ 1 ].xyz, modelMatrix[ 2 ].xyz ) * objectNormal;\n	worldNormal = normalize( worldNormal );\n\n	vec3 cameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\n	if ( useRefract ) {\n\n		vReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\n	} else {\n\n		vReflect = reflect( cameraToVertex, worldNormal );\n\n	}\n\n#endif";THREE.ShaderChunk["shadowmap_fragment"]="#ifdef USE_SHADOWMAP\n\n	#ifdef SHADOWMAP_DEBUG\n\n		vec3 frustumColors[3];\n		frustumColors[0] = vec3( 1.0, 0.5, 0.0 );\n		frustumColors[1] = vec3( 0.0, 1.0, 0.8 );\n		frustumColors[2] = vec3( 0.0, 0.5, 1.0 );\n\n	#endif\n\n	#ifdef SHADOWMAP_CASCADE\n\n		int inFrustumCount = 0;\n\n	#endif\n\n	float fDepth;\n	vec3 shadowColor = vec3( 1.0 );\n\n	for( int i = 0; i < MAX_SHADOWS; i ++ ) {\n\n		vec3 shadowCoord = vShadowCoord[ i ].xyz / vShadowCoord[ i ].w;\n\n				// if ( something && something ) breaks ATI OpenGL shader compiler\n				// if ( all( something, something ) ) using this instead\n\n		bvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\n		bool inFrustum = all( inFrustumVec );\n\n				// don't shadow pixels outside of light frustum\n				// use just first frustum (for cascades)\n				// don't shadow pixels behind far plane of light frustum\n\n		#ifdef SHADOWMAP_CASCADE\n\n			inFrustumCount += int( inFrustum );\n			bvec3 frustumTestVec = bvec3( inFrustum, inFrustumCount == 1, shadowCoord.z <= 1.0 );\n\n		#else\n\n			bvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n\n		#endif\n\n		bool frustumTest = all( frustumTestVec );\n\n		if ( frustumTest ) {\n\n			shadowCoord.z += shadowBias[ i ];\n\n			#if defined( SHADOWMAP_TYPE_PCF )\n\n						// Percentage-close filtering\n						// (9 pixel kernel)\n						// http://fabiensanglard.net/shadowmappingPCF/\n\n				float shadow = 0.0;\n\n		/*\n						// nested loops breaks shader compiler / validator on some ATI cards when using OpenGL\n						// must enroll loop manually\n\n				for ( float y = -1.25; y <= 1.25; y += 1.25 )\n					for ( float x = -1.25; x <= 1.25; x += 1.25 ) {\n\n						vec4 rgbaDepth = texture2D( shadowMap[ i ], vec2( x * xPixelOffset, y * yPixelOffset ) + shadowCoord.xy );\n\n								// doesn't seem to produce any noticeable visual difference compared to simple texture2D lookup\n								//vec4 rgbaDepth = texture2DProj( shadowMap[ i ], vec4( vShadowCoord[ i ].w * ( vec2( x * xPixelOffset, y * yPixelOffset ) + shadowCoord.xy ), 0.05, vShadowCoord[ i ].w ) );\n\n						float fDepth = unpackDepth( rgbaDepth );\n\n						if ( fDepth < shadowCoord.z )\n							shadow += 1.0;\n\n				}\n\n				shadow /= 9.0;\n\n		*/\n\n				const float shadowDelta = 1.0 / 9.0;\n\n				float xPixelOffset = 1.0 / shadowMapSize[ i ].x;\n				float yPixelOffset = 1.0 / shadowMapSize[ i ].y;\n\n				float dx0 = -1.25 * xPixelOffset;\n				float dy0 = -1.25 * yPixelOffset;\n				float dx1 = 1.25 * xPixelOffset;\n				float dy1 = 1.25 * yPixelOffset;\n\n				fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy0 ) ) );\n				if ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n				fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy0 ) ) );\n				if ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n				fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy0 ) ) );\n				if ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n				fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, 0.0 ) ) );\n				if ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n				fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy ) );\n				if ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n				fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, 0.0 ) ) );\n				if ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n				fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy1 ) ) );\n				if ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n				fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy1 ) ) );\n				if ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n				fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy1 ) ) );\n				if ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n				shadowColor = shadowColor * vec3( ( 1.0 - shadowDarkness[ i ] * shadow ) );\n\n			#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\n						// Percentage-close filtering\n						// (9 pixel kernel)\n						// http://fabiensanglard.net/shadowmappingPCF/\n\n				float shadow = 0.0;\n\n				float xPixelOffset = 1.0 / shadowMapSize[ i ].x;\n				float yPixelOffset = 1.0 / shadowMapSize[ i ].y;\n\n				float dx0 = -1.0 * xPixelOffset;\n				float dy0 = -1.0 * yPixelOffset;\n				float dx1 = 1.0 * xPixelOffset;\n				float dy1 = 1.0 * yPixelOffset;\n\n				mat3 shadowKernel;\n				mat3 depthKernel;\n\n				depthKernel[0][0] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy0 ) ) );\n				depthKernel[0][1] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, 0.0 ) ) );\n				depthKernel[0][2] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy1 ) ) );\n				depthKernel[1][0] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy0 ) ) );\n				depthKernel[1][1] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy ) );\n				depthKernel[1][2] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy1 ) ) );\n				depthKernel[2][0] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy0 ) ) );\n				depthKernel[2][1] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, 0.0 ) ) );\n				depthKernel[2][2] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy1 ) ) );\n\n				vec3 shadowZ = vec3( shadowCoord.z );\n				shadowKernel[0] = vec3(lessThan(depthKernel[0], shadowZ ));\n				shadowKernel[0] *= vec3(0.25);\n\n				shadowKernel[1] = vec3(lessThan(depthKernel[1], shadowZ ));\n				shadowKernel[1] *= vec3(0.25);\n\n				shadowKernel[2] = vec3(lessThan(depthKernel[2], shadowZ ));\n				shadowKernel[2] *= vec3(0.25);\n\n				vec2 fractionalCoord = 1.0 - fract( shadowCoord.xy * shadowMapSize[i].xy );\n\n				shadowKernel[0] = mix( shadowKernel[1], shadowKernel[0], fractionalCoord.x );\n				shadowKernel[1] = mix( shadowKernel[2], shadowKernel[1], fractionalCoord.x );\n\n				vec4 shadowValues;\n				shadowValues.x = mix( shadowKernel[0][1], shadowKernel[0][0], fractionalCoord.y );\n				shadowValues.y = mix( shadowKernel[0][2], shadowKernel[0][1], fractionalCoord.y );\n				shadowValues.z = mix( shadowKernel[1][1], shadowKernel[1][0], fractionalCoord.y );\n				shadowValues.w = mix( shadowKernel[1][2], shadowKernel[1][1], fractionalCoord.y );\n\n				shadow = dot( shadowValues, vec4( 1.0 ) );\n\n				shadowColor = shadowColor * vec3( ( 1.0 - shadowDarkness[ i ] * shadow ) );\n\n			#else\n\n				vec4 rgbaDepth = texture2D( shadowMap[ i ], shadowCoord.xy );\n				float fDepth = unpackDepth( rgbaDepth );\n\n				if ( fDepth < shadowCoord.z )\n\n		// spot with multiple shadows is darker\n\n					shadowColor = shadowColor * vec3( 1.0 - shadowDarkness[ i ] );\n\n		// spot with multiple shadows has the same color as single shadow spot\n\n		// 					shadowColor = min( shadowColor, vec3( shadowDarkness[ i ] ) );\n\n			#endif\n\n		}\n\n\n		#ifdef SHADOWMAP_DEBUG\n\n			#ifdef SHADOWMAP_CASCADE\n\n				if ( inFrustum && inFrustumCount == 1 ) gl_FragColor.xyz *= frustumColors[ i ];\n\n			#else\n\n				if ( inFrustum ) gl_FragColor.xyz *= frustumColors[ i ];\n\n			#endif\n\n		#endif\n\n	}\n\n	#ifdef GAMMA_OUTPUT\n\n		shadowColor *= shadowColor;\n\n	#endif\n\n	gl_FragColor.xyz = gl_FragColor.xyz * shadowColor;\n\n#endif\n";
THREE.ShaderChunk["worldpos_vertex"]="#if defined( USE_ENVMAP ) || defined( PHONG ) || defined( LAMBERT ) || defined ( USE_SHADOWMAP )\n\n	#ifdef USE_SKINNING\n\n		vec4 worldPosition = modelMatrix * skinned;\n\n	#endif\n\n	#if defined( USE_MORPHTARGETS ) && ! defined( USE_SKINNING )\n\n		vec4 worldPosition = modelMatrix * vec4( morphed, 1.0 );\n\n	#endif\n\n	#if ! defined( USE_MORPHTARGETS ) && ! defined( USE_SKINNING )\n\n		vec4 worldPosition = modelMatrix * vec4( position, 1.0 );\n\n	#endif\n\n#endif";THREE.ShaderChunk["shadowmap_pars_fragment"]="#ifdef USE_SHADOWMAP\n\n	uniform sampler2D shadowMap[ MAX_SHADOWS ];\n	uniform vec2 shadowMapSize[ MAX_SHADOWS ];\n\n	uniform float shadowDarkness[ MAX_SHADOWS ];\n	uniform float shadowBias[ MAX_SHADOWS ];\n\n	varying vec4 vShadowCoord[ MAX_SHADOWS ];\n\n	float unpackDepth( const in vec4 rgba_depth ) {\n\n		const vec4 bit_shift = vec4( 1.0 / ( 256.0 * 256.0 * 256.0 ), 1.0 / ( 256.0 * 256.0 ), 1.0 / 256.0, 1.0 );\n		float depth = dot( rgba_depth, bit_shift );\n		return depth;\n\n	}\n\n#endif";THREE.ShaderChunk["skinning_pars_vertex"]="#ifdef USE_SKINNING\n\n	uniform mat4 bindMatrix;\n	uniform mat4 bindMatrixInverse;\n\n	#ifdef BONE_TEXTURE\n\n		uniform sampler2D boneTexture;\n		uniform int boneTextureWidth;\n		uniform int boneTextureHeight;\n\n		mat4 getBoneMatrix( const in float i ) {\n\n			float j = i * 4.0;\n			float x = mod( j, float( boneTextureWidth ) );\n			float y = floor( j / float( boneTextureWidth ) );\n\n			float dx = 1.0 / float( boneTextureWidth );\n			float dy = 1.0 / float( boneTextureHeight );\n\n			y = dy * ( y + 0.5 );\n\n			vec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n			vec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n			vec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n			vec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\n			mat4 bone = mat4( v1, v2, v3, v4 );\n\n			return bone;\n\n		}\n\n	#else\n\n		uniform mat4 boneGlobalMatrices[ MAX_BONES ];\n\n		mat4 getBoneMatrix( const in float i ) {\n\n			mat4 bone = boneGlobalMatrices[ int(i) ];\n			return bone;\n\n		}\n\n	#endif\n\n#endif\n";THREE.ShaderChunk["logdepthbuf_pars_fragment"]="#ifdef USE_LOGDEPTHBUF\n\n	uniform float logDepthBufFC;\n\n	#ifdef USE_LOGDEPTHBUF_EXT\n\n		#extension GL_EXT_frag_depth : enable\n		varying float vFragDepth;\n\n	#endif\n\n#endif";THREE.ShaderChunk["alphamap_fragment"]="#ifdef USE_ALPHAMAP\n\n	gl_FragColor.a *= texture2D( alphaMap, vUv ).g;\n\n#endif\n";THREE.ShaderChunk["alphamap_pars_fragment"]="#ifdef USE_ALPHAMAP\n\n	uniform sampler2D alphaMap;\n\n#endif\n";THREE.UniformsUtils={merge:function(uniforms){var merged={};for(var u=0;u<uniforms.length;u++){var tmp=this.clone(uniforms[u]);for(var p in tmp){merged[p]=tmp[p]}}return merged},clone:function(uniforms_src){var uniforms_dst={};for(var u in uniforms_src){uniforms_dst[u]={};for(var p in uniforms_src[u]){var parameter_src=uniforms_src[u][p];if(parameter_src instanceof THREE.Color||parameter_src instanceof THREE.Vector2||parameter_src instanceof THREE.Vector3||parameter_src instanceof THREE.Vector4||parameter_src instanceof THREE.Matrix4||parameter_src instanceof THREE.Texture){uniforms_dst[u][p]=parameter_src.clone()}else if(parameter_src instanceof Array){uniforms_dst[u][p]=parameter_src.slice()}else{uniforms_dst[u][p]=parameter_src}}}return uniforms_dst}};THREE.UniformsLib={common:{diffuse:{type:"c",value:new THREE.Color(15658734)},opacity:{type:"f",value:1},map:{type:"t",value:null},offsetRepeat:{type:"v4",value:new THREE.Vector4(0,0,1,1)},lightMap:{type:"t",value:null},specularMap:{type:"t",value:null},alphaMap:{type:"t",value:null},envMap:{type:"t",value:null},flipEnvMap:{type:"f",value:-1},useRefract:{type:"i",value:0},reflectivity:{type:"f",value:1},refractionRatio:{type:"f",value:.98},combine:{type:"i",value:0},morphTargetInfluences:{type:"f",value:0}},bump:{bumpMap:{type:"t",value:null},bumpScale:{type:"f",value:1}},normalmap:{normalMap:{type:"t",value:null},normalScale:{type:"v2",value:new THREE.Vector2(1,1)}},fog:{fogDensity:{type:"f",value:25e-5},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},fogColor:{type:"c",value:new THREE.Color(16777215)}},lights:{ambientLightColor:{type:"fv",value:[]},directionalLightDirection:{type:"fv",value:[]},directionalLightColor:{type:"fv",value:[]},hemisphereLightDirection:{type:"fv",value:[]},hemisphereLightSkyColor:{type:"fv",value:[]},hemisphereLightGroundColor:{type:"fv",value:[]},pointLightColor:{type:"fv",value:[]},pointLightPosition:{type:"fv",value:[]},pointLightDistance:{type:"fv1",value:[]},spotLightColor:{type:"fv",value:[]},spotLightPosition:{type:"fv",value:[]},spotLightDirection:{type:"fv",value:[]},spotLightDistance:{type:"fv1",value:[]},spotLightAngleCos:{type:"fv1",value:[]},spotLightExponent:{type:"fv1",value:[]}},particle:{psColor:{type:"c",value:new THREE.Color(15658734)},opacity:{type:"f",value:1},size:{type:"f",value:1},scale:{type:"f",value:1},map:{type:"t",value:null},fogDensity:{type:"f",value:25e-5},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},fogColor:{type:"c",value:new THREE.Color(16777215)}},shadowmap:{shadowMap:{type:"tv",value:[]},shadowMapSize:{type:"v2v",value:[]},shadowBias:{type:"fv1",value:[]},shadowDarkness:{type:"fv1",value:[]},shadowMatrix:{type:"m4v",value:[]}}};THREE.ShaderLib={basic:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib["common"],THREE.UniformsLib["fog"],THREE.UniformsLib["shadowmap"]]),vertexShader:[THREE.ShaderChunk["map_pars_vertex"],THREE.ShaderChunk["lightmap_pars_vertex"],THREE.ShaderChunk["envmap_pars_vertex"],THREE.ShaderChunk["color_pars_vertex"],THREE.ShaderChunk["morphtarget_pars_vertex"],THREE.ShaderChunk["skinning_pars_vertex"],THREE.ShaderChunk["shadowmap_pars_vertex"],THREE.ShaderChunk["logdepthbuf_pars_vertex"],"void main() {",THREE.ShaderChunk["map_vertex"],THREE.ShaderChunk["lightmap_vertex"],THREE.ShaderChunk["color_vertex"],THREE.ShaderChunk["skinbase_vertex"],"	#ifdef USE_ENVMAP",THREE.ShaderChunk["morphnormal_vertex"],THREE.ShaderChunk["skinnormal_vertex"],THREE.ShaderChunk["defaultnormal_vertex"],"	#endif",THREE.ShaderChunk["morphtarget_vertex"],THREE.ShaderChunk["skinning_vertex"],THREE.ShaderChunk["default_vertex"],THREE.ShaderChunk["logdepthbuf_vertex"],THREE.ShaderChunk["worldpos_vertex"],THREE.ShaderChunk["envmap_vertex"],THREE.ShaderChunk["shadowmap_vertex"],"}"].join("\n"),fragmentShader:["uniform vec3 diffuse;","uniform float opacity;",THREE.ShaderChunk["color_pars_fragment"],THREE.ShaderChunk["map_pars_fragment"],THREE.ShaderChunk["alphamap_pars_fragment"],THREE.ShaderChunk["lightmap_pars_fragment"],THREE.ShaderChunk["envmap_pars_fragment"],THREE.ShaderChunk["fog_pars_fragment"],THREE.ShaderChunk["shadowmap_pars_fragment"],THREE.ShaderChunk["specularmap_pars_fragment"],THREE.ShaderChunk["logdepthbuf_pars_fragment"],"void main() {","	gl_FragColor = vec4( diffuse, opacity );",THREE.ShaderChunk["logdepthbuf_fragment"],THREE.ShaderChunk["map_fragment"],THREE.ShaderChunk["alphamap_fragment"],THREE.ShaderChunk["alphatest_fragment"],THREE.ShaderChunk["specularmap_fragment"],THREE.ShaderChunk["lightmap_fragment"],THREE.ShaderChunk["color_fragment"],THREE.ShaderChunk["envmap_fragment"],THREE.ShaderChunk["shadowmap_fragment"],THREE.ShaderChunk["linear_to_gamma_fragment"],THREE.ShaderChunk["fog_fragment"],"}"].join("\n")},lambert:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib["common"],THREE.UniformsLib["fog"],THREE.UniformsLib["lights"],THREE.UniformsLib["shadowmap"],{ambient:{type:"c",value:new THREE.Color(16777215)},emissive:{type:"c",value:new THREE.Color(0)},wrapRGB:{type:"v3",value:new THREE.Vector3(1,1,1)}}]),vertexShader:["#define LAMBERT","varying vec3 vLightFront;","#ifdef DOUBLE_SIDED","	varying vec3 vLightBack;","#endif",THREE.ShaderChunk["map_pars_vertex"],THREE.ShaderChunk["lightmap_pars_vertex"],THREE.ShaderChunk["envmap_pars_vertex"],THREE.ShaderChunk["lights_lambert_pars_vertex"],THREE.ShaderChunk["color_pars_vertex"],THREE.ShaderChunk["morphtarget_pars_vertex"],THREE.ShaderChunk["skinning_pars_vertex"],THREE.ShaderChunk["shadowmap_pars_vertex"],THREE.ShaderChunk["logdepthbuf_pars_vertex"],"void main() {",THREE.ShaderChunk["map_vertex"],THREE.ShaderChunk["lightmap_vertex"],THREE.ShaderChunk["color_vertex"],THREE.ShaderChunk["morphnormal_vertex"],THREE.ShaderChunk["skinbase_vertex"],THREE.ShaderChunk["skinnormal_vertex"],THREE.ShaderChunk["defaultnormal_vertex"],THREE.ShaderChunk["morphtarget_vertex"],THREE.ShaderChunk["skinning_vertex"],THREE.ShaderChunk["default_vertex"],THREE.ShaderChunk["logdepthbuf_vertex"],THREE.ShaderChunk["worldpos_vertex"],THREE.ShaderChunk["envmap_vertex"],THREE.ShaderChunk["lights_lambert_vertex"],THREE.ShaderChunk["shadowmap_vertex"],"}"].join("\n"),fragmentShader:["uniform float opacity;","varying vec3 vLightFront;","#ifdef DOUBLE_SIDED","	varying vec3 vLightBack;","#endif",THREE.ShaderChunk["color_pars_fragment"],THREE.ShaderChunk["map_pars_fragment"],THREE.ShaderChunk["alphamap_pars_fragment"],THREE.ShaderChunk["lightmap_pars_fragment"],THREE.ShaderChunk["envmap_pars_fragment"],THREE.ShaderChunk["fog_pars_fragment"],THREE.ShaderChunk["shadowmap_pars_fragment"],THREE.ShaderChunk["specularmap_pars_fragment"],THREE.ShaderChunk["logdepthbuf_pars_fragment"],"void main() {","	gl_FragColor = vec4( vec3( 1.0 ), opacity );",THREE.ShaderChunk["logdepthbuf_fragment"],THREE.ShaderChunk["map_fragment"],THREE.ShaderChunk["alphamap_fragment"],THREE.ShaderChunk["alphatest_fragment"],THREE.ShaderChunk["specularmap_fragment"],"	#ifdef DOUBLE_SIDED","		if ( gl_FrontFacing )","			gl_FragColor.xyz *= vLightFront;","		else","			gl_FragColor.xyz *= vLightBack;","	#else","		gl_FragColor.xyz *= vLightFront;","	#endif",THREE.ShaderChunk["lightmap_fragment"],THREE.ShaderChunk["color_fragment"],THREE.ShaderChunk["envmap_fragment"],THREE.ShaderChunk["shadowmap_fragment"],THREE.ShaderChunk["linear_to_gamma_fragment"],THREE.ShaderChunk["fog_fragment"],"}"].join("\n")},phong:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib["common"],THREE.UniformsLib["bump"],THREE.UniformsLib["normalmap"],THREE.UniformsLib["fog"],THREE.UniformsLib["lights"],THREE.UniformsLib["shadowmap"],{ambient:{type:"c",value:new THREE.Color(16777215)},emissive:{type:"c",value:new THREE.Color(0)},specular:{type:"c",value:new THREE.Color(1118481)},shininess:{type:"f",value:30},wrapRGB:{type:"v3",value:new THREE.Vector3(1,1,1)}}]),vertexShader:["#define PHONG","varying vec3 vViewPosition;","varying vec3 vNormal;",THREE.ShaderChunk["map_pars_vertex"],THREE.ShaderChunk["lightmap_pars_vertex"],THREE.ShaderChunk["envmap_pars_vertex"],THREE.ShaderChunk["lights_phong_pars_vertex"],THREE.ShaderChunk["color_pars_vertex"],THREE.ShaderChunk["morphtarget_pars_vertex"],THREE.ShaderChunk["skinning_pars_vertex"],THREE.ShaderChunk["shadowmap_pars_vertex"],THREE.ShaderChunk["logdepthbuf_pars_vertex"],"void main() {",THREE.ShaderChunk["map_vertex"],THREE.ShaderChunk["lightmap_vertex"],THREE.ShaderChunk["color_vertex"],THREE.ShaderChunk["morphnormal_vertex"],THREE.ShaderChunk["skinbase_vertex"],THREE.ShaderChunk["skinnormal_vertex"],THREE.ShaderChunk["defaultnormal_vertex"],"	vNormal = normalize( transformedNormal );",THREE.ShaderChunk["morphtarget_vertex"],THREE.ShaderChunk["skinning_vertex"],THREE.ShaderChunk["default_vertex"],THREE.ShaderChunk["logdepthbuf_vertex"],"	vViewPosition = -mvPosition.xyz;",THREE.ShaderChunk["worldpos_vertex"],THREE.ShaderChunk["envmap_vertex"],THREE.ShaderChunk["lights_phong_vertex"],THREE.ShaderChunk["shadowmap_vertex"],"}"].join("\n"),fragmentShader:["#define PHONG","uniform vec3 diffuse;","uniform float opacity;","uniform vec3 ambient;","uniform vec3 emissive;","uniform vec3 specular;","uniform float shininess;",THREE.ShaderChunk["color_pars_fragment"],THREE.ShaderChunk["map_pars_fragment"],THREE.ShaderChunk["alphamap_pars_fragment"],THREE.ShaderChunk["lightmap_pars_fragment"],THREE.ShaderChunk["envmap_pars_fragment"],THREE.ShaderChunk["fog_pars_fragment"],THREE.ShaderChunk["lights_phong_pars_fragment"],THREE.ShaderChunk["shadowmap_pars_fragment"],THREE.ShaderChunk["bumpmap_pars_fragment"],THREE.ShaderChunk["normalmap_pars_fragment"],THREE.ShaderChunk["specularmap_pars_fragment"],THREE.ShaderChunk["logdepthbuf_pars_fragment"],"void main() {","	gl_FragColor = vec4( vec3( 1.0 ), opacity );",THREE.ShaderChunk["logdepthbuf_fragment"],THREE.ShaderChunk["map_fragment"],THREE.ShaderChunk["alphamap_fragment"],THREE.ShaderChunk["alphatest_fragment"],THREE.ShaderChunk["specularmap_fragment"],THREE.ShaderChunk["lights_phong_fragment"],THREE.ShaderChunk["lightmap_fragment"],THREE.ShaderChunk["color_fragment"],THREE.ShaderChunk["envmap_fragment"],THREE.ShaderChunk["shadowmap_fragment"],THREE.ShaderChunk["linear_to_gamma_fragment"],THREE.ShaderChunk["fog_fragment"],"}"].join("\n")},particle_basic:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib["particle"],THREE.UniformsLib["shadowmap"]]),vertexShader:["uniform float size;","uniform float scale;",THREE.ShaderChunk["color_pars_vertex"],THREE.ShaderChunk["shadowmap_pars_vertex"],THREE.ShaderChunk["logdepthbuf_pars_vertex"],"void main() {",THREE.ShaderChunk["color_vertex"],"	vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","	#ifdef USE_SIZEATTENUATION","		gl_PointSize = size * ( scale / length( mvPosition.xyz ) );","	#else","		gl_PointSize = size;","	#endif","	gl_Position = projectionMatrix * mvPosition;",THREE.ShaderChunk["logdepthbuf_vertex"],THREE.ShaderChunk["worldpos_vertex"],THREE.ShaderChunk["shadowmap_vertex"],"}"].join("\n"),fragmentShader:["uniform vec3 psColor;","uniform float opacity;",THREE.ShaderChunk["color_pars_fragment"],THREE.ShaderChunk["map_particle_pars_fragment"],THREE.ShaderChunk["fog_pars_fragment"],THREE.ShaderChunk["shadowmap_pars_fragment"],THREE.ShaderChunk["logdepthbuf_pars_fragment"],"void main() {","	gl_FragColor = vec4( psColor, opacity );",THREE.ShaderChunk["logdepthbuf_fragment"],THREE.ShaderChunk["map_particle_fragment"],THREE.ShaderChunk["alphatest_fragment"],THREE.ShaderChunk["color_fragment"],THREE.ShaderChunk["shadowmap_fragment"],THREE.ShaderChunk["fog_fragment"],"}"].join("\n")},dashed:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib["common"],THREE.UniformsLib["fog"],{scale:{type:"f",value:1},dashSize:{type:"f",value:1},totalSize:{type:"f",value:2}}]),vertexShader:["uniform float scale;","attribute float lineDistance;","varying float vLineDistance;",THREE.ShaderChunk["color_pars_vertex"],THREE.ShaderChunk["logdepthbuf_pars_vertex"],"void main() {",THREE.ShaderChunk["color_vertex"],"	vLineDistance = scale * lineDistance;","	vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","	gl_Position = projectionMatrix * mvPosition;",THREE.ShaderChunk["logdepthbuf_vertex"],"}"].join("\n"),fragmentShader:["uniform vec3 diffuse;","uniform float opacity;","uniform float dashSize;","uniform float totalSize;","varying float vLineDistance;",THREE.ShaderChunk["color_pars_fragment"],THREE.ShaderChunk["fog_pars_fragment"],THREE.ShaderChunk["logdepthbuf_pars_fragment"],"void main() {","	if ( mod( vLineDistance, totalSize ) > dashSize ) {","		discard;","	}","	gl_FragColor = vec4( diffuse, opacity );",THREE.ShaderChunk["logdepthbuf_fragment"],THREE.ShaderChunk["color_fragment"],THREE.ShaderChunk["fog_fragment"],"}"].join("\n")},depth:{uniforms:{mNear:{type:"f",value:1},mFar:{type:"f",value:2e3},opacity:{type:"f",value:1}},vertexShader:[THREE.ShaderChunk["morphtarget_pars_vertex"],THREE.ShaderChunk["logdepthbuf_pars_vertex"],"void main() {",THREE.ShaderChunk["morphtarget_vertex"],THREE.ShaderChunk["default_vertex"],THREE.ShaderChunk["logdepthbuf_vertex"],"}"].join("\n"),fragmentShader:["uniform float mNear;","uniform float mFar;","uniform float opacity;",THREE.ShaderChunk["logdepthbuf_pars_fragment"],"void main() {",THREE.ShaderChunk["logdepthbuf_fragment"],"	#ifdef USE_LOGDEPTHBUF_EXT","		float depth = gl_FragDepthEXT / gl_FragCoord.w;","	#else","		float depth = gl_FragCoord.z / gl_FragCoord.w;","	#endif","	float color = 1.0 - smoothstep( mNear, mFar, depth );","	gl_FragColor = vec4( vec3( color ), opacity );","}"].join("\n")},normal:{uniforms:{opacity:{type:"f",value:1}},vertexShader:["varying vec3 vNormal;",THREE.ShaderChunk["morphtarget_pars_vertex"],THREE.ShaderChunk["logdepthbuf_pars_vertex"],"void main() {","	vNormal = normalize( normalMatrix * normal );",THREE.ShaderChunk["morphtarget_vertex"],THREE.ShaderChunk["default_vertex"],THREE.ShaderChunk["logdepthbuf_vertex"],"}"].join("\n"),fragmentShader:["uniform float opacity;","varying vec3 vNormal;",THREE.ShaderChunk["logdepthbuf_pars_fragment"],"void main() {","	gl_FragColor = vec4( 0.5 * normalize( vNormal ) + 0.5, opacity );",THREE.ShaderChunk["logdepthbuf_fragment"],"}"].join("\n")},normalmap:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib["fog"],THREE.UniformsLib["lights"],THREE.UniformsLib["shadowmap"],{enableAO:{type:"i",value:0},enableDiffuse:{type:"i",value:0},enableSpecular:{type:"i",value:0},enableReflection:{type:"i",value:0},enableDisplacement:{type:"i",value:0},tDisplacement:{type:"t",value:null},tDiffuse:{type:"t",value:null},tCube:{type:"t",value:null},tNormal:{type:"t",value:null},tSpecular:{type:"t",value:null},tAO:{type:"t",value:null},uNormalScale:{type:"v2",value:new THREE.Vector2(1,1)},uDisplacementBias:{type:"f",value:0},uDisplacementScale:{type:"f",value:1},diffuse:{type:"c",value:new THREE.Color(16777215)},specular:{type:"c",value:new THREE.Color(1118481)},ambient:{type:"c",value:new THREE.Color(16777215)},shininess:{type:"f",value:30},opacity:{type:"f",value:1},useRefract:{type:"i",value:0},refractionRatio:{type:"f",value:.98},reflectivity:{type:"f",value:.5},uOffset:{type:"v2",value:new THREE.Vector2(0,0)},uRepeat:{type:"v2",value:new THREE.Vector2(1,1)},wrapRGB:{type:"v3",value:new THREE.Vector3(1,1,1)}}]),fragmentShader:["uniform vec3 ambient;","uniform vec3 diffuse;","uniform vec3 specular;","uniform float shininess;","uniform float opacity;","uniform bool enableDiffuse;","uniform bool enableSpecular;","uniform bool enableAO;","uniform bool enableReflection;","uniform sampler2D tDiffuse;","uniform sampler2D tNormal;","uniform sampler2D tSpecular;","uniform sampler2D tAO;","uniform samplerCube tCube;","uniform vec2 uNormalScale;","uniform bool useRefract;","uniform float refractionRatio;","uniform float reflectivity;","varying vec3 vTangent;","varying vec3 vBinormal;","varying vec3 vNormal;","varying vec2 vUv;","uniform vec3 ambientLightColor;","#if MAX_DIR_LIGHTS > 0","	uniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];","	uniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];","#endif","#if MAX_HEMI_LIGHTS > 0","	uniform vec3 hemisphereLightSkyColor[ MAX_HEMI_LIGHTS ];","	uniform vec3 hemisphereLightGroundColor[ MAX_HEMI_LIGHTS ];","	uniform vec3 hemisphereLightDirection[ MAX_HEMI_LIGHTS ];","#endif","#if MAX_POINT_LIGHTS > 0","	uniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];","	uniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];","	uniform float pointLightDistance[ MAX_POINT_LIGHTS ];","#endif","#if MAX_SPOT_LIGHTS > 0","	uniform vec3 spotLightColor[ MAX_SPOT_LIGHTS ];","	uniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];","	uniform vec3 spotLightDirection[ MAX_SPOT_LIGHTS ];","	uniform float spotLightAngleCos[ MAX_SPOT_LIGHTS ];","	uniform float spotLightExponent[ MAX_SPOT_LIGHTS ];","	uniform float spotLightDistance[ MAX_SPOT_LIGHTS ];","#endif","#ifdef WRAP_AROUND","	uniform vec3 wrapRGB;","#endif","varying vec3 vWorldPosition;","varying vec3 vViewPosition;",THREE.ShaderChunk["shadowmap_pars_fragment"],THREE.ShaderChunk["fog_pars_fragment"],THREE.ShaderChunk["logdepthbuf_pars_fragment"],"void main() {",THREE.ShaderChunk["logdepthbuf_fragment"],"	gl_FragColor = vec4( vec3( 1.0 ), opacity );","	vec3 specularTex = vec3( 1.0 );","	vec3 normalTex = texture2D( tNormal, vUv ).xyz * 2.0 - 1.0;","	normalTex.xy *= uNormalScale;","	normalTex = normalize( normalTex );","	if( enableDiffuse ) {","		#ifdef GAMMA_INPUT","			vec4 texelColor = texture2D( tDiffuse, vUv );","			texelColor.xyz *= texelColor.xyz;","			gl_FragColor = gl_FragColor * texelColor;","		#else","			gl_FragColor = gl_FragColor * texture2D( tDiffuse, vUv );","		#endif","	}","	if( enableAO ) {","		#ifdef GAMMA_INPUT","			vec4 aoColor = texture2D( tAO, vUv );","			aoColor.xyz *= aoColor.xyz;","			gl_FragColor.xyz = gl_FragColor.xyz * aoColor.xyz;","		#else","			gl_FragColor.xyz = gl_FragColor.xyz * texture2D( tAO, vUv ).xyz;","		#endif","	}",THREE.ShaderChunk["alphatest_fragment"],"	if( enableSpecular )","		specularTex = texture2D( tSpecular, vUv ).xyz;","	mat3 tsb = mat3( normalize( vTangent ), normalize( vBinormal ), normalize( vNormal ) );","	vec3 finalNormal = tsb * normalTex;","	#ifdef FLIP_SIDED","		finalNormal = -finalNormal;","	#endif","	vec3 normal = normalize( finalNormal );","	vec3 viewPosition = normalize( vViewPosition );","	#if MAX_POINT_LIGHTS > 0","		vec3 pointDiffuse = vec3( 0.0 );","		vec3 pointSpecular = vec3( 0.0 );","		for ( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {","			vec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );","			vec3 pointVector = lPosition.xyz + vViewPosition.xyz;","			float pointDistance = 1.0;","			if ( pointLightDistance[ i ] > 0.0 )","				pointDistance = 1.0 - min( ( length( pointVector ) / pointLightDistance[ i ] ), 1.0 );","			pointVector = normalize( pointVector );","			#ifdef WRAP_AROUND","				float pointDiffuseWeightFull = max( dot( normal, pointVector ), 0.0 );","				float pointDiffuseWeightHalf = max( 0.5 * dot( normal, pointVector ) + 0.5, 0.0 );","				vec3 pointDiffuseWeight = mix( vec3( pointDiffuseWeightFull ), vec3( pointDiffuseWeightHalf ), wrapRGB );","			#else","				float pointDiffuseWeight = max( dot( normal, pointVector ), 0.0 );","			#endif","			pointDiffuse += pointDistance * pointLightColor[ i ] * diffuse * pointDiffuseWeight;","			vec3 pointHalfVector = normalize( pointVector + viewPosition );","			float pointDotNormalHalf = max( dot( normal, pointHalfVector ), 0.0 );","			float pointSpecularWeight = specularTex.r * max( pow( pointDotNormalHalf, shininess ), 0.0 );","			float specularNormalization = ( shininess + 2.0 ) / 8.0;","			vec3 schlick = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( pointVector, pointHalfVector ), 0.0 ), 5.0 );","			pointSpecular += schlick * pointLightColor[ i ] * pointSpecularWeight * pointDiffuseWeight * pointDistance * specularNormalization;","		}","	#endif","	#if MAX_SPOT_LIGHTS > 0","		vec3 spotDiffuse = vec3( 0.0 );","		vec3 spotSpecular = vec3( 0.0 );","		for ( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {","			vec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );","			vec3 spotVector = lPosition.xyz + vViewPosition.xyz;","			float spotDistance = 1.0;","			if ( spotLightDistance[ i ] > 0.0 )","				spotDistance = 1.0 - min( ( length( spotVector ) / spotLightDistance[ i ] ), 1.0 );","			spotVector = normalize( spotVector );","			float spotEffect = dot( spotLightDirection[ i ], normalize( spotLightPosition[ i ] - vWorldPosition ) );","			if ( spotEffect > spotLightAngleCos[ i ] ) {","				spotEffect = max( pow( max( spotEffect, 0.0 ), spotLightExponent[ i ] ), 0.0 );","				#ifdef WRAP_AROUND","					float spotDiffuseWeightFull = max( dot( normal, spotVector ), 0.0 );","					float spotDiffuseWeightHalf = max( 0.5 * dot( normal, spotVector ) + 0.5, 0.0 );","					vec3 spotDiffuseWeight = mix( vec3( spotDiffuseWeightFull ), vec3( spotDiffuseWeightHalf ), wrapRGB );","				#else","					float spotDiffuseWeight = max( dot( normal, spotVector ), 0.0 );","				#endif","				spotDiffuse += spotDistance * spotLightColor[ i ] * diffuse * spotDiffuseWeight * spotEffect;","				vec3 spotHalfVector = normalize( spotVector + viewPosition );","				float spotDotNormalHalf = max( dot( normal, spotHalfVector ), 0.0 );","				float spotSpecularWeight = specularTex.r * max( pow( spotDotNormalHalf, shininess ), 0.0 );","				float specularNormalization = ( shininess + 2.0 ) / 8.0;","				vec3 schlick = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( spotVector, spotHalfVector ), 0.0 ), 5.0 );","				spotSpecular += schlick * spotLightColor[ i ] * spotSpecularWeight * spotDiffuseWeight * spotDistance * specularNormalization * spotEffect;","			}","		}","	#endif","	#if MAX_DIR_LIGHTS > 0","		vec3 dirDiffuse = vec3( 0.0 );","		vec3 dirSpecular = vec3( 0.0 );","		for( int i = 0; i < MAX_DIR_LIGHTS; i++ ) {","			vec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );","			vec3 dirVector = normalize( lDirection.xyz );","			#ifdef WRAP_AROUND","				float directionalLightWeightingFull = max( dot( normal, dirVector ), 0.0 );","				float directionalLightWeightingHalf = max( 0.5 * dot( normal, dirVector ) + 0.5, 0.0 );","				vec3 dirDiffuseWeight = mix( vec3( directionalLightWeightingFull ), vec3( directionalLightWeightingHalf ), wrapRGB );","			#else","				float dirDiffuseWeight = max( dot( normal, dirVector ), 0.0 );","			#endif","			dirDiffuse += directionalLightColor[ i ] * diffuse * dirDiffuseWeight;","			vec3 dirHalfVector = normalize( dirVector + viewPosition );","			float dirDotNormalHalf = max( dot( normal, dirHalfVector ), 0.0 );","			float dirSpecularWeight = specularTex.r * max( pow( dirDotNormalHalf, shininess ), 0.0 );","			float specularNormalization = ( shininess + 2.0 ) / 8.0;","			vec3 schlick = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( dirVector, dirHalfVector ), 0.0 ), 5.0 );","			dirSpecular += schlick * directionalLightColor[ i ] * dirSpecularWeight * dirDiffuseWeight * specularNormalization;","		}","	#endif","	#if MAX_HEMI_LIGHTS > 0","		vec3 hemiDiffuse = vec3( 0.0 );","		vec3 hemiSpecular = vec3( 0.0 );","		for( int i = 0; i < MAX_HEMI_LIGHTS; i ++ ) {","			vec4 lDirection = viewMatrix * vec4( hemisphereLightDirection[ i ], 0.0 );","			vec3 lVector = normalize( lDirection.xyz );","			float dotProduct = dot( normal, lVector );","			float hemiDiffuseWeight = 0.5 * dotProduct + 0.5;","			vec3 hemiColor = mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeight );","			hemiDiffuse += diffuse * hemiColor;","			vec3 hemiHalfVectorSky = normalize( lVector + viewPosition );","			float hemiDotNormalHalfSky = 0.5 * dot( normal, hemiHalfVectorSky ) + 0.5;","			float hemiSpecularWeightSky = specularTex.r * max( pow( max( hemiDotNormalHalfSky, 0.0 ), shininess ), 0.0 );","			vec3 lVectorGround = -lVector;","			vec3 hemiHalfVectorGround = normalize( lVectorGround + viewPosition );","			float hemiDotNormalHalfGround = 0.5 * dot( normal, hemiHalfVectorGround ) + 0.5;","			float hemiSpecularWeightGround = specularTex.r * max( pow( max( hemiDotNormalHalfGround, 0.0 ), shininess ), 0.0 );","			float dotProductGround = dot( normal, lVectorGround );","			float specularNormalization = ( shininess + 2.0 ) / 8.0;","			vec3 schlickSky = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( lVector, hemiHalfVectorSky ), 0.0 ), 5.0 );","			vec3 schlickGround = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( lVectorGround, hemiHalfVectorGround ), 0.0 ), 5.0 );","			hemiSpecular += hemiColor * specularNormalization * ( schlickSky * hemiSpecularWeightSky * max( dotProduct, 0.0 ) + schlickGround * hemiSpecularWeightGround * max( dotProductGround, 0.0 ) );","		}","	#endif","	vec3 totalDiffuse = vec3( 0.0 );","	vec3 totalSpecular = vec3( 0.0 );","	#if MAX_DIR_LIGHTS > 0","		totalDiffuse += dirDiffuse;","		totalSpecular += dirSpecular;","	#endif","	#if MAX_HEMI_LIGHTS > 0","		totalDiffuse += hemiDiffuse;","		totalSpecular += hemiSpecular;","	#endif","	#if MAX_POINT_LIGHTS > 0","		totalDiffuse += pointDiffuse;","		totalSpecular += pointSpecular;","	#endif","	#if MAX_SPOT_LIGHTS > 0","		totalDiffuse += spotDiffuse;","		totalSpecular += spotSpecular;","	#endif","	#ifdef METAL","		gl_FragColor.xyz = gl_FragColor.xyz * ( totalDiffuse + ambientLightColor * ambient + totalSpecular );","	#else","		gl_FragColor.xyz = gl_FragColor.xyz * ( totalDiffuse + ambientLightColor * ambient ) + totalSpecular;","	#endif","	if ( enableReflection ) {","		vec3 vReflect;","		vec3 cameraToVertex = normalize( vWorldPosition - cameraPosition );","		if ( useRefract ) {","			vReflect = refract( cameraToVertex, normal, refractionRatio );","		} else {","			vReflect = reflect( cameraToVertex, normal );","		}","		vec4 cubeColor = textureCube( tCube, vec3( -vReflect.x, vReflect.yz ) );","		#ifdef GAMMA_INPUT","			cubeColor.xyz *= cubeColor.xyz;","		#endif","		gl_FragColor.xyz = mix( gl_FragColor.xyz, cubeColor.xyz, specularTex.r * reflectivity );","	}",THREE.ShaderChunk["shadowmap_fragment"],THREE.ShaderChunk["linear_to_gamma_fragment"],THREE.ShaderChunk["fog_fragment"],"}"].join("\n"),vertexShader:["attribute vec4 tangent;","uniform vec2 uOffset;","uniform vec2 uRepeat;","uniform bool enableDisplacement;","#ifdef VERTEX_TEXTURES","	uniform sampler2D tDisplacement;","	uniform float uDisplacementScale;","	uniform float uDisplacementBias;","#endif","varying vec3 vTangent;","varying vec3 vBinormal;","varying vec3 vNormal;","varying vec2 vUv;","varying vec3 vWorldPosition;","varying vec3 vViewPosition;",THREE.ShaderChunk["skinning_pars_vertex"],THREE.ShaderChunk["shadowmap_pars_vertex"],THREE.ShaderChunk["logdepthbuf_pars_vertex"],"void main() {",THREE.ShaderChunk["skinbase_vertex"],THREE.ShaderChunk["skinnormal_vertex"],"	#ifdef USE_SKINNING","		vNormal = normalize( normalMatrix * skinnedNormal.xyz );","		vec4 skinnedTangent = skinMatrix * vec4( tangent.xyz, 0.0 );","		vTangent = normalize( normalMatrix * skinnedTangent.xyz );","	#else","		vNormal = normalize( normalMatrix * normal );","		vTangent = normalize( normalMatrix * tangent.xyz );","	#endif","	vBinormal = normalize( cross( vNormal, vTangent ) * tangent.w );","	vUv = uv * uRepeat + uOffset;","	vec3 displacedPosition;","	#ifdef VERTEX_TEXTURES","		if ( enableDisplacement ) {","			vec3 dv = texture2D( tDisplacement, uv ).xyz;","			float df = uDisplacementScale * dv.x + uDisplacementBias;","			displacedPosition = position + normalize( normal ) * df;","		} else {","			#ifdef USE_SKINNING","				vec4 skinVertex = bindMatrix * vec4( position, 1.0 );","				vec4 skinned = vec4( 0.0 );","				skinned += boneMatX * skinVertex * skinWeight.x;","				skinned += boneMatY * skinVertex * skinWeight.y;","				skinned += boneMatZ * skinVertex * skinWeight.z;","				skinned += boneMatW * skinVertex * skinWeight.w;","				skinned  = bindMatrixInverse * skinned;","				displacedPosition = skinned.xyz;","			#else","				displacedPosition = position;","			#endif","		}","	#else","		#ifdef USE_SKINNING","			vec4 skinVertex = bindMatrix * vec4( position, 1.0 );","			vec4 skinned = vec4( 0.0 );","			skinned += boneMatX * skinVertex * skinWeight.x;","			skinned += boneMatY * skinVertex * skinWeight.y;","			skinned += boneMatZ * skinVertex * skinWeight.z;","			skinned += boneMatW * skinVertex * skinWeight.w;","			skinned  = bindMatrixInverse * skinned;","			displacedPosition = skinned.xyz;","		#else","			displacedPosition = position;","		#endif","	#endif","	vec4 mvPosition = modelViewMatrix * vec4( displacedPosition, 1.0 );","	vec4 worldPosition = modelMatrix * vec4( displacedPosition, 1.0 );","	gl_Position = projectionMatrix * mvPosition;",THREE.ShaderChunk["logdepthbuf_vertex"],"	vWorldPosition = worldPosition.xyz;","	vViewPosition = -mvPosition.xyz;","	#ifdef USE_SHADOWMAP","		for( int i = 0; i < MAX_SHADOWS; i ++ ) {","			vShadowCoord[ i ] = shadowMatrix[ i ] * worldPosition;","		}","	#endif","}"].join("\n")},cube:{uniforms:{tCube:{type:"t",value:null},tFlip:{type:"f",value:-1}},vertexShader:["varying vec3 vWorldPosition;",THREE.ShaderChunk["logdepthbuf_pars_vertex"],"void main() {","	vec4 worldPosition = modelMatrix * vec4( position, 1.0 );","	vWorldPosition = worldPosition.xyz;","	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );",THREE.ShaderChunk["logdepthbuf_vertex"],"}"].join("\n"),fragmentShader:["uniform samplerCube tCube;","uniform float tFlip;","varying vec3 vWorldPosition;",THREE.ShaderChunk["logdepthbuf_pars_fragment"],"void main() {","	gl_FragColor = textureCube( tCube, vec3( tFlip * vWorldPosition.x, vWorldPosition.yz ) );",THREE.ShaderChunk["logdepthbuf_fragment"],"}"].join("\n")},depthRGBA:{uniforms:{},vertexShader:[THREE.ShaderChunk["morphtarget_pars_vertex"],THREE.ShaderChunk["skinning_pars_vertex"],THREE.ShaderChunk["logdepthbuf_pars_vertex"],"void main() {",THREE.ShaderChunk["skinbase_vertex"],THREE.ShaderChunk["morphtarget_vertex"],THREE.ShaderChunk["skinning_vertex"],THREE.ShaderChunk["default_vertex"],THREE.ShaderChunk["logdepthbuf_vertex"],"}"].join("\n"),fragmentShader:[THREE.ShaderChunk["logdepthbuf_pars_fragment"],"vec4 pack_depth( const in float depth ) {","	const vec4 bit_shift = vec4( 256.0 * 256.0 * 256.0, 256.0 * 256.0, 256.0, 1.0 );","	const vec4 bit_mask = vec4( 0.0, 1.0 / 256.0, 1.0 / 256.0, 1.0 / 256.0 );","	vec4 res = mod( depth * bit_shift * vec4( 255 ), vec4( 256 ) ) / vec4( 255 );","	res -= res.xxyz * bit_mask;","	return res;","}","void main() {",THREE.ShaderChunk["logdepthbuf_fragment"],"	#ifdef USE_LOGDEPTHBUF_EXT","		gl_FragData[ 0 ] = pack_depth( gl_FragDepthEXT );","	#else","		gl_FragData[ 0 ] = pack_depth( gl_FragCoord.z );","	#endif","}"].join("\n")}};
THREE.WebGLRenderer=function(parameters){console.log("THREE.WebGLRenderer",THREE.REVISION);parameters=parameters||{};var _canvas=parameters.canvas!==undefined?parameters.canvas:document.createElement("canvas"),_context=parameters.context!==undefined?parameters.context:null,_precision=parameters.precision!==undefined?parameters.precision:"highp",_alpha=parameters.alpha!==undefined?parameters.alpha:false,_depth=parameters.depth!==undefined?parameters.depth:true,_stencil=parameters.stencil!==undefined?parameters.stencil:true,_antialias=parameters.antialias!==undefined?parameters.antialias:false,_premultipliedAlpha=parameters.premultipliedAlpha!==undefined?parameters.premultipliedAlpha:true,_preserveDrawingBuffer=parameters.preserveDrawingBuffer!==undefined?parameters.preserveDrawingBuffer:false,_logarithmicDepthBuffer=parameters.logarithmicDepthBuffer!==undefined?parameters.logarithmicDepthBuffer:false,_clearColor=new THREE.Color(0),_clearAlpha=0;var lights=[];var _webglObjects={};var _webglObjectsImmediate=[];var opaqueObjects=[];var transparentObjects=[];var sprites=[];var lensFlares=[];this.domElement=_canvas;this.context=null;this.devicePixelRatio=parameters.devicePixelRatio!==undefined?parameters.devicePixelRatio:self.devicePixelRatio!==undefined?self.devicePixelRatio:1;this.autoClear=true;this.autoClearColor=true;this.autoClearDepth=true;this.autoClearStencil=true;this.sortObjects=true;this.gammaInput=false;this.gammaOutput=false;this.shadowMapEnabled=false;this.shadowMapType=THREE.PCFShadowMap;this.shadowMapCullFace=THREE.CullFaceFront;this.shadowMapDebug=false;this.shadowMapCascade=false;this.maxMorphTargets=8;this.maxMorphNormals=4;this.autoScaleCubemaps=true;this.info={memory:{programs:0,geometries:0,textures:0},render:{calls:0,vertices:0,faces:0,points:0}};var _this=this,_programs=[],_currentProgram=null,_currentFramebuffer=null,_currentMaterialId=-1,_currentGeometryGroupHash=-1,_currentCamera=null,_usedTextureUnits=0,_oldDoubleSided=-1,_oldFlipSided=-1,_oldBlending=-1,_oldBlendEquation=-1,_oldBlendSrc=-1,_oldBlendDst=-1,_oldDepthTest=-1,_oldDepthWrite=-1,_oldPolygonOffset=null,_oldPolygonOffsetFactor=null,_oldPolygonOffsetUnits=null,_oldLineWidth=null,_viewportX=0,_viewportY=0,_viewportWidth=_canvas.width,_viewportHeight=_canvas.height,_currentWidth=0,_currentHeight=0,_newAttributes=new Uint8Array(16),_enabledAttributes=new Uint8Array(16),_frustum=new THREE.Frustum,_projScreenMatrix=new THREE.Matrix4,_projScreenMatrixPS=new THREE.Matrix4,_vector3=new THREE.Vector3,_direction=new THREE.Vector3,_lightsNeedUpdate=true,_lights={ambient:[0,0,0],directional:{length:0,colors:[],positions:[]},point:{length:0,colors:[],positions:[],distances:[]},spot:{length:0,colors:[],positions:[],distances:[],directions:[],anglesCos:[],exponents:[]},hemi:{length:0,skyColors:[],groundColors:[],positions:[]}};var _gl;try{var attributes={alpha:_alpha,depth:_depth,stencil:_stencil,antialias:_antialias,premultipliedAlpha:_premultipliedAlpha,preserveDrawingBuffer:_preserveDrawingBuffer};_gl=_context||_canvas.getContext("webgl",attributes)||_canvas.getContext("experimental-webgl",attributes);if(_gl===null){if(_canvas.getContext("webgl")!==null){throw"Error creating WebGL context with your selected attributes."}else{throw"Error creating WebGL context."}}}catch(error){console.error(error)}if(_gl.getShaderPrecisionFormat===undefined){_gl.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}}}var extensions=new THREE.WebGLExtensions(_gl);extensions.get("OES_texture_float");extensions.get("OES_texture_float_linear");extensions.get("OES_standard_derivatives");if(_logarithmicDepthBuffer){extensions.get("EXT_frag_depth")}function setDefaultGLState(){_gl.clearColor(0,0,0,1);_gl.clearDepth(1);_gl.clearStencil(0);_gl.enable(_gl.DEPTH_TEST);_gl.depthFunc(_gl.LEQUAL);_gl.frontFace(_gl.CCW);_gl.cullFace(_gl.BACK);_gl.enable(_gl.CULL_FACE);_gl.enable(_gl.BLEND);_gl.blendEquation(_gl.FUNC_ADD);_gl.blendFunc(_gl.SRC_ALPHA,_gl.ONE_MINUS_SRC_ALPHA);_gl.viewport(_viewportX,_viewportY,_viewportWidth,_viewportHeight);_gl.clearColor(_clearColor.r,_clearColor.g,_clearColor.b,_clearAlpha)}setDefaultGLState();this.context=_gl;var _maxTextures=_gl.getParameter(_gl.MAX_TEXTURE_IMAGE_UNITS);var _maxVertexTextures=_gl.getParameter(_gl.MAX_VERTEX_TEXTURE_IMAGE_UNITS);var _maxTextureSize=_gl.getParameter(_gl.MAX_TEXTURE_SIZE);var _maxCubemapSize=_gl.getParameter(_gl.MAX_CUBE_MAP_TEXTURE_SIZE);var _supportsVertexTextures=_maxVertexTextures>0;var _supportsBoneTextures=_supportsVertexTextures&&extensions.get("OES_texture_float");var _vertexShaderPrecisionHighpFloat=_gl.getShaderPrecisionFormat(_gl.VERTEX_SHADER,_gl.HIGH_FLOAT);var _vertexShaderPrecisionMediumpFloat=_gl.getShaderPrecisionFormat(_gl.VERTEX_SHADER,_gl.MEDIUM_FLOAT);var _vertexShaderPrecisionLowpFloat=_gl.getShaderPrecisionFormat(_gl.VERTEX_SHADER,_gl.LOW_FLOAT);var _fragmentShaderPrecisionHighpFloat=_gl.getShaderPrecisionFormat(_gl.FRAGMENT_SHADER,_gl.HIGH_FLOAT);var _fragmentShaderPrecisionMediumpFloat=_gl.getShaderPrecisionFormat(_gl.FRAGMENT_SHADER,_gl.MEDIUM_FLOAT);var _fragmentShaderPrecisionLowpFloat=_gl.getShaderPrecisionFormat(_gl.FRAGMENT_SHADER,_gl.LOW_FLOAT);var getCompressedTextureFormats=function(){var array;return function(){if(array!==undefined){return array}array=[];if(extensions.get("WEBGL_compressed_texture_pvrtc")||extensions.get("WEBGL_compressed_texture_s3tc")){var formats=_gl.getParameter(_gl.COMPRESSED_TEXTURE_FORMATS);for(var i=0;i<formats.length;i++){array.push(formats[i])}}return array}}();var highpAvailable=_vertexShaderPrecisionHighpFloat.precision>0&&_fragmentShaderPrecisionHighpFloat.precision>0;var mediumpAvailable=_vertexShaderPrecisionMediumpFloat.precision>0&&_fragmentShaderPrecisionMediumpFloat.precision>0;if(_precision==="highp"&&!highpAvailable){if(mediumpAvailable){_precision="mediump";console.warn("THREE.WebGLRenderer: highp not supported, using mediump.")}else{_precision="lowp";console.warn("THREE.WebGLRenderer: highp and mediump not supported, using lowp.")}}if(_precision==="mediump"&&!mediumpAvailable){_precision="lowp";console.warn("THREE.WebGLRenderer: mediump not supported, using lowp.")}var shadowMapPlugin=new THREE.ShadowMapPlugin(this,lights,_webglObjects,_webglObjectsImmediate);var spritePlugin=new THREE.SpritePlugin(this,sprites);var lensFlarePlugin=new THREE.LensFlarePlugin(this,lensFlares);this.getContext=function(){return _gl};this.supportsVertexTextures=function(){return _supportsVertexTextures};this.supportsFloatTextures=function(){return extensions.get("OES_texture_float")};this.supportsStandardDerivatives=function(){return extensions.get("OES_standard_derivatives")};this.supportsCompressedTextureS3TC=function(){return extensions.get("WEBGL_compressed_texture_s3tc")};this.supportsCompressedTexturePVRTC=function(){return extensions.get("WEBGL_compressed_texture_pvrtc")};this.supportsBlendMinMax=function(){return extensions.get("EXT_blend_minmax")};this.getMaxAnisotropy=function(){var value;return function(){if(value!==undefined){return value}var extension=extensions.get("EXT_texture_filter_anisotropic");value=extension!==null?_gl.getParameter(extension.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0;return value}}();this.getPrecision=function(){return _precision};this.setSize=function(width,height,updateStyle){_canvas.width=width*this.devicePixelRatio;_canvas.height=height*this.devicePixelRatio;if(updateStyle!==false){_canvas.style.width=width+"px";_canvas.style.height=height+"px"}this.setViewport(0,0,width,height)};this.setViewport=function(x,y,width,height){_viewportX=x*this.devicePixelRatio;_viewportY=y*this.devicePixelRatio;_viewportWidth=width*this.devicePixelRatio;_viewportHeight=height*this.devicePixelRatio;_gl.viewport(_viewportX,_viewportY,_viewportWidth,_viewportHeight)};this.setScissor=function(x,y,width,height){_gl.scissor(x*this.devicePixelRatio,y*this.devicePixelRatio,width*this.devicePixelRatio,height*this.devicePixelRatio)};this.enableScissorTest=function(enable){enable?_gl.enable(_gl.SCISSOR_TEST):_gl.disable(_gl.SCISSOR_TEST)};this.resetAttributes=function(){for(var i=0;i<_enabledAttributes.length;i++){_enabledAttributes[i]=0}};this.setClearColor=function(color,alpha){_clearColor.set(color);_clearAlpha=alpha!==undefined?alpha:1;_gl.clearColor(_clearColor.r,_clearColor.g,_clearColor.b,_clearAlpha)};this.setClearColorHex=function(hex,alpha){console.warn("THREE.WebGLRenderer: .setClearColorHex() is being removed. Use .setClearColor() instead.");this.setClearColor(hex,alpha)};this.getClearColor=function(){return _clearColor};this.getClearAlpha=function(){return _clearAlpha};this.clear=function(color,depth,stencil){var bits=0;if(color===undefined||color)bits|=_gl.COLOR_BUFFER_BIT;if(depth===undefined||depth)bits|=_gl.DEPTH_BUFFER_BIT;if(stencil===undefined||stencil)bits|=_gl.STENCIL_BUFFER_BIT;_gl.clear(bits)};this.clearColor=function(){_gl.clear(_gl.COLOR_BUFFER_BIT)};this.clearDepth=function(){_gl.clear(_gl.DEPTH_BUFFER_BIT)};this.clearStencil=function(){_gl.clear(_gl.STENCIL_BUFFER_BIT)};this.clearTarget=function(renderTarget,color,depth,stencil){this.setRenderTarget(renderTarget);this.clear(color,depth,stencil)};this.resetGLState=function(){_currentProgram=null;_currentCamera=null;_oldBlending=-1;_oldDepthTest=-1;_oldDepthWrite=-1;_oldDoubleSided=-1;_oldFlipSided=-1;_currentGeometryGroupHash=-1;_currentMaterialId=-1;_lightsNeedUpdate=true};function createParticleBuffers(geometry){geometry.__webglVertexBuffer=_gl.createBuffer();geometry.__webglColorBuffer=_gl.createBuffer();_this.info.memory.geometries++}function createLineBuffers(geometry){geometry.__webglVertexBuffer=_gl.createBuffer();geometry.__webglColorBuffer=_gl.createBuffer();geometry.__webglLineDistanceBuffer=_gl.createBuffer();_this.info.memory.geometries++}function createMeshBuffers(geometryGroup){geometryGroup.__webglVertexBuffer=_gl.createBuffer();geometryGroup.__webglNormalBuffer=_gl.createBuffer();geometryGroup.__webglTangentBuffer=_gl.createBuffer();geometryGroup.__webglColorBuffer=_gl.createBuffer();geometryGroup.__webglUVBuffer=_gl.createBuffer();geometryGroup.__webglUV2Buffer=_gl.createBuffer();geometryGroup.__webglSkinIndicesBuffer=_gl.createBuffer();geometryGroup.__webglSkinWeightsBuffer=_gl.createBuffer();geometryGroup.__webglFaceBuffer=_gl.createBuffer();geometryGroup.__webglLineBuffer=_gl.createBuffer();var m,ml;if(geometryGroup.numMorphTargets){geometryGroup.__webglMorphTargetsBuffers=[];for(m=0,ml=geometryGroup.numMorphTargets;m<ml;m++){geometryGroup.__webglMorphTargetsBuffers.push(_gl.createBuffer())}}if(geometryGroup.numMorphNormals){geometryGroup.__webglMorphNormalsBuffers=[];for(m=0,ml=geometryGroup.numMorphNormals;m<ml;m++){geometryGroup.__webglMorphNormalsBuffers.push(_gl.createBuffer())}}_this.info.memory.geometries++}var onObjectRemoved=function(event){var object=event.target;object.traverse(function(child){child.removeEventListener("remove",onObjectRemoved);removeObject(child)})};var onGeometryDispose=function(event){var geometry=event.target;geometry.removeEventListener("dispose",onGeometryDispose);deallocateGeometry(geometry)};var onTextureDispose=function(event){var texture=event.target;texture.removeEventListener("dispose",onTextureDispose);deallocateTexture(texture);_this.info.memory.textures--};var onRenderTargetDispose=function(event){var renderTarget=event.target;renderTarget.removeEventListener("dispose",onRenderTargetDispose);deallocateRenderTarget(renderTarget);_this.info.memory.textures--};var onMaterialDispose=function(event){var material=event.target;material.removeEventListener("dispose",onMaterialDispose);deallocateMaterial(material)};var deleteBuffers=function(geometry){var buffers=["__webglVertexBuffer","__webglNormalBuffer","__webglTangentBuffer","__webglColorBuffer","__webglUVBuffer","__webglUV2Buffer","__webglSkinIndicesBuffer","__webglSkinWeightsBuffer","__webglFaceBuffer","__webglLineBuffer","__webglLineDistanceBuffer"];for(var i=0,l=buffers.length;i<l;i++){var name=buffers[i];if(geometry[name]!==undefined){_gl.deleteBuffer(geometry[name]);delete geometry[name]}}if(geometry.__webglCustomAttributesList!==undefined){for(var name in geometry.__webglCustomAttributesList){_gl.deleteBuffer(geometry.__webglCustomAttributesList[name].buffer)}delete geometry.__webglCustomAttributesList}_this.info.memory.geometries--};var deallocateGeometry=function(geometry){delete geometry.__webglInit;if(geometry instanceof THREE.BufferGeometry){for(var name in geometry.attributes){var attribute=geometry.attributes[name];if(attribute.buffer!==undefined){_gl.deleteBuffer(attribute.buffer);delete attribute.buffer}}_this.info.memory.geometries--}else{var geometryGroupsList=geometryGroups[geometry.id];if(geometryGroupsList!==undefined){for(var i=0,l=geometryGroupsList.length;i<l;i++){var geometryGroup=geometryGroupsList[i];if(geometryGroup.numMorphTargets!==undefined){for(var m=0,ml=geometryGroup.numMorphTargets;m<ml;m++){_gl.deleteBuffer(geometryGroup.__webglMorphTargetsBuffers[m])}delete geometryGroup.__webglMorphTargetsBuffers}if(geometryGroup.numMorphNormals!==undefined){for(var m=0,ml=geometryGroup.numMorphNormals;m<ml;m++){_gl.deleteBuffer(geometryGroup.__webglMorphNormalsBuffers[m])}delete geometryGroup.__webglMorphNormalsBuffers}deleteBuffers(geometryGroup)}delete geometryGroups[geometry.id]}else{deleteBuffers(geometry)}}_currentGeometryGroupHash=-1};var deallocateTexture=function(texture){if(texture.image&&texture.image.__webglTextureCube){_gl.deleteTexture(texture.image.__webglTextureCube);delete texture.image.__webglTextureCube}else{if(texture.__webglInit===undefined)return;_gl.deleteTexture(texture.__webglTexture);delete texture.__webglTexture;delete texture.__webglInit}};var deallocateRenderTarget=function(renderTarget){if(!renderTarget||renderTarget.__webglTexture===undefined)return;_gl.deleteTexture(renderTarget.__webglTexture);delete renderTarget.__webglTexture;if(renderTarget instanceof THREE.WebGLRenderTargetCube){for(var i=0;i<6;i++){_gl.deleteFramebuffer(renderTarget.__webglFramebuffer[i]);_gl.deleteRenderbuffer(renderTarget.__webglRenderbuffer[i])}}else{_gl.deleteFramebuffer(renderTarget.__webglFramebuffer);_gl.deleteRenderbuffer(renderTarget.__webglRenderbuffer)}delete renderTarget.__webglFramebuffer;delete renderTarget.__webglRenderbuffer};var deallocateMaterial=function(material){var program=material.program.program;if(program===undefined)return;material.program=undefined;var i,il,programInfo;var deleteProgram=false;for(i=0,il=_programs.length;i<il;i++){programInfo=_programs[i];if(programInfo.program===program){programInfo.usedTimes--;if(programInfo.usedTimes===0){deleteProgram=true}break}}if(deleteProgram===true){var newPrograms=[];for(i=0,il=_programs.length;i<il;i++){programInfo=_programs[i];if(programInfo.program!==program){newPrograms.push(programInfo)}}_programs=newPrograms;_gl.deleteProgram(program);_this.info.memory.programs--}};function initCustomAttributes(object){var geometry=object.geometry;var material=object.material;var nvertices=geometry.vertices.length;if(material.attributes){if(geometry.__webglCustomAttributesList===undefined){geometry.__webglCustomAttributesList=[]}for(var name in material.attributes){var attribute=material.attributes[name];if(!attribute.__webglInitialized||attribute.createUniqueBuffers){attribute.__webglInitialized=true;var size=1;if(attribute.type==="v2")size=2;else if(attribute.type==="v3")size=3;else if(attribute.type==="v4")size=4;else if(attribute.type==="c")size=3;attribute.size=size;attribute.array=new Float32Array(nvertices*size);attribute.buffer=_gl.createBuffer();attribute.buffer.belongsToAttribute=name;attribute.needsUpdate=true}geometry.__webglCustomAttributesList.push(attribute)}}}function initParticleBuffers(geometry,object){var nvertices=geometry.vertices.length;geometry.__vertexArray=new Float32Array(nvertices*3);geometry.__colorArray=new Float32Array(nvertices*3);geometry.__sortArray=[];geometry.__webglParticleCount=nvertices;initCustomAttributes(object)}function initLineBuffers(geometry,object){var nvertices=geometry.vertices.length;geometry.__vertexArray=new Float32Array(nvertices*3);geometry.__colorArray=new Float32Array(nvertices*3);geometry.__lineDistanceArray=new Float32Array(nvertices*1);geometry.__webglLineCount=nvertices;initCustomAttributes(object)}function initMeshBuffers(geometryGroup,object){var geometry=object.geometry,faces3=geometryGroup.faces3,nvertices=faces3.length*3,ntris=faces3.length*1,nlines=faces3.length*3,material=getBufferMaterial(object,geometryGroup);geometryGroup.__vertexArray=new Float32Array(nvertices*3);geometryGroup.__normalArray=new Float32Array(nvertices*3);geometryGroup.__colorArray=new Float32Array(nvertices*3);geometryGroup.__uvArray=new Float32Array(nvertices*2);if(geometry.faceVertexUvs.length>1){geometryGroup.__uv2Array=new Float32Array(nvertices*2)}if(geometry.hasTangents){geometryGroup.__tangentArray=new Float32Array(nvertices*4)}if(object.geometry.skinWeights.length&&object.geometry.skinIndices.length){geometryGroup.__skinIndexArray=new Float32Array(nvertices*4);geometryGroup.__skinWeightArray=new Float32Array(nvertices*4)}var UintArray=extensions.get("OES_element_index_uint")!==null&&ntris>21845?Uint32Array:Uint16Array;geometryGroup.__typeArray=UintArray;geometryGroup.__faceArray=new UintArray(ntris*3);geometryGroup.__lineArray=new UintArray(nlines*2);var m,ml;if(geometryGroup.numMorphTargets){geometryGroup.__morphTargetsArrays=[];for(m=0,ml=geometryGroup.numMorphTargets;m<ml;m++){geometryGroup.__morphTargetsArrays.push(new Float32Array(nvertices*3))}}if(geometryGroup.numMorphNormals){geometryGroup.__morphNormalsArrays=[];for(m=0,ml=geometryGroup.numMorphNormals;m<ml;m++){geometryGroup.__morphNormalsArrays.push(new Float32Array(nvertices*3))}}geometryGroup.__webglFaceCount=ntris*3;geometryGroup.__webglLineCount=nlines*2;if(material.attributes){if(geometryGroup.__webglCustomAttributesList===undefined){geometryGroup.__webglCustomAttributesList=[]}for(var name in material.attributes){var originalAttribute=material.attributes[name];var attribute={};for(var property in originalAttribute){attribute[property]=originalAttribute[property]}if(!attribute.__webglInitialized||attribute.createUniqueBuffers){attribute.__webglInitialized=true;var size=1;if(attribute.type==="v2")size=2;else if(attribute.type==="v3")size=3;else if(attribute.type==="v4")size=4;else if(attribute.type==="c")size=3;attribute.size=size;attribute.array=new Float32Array(nvertices*size);attribute.buffer=_gl.createBuffer();attribute.buffer.belongsToAttribute=name;originalAttribute.needsUpdate=true;attribute.__original=originalAttribute}geometryGroup.__webglCustomAttributesList.push(attribute)}}geometryGroup.__inittedArrays=true}function getBufferMaterial(object,geometryGroup){return object.material instanceof THREE.MeshFaceMaterial?object.material.materials[geometryGroup.materialIndex]:object.material}function materialNeedsSmoothNormals(material){return material&&material.shading!==undefined&&material.shading===THREE.SmoothShading}function setParticleBuffers(geometry,hint,object){var v,c,vertex,offset,index,color,vertices=geometry.vertices,vl=vertices.length,colors=geometry.colors,cl=colors.length,vertexArray=geometry.__vertexArray,colorArray=geometry.__colorArray,sortArray=geometry.__sortArray,dirtyVertices=geometry.verticesNeedUpdate,dirtyElements=geometry.elementsNeedUpdate,dirtyColors=geometry.colorsNeedUpdate,customAttributes=geometry.__webglCustomAttributesList,i,il,a,ca,cal,value,customAttribute;if(object.sortParticles){_projScreenMatrixPS.copy(_projScreenMatrix);_projScreenMatrixPS.multiply(object.matrixWorld);for(v=0;v<vl;v++){vertex=vertices[v];_vector3.copy(vertex);_vector3.applyProjection(_projScreenMatrixPS);sortArray[v]=[_vector3.z,v]}sortArray.sort(numericalSort);for(v=0;v<vl;v++){vertex=vertices[sortArray[v][1]];offset=v*3;vertexArray[offset]=vertex.x;vertexArray[offset+1]=vertex.y;vertexArray[offset+2]=vertex.z}for(c=0;c<cl;c++){offset=c*3;color=colors[sortArray[c][1]];colorArray[offset]=color.r;colorArray[offset+1]=color.g;colorArray[offset+2]=color.b}if(customAttributes){for(i=0,il=customAttributes.length;i<il;i++){customAttribute=customAttributes[i];if(!(customAttribute.boundTo===undefined||customAttribute.boundTo==="vertices"))continue;offset=0;cal=customAttribute.value.length;if(customAttribute.size===1){for(ca=0;ca<cal;ca++){index=sortArray[ca][1];customAttribute.array[ca]=customAttribute.value[index]}}else if(customAttribute.size===2){for(ca=0;ca<cal;ca++){index=sortArray[ca][1];value=customAttribute.value[index];customAttribute.array[offset]=value.x;customAttribute.array[offset+1]=value.y;offset+=2}}else if(customAttribute.size===3){if(customAttribute.type==="c"){for(ca=0;ca<cal;ca++){index=sortArray[ca][1];value=customAttribute.value[index];customAttribute.array[offset]=value.r;customAttribute.array[offset+1]=value.g;customAttribute.array[offset+2]=value.b;offset+=3}}else{for(ca=0;ca<cal;ca++){index=sortArray[ca][1];value=customAttribute.value[index];customAttribute.array[offset]=value.x;customAttribute.array[offset+1]=value.y;customAttribute.array[offset+2]=value.z;offset+=3}}}else if(customAttribute.size===4){for(ca=0;ca<cal;ca++){index=sortArray[ca][1];value=customAttribute.value[index];customAttribute.array[offset]=value.x;customAttribute.array[offset+1]=value.y;customAttribute.array[offset+2]=value.z;customAttribute.array[offset+3]=value.w;offset+=4}}}}}else{if(dirtyVertices){for(v=0;v<vl;v++){vertex=vertices[v];offset=v*3;vertexArray[offset]=vertex.x;vertexArray[offset+1]=vertex.y;vertexArray[offset+2]=vertex.z}}if(dirtyColors){for(c=0;c<cl;c++){color=colors[c];offset=c*3;colorArray[offset]=color.r;colorArray[offset+1]=color.g;colorArray[offset+2]=color.b}}if(customAttributes){for(i=0,il=customAttributes.length;i<il;i++){customAttribute=customAttributes[i];if(customAttribute.needsUpdate&&(customAttribute.boundTo===undefined||customAttribute.boundTo==="vertices")){cal=customAttribute.value.length;offset=0;if(customAttribute.size===1){for(ca=0;ca<cal;ca++){customAttribute.array[ca]=customAttribute.value[ca]}}else if(customAttribute.size===2){for(ca=0;ca<cal;ca++){value=customAttribute.value[ca];customAttribute.array[offset]=value.x;customAttribute.array[offset+1]=value.y;offset+=2}}else if(customAttribute.size===3){if(customAttribute.type==="c"){for(ca=0;ca<cal;ca++){value=customAttribute.value[ca];customAttribute.array[offset]=value.r;customAttribute.array[offset+1]=value.g;customAttribute.array[offset+2]=value.b;offset+=3}}else{for(ca=0;ca<cal;ca++){value=customAttribute.value[ca];customAttribute.array[offset]=value.x;customAttribute.array[offset+1]=value.y;customAttribute.array[offset+2]=value.z;offset+=3}}}else if(customAttribute.size===4){for(ca=0;ca<cal;ca++){value=customAttribute.value[ca];customAttribute.array[offset]=value.x;customAttribute.array[offset+1]=value.y;customAttribute.array[offset+2]=value.z;customAttribute.array[offset+3]=value.w;offset+=4}}}}}}if(dirtyVertices||object.sortParticles){_gl.bindBuffer(_gl.ARRAY_BUFFER,geometry.__webglVertexBuffer);_gl.bufferData(_gl.ARRAY_BUFFER,vertexArray,hint)}if(dirtyColors||object.sortParticles){_gl.bindBuffer(_gl.ARRAY_BUFFER,geometry.__webglColorBuffer);_gl.bufferData(_gl.ARRAY_BUFFER,colorArray,hint)}if(customAttributes){for(i=0,il=customAttributes.length;i<il;i++){customAttribute=customAttributes[i];if(customAttribute.needsUpdate||object.sortParticles){_gl.bindBuffer(_gl.ARRAY_BUFFER,customAttribute.buffer);_gl.bufferData(_gl.ARRAY_BUFFER,customAttribute.array,hint)}}}}function setLineBuffers(geometry,hint){var v,c,d,vertex,offset,color,vertices=geometry.vertices,colors=geometry.colors,lineDistances=geometry.lineDistances,vl=vertices.length,cl=colors.length,dl=lineDistances.length,vertexArray=geometry.__vertexArray,colorArray=geometry.__colorArray,lineDistanceArray=geometry.__lineDistanceArray,dirtyVertices=geometry.verticesNeedUpdate,dirtyColors=geometry.colorsNeedUpdate,dirtyLineDistances=geometry.lineDistancesNeedUpdate,customAttributes=geometry.__webglCustomAttributesList,i,il,a,ca,cal,value,customAttribute;if(dirtyVertices){for(v=0;v<vl;v++){vertex=vertices[v];offset=v*3;vertexArray[offset]=vertex.x;vertexArray[offset+1]=vertex.y;vertexArray[offset+2]=vertex.z}_gl.bindBuffer(_gl.ARRAY_BUFFER,geometry.__webglVertexBuffer);_gl.bufferData(_gl.ARRAY_BUFFER,vertexArray,hint)}if(dirtyColors){for(c=0;c<cl;c++){color=colors[c];offset=c*3;colorArray[offset]=color.r;colorArray[offset+1]=color.g;colorArray[offset+2]=color.b}_gl.bindBuffer(_gl.ARRAY_BUFFER,geometry.__webglColorBuffer);_gl.bufferData(_gl.ARRAY_BUFFER,colorArray,hint)}if(dirtyLineDistances){for(d=0;d<dl;d++){lineDistanceArray[d]=lineDistances[d]}_gl.bindBuffer(_gl.ARRAY_BUFFER,geometry.__webglLineDistanceBuffer);_gl.bufferData(_gl.ARRAY_BUFFER,lineDistanceArray,hint)}if(customAttributes){for(i=0,il=customAttributes.length;i<il;i++){customAttribute=customAttributes[i];if(customAttribute.needsUpdate&&(customAttribute.boundTo===undefined||customAttribute.boundTo==="vertices")){offset=0;cal=customAttribute.value.length;if(customAttribute.size===1){for(ca=0;ca<cal;ca++){customAttribute.array[ca]=customAttribute.value[ca]}}else if(customAttribute.size===2){for(ca=0;ca<cal;ca++){value=customAttribute.value[ca];customAttribute.array[offset]=value.x;customAttribute.array[offset+1]=value.y;offset+=2}}else if(customAttribute.size===3){if(customAttribute.type==="c"){for(ca=0;ca<cal;ca++){value=customAttribute.value[ca];customAttribute.array[offset]=value.r;customAttribute.array[offset+1]=value.g;customAttribute.array[offset+2]=value.b;offset+=3}}else{for(ca=0;ca<cal;ca++){value=customAttribute.value[ca];customAttribute.array[offset]=value.x;customAttribute.array[offset+1]=value.y;customAttribute.array[offset+2]=value.z;offset+=3}}}else if(customAttribute.size===4){for(ca=0;ca<cal;ca++){value=customAttribute.value[ca];customAttribute.array[offset]=value.x;customAttribute.array[offset+1]=value.y;customAttribute.array[offset+2]=value.z;customAttribute.array[offset+3]=value.w;offset+=4}}_gl.bindBuffer(_gl.ARRAY_BUFFER,customAttribute.buffer);_gl.bufferData(_gl.ARRAY_BUFFER,customAttribute.array,hint)}}}}function setMeshBuffers(geometryGroup,object,hint,dispose,material){if(!geometryGroup.__inittedArrays){return}var needsSmoothNormals=materialNeedsSmoothNormals(material);var f,fl,fi,face,vertexNormals,faceNormal,normal,vertexColors,faceColor,vertexTangents,uv,uv2,v1,v2,v3,v4,t1,t2,t3,t4,n1,n2,n3,n4,c1,c2,c3,sw1,sw2,sw3,sw4,si1,si2,si3,si4,sa1,sa2,sa3,sa4,sb1,sb2,sb3,sb4,m,ml,i,il,vn,uvi,uv2i,vk,vkl,vka,nka,chf,faceVertexNormals,a,vertexIndex=0,offset=0,offset_uv=0,offset_uv2=0,offset_face=0,offset_normal=0,offset_tangent=0,offset_line=0,offset_color=0,offset_skin=0,offset_morphTarget=0,offset_custom=0,offset_customSrc=0,value,vertexArray=geometryGroup.__vertexArray,uvArray=geometryGroup.__uvArray,uv2Array=geometryGroup.__uv2Array,normalArray=geometryGroup.__normalArray,tangentArray=geometryGroup.__tangentArray,colorArray=geometryGroup.__colorArray,skinIndexArray=geometryGroup.__skinIndexArray,skinWeightArray=geometryGroup.__skinWeightArray,morphTargetsArrays=geometryGroup.__morphTargetsArrays,morphNormalsArrays=geometryGroup.__morphNormalsArrays,customAttributes=geometryGroup.__webglCustomAttributesList,customAttribute,faceArray=geometryGroup.__faceArray,lineArray=geometryGroup.__lineArray,geometry=object.geometry,dirtyVertices=geometry.verticesNeedUpdate,dirtyElements=geometry.elementsNeedUpdate,dirtyUvs=geometry.uvsNeedUpdate,dirtyNormals=geometry.normalsNeedUpdate,dirtyTangents=geometry.tangentsNeedUpdate,dirtyColors=geometry.colorsNeedUpdate,dirtyMorphTargets=geometry.morphTargetsNeedUpdate,vertices=geometry.vertices,chunk_faces3=geometryGroup.faces3,obj_faces=geometry.faces,obj_uvs=geometry.faceVertexUvs[0],obj_uvs2=geometry.faceVertexUvs[1],obj_colors=geometry.colors,obj_skinIndices=geometry.skinIndices,obj_skinWeights=geometry.skinWeights,morphTargets=geometry.morphTargets,morphNormals=geometry.morphNormals;if(dirtyVertices){for(f=0,fl=chunk_faces3.length;f<fl;f++){face=obj_faces[chunk_faces3[f]];v1=vertices[face.a];v2=vertices[face.b];v3=vertices[face.c];vertexArray[offset]=v1.x;vertexArray[offset+1]=v1.y;vertexArray[offset+2]=v1.z;vertexArray[offset+3]=v2.x;vertexArray[offset+4]=v2.y;vertexArray[offset+5]=v2.z;vertexArray[offset+6]=v3.x;vertexArray[offset+7]=v3.y;vertexArray[offset+8]=v3.z;offset+=9}_gl.bindBuffer(_gl.ARRAY_BUFFER,geometryGroup.__webglVertexBuffer);_gl.bufferData(_gl.ARRAY_BUFFER,vertexArray,hint)}if(dirtyMorphTargets){for(vk=0,vkl=morphTargets.length;vk<vkl;vk++){offset_morphTarget=0;for(f=0,fl=chunk_faces3.length;f<fl;f++){chf=chunk_faces3[f];face=obj_faces[chf];v1=morphTargets[vk].vertices[face.a];v2=morphTargets[vk].vertices[face.b];v3=morphTargets[vk].vertices[face.c];vka=morphTargetsArrays[vk];vka[offset_morphTarget]=v1.x;vka[offset_morphTarget+1]=v1.y;vka[offset_morphTarget+2]=v1.z;vka[offset_morphTarget+3]=v2.x;vka[offset_morphTarget+4]=v2.y;vka[offset_morphTarget+5]=v2.z;vka[offset_morphTarget+6]=v3.x;vka[offset_morphTarget+7]=v3.y;vka[offset_morphTarget+8]=v3.z;if(material.morphNormals){if(needsSmoothNormals){faceVertexNormals=morphNormals[vk].vertexNormals[chf];n1=faceVertexNormals.a;n2=faceVertexNormals.b;n3=faceVertexNormals.c}else{n1=morphNormals[vk].faceNormals[chf];n2=n1;n3=n1}nka=morphNormalsArrays[vk];nka[offset_morphTarget]=n1.x;nka[offset_morphTarget+1]=n1.y;nka[offset_morphTarget+2]=n1.z;nka[offset_morphTarget+3]=n2.x;nka[offset_morphTarget+4]=n2.y;nka[offset_morphTarget+5]=n2.z;nka[offset_morphTarget+6]=n3.x;nka[offset_morphTarget+7]=n3.y;nka[offset_morphTarget+8]=n3.z}offset_morphTarget+=9}_gl.bindBuffer(_gl.ARRAY_BUFFER,geometryGroup.__webglMorphTargetsBuffers[vk]);_gl.bufferData(_gl.ARRAY_BUFFER,morphTargetsArrays[vk],hint);if(material.morphNormals){_gl.bindBuffer(_gl.ARRAY_BUFFER,geometryGroup.__webglMorphNormalsBuffers[vk]);_gl.bufferData(_gl.ARRAY_BUFFER,morphNormalsArrays[vk],hint)}}}if(obj_skinWeights.length){for(f=0,fl=chunk_faces3.length;f<fl;f++){face=obj_faces[chunk_faces3[f]];sw1=obj_skinWeights[face.a];sw2=obj_skinWeights[face.b];sw3=obj_skinWeights[face.c];skinWeightArray[offset_skin]=sw1.x;skinWeightArray[offset_skin+1]=sw1.y;skinWeightArray[offset_skin+2]=sw1.z;skinWeightArray[offset_skin+3]=sw1.w;skinWeightArray[offset_skin+4]=sw2.x;skinWeightArray[offset_skin+5]=sw2.y;skinWeightArray[offset_skin+6]=sw2.z;skinWeightArray[offset_skin+7]=sw2.w;skinWeightArray[offset_skin+8]=sw3.x;skinWeightArray[offset_skin+9]=sw3.y;skinWeightArray[offset_skin+10]=sw3.z;skinWeightArray[offset_skin+11]=sw3.w;si1=obj_skinIndices[face.a];si2=obj_skinIndices[face.b];si3=obj_skinIndices[face.c];skinIndexArray[offset_skin]=si1.x;skinIndexArray[offset_skin+1]=si1.y;skinIndexArray[offset_skin+2]=si1.z;skinIndexArray[offset_skin+3]=si1.w;skinIndexArray[offset_skin+4]=si2.x;skinIndexArray[offset_skin+5]=si2.y;skinIndexArray[offset_skin+6]=si2.z;skinIndexArray[offset_skin+7]=si2.w;skinIndexArray[offset_skin+8]=si3.x;skinIndexArray[offset_skin+9]=si3.y;skinIndexArray[offset_skin+10]=si3.z;skinIndexArray[offset_skin+11]=si3.w;offset_skin+=12}if(offset_skin>0){_gl.bindBuffer(_gl.ARRAY_BUFFER,geometryGroup.__webglSkinIndicesBuffer);_gl.bufferData(_gl.ARRAY_BUFFER,skinIndexArray,hint);_gl.bindBuffer(_gl.ARRAY_BUFFER,geometryGroup.__webglSkinWeightsBuffer);_gl.bufferData(_gl.ARRAY_BUFFER,skinWeightArray,hint)}}if(dirtyColors){for(f=0,fl=chunk_faces3.length;f<fl;f++){face=obj_faces[chunk_faces3[f]];vertexColors=face.vertexColors;faceColor=face.color;if(vertexColors.length===3&&material.vertexColors===THREE.VertexColors){c1=vertexColors[0];c2=vertexColors[1];c3=vertexColors[2]}else{c1=faceColor;c2=faceColor;c3=faceColor}colorArray[offset_color]=c1.r;colorArray[offset_color+1]=c1.g;colorArray[offset_color+2]=c1.b;colorArray[offset_color+3]=c2.r;colorArray[offset_color+4]=c2.g;colorArray[offset_color+5]=c2.b;colorArray[offset_color+6]=c3.r;colorArray[offset_color+7]=c3.g;colorArray[offset_color+8]=c3.b;
offset_color+=9}if(offset_color>0){_gl.bindBuffer(_gl.ARRAY_BUFFER,geometryGroup.__webglColorBuffer);_gl.bufferData(_gl.ARRAY_BUFFER,colorArray,hint)}}if(dirtyTangents&&geometry.hasTangents){for(f=0,fl=chunk_faces3.length;f<fl;f++){face=obj_faces[chunk_faces3[f]];vertexTangents=face.vertexTangents;t1=vertexTangents[0];t2=vertexTangents[1];t3=vertexTangents[2];tangentArray[offset_tangent]=t1.x;tangentArray[offset_tangent+1]=t1.y;tangentArray[offset_tangent+2]=t1.z;tangentArray[offset_tangent+3]=t1.w;tangentArray[offset_tangent+4]=t2.x;tangentArray[offset_tangent+5]=t2.y;tangentArray[offset_tangent+6]=t2.z;tangentArray[offset_tangent+7]=t2.w;tangentArray[offset_tangent+8]=t3.x;tangentArray[offset_tangent+9]=t3.y;tangentArray[offset_tangent+10]=t3.z;tangentArray[offset_tangent+11]=t3.w;offset_tangent+=12}_gl.bindBuffer(_gl.ARRAY_BUFFER,geometryGroup.__webglTangentBuffer);_gl.bufferData(_gl.ARRAY_BUFFER,tangentArray,hint)}if(dirtyNormals){for(f=0,fl=chunk_faces3.length;f<fl;f++){face=obj_faces[chunk_faces3[f]];vertexNormals=face.vertexNormals;faceNormal=face.normal;if(vertexNormals.length===3&&needsSmoothNormals){for(i=0;i<3;i++){vn=vertexNormals[i];normalArray[offset_normal]=vn.x;normalArray[offset_normal+1]=vn.y;normalArray[offset_normal+2]=vn.z;offset_normal+=3}}else{for(i=0;i<3;i++){normalArray[offset_normal]=faceNormal.x;normalArray[offset_normal+1]=faceNormal.y;normalArray[offset_normal+2]=faceNormal.z;offset_normal+=3}}}_gl.bindBuffer(_gl.ARRAY_BUFFER,geometryGroup.__webglNormalBuffer);_gl.bufferData(_gl.ARRAY_BUFFER,normalArray,hint)}if(dirtyUvs&&obj_uvs){for(f=0,fl=chunk_faces3.length;f<fl;f++){fi=chunk_faces3[f];uv=obj_uvs[fi];if(uv===undefined)continue;for(i=0;i<3;i++){uvi=uv[i];uvArray[offset_uv]=uvi.x;uvArray[offset_uv+1]=uvi.y;offset_uv+=2}}if(offset_uv>0){_gl.bindBuffer(_gl.ARRAY_BUFFER,geometryGroup.__webglUVBuffer);_gl.bufferData(_gl.ARRAY_BUFFER,uvArray,hint)}}if(dirtyUvs&&obj_uvs2){for(f=0,fl=chunk_faces3.length;f<fl;f++){fi=chunk_faces3[f];uv2=obj_uvs2[fi];if(uv2===undefined)continue;for(i=0;i<3;i++){uv2i=uv2[i];uv2Array[offset_uv2]=uv2i.x;uv2Array[offset_uv2+1]=uv2i.y;offset_uv2+=2}}if(offset_uv2>0){_gl.bindBuffer(_gl.ARRAY_BUFFER,geometryGroup.__webglUV2Buffer);_gl.bufferData(_gl.ARRAY_BUFFER,uv2Array,hint)}}if(dirtyElements){for(f=0,fl=chunk_faces3.length;f<fl;f++){faceArray[offset_face]=vertexIndex;faceArray[offset_face+1]=vertexIndex+1;faceArray[offset_face+2]=vertexIndex+2;offset_face+=3;lineArray[offset_line]=vertexIndex;lineArray[offset_line+1]=vertexIndex+1;lineArray[offset_line+2]=vertexIndex;lineArray[offset_line+3]=vertexIndex+2;lineArray[offset_line+4]=vertexIndex+1;lineArray[offset_line+5]=vertexIndex+2;offset_line+=6;vertexIndex+=3}_gl.bindBuffer(_gl.ELEMENT_ARRAY_BUFFER,geometryGroup.__webglFaceBuffer);_gl.bufferData(_gl.ELEMENT_ARRAY_BUFFER,faceArray,hint);_gl.bindBuffer(_gl.ELEMENT_ARRAY_BUFFER,geometryGroup.__webglLineBuffer);_gl.bufferData(_gl.ELEMENT_ARRAY_BUFFER,lineArray,hint)}if(customAttributes){for(i=0,il=customAttributes.length;i<il;i++){customAttribute=customAttributes[i];if(!customAttribute.__original.needsUpdate)continue;offset_custom=0;offset_customSrc=0;if(customAttribute.size===1){if(customAttribute.boundTo===undefined||customAttribute.boundTo==="vertices"){for(f=0,fl=chunk_faces3.length;f<fl;f++){face=obj_faces[chunk_faces3[f]];customAttribute.array[offset_custom]=customAttribute.value[face.a];customAttribute.array[offset_custom+1]=customAttribute.value[face.b];customAttribute.array[offset_custom+2]=customAttribute.value[face.c];offset_custom+=3}}else if(customAttribute.boundTo==="faces"){for(f=0,fl=chunk_faces3.length;f<fl;f++){value=customAttribute.value[chunk_faces3[f]];customAttribute.array[offset_custom]=value;customAttribute.array[offset_custom+1]=value;customAttribute.array[offset_custom+2]=value;offset_custom+=3}}}else if(customAttribute.size===2){if(customAttribute.boundTo===undefined||customAttribute.boundTo==="vertices"){for(f=0,fl=chunk_faces3.length;f<fl;f++){face=obj_faces[chunk_faces3[f]];v1=customAttribute.value[face.a];v2=customAttribute.value[face.b];v3=customAttribute.value[face.c];customAttribute.array[offset_custom]=v1.x;customAttribute.array[offset_custom+1]=v1.y;customAttribute.array[offset_custom+2]=v2.x;customAttribute.array[offset_custom+3]=v2.y;customAttribute.array[offset_custom+4]=v3.x;customAttribute.array[offset_custom+5]=v3.y;offset_custom+=6}}else if(customAttribute.boundTo==="faces"){for(f=0,fl=chunk_faces3.length;f<fl;f++){value=customAttribute.value[chunk_faces3[f]];v1=value;v2=value;v3=value;customAttribute.array[offset_custom]=v1.x;customAttribute.array[offset_custom+1]=v1.y;customAttribute.array[offset_custom+2]=v2.x;customAttribute.array[offset_custom+3]=v2.y;customAttribute.array[offset_custom+4]=v3.x;customAttribute.array[offset_custom+5]=v3.y;offset_custom+=6}}}else if(customAttribute.size===3){var pp;if(customAttribute.type==="c"){pp=["r","g","b"]}else{pp=["x","y","z"]}if(customAttribute.boundTo===undefined||customAttribute.boundTo==="vertices"){for(f=0,fl=chunk_faces3.length;f<fl;f++){face=obj_faces[chunk_faces3[f]];v1=customAttribute.value[face.a];v2=customAttribute.value[face.b];v3=customAttribute.value[face.c];customAttribute.array[offset_custom]=v1[pp[0]];customAttribute.array[offset_custom+1]=v1[pp[1]];customAttribute.array[offset_custom+2]=v1[pp[2]];customAttribute.array[offset_custom+3]=v2[pp[0]];customAttribute.array[offset_custom+4]=v2[pp[1]];customAttribute.array[offset_custom+5]=v2[pp[2]];customAttribute.array[offset_custom+6]=v3[pp[0]];customAttribute.array[offset_custom+7]=v3[pp[1]];customAttribute.array[offset_custom+8]=v3[pp[2]];offset_custom+=9}}else if(customAttribute.boundTo==="faces"){for(f=0,fl=chunk_faces3.length;f<fl;f++){value=customAttribute.value[chunk_faces3[f]];v1=value;v2=value;v3=value;customAttribute.array[offset_custom]=v1[pp[0]];customAttribute.array[offset_custom+1]=v1[pp[1]];customAttribute.array[offset_custom+2]=v1[pp[2]];customAttribute.array[offset_custom+3]=v2[pp[0]];customAttribute.array[offset_custom+4]=v2[pp[1]];customAttribute.array[offset_custom+5]=v2[pp[2]];customAttribute.array[offset_custom+6]=v3[pp[0]];customAttribute.array[offset_custom+7]=v3[pp[1]];customAttribute.array[offset_custom+8]=v3[pp[2]];offset_custom+=9}}else if(customAttribute.boundTo==="faceVertices"){for(f=0,fl=chunk_faces3.length;f<fl;f++){value=customAttribute.value[chunk_faces3[f]];v1=value[0];v2=value[1];v3=value[2];customAttribute.array[offset_custom]=v1[pp[0]];customAttribute.array[offset_custom+1]=v1[pp[1]];customAttribute.array[offset_custom+2]=v1[pp[2]];customAttribute.array[offset_custom+3]=v2[pp[0]];customAttribute.array[offset_custom+4]=v2[pp[1]];customAttribute.array[offset_custom+5]=v2[pp[2]];customAttribute.array[offset_custom+6]=v3[pp[0]];customAttribute.array[offset_custom+7]=v3[pp[1]];customAttribute.array[offset_custom+8]=v3[pp[2]];offset_custom+=9}}}else if(customAttribute.size===4){if(customAttribute.boundTo===undefined||customAttribute.boundTo==="vertices"){for(f=0,fl=chunk_faces3.length;f<fl;f++){face=obj_faces[chunk_faces3[f]];v1=customAttribute.value[face.a];v2=customAttribute.value[face.b];v3=customAttribute.value[face.c];customAttribute.array[offset_custom]=v1.x;customAttribute.array[offset_custom+1]=v1.y;customAttribute.array[offset_custom+2]=v1.z;customAttribute.array[offset_custom+3]=v1.w;customAttribute.array[offset_custom+4]=v2.x;customAttribute.array[offset_custom+5]=v2.y;customAttribute.array[offset_custom+6]=v2.z;customAttribute.array[offset_custom+7]=v2.w;customAttribute.array[offset_custom+8]=v3.x;customAttribute.array[offset_custom+9]=v3.y;customAttribute.array[offset_custom+10]=v3.z;customAttribute.array[offset_custom+11]=v3.w;offset_custom+=12}}else if(customAttribute.boundTo==="faces"){for(f=0,fl=chunk_faces3.length;f<fl;f++){value=customAttribute.value[chunk_faces3[f]];v1=value;v2=value;v3=value;customAttribute.array[offset_custom]=v1.x;customAttribute.array[offset_custom+1]=v1.y;customAttribute.array[offset_custom+2]=v1.z;customAttribute.array[offset_custom+3]=v1.w;customAttribute.array[offset_custom+4]=v2.x;customAttribute.array[offset_custom+5]=v2.y;customAttribute.array[offset_custom+6]=v2.z;customAttribute.array[offset_custom+7]=v2.w;customAttribute.array[offset_custom+8]=v3.x;customAttribute.array[offset_custom+9]=v3.y;customAttribute.array[offset_custom+10]=v3.z;customAttribute.array[offset_custom+11]=v3.w;offset_custom+=12}}else if(customAttribute.boundTo==="faceVertices"){for(f=0,fl=chunk_faces3.length;f<fl;f++){value=customAttribute.value[chunk_faces3[f]];v1=value[0];v2=value[1];v3=value[2];customAttribute.array[offset_custom]=v1.x;customAttribute.array[offset_custom+1]=v1.y;customAttribute.array[offset_custom+2]=v1.z;customAttribute.array[offset_custom+3]=v1.w;customAttribute.array[offset_custom+4]=v2.x;customAttribute.array[offset_custom+5]=v2.y;customAttribute.array[offset_custom+6]=v2.z;customAttribute.array[offset_custom+7]=v2.w;customAttribute.array[offset_custom+8]=v3.x;customAttribute.array[offset_custom+9]=v3.y;customAttribute.array[offset_custom+10]=v3.z;customAttribute.array[offset_custom+11]=v3.w;offset_custom+=12}}}_gl.bindBuffer(_gl.ARRAY_BUFFER,customAttribute.buffer);_gl.bufferData(_gl.ARRAY_BUFFER,customAttribute.array,hint)}}if(dispose){delete geometryGroup.__inittedArrays;delete geometryGroup.__colorArray;delete geometryGroup.__normalArray;delete geometryGroup.__tangentArray;delete geometryGroup.__uvArray;delete geometryGroup.__uv2Array;delete geometryGroup.__faceArray;delete geometryGroup.__vertexArray;delete geometryGroup.__lineArray;delete geometryGroup.__skinIndexArray;delete geometryGroup.__skinWeightArray}}function setDirectBuffers(geometry){var attributes=geometry.attributes;var attributesKeys=geometry.attributesKeys;for(var i=0,l=attributesKeys.length;i<l;i++){var key=attributesKeys[i];var attribute=attributes[key];if(attribute.buffer===undefined){attribute.buffer=_gl.createBuffer();attribute.needsUpdate=true}if(attribute.needsUpdate===true){var bufferType=key==="index"?_gl.ELEMENT_ARRAY_BUFFER:_gl.ARRAY_BUFFER;_gl.bindBuffer(bufferType,attribute.buffer);_gl.bufferData(bufferType,attribute.array,_gl.STATIC_DRAW);attribute.needsUpdate=false}}}this.renderBufferImmediate=function(object,program,material){initAttributes();if(object.hasPositions&&!object.__webglVertexBuffer)object.__webglVertexBuffer=_gl.createBuffer();if(object.hasNormals&&!object.__webglNormalBuffer)object.__webglNormalBuffer=_gl.createBuffer();if(object.hasUvs&&!object.__webglUvBuffer)object.__webglUvBuffer=_gl.createBuffer();if(object.hasColors&&!object.__webglColorBuffer)object.__webglColorBuffer=_gl.createBuffer();if(object.hasPositions){_gl.bindBuffer(_gl.ARRAY_BUFFER,object.__webglVertexBuffer);_gl.bufferData(_gl.ARRAY_BUFFER,object.positionArray,_gl.DYNAMIC_DRAW);enableAttribute(program.attributes.position);_gl.vertexAttribPointer(program.attributes.position,3,_gl.FLOAT,false,0,0)}if(object.hasNormals){_gl.bindBuffer(_gl.ARRAY_BUFFER,object.__webglNormalBuffer);if(material.shading===THREE.FlatShading){var nx,ny,nz,nax,nbx,ncx,nay,nby,ncy,naz,nbz,ncz,normalArray,i,il=object.count*3;for(i=0;i<il;i+=9){normalArray=object.normalArray;nax=normalArray[i];nay=normalArray[i+1];naz=normalArray[i+2];nbx=normalArray[i+3];nby=normalArray[i+4];nbz=normalArray[i+5];ncx=normalArray[i+6];ncy=normalArray[i+7];ncz=normalArray[i+8];nx=(nax+nbx+ncx)/3;ny=(nay+nby+ncy)/3;nz=(naz+nbz+ncz)/3;normalArray[i]=nx;normalArray[i+1]=ny;normalArray[i+2]=nz;normalArray[i+3]=nx;normalArray[i+4]=ny;normalArray[i+5]=nz;normalArray[i+6]=nx;normalArray[i+7]=ny;normalArray[i+8]=nz}}_gl.bufferData(_gl.ARRAY_BUFFER,object.normalArray,_gl.DYNAMIC_DRAW);enableAttribute(program.attributes.normal);_gl.vertexAttribPointer(program.attributes.normal,3,_gl.FLOAT,false,0,0)}if(object.hasUvs&&material.map){_gl.bindBuffer(_gl.ARRAY_BUFFER,object.__webglUvBuffer);_gl.bufferData(_gl.ARRAY_BUFFER,object.uvArray,_gl.DYNAMIC_DRAW);enableAttribute(program.attributes.uv);_gl.vertexAttribPointer(program.attributes.uv,2,_gl.FLOAT,false,0,0)}if(object.hasColors&&material.vertexColors!==THREE.NoColors){_gl.bindBuffer(_gl.ARRAY_BUFFER,object.__webglColorBuffer);_gl.bufferData(_gl.ARRAY_BUFFER,object.colorArray,_gl.DYNAMIC_DRAW);enableAttribute(program.attributes.color);_gl.vertexAttribPointer(program.attributes.color,3,_gl.FLOAT,false,0,0)}disableUnusedAttributes();_gl.drawArrays(_gl.TRIANGLES,0,object.count);object.count=0};function setupVertexAttributes(material,program,geometry,startIndex){var geometryAttributes=geometry.attributes;var programAttributes=program.attributes;var programAttributesKeys=program.attributesKeys;for(var i=0,l=programAttributesKeys.length;i<l;i++){var key=programAttributesKeys[i];var programAttribute=programAttributes[key];if(programAttribute>=0){var geometryAttribute=geometryAttributes[key];if(geometryAttribute!==undefined){var size=geometryAttribute.itemSize;_gl.bindBuffer(_gl.ARRAY_BUFFER,geometryAttribute.buffer);enableAttribute(programAttribute);_gl.vertexAttribPointer(programAttribute,size,_gl.FLOAT,false,0,startIndex*size*4)}else if(material.defaultAttributeValues!==undefined){if(material.defaultAttributeValues[key].length===2){_gl.vertexAttrib2fv(programAttribute,material.defaultAttributeValues[key])}else if(material.defaultAttributeValues[key].length===3){_gl.vertexAttrib3fv(programAttribute,material.defaultAttributeValues[key])}}}}disableUnusedAttributes()}this.renderBufferDirect=function(camera,lights,fog,material,geometry,object){if(material.visible===false)return;var program=setProgram(camera,lights,fog,material,object);var updateBuffers=false,wireframeBit=material.wireframe?1:0,geometryHash=geometry.id*16777215+program.id*2+wireframeBit;if(geometryHash!==_currentGeometryGroupHash){_currentGeometryGroupHash=geometryHash;updateBuffers=true}if(updateBuffers){initAttributes()}if(object instanceof THREE.Mesh){var mode=material.wireframe===true?_gl.LINES:_gl.TRIANGLES;var index=geometry.attributes.index;if(index){var type,size;if(index.array instanceof Uint32Array&&extensions.get("OES_element_index_uint")){type=_gl.UNSIGNED_INT;size=4}else{type=_gl.UNSIGNED_SHORT;size=2}var offsets=geometry.offsets;if(offsets.length===0){if(updateBuffers){setupVertexAttributes(material,program,geometry,0);_gl.bindBuffer(_gl.ELEMENT_ARRAY_BUFFER,index.buffer)}_gl.drawElements(mode,index.array.length,type,0);_this.info.render.calls++;_this.info.render.vertices+=index.array.length;_this.info.render.faces+=index.array.length/3}else{updateBuffers=true;for(var i=0,il=offsets.length;i<il;i++){var startIndex=offsets[i].index;if(updateBuffers){setupVertexAttributes(material,program,geometry,startIndex);_gl.bindBuffer(_gl.ELEMENT_ARRAY_BUFFER,index.buffer)}_gl.drawElements(mode,offsets[i].count,type,offsets[i].start*size);_this.info.render.calls++;_this.info.render.vertices+=offsets[i].count;_this.info.render.faces+=offsets[i].count/3}}}else{if(updateBuffers){setupVertexAttributes(material,program,geometry,0)}var position=geometry.attributes["position"];_gl.drawArrays(mode,0,position.array.length/3);_this.info.render.calls++;_this.info.render.vertices+=position.array.length/3;_this.info.render.faces+=position.array.length/9}}else if(object instanceof THREE.PointCloud){if(updateBuffers){setupVertexAttributes(material,program,geometry,0)}var position=geometry.attributes.position;_gl.drawArrays(_gl.POINTS,0,position.array.length/3);_this.info.render.calls++;_this.info.render.points+=position.array.length/3}else if(object instanceof THREE.Line){var mode=object.mode===THREE.LineStrip?_gl.LINE_STRIP:_gl.LINES;setLineWidth(material.linewidth);var index=geometry.attributes.index;if(index){var type,size;if(index.array instanceof Uint32Array){type=_gl.UNSIGNED_INT;size=4}else{type=_gl.UNSIGNED_SHORT;size=2}var offsets=geometry.offsets;if(offsets.length===0){if(updateBuffers){setupVertexAttributes(material,program,geometry,0);_gl.bindBuffer(_gl.ELEMENT_ARRAY_BUFFER,index.buffer)}_gl.drawElements(mode,index.array.length,type,0);_this.info.render.calls++;_this.info.render.vertices+=index.array.length}else{if(offsets.length>1)updateBuffers=true;for(var i=0,il=offsets.length;i<il;i++){var startIndex=offsets[i].index;if(updateBuffers){setupVertexAttributes(material,program,geometry,startIndex);_gl.bindBuffer(_gl.ELEMENT_ARRAY_BUFFER,index.buffer)}_gl.drawElements(mode,offsets[i].count,type,offsets[i].start*size);_this.info.render.calls++;_this.info.render.vertices+=offsets[i].count}}}else{if(updateBuffers){setupVertexAttributes(material,program,geometry,0)}var position=geometry.attributes.position;_gl.drawArrays(mode,0,position.array.length/3);_this.info.render.calls++;_this.info.render.points+=position.array.length/3}}};this.renderBuffer=function(camera,lights,fog,material,geometryGroup,object){if(material.visible===false)return;var program=setProgram(camera,lights,fog,material,object);var attributes=program.attributes;var updateBuffers=false,wireframeBit=material.wireframe?1:0,geometryGroupHash=geometryGroup.id*16777215+program.id*2+wireframeBit;if(geometryGroupHash!==_currentGeometryGroupHash){_currentGeometryGroupHash=geometryGroupHash;updateBuffers=true}if(updateBuffers){initAttributes()}if(!material.morphTargets&&attributes.position>=0){if(updateBuffers){_gl.bindBuffer(_gl.ARRAY_BUFFER,geometryGroup.__webglVertexBuffer);enableAttribute(attributes.position);_gl.vertexAttribPointer(attributes.position,3,_gl.FLOAT,false,0,0)}}else{if(object.morphTargetBase){setupMorphTargets(material,geometryGroup,object)}}if(updateBuffers){if(geometryGroup.__webglCustomAttributesList){for(var i=0,il=geometryGroup.__webglCustomAttributesList.length;i<il;i++){var attribute=geometryGroup.__webglCustomAttributesList[i];if(attributes[attribute.buffer.belongsToAttribute]>=0){_gl.bindBuffer(_gl.ARRAY_BUFFER,attribute.buffer);enableAttribute(attributes[attribute.buffer.belongsToAttribute]);_gl.vertexAttribPointer(attributes[attribute.buffer.belongsToAttribute],attribute.size,_gl.FLOAT,false,0,0)}}}if(attributes.color>=0){if(object.geometry.colors.length>0||object.geometry.faces.length>0){_gl.bindBuffer(_gl.ARRAY_BUFFER,geometryGroup.__webglColorBuffer);enableAttribute(attributes.color);_gl.vertexAttribPointer(attributes.color,3,_gl.FLOAT,false,0,0)}else if(material.defaultAttributeValues!==undefined){_gl.vertexAttrib3fv(attributes.color,material.defaultAttributeValues.color)}}if(attributes.normal>=0){_gl.bindBuffer(_gl.ARRAY_BUFFER,geometryGroup.__webglNormalBuffer);enableAttribute(attributes.normal);_gl.vertexAttribPointer(attributes.normal,3,_gl.FLOAT,false,0,0)}if(attributes.tangent>=0){_gl.bindBuffer(_gl.ARRAY_BUFFER,geometryGroup.__webglTangentBuffer);enableAttribute(attributes.tangent);_gl.vertexAttribPointer(attributes.tangent,4,_gl.FLOAT,false,0,0)}if(attributes.uv>=0){if(object.geometry.faceVertexUvs[0]){_gl.bindBuffer(_gl.ARRAY_BUFFER,geometryGroup.__webglUVBuffer);enableAttribute(attributes.uv);_gl.vertexAttribPointer(attributes.uv,2,_gl.FLOAT,false,0,0)}else if(material.defaultAttributeValues!==undefined){_gl.vertexAttrib2fv(attributes.uv,material.defaultAttributeValues.uv)}}if(attributes.uv2>=0){if(object.geometry.faceVertexUvs[1]){_gl.bindBuffer(_gl.ARRAY_BUFFER,geometryGroup.__webglUV2Buffer);enableAttribute(attributes.uv2);_gl.vertexAttribPointer(attributes.uv2,2,_gl.FLOAT,false,0,0)}else if(material.defaultAttributeValues!==undefined){_gl.vertexAttrib2fv(attributes.uv2,material.defaultAttributeValues.uv2)}}if(material.skinning&&attributes.skinIndex>=0&&attributes.skinWeight>=0){_gl.bindBuffer(_gl.ARRAY_BUFFER,geometryGroup.__webglSkinIndicesBuffer);enableAttribute(attributes.skinIndex);_gl.vertexAttribPointer(attributes.skinIndex,4,_gl.FLOAT,false,0,0);_gl.bindBuffer(_gl.ARRAY_BUFFER,geometryGroup.__webglSkinWeightsBuffer);enableAttribute(attributes.skinWeight);_gl.vertexAttribPointer(attributes.skinWeight,4,_gl.FLOAT,false,0,0)}if(attributes.lineDistance>=0){_gl.bindBuffer(_gl.ARRAY_BUFFER,geometryGroup.__webglLineDistanceBuffer);enableAttribute(attributes.lineDistance);_gl.vertexAttribPointer(attributes.lineDistance,1,_gl.FLOAT,false,0,0)}}disableUnusedAttributes();if(object instanceof THREE.Mesh){var type=geometryGroup.__typeArray===Uint32Array?_gl.UNSIGNED_INT:_gl.UNSIGNED_SHORT;if(material.wireframe){setLineWidth(material.wireframeLinewidth);if(updateBuffers)_gl.bindBuffer(_gl.ELEMENT_ARRAY_BUFFER,geometryGroup.__webglLineBuffer);_gl.drawElements(_gl.LINES,geometryGroup.__webglLineCount,type,0)}else{if(updateBuffers)_gl.bindBuffer(_gl.ELEMENT_ARRAY_BUFFER,geometryGroup.__webglFaceBuffer);_gl.drawElements(_gl.TRIANGLES,geometryGroup.__webglFaceCount,type,0)}_this.info.render.calls++;_this.info.render.vertices+=geometryGroup.__webglFaceCount;_this.info.render.faces+=geometryGroup.__webglFaceCount/3}else if(object instanceof THREE.Line){var mode=object.mode===THREE.LineStrip?_gl.LINE_STRIP:_gl.LINES;setLineWidth(material.linewidth);_gl.drawArrays(mode,0,geometryGroup.__webglLineCount);_this.info.render.calls++}else if(object instanceof THREE.PointCloud){_gl.drawArrays(_gl.POINTS,0,geometryGroup.__webglParticleCount);_this.info.render.calls++;_this.info.render.points+=geometryGroup.__webglParticleCount}};function initAttributes(){for(var i=0,l=_newAttributes.length;i<l;i++){_newAttributes[i]=0}}function enableAttribute(attribute){_newAttributes[attribute]=1;if(_enabledAttributes[attribute]===0){_gl.enableVertexAttribArray(attribute);_enabledAttributes[attribute]=1}}function disableUnusedAttributes(){for(var i=0,l=_enabledAttributes.length;i<l;i++){if(_enabledAttributes[i]!==_newAttributes[i]){_gl.disableVertexAttribArray(i);_enabledAttributes[i]=0}}}function setupMorphTargets(material,geometryGroup,object){var attributes=material.program.attributes;if(object.morphTargetBase!==-1&&attributes.position>=0){_gl.bindBuffer(_gl.ARRAY_BUFFER,geometryGroup.__webglMorphTargetsBuffers[object.morphTargetBase]);enableAttribute(attributes.position);_gl.vertexAttribPointer(attributes.position,3,_gl.FLOAT,false,0,0)}else if(attributes.position>=0){_gl.bindBuffer(_gl.ARRAY_BUFFER,geometryGroup.__webglVertexBuffer);enableAttribute(attributes.position);_gl.vertexAttribPointer(attributes.position,3,_gl.FLOAT,false,0,0)}if(object.morphTargetForcedOrder.length){var m=0;var order=object.morphTargetForcedOrder;var influences=object.morphTargetInfluences;while(m<material.numSupportedMorphTargets&&m<order.length){if(attributes["morphTarget"+m]>=0){_gl.bindBuffer(_gl.ARRAY_BUFFER,geometryGroup.__webglMorphTargetsBuffers[order[m]]);enableAttribute(attributes["morphTarget"+m]);_gl.vertexAttribPointer(attributes["morphTarget"+m],3,_gl.FLOAT,false,0,0)}if(attributes["morphNormal"+m]>=0&&material.morphNormals){_gl.bindBuffer(_gl.ARRAY_BUFFER,geometryGroup.__webglMorphNormalsBuffers[order[m]]);enableAttribute(attributes["morphNormal"+m]);_gl.vertexAttribPointer(attributes["morphNormal"+m],3,_gl.FLOAT,false,0,0)}object.__webglMorphTargetInfluences[m]=influences[order[m]];m++}}else{var influence,activeInfluenceIndices=[];var influences=object.morphTargetInfluences;var i,il=influences.length;for(i=0;i<il;i++){influence=influences[i];if(influence>0){activeInfluenceIndices.push([influence,i])}}if(activeInfluenceIndices.length>material.numSupportedMorphTargets){activeInfluenceIndices.sort(numericalSort);activeInfluenceIndices.length=material.numSupportedMorphTargets}else if(activeInfluenceIndices.length>material.numSupportedMorphNormals){activeInfluenceIndices.sort(numericalSort)}else if(activeInfluenceIndices.length===0){activeInfluenceIndices.push([0,0])}var influenceIndex,m=0;while(m<material.numSupportedMorphTargets){if(activeInfluenceIndices[m]){influenceIndex=activeInfluenceIndices[m][1];if(attributes["morphTarget"+m]>=0){_gl.bindBuffer(_gl.ARRAY_BUFFER,geometryGroup.__webglMorphTargetsBuffers[influenceIndex]);enableAttribute(attributes["morphTarget"+m]);_gl.vertexAttribPointer(attributes["morphTarget"+m],3,_gl.FLOAT,false,0,0)}if(attributes["morphNormal"+m]>=0&&material.morphNormals){_gl.bindBuffer(_gl.ARRAY_BUFFER,geometryGroup.__webglMorphNormalsBuffers[influenceIndex]);enableAttribute(attributes["morphNormal"+m]);_gl.vertexAttribPointer(attributes["morphNormal"+m],3,_gl.FLOAT,false,0,0)}object.__webglMorphTargetInfluences[m]=influences[influenceIndex]}else{object.__webglMorphTargetInfluences[m]=0}m++}}if(material.program.uniforms.morphTargetInfluences!==null){_gl.uniform1fv(material.program.uniforms.morphTargetInfluences,object.__webglMorphTargetInfluences)}}function painterSortStable(a,b){if(a.material.id!==b.material.id){return b.material.id-a.material.id}else if(a.z!==b.z){return b.z-a.z}else{return a.id-b.id}}function reversePainterSortStable(a,b){if(a.z!==b.z){return a.z-b.z}else{return a.id-b.id}}function numericalSort(a,b){return b[0]-a[0]}this.render=function(scene,camera,renderTarget,forceClear){if(camera instanceof THREE.Camera===false){console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");return}var fog=scene.fog;_currentGeometryGroupHash=-1;_currentMaterialId=-1;_currentCamera=null;_lightsNeedUpdate=true;if(scene.autoUpdate===true)scene.updateMatrixWorld();if(camera.parent===undefined)camera.updateMatrixWorld();scene.traverse(function(object){if(object instanceof THREE.SkinnedMesh){object.skeleton.update()}});camera.matrixWorldInverse.getInverse(camera.matrixWorld);_projScreenMatrix.multiplyMatrices(camera.projectionMatrix,camera.matrixWorldInverse);_frustum.setFromMatrix(_projScreenMatrix);lights.length=0;opaqueObjects.length=0;transparentObjects.length=0;sprites.length=0;lensFlares.length=0;projectObject(scene,scene);if(_this.sortObjects===true){opaqueObjects.sort(painterSortStable);transparentObjects.sort(reversePainterSortStable)}shadowMapPlugin.render(scene,camera);_this.info.render.calls=0;_this.info.render.vertices=0;_this.info.render.faces=0;_this.info.render.points=0;this.setRenderTarget(renderTarget);if(this.autoClear||forceClear){this.clear(this.autoClearColor,this.autoClearDepth,this.autoClearStencil)}for(var i=0,il=_webglObjectsImmediate.length;i<il;i++){var webglObject=_webglObjectsImmediate[i];var object=webglObject.object;if(object.visible){setupMatrices(object,camera);unrollImmediateBufferMaterial(webglObject)}}if(scene.overrideMaterial){var material=scene.overrideMaterial;this.setBlending(material.blending,material.blendEquation,material.blendSrc,material.blendDst);this.setDepthTest(material.depthTest);this.setDepthWrite(material.depthWrite);setPolygonOffset(material.polygonOffset,material.polygonOffsetFactor,material.polygonOffsetUnits);renderObjects(opaqueObjects,camera,lights,fog,true,material);renderObjects(transparentObjects,camera,lights,fog,true,material);renderObjectsImmediate(_webglObjectsImmediate,"",camera,lights,fog,false,material)}else{var material=null;this.setBlending(THREE.NoBlending);renderObjects(opaqueObjects,camera,lights,fog,false,material);renderObjectsImmediate(_webglObjectsImmediate,"opaque",camera,lights,fog,false,material);renderObjects(transparentObjects,camera,lights,fog,true,material);renderObjectsImmediate(_webglObjectsImmediate,"transparent",camera,lights,fog,true,material)}spritePlugin.render(scene,camera);lensFlarePlugin.render(scene,camera,_currentWidth,_currentHeight);if(renderTarget&&renderTarget.generateMipmaps&&renderTarget.minFilter!==THREE.NearestFilter&&renderTarget.minFilter!==THREE.LinearFilter){updateRenderTargetMipmap(renderTarget)}this.setDepthTest(true);this.setDepthWrite(true)};function projectObject(scene,object){if(object.visible===false)return;if(object instanceof THREE.Scene||object instanceof THREE.Group){}else{initObject(object,scene);if(object instanceof THREE.Light){lights.push(object)}else if(object instanceof THREE.Sprite){sprites.push(object)}else if(object instanceof THREE.LensFlare){lensFlares.push(object)}else{var webglObjects=_webglObjects[object.id];if(webglObjects&&(object.frustumCulled===false||_frustum.intersectsObject(object)===true)){updateObject(object,scene);for(var i=0,l=webglObjects.length;i<l;i++){var webglObject=webglObjects[i];unrollBufferMaterial(webglObject);webglObject.render=true;if(_this.sortObjects===true){if(object.renderDepth!==null){webglObject.z=object.renderDepth}else{_vector3.setFromMatrixPosition(object.matrixWorld);_vector3.applyProjection(_projScreenMatrix);webglObject.z=_vector3.z}}}}}}for(var i=0,l=object.children.length;i<l;i++){projectObject(scene,object.children[i])}}function renderObjects(renderList,camera,lights,fog,useBlending,overrideMaterial){var material;for(var i=renderList.length-1;i!==-1;i--){var webglObject=renderList[i];var object=webglObject.object;var buffer=webglObject.buffer;setupMatrices(object,camera);if(overrideMaterial){material=overrideMaterial}else{material=webglObject.material;if(!material)continue;if(useBlending)_this.setBlending(material.blending,material.blendEquation,material.blendSrc,material.blendDst);_this.setDepthTest(material.depthTest);_this.setDepthWrite(material.depthWrite);setPolygonOffset(material.polygonOffset,material.polygonOffsetFactor,material.polygonOffsetUnits)}_this.setMaterialFaces(material);if(buffer instanceof THREE.BufferGeometry){_this.renderBufferDirect(camera,lights,fog,material,buffer,object)}else{_this.renderBuffer(camera,lights,fog,material,buffer,object)}}}function renderObjectsImmediate(renderList,materialType,camera,lights,fog,useBlending,overrideMaterial){var material;for(var i=0,il=renderList.length;i<il;i++){var webglObject=renderList[i];var object=webglObject.object;if(object.visible){if(overrideMaterial){material=overrideMaterial}else{material=webglObject[materialType];if(!material)continue;if(useBlending)_this.setBlending(material.blending,material.blendEquation,material.blendSrc,material.blendDst);_this.setDepthTest(material.depthTest);_this.setDepthWrite(material.depthWrite);setPolygonOffset(material.polygonOffset,material.polygonOffsetFactor,material.polygonOffsetUnits)}_this.renderImmediateObject(camera,lights,fog,material,object)}}}this.renderImmediateObject=function(camera,lights,fog,material,object){var program=setProgram(camera,lights,fog,material,object);_currentGeometryGroupHash=-1;_this.setMaterialFaces(material);if(object.immediateRenderCallback){object.immediateRenderCallback(program,_gl,_frustum)}else{object.render(function(object){_this.renderBufferImmediate(object,program,material)})}};function unrollImmediateBufferMaterial(globject){var object=globject.object,material=object.material;if(material.transparent){globject.transparent=material;globject.opaque=null}else{globject.opaque=material;globject.transparent=null}}function unrollBufferMaterial(globject){var object=globject.object;var buffer=globject.buffer;var geometry=object.geometry;var material=object.material;if(material instanceof THREE.MeshFaceMaterial){var materialIndex=geometry instanceof THREE.BufferGeometry?0:buffer.materialIndex;material=material.materials[materialIndex];globject.material=material;if(material.transparent){transparentObjects.push(globject)}else{opaqueObjects.push(globject)}}else if(material){globject.material=material;if(material.transparent){transparentObjects.push(globject)}else{opaqueObjects.push(globject)}}}function initObject(object,scene){if(object.__webglInit===undefined){object.__webglInit=true;object._modelViewMatrix=new THREE.Matrix4;object._normalMatrix=new THREE.Matrix3;object.addEventListener("removed",onObjectRemoved)}var geometry=object.geometry;if(geometry===undefined){}else if(geometry.__webglInit===undefined){geometry.__webglInit=true;geometry.addEventListener("dispose",onGeometryDispose);if(geometry instanceof THREE.BufferGeometry){}else if(object instanceof THREE.Mesh){initGeometryGroups(scene,object,geometry)}else if(object instanceof THREE.Line){if(geometry.__webglVertexBuffer===undefined){createLineBuffers(geometry);initLineBuffers(geometry,object);geometry.verticesNeedUpdate=true;geometry.colorsNeedUpdate=true;geometry.lineDistancesNeedUpdate=true}}else if(object instanceof THREE.PointCloud){if(geometry.__webglVertexBuffer===undefined){createParticleBuffers(geometry);
initParticleBuffers(geometry,object);geometry.verticesNeedUpdate=true;geometry.colorsNeedUpdate=true}}}if(object.__webglActive===undefined){object.__webglActive=true;if(object instanceof THREE.Mesh){if(geometry instanceof THREE.BufferGeometry){addBuffer(_webglObjects,geometry,object)}else if(geometry instanceof THREE.Geometry){var geometryGroupsList=geometryGroups[geometry.id];for(var i=0,l=geometryGroupsList.length;i<l;i++){addBuffer(_webglObjects,geometryGroupsList[i],object)}}}else if(object instanceof THREE.Line||object instanceof THREE.PointCloud){addBuffer(_webglObjects,geometry,object)}else if(object instanceof THREE.ImmediateRenderObject||object.immediateRenderCallback){addBufferImmediate(_webglObjectsImmediate,object)}}}var geometryGroups={};var geometryGroupCounter=0;function makeGroups(geometry,usesFaceMaterial){var maxVerticesInGroup=extensions.get("OES_element_index_uint")?4294967296:65535;var groupHash,hash_map={};var numMorphTargets=geometry.morphTargets.length;var numMorphNormals=geometry.morphNormals.length;var group;var groups={};var groupsList=[];for(var f=0,fl=geometry.faces.length;f<fl;f++){var face=geometry.faces[f];var materialIndex=usesFaceMaterial?face.materialIndex:0;if(!(materialIndex in hash_map)){hash_map[materialIndex]={hash:materialIndex,counter:0}}groupHash=hash_map[materialIndex].hash+"_"+hash_map[materialIndex].counter;if(!(groupHash in groups)){group={id:geometryGroupCounter++,faces3:[],materialIndex:materialIndex,vertices:0,numMorphTargets:numMorphTargets,numMorphNormals:numMorphNormals};groups[groupHash]=group;groupsList.push(group)}if(groups[groupHash].vertices+3>maxVerticesInGroup){hash_map[materialIndex].counter+=1;groupHash=hash_map[materialIndex].hash+"_"+hash_map[materialIndex].counter;if(!(groupHash in groups)){group={id:geometryGroupCounter++,faces3:[],materialIndex:materialIndex,vertices:0,numMorphTargets:numMorphTargets,numMorphNormals:numMorphNormals};groups[groupHash]=group;groupsList.push(group)}}groups[groupHash].faces3.push(f);groups[groupHash].vertices+=3}return groupsList}function initGeometryGroups(scene,object,geometry){var material=object.material,addBuffers=false;if(geometryGroups[geometry.id]===undefined||geometry.groupsNeedUpdate===true){delete _webglObjects[object.id];geometryGroups[geometry.id]=makeGroups(geometry,material instanceof THREE.MeshFaceMaterial);geometry.groupsNeedUpdate=false}var geometryGroupsList=geometryGroups[geometry.id];for(var i=0,il=geometryGroupsList.length;i<il;i++){var geometryGroup=geometryGroupsList[i];if(geometryGroup.__webglVertexBuffer===undefined){createMeshBuffers(geometryGroup);initMeshBuffers(geometryGroup,object);geometry.verticesNeedUpdate=true;geometry.morphTargetsNeedUpdate=true;geometry.elementsNeedUpdate=true;geometry.uvsNeedUpdate=true;geometry.normalsNeedUpdate=true;geometry.tangentsNeedUpdate=true;geometry.colorsNeedUpdate=true;addBuffers=true}else{addBuffers=false}if(addBuffers||object.__webglActive===undefined){addBuffer(_webglObjects,geometryGroup,object)}}object.__webglActive=true}function addBuffer(objlist,buffer,object){var id=object.id;objlist[id]=objlist[id]||[];objlist[id].push({id:id,buffer:buffer,object:object,material:null,z:0})}function addBufferImmediate(objlist,object){objlist.push({id:null,object:object,opaque:null,transparent:null,z:0})}function updateObject(object,scene){var geometry=object.geometry,customAttributesDirty,material;if(geometry instanceof THREE.BufferGeometry){setDirectBuffers(geometry)}else if(object instanceof THREE.Mesh){if(geometry.groupsNeedUpdate===true){initGeometryGroups(scene,object,geometry)}var geometryGroupsList=geometryGroups[geometry.id];for(var i=0,il=geometryGroupsList.length;i<il;i++){var geometryGroup=geometryGroupsList[i];material=getBufferMaterial(object,geometryGroup);if(geometry.groupsNeedUpdate===true){initMeshBuffers(geometryGroup,object)}customAttributesDirty=material.attributes&&areCustomAttributesDirty(material);if(geometry.verticesNeedUpdate||geometry.morphTargetsNeedUpdate||geometry.elementsNeedUpdate||geometry.uvsNeedUpdate||geometry.normalsNeedUpdate||geometry.colorsNeedUpdate||geometry.tangentsNeedUpdate||customAttributesDirty){setMeshBuffers(geometryGroup,object,_gl.DYNAMIC_DRAW,!geometry.dynamic,material)}}geometry.verticesNeedUpdate=false;geometry.morphTargetsNeedUpdate=false;geometry.elementsNeedUpdate=false;geometry.uvsNeedUpdate=false;geometry.normalsNeedUpdate=false;geometry.colorsNeedUpdate=false;geometry.tangentsNeedUpdate=false;material.attributes&&clearCustomAttributes(material)}else if(object instanceof THREE.Line){material=getBufferMaterial(object,geometry);customAttributesDirty=material.attributes&&areCustomAttributesDirty(material);if(geometry.verticesNeedUpdate||geometry.colorsNeedUpdate||geometry.lineDistancesNeedUpdate||customAttributesDirty){setLineBuffers(geometry,_gl.DYNAMIC_DRAW)}geometry.verticesNeedUpdate=false;geometry.colorsNeedUpdate=false;geometry.lineDistancesNeedUpdate=false;material.attributes&&clearCustomAttributes(material)}else if(object instanceof THREE.PointCloud){material=getBufferMaterial(object,geometry);customAttributesDirty=material.attributes&&areCustomAttributesDirty(material);if(geometry.verticesNeedUpdate||geometry.colorsNeedUpdate||object.sortParticles||customAttributesDirty){setParticleBuffers(geometry,_gl.DYNAMIC_DRAW,object)}geometry.verticesNeedUpdate=false;geometry.colorsNeedUpdate=false;material.attributes&&clearCustomAttributes(material)}}function areCustomAttributesDirty(material){for(var name in material.attributes){if(material.attributes[name].needsUpdate)return true}return false}function clearCustomAttributes(material){for(var name in material.attributes){material.attributes[name].needsUpdate=false}}function removeObject(object){if(object instanceof THREE.Mesh||object instanceof THREE.PointCloud||object instanceof THREE.Line){delete _webglObjects[object.id]}else if(object instanceof THREE.ImmediateRenderObject||object.immediateRenderCallback){removeInstances(_webglObjectsImmediate,object)}delete object.__webglInit;delete object._modelViewMatrix;delete object._normalMatrix;delete object.__webglActive}function removeInstances(objlist,object){for(var o=objlist.length-1;o>=0;o--){if(objlist[o].object===object){objlist.splice(o,1)}}}function initMaterial(material,lights,fog,object){material.addEventListener("dispose",onMaterialDispose);var shaderID;if(material instanceof THREE.MeshDepthMaterial){shaderID="depth"}else if(material instanceof THREE.MeshNormalMaterial){shaderID="normal"}else if(material instanceof THREE.MeshBasicMaterial){shaderID="basic"}else if(material instanceof THREE.MeshLambertMaterial){shaderID="lambert"}else if(material instanceof THREE.MeshPhongMaterial){shaderID="phong"}else if(material instanceof THREE.LineBasicMaterial){shaderID="basic"}else if(material instanceof THREE.LineDashedMaterial){shaderID="dashed"}else if(material instanceof THREE.PointCloudMaterial){shaderID="particle_basic"}if(shaderID){var shader=THREE.ShaderLib[shaderID];material.__webglShader={uniforms:THREE.UniformsUtils.clone(shader.uniforms),vertexShader:shader.vertexShader,fragmentShader:shader.fragmentShader}}else{material.__webglShader={uniforms:material.uniforms,vertexShader:material.vertexShader,fragmentShader:material.fragmentShader}}var maxLightCount=allocateLights(lights);var maxShadows=allocateShadows(lights);var maxBones=allocateBones(object);var parameters={precision:_precision,supportsVertexTextures:_supportsVertexTextures,map:!!material.map,envMap:!!material.envMap,lightMap:!!material.lightMap,bumpMap:!!material.bumpMap,normalMap:!!material.normalMap,specularMap:!!material.specularMap,alphaMap:!!material.alphaMap,vertexColors:material.vertexColors,fog:fog,useFog:material.fog,fogExp:fog instanceof THREE.FogExp2,sizeAttenuation:material.sizeAttenuation,logarithmicDepthBuffer:_logarithmicDepthBuffer,skinning:material.skinning,maxBones:maxBones,useVertexTexture:_supportsBoneTextures&&object&&object.skeleton&&object.skeleton.useVertexTexture,morphTargets:material.morphTargets,morphNormals:material.morphNormals,maxMorphTargets:_this.maxMorphTargets,maxMorphNormals:_this.maxMorphNormals,maxDirLights:maxLightCount.directional,maxPointLights:maxLightCount.point,maxSpotLights:maxLightCount.spot,maxHemiLights:maxLightCount.hemi,maxShadows:maxShadows,shadowMapEnabled:_this.shadowMapEnabled&&object.receiveShadow&&maxShadows>0,shadowMapType:_this.shadowMapType,shadowMapDebug:_this.shadowMapDebug,shadowMapCascade:_this.shadowMapCascade,alphaTest:material.alphaTest,metal:material.metal,wrapAround:material.wrapAround,doubleSided:material.side===THREE.DoubleSide,flipSided:material.side===THREE.BackSide};var chunks=[];if(shaderID){chunks.push(shaderID)}else{chunks.push(material.fragmentShader);chunks.push(material.vertexShader)}if(material.defines!==undefined){for(var name in material.defines){chunks.push(name);chunks.push(material.defines[name])}}for(var name in parameters){chunks.push(name);chunks.push(parameters[name])}var code=chunks.join();var program;for(var p=0,pl=_programs.length;p<pl;p++){var programInfo=_programs[p];if(programInfo.code===code){program=programInfo;program.usedTimes++;break}}if(program===undefined){program=new THREE.WebGLProgram(_this,code,material,parameters);_programs.push(program);_this.info.memory.programs=_programs.length}material.program=program;var attributes=program.attributes;if(material.morphTargets){material.numSupportedMorphTargets=0;var id,base="morphTarget";for(var i=0;i<_this.maxMorphTargets;i++){id=base+i;if(attributes[id]>=0){material.numSupportedMorphTargets++}}}if(material.morphNormals){material.numSupportedMorphNormals=0;var id,base="morphNormal";for(i=0;i<_this.maxMorphNormals;i++){id=base+i;if(attributes[id]>=0){material.numSupportedMorphNormals++}}}material.uniformsList=[];for(var u in material.__webglShader.uniforms){var location=material.program.uniforms[u];if(location){material.uniformsList.push([material.__webglShader.uniforms[u],location])}}}function setProgram(camera,lights,fog,material,object){_usedTextureUnits=0;if(material.needsUpdate){if(material.program)deallocateMaterial(material);initMaterial(material,lights,fog,object);material.needsUpdate=false}if(material.morphTargets){if(!object.__webglMorphTargetInfluences){object.__webglMorphTargetInfluences=new Float32Array(_this.maxMorphTargets)}}var refreshProgram=false;var refreshMaterial=false;var refreshLights=false;var program=material.program,p_uniforms=program.uniforms,m_uniforms=material.__webglShader.uniforms;if(program.id!==_currentProgram){_gl.useProgram(program.program);_currentProgram=program.id;refreshProgram=true;refreshMaterial=true;refreshLights=true}if(material.id!==_currentMaterialId){if(_currentMaterialId===-1)refreshLights=true;_currentMaterialId=material.id;refreshMaterial=true}if(refreshProgram||camera!==_currentCamera){_gl.uniformMatrix4fv(p_uniforms.projectionMatrix,false,camera.projectionMatrix.elements);if(_logarithmicDepthBuffer){_gl.uniform1f(p_uniforms.logDepthBufFC,2/(Math.log(camera.far+1)/Math.LN2))}if(camera!==_currentCamera)_currentCamera=camera;if(material instanceof THREE.ShaderMaterial||material instanceof THREE.MeshPhongMaterial||material.envMap){if(p_uniforms.cameraPosition!==null){_vector3.setFromMatrixPosition(camera.matrixWorld);_gl.uniform3f(p_uniforms.cameraPosition,_vector3.x,_vector3.y,_vector3.z)}}if(material instanceof THREE.MeshPhongMaterial||material instanceof THREE.MeshLambertMaterial||material instanceof THREE.ShaderMaterial||material.skinning){if(p_uniforms.viewMatrix!==null){_gl.uniformMatrix4fv(p_uniforms.viewMatrix,false,camera.matrixWorldInverse.elements)}}}if(material.skinning){if(object.bindMatrix&&p_uniforms.bindMatrix!==null){_gl.uniformMatrix4fv(p_uniforms.bindMatrix,false,object.bindMatrix.elements)}if(object.bindMatrixInverse&&p_uniforms.bindMatrixInverse!==null){_gl.uniformMatrix4fv(p_uniforms.bindMatrixInverse,false,object.bindMatrixInverse.elements)}if(_supportsBoneTextures&&object.skeleton&&object.skeleton.useVertexTexture){if(p_uniforms.boneTexture!==null){var textureUnit=getTextureUnit();_gl.uniform1i(p_uniforms.boneTexture,textureUnit);_this.setTexture(object.skeleton.boneTexture,textureUnit)}if(p_uniforms.boneTextureWidth!==null){_gl.uniform1i(p_uniforms.boneTextureWidth,object.skeleton.boneTextureWidth)}if(p_uniforms.boneTextureHeight!==null){_gl.uniform1i(p_uniforms.boneTextureHeight,object.skeleton.boneTextureHeight)}}else if(object.skeleton&&object.skeleton.boneMatrices){if(p_uniforms.boneGlobalMatrices!==null){_gl.uniformMatrix4fv(p_uniforms.boneGlobalMatrices,false,object.skeleton.boneMatrices)}}}if(refreshMaterial){if(fog&&material.fog){refreshUniformsFog(m_uniforms,fog)}if(material instanceof THREE.MeshPhongMaterial||material instanceof THREE.MeshLambertMaterial||material.lights){if(_lightsNeedUpdate){refreshLights=true;setupLights(lights);_lightsNeedUpdate=false}if(refreshLights){refreshUniformsLights(m_uniforms,_lights);markUniformsLightsNeedsUpdate(m_uniforms,true)}else{markUniformsLightsNeedsUpdate(m_uniforms,false)}}if(material instanceof THREE.MeshBasicMaterial||material instanceof THREE.MeshLambertMaterial||material instanceof THREE.MeshPhongMaterial){refreshUniformsCommon(m_uniforms,material)}if(material instanceof THREE.LineBasicMaterial){refreshUniformsLine(m_uniforms,material)}else if(material instanceof THREE.LineDashedMaterial){refreshUniformsLine(m_uniforms,material);refreshUniformsDash(m_uniforms,material)}else if(material instanceof THREE.PointCloudMaterial){refreshUniformsParticle(m_uniforms,material)}else if(material instanceof THREE.MeshPhongMaterial){refreshUniformsPhong(m_uniforms,material)}else if(material instanceof THREE.MeshLambertMaterial){refreshUniformsLambert(m_uniforms,material)}else if(material instanceof THREE.MeshDepthMaterial){m_uniforms.mNear.value=camera.near;m_uniforms.mFar.value=camera.far;m_uniforms.opacity.value=material.opacity}else if(material instanceof THREE.MeshNormalMaterial){m_uniforms.opacity.value=material.opacity}if(object.receiveShadow&&!material._shadowPass){refreshUniformsShadow(m_uniforms,lights)}loadUniformsGeneric(material.uniformsList)}loadUniformsMatrices(p_uniforms,object);if(p_uniforms.modelMatrix!==null){_gl.uniformMatrix4fv(p_uniforms.modelMatrix,false,object.matrixWorld.elements)}return program}function refreshUniformsCommon(uniforms,material){uniforms.opacity.value=material.opacity;if(_this.gammaInput){uniforms.diffuse.value.copyGammaToLinear(material.color)}else{uniforms.diffuse.value=material.color}uniforms.map.value=material.map;uniforms.lightMap.value=material.lightMap;uniforms.specularMap.value=material.specularMap;uniforms.alphaMap.value=material.alphaMap;if(material.bumpMap){uniforms.bumpMap.value=material.bumpMap;uniforms.bumpScale.value=material.bumpScale}if(material.normalMap){uniforms.normalMap.value=material.normalMap;uniforms.normalScale.value.copy(material.normalScale)}var uvScaleMap;if(material.map){uvScaleMap=material.map}else if(material.specularMap){uvScaleMap=material.specularMap}else if(material.normalMap){uvScaleMap=material.normalMap}else if(material.bumpMap){uvScaleMap=material.bumpMap}else if(material.alphaMap){uvScaleMap=material.alphaMap}if(uvScaleMap!==undefined){var offset=uvScaleMap.offset;var repeat=uvScaleMap.repeat;uniforms.offsetRepeat.value.set(offset.x,offset.y,repeat.x,repeat.y)}uniforms.envMap.value=material.envMap;uniforms.flipEnvMap.value=material.envMap instanceof THREE.WebGLRenderTargetCube?1:-1;if(_this.gammaInput){uniforms.reflectivity.value=material.reflectivity}else{uniforms.reflectivity.value=material.reflectivity}uniforms.refractionRatio.value=material.refractionRatio;uniforms.combine.value=material.combine;uniforms.useRefract.value=material.envMap&&material.envMap.mapping instanceof THREE.CubeRefractionMapping}function refreshUniformsLine(uniforms,material){uniforms.diffuse.value=material.color;uniforms.opacity.value=material.opacity}function refreshUniformsDash(uniforms,material){uniforms.dashSize.value=material.dashSize;uniforms.totalSize.value=material.dashSize+material.gapSize;uniforms.scale.value=material.scale}function refreshUniformsParticle(uniforms,material){uniforms.psColor.value=material.color;uniforms.opacity.value=material.opacity;uniforms.size.value=material.size;uniforms.scale.value=_canvas.height/2;uniforms.map.value=material.map}function refreshUniformsFog(uniforms,fog){uniforms.fogColor.value=fog.color;if(fog instanceof THREE.Fog){uniforms.fogNear.value=fog.near;uniforms.fogFar.value=fog.far}else if(fog instanceof THREE.FogExp2){uniforms.fogDensity.value=fog.density}}function refreshUniformsPhong(uniforms,material){uniforms.shininess.value=material.shininess;if(_this.gammaInput){uniforms.ambient.value.copyGammaToLinear(material.ambient);uniforms.emissive.value.copyGammaToLinear(material.emissive);uniforms.specular.value.copyGammaToLinear(material.specular)}else{uniforms.ambient.value=material.ambient;uniforms.emissive.value=material.emissive;uniforms.specular.value=material.specular}if(material.wrapAround){uniforms.wrapRGB.value.copy(material.wrapRGB)}}function refreshUniformsLambert(uniforms,material){if(_this.gammaInput){uniforms.ambient.value.copyGammaToLinear(material.ambient);uniforms.emissive.value.copyGammaToLinear(material.emissive)}else{uniforms.ambient.value=material.ambient;uniforms.emissive.value=material.emissive}if(material.wrapAround){uniforms.wrapRGB.value.copy(material.wrapRGB)}}function refreshUniformsLights(uniforms,lights){uniforms.ambientLightColor.value=lights.ambient;uniforms.directionalLightColor.value=lights.directional.colors;uniforms.directionalLightDirection.value=lights.directional.positions;uniforms.pointLightColor.value=lights.point.colors;uniforms.pointLightPosition.value=lights.point.positions;uniforms.pointLightDistance.value=lights.point.distances;uniforms.spotLightColor.value=lights.spot.colors;uniforms.spotLightPosition.value=lights.spot.positions;uniforms.spotLightDistance.value=lights.spot.distances;uniforms.spotLightDirection.value=lights.spot.directions;uniforms.spotLightAngleCos.value=lights.spot.anglesCos;uniforms.spotLightExponent.value=lights.spot.exponents;uniforms.hemisphereLightSkyColor.value=lights.hemi.skyColors;uniforms.hemisphereLightGroundColor.value=lights.hemi.groundColors;uniforms.hemisphereLightDirection.value=lights.hemi.positions}function markUniformsLightsNeedsUpdate(uniforms,boolean){uniforms.ambientLightColor.needsUpdate=boolean;uniforms.directionalLightColor.needsUpdate=boolean;uniforms.directionalLightDirection.needsUpdate=boolean;uniforms.pointLightColor.needsUpdate=boolean;uniforms.pointLightPosition.needsUpdate=boolean;uniforms.pointLightDistance.needsUpdate=boolean;uniforms.spotLightColor.needsUpdate=boolean;uniforms.spotLightPosition.needsUpdate=boolean;uniforms.spotLightDistance.needsUpdate=boolean;uniforms.spotLightDirection.needsUpdate=boolean;uniforms.spotLightAngleCos.needsUpdate=boolean;uniforms.spotLightExponent.needsUpdate=boolean;uniforms.hemisphereLightSkyColor.needsUpdate=boolean;uniforms.hemisphereLightGroundColor.needsUpdate=boolean;uniforms.hemisphereLightDirection.needsUpdate=boolean}function refreshUniformsShadow(uniforms,lights){if(uniforms.shadowMatrix){var j=0;for(var i=0,il=lights.length;i<il;i++){var light=lights[i];if(!light.castShadow)continue;if(light instanceof THREE.SpotLight||light instanceof THREE.DirectionalLight&&!light.shadowCascade){uniforms.shadowMap.value[j]=light.shadowMap;uniforms.shadowMapSize.value[j]=light.shadowMapSize;uniforms.shadowMatrix.value[j]=light.shadowMatrix;uniforms.shadowDarkness.value[j]=light.shadowDarkness;uniforms.shadowBias.value[j]=light.shadowBias;j++}}}}function loadUniformsMatrices(uniforms,object){_gl.uniformMatrix4fv(uniforms.modelViewMatrix,false,object._modelViewMatrix.elements);if(uniforms.normalMatrix){_gl.uniformMatrix3fv(uniforms.normalMatrix,false,object._normalMatrix.elements)}}function getTextureUnit(){var textureUnit=_usedTextureUnits;if(textureUnit>=_maxTextures){console.warn("WebGLRenderer: trying to use "+textureUnit+" texture units while this GPU supports only "+_maxTextures)}_usedTextureUnits+=1;return textureUnit}function loadUniformsGeneric(uniforms){var texture,textureUnit,offset;for(var j=0,jl=uniforms.length;j<jl;j++){var uniform=uniforms[j][0];if(uniform.needsUpdate===false)continue;var type=uniform.type;var value=uniform.value;var location=uniforms[j][1];switch(type){case"1i":_gl.uniform1i(location,value);break;case"1f":_gl.uniform1f(location,value);break;case"2f":_gl.uniform2f(location,value[0],value[1]);break;case"3f":_gl.uniform3f(location,value[0],value[1],value[2]);break;case"4f":_gl.uniform4f(location,value[0],value[1],value[2],value[3]);break;case"1iv":_gl.uniform1iv(location,value);break;case"3iv":_gl.uniform3iv(location,value);break;case"1fv":_gl.uniform1fv(location,value);break;case"2fv":_gl.uniform2fv(location,value);break;case"3fv":_gl.uniform3fv(location,value);break;case"4fv":_gl.uniform4fv(location,value);break;case"Matrix3fv":_gl.uniformMatrix3fv(location,false,value);break;case"Matrix4fv":_gl.uniformMatrix4fv(location,false,value);break;case"i":_gl.uniform1i(location,value);break;case"f":_gl.uniform1f(location,value);break;case"v2":_gl.uniform2f(location,value.x,value.y);break;case"v3":_gl.uniform3f(location,value.x,value.y,value.z);break;case"v4":_gl.uniform4f(location,value.x,value.y,value.z,value.w);break;case"c":_gl.uniform3f(location,value.r,value.g,value.b);break;case"iv1":_gl.uniform1iv(location,value);break;case"iv":_gl.uniform3iv(location,value);break;case"fv1":_gl.uniform1fv(location,value);break;case"fv":_gl.uniform3fv(location,value);break;case"v2v":if(uniform._array===undefined){uniform._array=new Float32Array(2*value.length)}for(var i=0,il=value.length;i<il;i++){offset=i*2;uniform._array[offset]=value[i].x;uniform._array[offset+1]=value[i].y}_gl.uniform2fv(location,uniform._array);break;case"v3v":if(uniform._array===undefined){uniform._array=new Float32Array(3*value.length)}for(var i=0,il=value.length;i<il;i++){offset=i*3;uniform._array[offset]=value[i].x;uniform._array[offset+1]=value[i].y;uniform._array[offset+2]=value[i].z}_gl.uniform3fv(location,uniform._array);break;case"v4v":if(uniform._array===undefined){uniform._array=new Float32Array(4*value.length)}for(var i=0,il=value.length;i<il;i++){offset=i*4;uniform._array[offset]=value[i].x;uniform._array[offset+1]=value[i].y;uniform._array[offset+2]=value[i].z;uniform._array[offset+3]=value[i].w}_gl.uniform4fv(location,uniform._array);break;case"m3":_gl.uniformMatrix3fv(location,false,value.elements);break;case"m3v":if(uniform._array===undefined){uniform._array=new Float32Array(9*value.length)}for(var i=0,il=value.length;i<il;i++){value[i].flattenToArrayOffset(uniform._array,i*9)}_gl.uniformMatrix3fv(location,false,uniform._array);break;case"m4":_gl.uniformMatrix4fv(location,false,value.elements);break;case"m4v":if(uniform._array===undefined){uniform._array=new Float32Array(16*value.length)}for(var i=0,il=value.length;i<il;i++){value[i].flattenToArrayOffset(uniform._array,i*16)}_gl.uniformMatrix4fv(location,false,uniform._array);break;case"t":texture=value;textureUnit=getTextureUnit();_gl.uniform1i(location,textureUnit);if(!texture)continue;if(texture instanceof THREE.CubeTexture||texture.image instanceof Array&&texture.image.length===6){setCubeTexture(texture,textureUnit)}else if(texture instanceof THREE.WebGLRenderTargetCube){setCubeTextureDynamic(texture,textureUnit)}else{_this.setTexture(texture,textureUnit)}break;case"tv":if(uniform._array===undefined){uniform._array=[]}for(var i=0,il=uniform.value.length;i<il;i++){uniform._array[i]=getTextureUnit()}_gl.uniform1iv(location,uniform._array);for(var i=0,il=uniform.value.length;i<il;i++){texture=uniform.value[i];textureUnit=uniform._array[i];if(!texture)continue;_this.setTexture(texture,textureUnit)}break;default:console.warn("THREE.WebGLRenderer: Unknown uniform type: "+type)}}}function setupMatrices(object,camera){object._modelViewMatrix.multiplyMatrices(camera.matrixWorldInverse,object.matrixWorld);object._normalMatrix.getNormalMatrix(object._modelViewMatrix)}function setColorGamma(array,offset,color,intensitySq){array[offset]=color.r*color.r*intensitySq;array[offset+1]=color.g*color.g*intensitySq;array[offset+2]=color.b*color.b*intensitySq}function setColorLinear(array,offset,color,intensity){array[offset]=color.r*intensity;array[offset+1]=color.g*intensity;array[offset+2]=color.b*intensity}function setupLights(lights){var l,ll,light,n,r=0,g=0,b=0,color,skyColor,groundColor,intensity,intensitySq,position,distance,zlights=_lights,dirColors=zlights.directional.colors,dirPositions=zlights.directional.positions,pointColors=zlights.point.colors,pointPositions=zlights.point.positions,pointDistances=zlights.point.distances,spotColors=zlights.spot.colors,spotPositions=zlights.spot.positions,spotDistances=zlights.spot.distances,spotDirections=zlights.spot.directions,spotAnglesCos=zlights.spot.anglesCos,spotExponents=zlights.spot.exponents,hemiSkyColors=zlights.hemi.skyColors,hemiGroundColors=zlights.hemi.groundColors,hemiPositions=zlights.hemi.positions,dirLength=0,pointLength=0,spotLength=0,hemiLength=0,dirCount=0,pointCount=0,spotCount=0,hemiCount=0,dirOffset=0,pointOffset=0,spotOffset=0,hemiOffset=0;for(l=0,ll=lights.length;l<ll;l++){light=lights[l];if(light.onlyShadow)continue;color=light.color;intensity=light.intensity;distance=light.distance;if(light instanceof THREE.AmbientLight){if(!light.visible)continue;if(_this.gammaInput){r+=color.r*color.r;g+=color.g*color.g;b+=color.b*color.b}else{r+=color.r;g+=color.g;b+=color.b}}else if(light instanceof THREE.DirectionalLight){dirCount+=1;if(!light.visible)continue;_direction.setFromMatrixPosition(light.matrixWorld);_vector3.setFromMatrixPosition(light.target.matrixWorld);_direction.sub(_vector3);_direction.normalize();dirOffset=dirLength*3;dirPositions[dirOffset]=_direction.x;dirPositions[dirOffset+1]=_direction.y;dirPositions[dirOffset+2]=_direction.z;if(_this.gammaInput){setColorGamma(dirColors,dirOffset,color,intensity*intensity)}else{setColorLinear(dirColors,dirOffset,color,intensity)}dirLength+=1}else if(light instanceof THREE.PointLight){pointCount+=1;if(!light.visible)continue;pointOffset=pointLength*3;if(_this.gammaInput){setColorGamma(pointColors,pointOffset,color,intensity*intensity)}else{setColorLinear(pointColors,pointOffset,color,intensity)}_vector3.setFromMatrixPosition(light.matrixWorld);pointPositions[pointOffset]=_vector3.x;pointPositions[pointOffset+1]=_vector3.y;pointPositions[pointOffset+2]=_vector3.z;pointDistances[pointLength]=distance;pointLength+=1}else if(light instanceof THREE.SpotLight){spotCount+=1;if(!light.visible)continue;spotOffset=spotLength*3;if(_this.gammaInput){setColorGamma(spotColors,spotOffset,color,intensity*intensity)}else{setColorLinear(spotColors,spotOffset,color,intensity)}_direction.setFromMatrixPosition(light.matrixWorld);spotPositions[spotOffset]=_direction.x;spotPositions[spotOffset+1]=_direction.y;spotPositions[spotOffset+2]=_direction.z;spotDistances[spotLength]=distance;_vector3.setFromMatrixPosition(light.target.matrixWorld);_direction.sub(_vector3);_direction.normalize();spotDirections[spotOffset]=_direction.x;spotDirections[spotOffset+1]=_direction.y;spotDirections[spotOffset+2]=_direction.z;spotAnglesCos[spotLength]=Math.cos(light.angle);spotExponents[spotLength]=light.exponent;spotLength+=1}else if(light instanceof THREE.HemisphereLight){hemiCount+=1;if(!light.visible)continue;_direction.setFromMatrixPosition(light.matrixWorld);_direction.normalize();hemiOffset=hemiLength*3;hemiPositions[hemiOffset]=_direction.x;hemiPositions[hemiOffset+1]=_direction.y;hemiPositions[hemiOffset+2]=_direction.z;skyColor=light.color;groundColor=light.groundColor;if(_this.gammaInput){intensitySq=intensity*intensity;setColorGamma(hemiSkyColors,hemiOffset,skyColor,intensitySq);setColorGamma(hemiGroundColors,hemiOffset,groundColor,intensitySq)}else{setColorLinear(hemiSkyColors,hemiOffset,skyColor,intensity);setColorLinear(hemiGroundColors,hemiOffset,groundColor,intensity)}hemiLength+=1}}for(l=dirLength*3,ll=Math.max(dirColors.length,dirCount*3);l<ll;l++)dirColors[l]=0;for(l=pointLength*3,ll=Math.max(pointColors.length,pointCount*3);l<ll;l++)pointColors[l]=0;for(l=spotLength*3,ll=Math.max(spotColors.length,spotCount*3);l<ll;l++)spotColors[l]=0;for(l=hemiLength*3,ll=Math.max(hemiSkyColors.length,hemiCount*3);l<ll;l++)hemiSkyColors[l]=0;for(l=hemiLength*3,ll=Math.max(hemiGroundColors.length,hemiCount*3);l<ll;l++)hemiGroundColors[l]=0;zlights.directional.length=dirLength;zlights.point.length=pointLength;zlights.spot.length=spotLength;zlights.hemi.length=hemiLength;zlights.ambient[0]=r;zlights.ambient[1]=g;zlights.ambient[2]=b}this.setFaceCulling=function(cullFace,frontFaceDirection){if(cullFace===THREE.CullFaceNone){_gl.disable(_gl.CULL_FACE)}else{if(frontFaceDirection===THREE.FrontFaceDirectionCW){_gl.frontFace(_gl.CW)}else{_gl.frontFace(_gl.CCW)}if(cullFace===THREE.CullFaceBack){_gl.cullFace(_gl.BACK)}else if(cullFace===THREE.CullFaceFront){_gl.cullFace(_gl.FRONT)}else{_gl.cullFace(_gl.FRONT_AND_BACK)}_gl.enable(_gl.CULL_FACE)}};this.setMaterialFaces=function(material){var doubleSided=material.side===THREE.DoubleSide;var flipSided=material.side===THREE.BackSide;if(_oldDoubleSided!==doubleSided){if(doubleSided){_gl.disable(_gl.CULL_FACE)}else{_gl.enable(_gl.CULL_FACE)}_oldDoubleSided=doubleSided}if(_oldFlipSided!==flipSided){if(flipSided){_gl.frontFace(_gl.CW)}else{_gl.frontFace(_gl.CCW)}_oldFlipSided=flipSided}};this.setDepthTest=function(depthTest){if(_oldDepthTest!==depthTest){if(depthTest){_gl.enable(_gl.DEPTH_TEST)}else{_gl.disable(_gl.DEPTH_TEST)}_oldDepthTest=depthTest}};this.setDepthWrite=function(depthWrite){if(_oldDepthWrite!==depthWrite){_gl.depthMask(depthWrite);_oldDepthWrite=depthWrite}};function setLineWidth(width){if(width!==_oldLineWidth){_gl.lineWidth(width);_oldLineWidth=width}}function setPolygonOffset(polygonoffset,factor,units){if(_oldPolygonOffset!==polygonoffset){if(polygonoffset){_gl.enable(_gl.POLYGON_OFFSET_FILL)}else{_gl.disable(_gl.POLYGON_OFFSET_FILL)}_oldPolygonOffset=polygonoffset}if(polygonoffset&&(_oldPolygonOffsetFactor!==factor||_oldPolygonOffsetUnits!==units)){_gl.polygonOffset(factor,units);_oldPolygonOffsetFactor=factor;_oldPolygonOffsetUnits=units}}this.setBlending=function(blending,blendEquation,blendSrc,blendDst){if(blending!==_oldBlending){if(blending===THREE.NoBlending){_gl.disable(_gl.BLEND)}else if(blending===THREE.AdditiveBlending){_gl.enable(_gl.BLEND);_gl.blendEquation(_gl.FUNC_ADD);_gl.blendFunc(_gl.SRC_ALPHA,_gl.ONE)}else if(blending===THREE.SubtractiveBlending){_gl.enable(_gl.BLEND);_gl.blendEquation(_gl.FUNC_ADD);_gl.blendFunc(_gl.ZERO,_gl.ONE_MINUS_SRC_COLOR)}else if(blending===THREE.MultiplyBlending){_gl.enable(_gl.BLEND);_gl.blendEquation(_gl.FUNC_ADD);_gl.blendFunc(_gl.ZERO,_gl.SRC_COLOR)}else if(blending===THREE.CustomBlending){_gl.enable(_gl.BLEND)}else{_gl.enable(_gl.BLEND);_gl.blendEquationSeparate(_gl.FUNC_ADD,_gl.FUNC_ADD);_gl.blendFuncSeparate(_gl.SRC_ALPHA,_gl.ONE_MINUS_SRC_ALPHA,_gl.ONE,_gl.ONE_MINUS_SRC_ALPHA)}_oldBlending=blending}if(blending===THREE.CustomBlending){if(blendEquation!==_oldBlendEquation){_gl.blendEquation(paramThreeToGL(blendEquation));_oldBlendEquation=blendEquation}if(blendSrc!==_oldBlendSrc||blendDst!==_oldBlendDst){_gl.blendFunc(paramThreeToGL(blendSrc),paramThreeToGL(blendDst));_oldBlendSrc=blendSrc;_oldBlendDst=blendDst}}else{_oldBlendEquation=null;_oldBlendSrc=null;_oldBlendDst=null}};function setTextureParameters(textureType,texture,isImagePowerOfTwo){var extension;if(isImagePowerOfTwo){_gl.texParameteri(textureType,_gl.TEXTURE_WRAP_S,paramThreeToGL(texture.wrapS));_gl.texParameteri(textureType,_gl.TEXTURE_WRAP_T,paramThreeToGL(texture.wrapT));_gl.texParameteri(textureType,_gl.TEXTURE_MAG_FILTER,paramThreeToGL(texture.magFilter));_gl.texParameteri(textureType,_gl.TEXTURE_MIN_FILTER,paramThreeToGL(texture.minFilter))}else{_gl.texParameteri(textureType,_gl.TEXTURE_WRAP_S,_gl.CLAMP_TO_EDGE);
_gl.texParameteri(textureType,_gl.TEXTURE_WRAP_T,_gl.CLAMP_TO_EDGE);_gl.texParameteri(textureType,_gl.TEXTURE_MAG_FILTER,filterFallback(texture.magFilter));_gl.texParameteri(textureType,_gl.TEXTURE_MIN_FILTER,filterFallback(texture.minFilter))}extension=extensions.get("EXT_texture_filter_anisotropic");if(extension&&texture.type!==THREE.FloatType){if(texture.anisotropy>1||texture.__oldAnisotropy){_gl.texParameterf(textureType,extension.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(texture.anisotropy,_this.getMaxAnisotropy()));texture.__oldAnisotropy=texture.anisotropy}}}this.uploadTexture=function(texture){if(texture.__webglInit===undefined){texture.__webglInit=true;texture.addEventListener("dispose",onTextureDispose);texture.__webglTexture=_gl.createTexture();_this.info.memory.textures++}_gl.bindTexture(_gl.TEXTURE_2D,texture.__webglTexture);_gl.pixelStorei(_gl.UNPACK_FLIP_Y_WEBGL,texture.flipY);_gl.pixelStorei(_gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,texture.premultiplyAlpha);_gl.pixelStorei(_gl.UNPACK_ALIGNMENT,texture.unpackAlignment);texture.image=clampToMaxSize(texture.image,_maxTextureSize);var image=texture.image,isImagePowerOfTwo=THREE.Math.isPowerOfTwo(image.width)&&THREE.Math.isPowerOfTwo(image.height),glFormat=paramThreeToGL(texture.format),glType=paramThreeToGL(texture.type);setTextureParameters(_gl.TEXTURE_2D,texture,isImagePowerOfTwo);var mipmap,mipmaps=texture.mipmaps;if(texture instanceof THREE.DataTexture){if(mipmaps.length>0&&isImagePowerOfTwo){for(var i=0,il=mipmaps.length;i<il;i++){mipmap=mipmaps[i];_gl.texImage2D(_gl.TEXTURE_2D,i,glFormat,mipmap.width,mipmap.height,0,glFormat,glType,mipmap.data)}texture.generateMipmaps=false}else{_gl.texImage2D(_gl.TEXTURE_2D,0,glFormat,image.width,image.height,0,glFormat,glType,image.data)}}else if(texture instanceof THREE.CompressedTexture){for(var i=0,il=mipmaps.length;i<il;i++){mipmap=mipmaps[i];if(texture.format!==THREE.RGBAFormat&&texture.format!==THREE.RGBFormat){if(getCompressedTextureFormats().indexOf(glFormat)>-1){_gl.compressedTexImage2D(_gl.TEXTURE_2D,i,glFormat,mipmap.width,mipmap.height,0,mipmap.data)}else{console.warn("Attempt to load unsupported compressed texture format")}}else{_gl.texImage2D(_gl.TEXTURE_2D,i,glFormat,mipmap.width,mipmap.height,0,glFormat,glType,mipmap.data)}}}else{if(mipmaps.length>0&&isImagePowerOfTwo){for(var i=0,il=mipmaps.length;i<il;i++){mipmap=mipmaps[i];_gl.texImage2D(_gl.TEXTURE_2D,i,glFormat,glFormat,glType,mipmap)}texture.generateMipmaps=false}else{_gl.texImage2D(_gl.TEXTURE_2D,0,glFormat,glFormat,glType,texture.image)}}if(texture.generateMipmaps&&isImagePowerOfTwo)_gl.generateMipmap(_gl.TEXTURE_2D);texture.needsUpdate=false;if(texture.onUpdate)texture.onUpdate()};this.setTexture=function(texture,slot){_gl.activeTexture(_gl.TEXTURE0+slot);if(texture.needsUpdate){_this.uploadTexture(texture)}else{_gl.bindTexture(_gl.TEXTURE_2D,texture.__webglTexture)}};function clampToMaxSize(image,maxSize){if(image.width>maxSize||image.height>maxSize){var scale=maxSize/Math.max(image.width,image.height);var canvas=document.createElement("canvas");canvas.width=Math.floor(image.width*scale);canvas.height=Math.floor(image.height*scale);var context=canvas.getContext("2d");context.drawImage(image,0,0,image.width,image.height,0,0,canvas.width,canvas.height);console.log("THREE.WebGLRenderer:",image,"is too big ("+image.width+"x"+image.height+"). Resized to "+canvas.width+"x"+canvas.height+".");return canvas}return image}function setCubeTexture(texture,slot){if(texture.image.length===6){if(texture.needsUpdate){if(!texture.image.__webglTextureCube){texture.addEventListener("dispose",onTextureDispose);texture.image.__webglTextureCube=_gl.createTexture();_this.info.memory.textures++}_gl.activeTexture(_gl.TEXTURE0+slot);_gl.bindTexture(_gl.TEXTURE_CUBE_MAP,texture.image.__webglTextureCube);_gl.pixelStorei(_gl.UNPACK_FLIP_Y_WEBGL,texture.flipY);var isCompressed=texture instanceof THREE.CompressedTexture;var isDataTexture=texture.image[0]instanceof THREE.DataTexture;var cubeImage=[];for(var i=0;i<6;i++){if(_this.autoScaleCubemaps&&!isCompressed&&!isDataTexture){cubeImage[i]=clampToMaxSize(texture.image[i],_maxCubemapSize)}else{cubeImage[i]=isDataTexture?texture.image[i].image:texture.image[i]}}var image=cubeImage[0],isImagePowerOfTwo=THREE.Math.isPowerOfTwo(image.width)&&THREE.Math.isPowerOfTwo(image.height),glFormat=paramThreeToGL(texture.format),glType=paramThreeToGL(texture.type);setTextureParameters(_gl.TEXTURE_CUBE_MAP,texture,isImagePowerOfTwo);for(var i=0;i<6;i++){if(!isCompressed){if(isDataTexture){_gl.texImage2D(_gl.TEXTURE_CUBE_MAP_POSITIVE_X+i,0,glFormat,cubeImage[i].width,cubeImage[i].height,0,glFormat,glType,cubeImage[i].data)}else{_gl.texImage2D(_gl.TEXTURE_CUBE_MAP_POSITIVE_X+i,0,glFormat,glFormat,glType,cubeImage[i])}}else{var mipmap,mipmaps=cubeImage[i].mipmaps;for(var j=0,jl=mipmaps.length;j<jl;j++){mipmap=mipmaps[j];if(texture.format!==THREE.RGBAFormat&&texture.format!==THREE.RGBFormat){if(getCompressedTextureFormats().indexOf(glFormat)>-1){_gl.compressedTexImage2D(_gl.TEXTURE_CUBE_MAP_POSITIVE_X+i,j,glFormat,mipmap.width,mipmap.height,0,mipmap.data)}else{console.warn("Attempt to load unsupported compressed texture format")}}else{_gl.texImage2D(_gl.TEXTURE_CUBE_MAP_POSITIVE_X+i,j,glFormat,mipmap.width,mipmap.height,0,glFormat,glType,mipmap.data)}}}}if(texture.generateMipmaps&&isImagePowerOfTwo){_gl.generateMipmap(_gl.TEXTURE_CUBE_MAP)}texture.needsUpdate=false;if(texture.onUpdate)texture.onUpdate()}else{_gl.activeTexture(_gl.TEXTURE0+slot);_gl.bindTexture(_gl.TEXTURE_CUBE_MAP,texture.image.__webglTextureCube)}}}function setCubeTextureDynamic(texture,slot){_gl.activeTexture(_gl.TEXTURE0+slot);_gl.bindTexture(_gl.TEXTURE_CUBE_MAP,texture.__webglTexture)}function setupFrameBuffer(framebuffer,renderTarget,textureTarget){_gl.bindFramebuffer(_gl.FRAMEBUFFER,framebuffer);_gl.framebufferTexture2D(_gl.FRAMEBUFFER,_gl.COLOR_ATTACHMENT0,textureTarget,renderTarget.__webglTexture,0)}function setupRenderBuffer(renderbuffer,renderTarget){_gl.bindRenderbuffer(_gl.RENDERBUFFER,renderbuffer);if(renderTarget.depthBuffer&&!renderTarget.stencilBuffer){_gl.renderbufferStorage(_gl.RENDERBUFFER,_gl.DEPTH_COMPONENT16,renderTarget.width,renderTarget.height);_gl.framebufferRenderbuffer(_gl.FRAMEBUFFER,_gl.DEPTH_ATTACHMENT,_gl.RENDERBUFFER,renderbuffer)}else if(renderTarget.depthBuffer&&renderTarget.stencilBuffer){_gl.renderbufferStorage(_gl.RENDERBUFFER,_gl.DEPTH_STENCIL,renderTarget.width,renderTarget.height);_gl.framebufferRenderbuffer(_gl.FRAMEBUFFER,_gl.DEPTH_STENCIL_ATTACHMENT,_gl.RENDERBUFFER,renderbuffer)}else{_gl.renderbufferStorage(_gl.RENDERBUFFER,_gl.RGBA4,renderTarget.width,renderTarget.height)}}this.setRenderTarget=function(renderTarget){var isCube=renderTarget instanceof THREE.WebGLRenderTargetCube;if(renderTarget&&renderTarget.__webglFramebuffer===undefined){if(renderTarget.depthBuffer===undefined)renderTarget.depthBuffer=true;if(renderTarget.stencilBuffer===undefined)renderTarget.stencilBuffer=true;renderTarget.addEventListener("dispose",onRenderTargetDispose);renderTarget.__webglTexture=_gl.createTexture();_this.info.memory.textures++;var isTargetPowerOfTwo=THREE.Math.isPowerOfTwo(renderTarget.width)&&THREE.Math.isPowerOfTwo(renderTarget.height),glFormat=paramThreeToGL(renderTarget.format),glType=paramThreeToGL(renderTarget.type);if(isCube){renderTarget.__webglFramebuffer=[];renderTarget.__webglRenderbuffer=[];_gl.bindTexture(_gl.TEXTURE_CUBE_MAP,renderTarget.__webglTexture);setTextureParameters(_gl.TEXTURE_CUBE_MAP,renderTarget,isTargetPowerOfTwo);for(var i=0;i<6;i++){renderTarget.__webglFramebuffer[i]=_gl.createFramebuffer();renderTarget.__webglRenderbuffer[i]=_gl.createRenderbuffer();_gl.texImage2D(_gl.TEXTURE_CUBE_MAP_POSITIVE_X+i,0,glFormat,renderTarget.width,renderTarget.height,0,glFormat,glType,null);setupFrameBuffer(renderTarget.__webglFramebuffer[i],renderTarget,_gl.TEXTURE_CUBE_MAP_POSITIVE_X+i);setupRenderBuffer(renderTarget.__webglRenderbuffer[i],renderTarget)}if(isTargetPowerOfTwo)_gl.generateMipmap(_gl.TEXTURE_CUBE_MAP)}else{renderTarget.__webglFramebuffer=_gl.createFramebuffer();if(renderTarget.shareDepthFrom){renderTarget.__webglRenderbuffer=renderTarget.shareDepthFrom.__webglRenderbuffer}else{renderTarget.__webglRenderbuffer=_gl.createRenderbuffer()}_gl.bindTexture(_gl.TEXTURE_2D,renderTarget.__webglTexture);setTextureParameters(_gl.TEXTURE_2D,renderTarget,isTargetPowerOfTwo);_gl.texImage2D(_gl.TEXTURE_2D,0,glFormat,renderTarget.width,renderTarget.height,0,glFormat,glType,null);setupFrameBuffer(renderTarget.__webglFramebuffer,renderTarget,_gl.TEXTURE_2D);if(renderTarget.shareDepthFrom){if(renderTarget.depthBuffer&&!renderTarget.stencilBuffer){_gl.framebufferRenderbuffer(_gl.FRAMEBUFFER,_gl.DEPTH_ATTACHMENT,_gl.RENDERBUFFER,renderTarget.__webglRenderbuffer)}else if(renderTarget.depthBuffer&&renderTarget.stencilBuffer){_gl.framebufferRenderbuffer(_gl.FRAMEBUFFER,_gl.DEPTH_STENCIL_ATTACHMENT,_gl.RENDERBUFFER,renderTarget.__webglRenderbuffer)}}else{setupRenderBuffer(renderTarget.__webglRenderbuffer,renderTarget)}if(isTargetPowerOfTwo)_gl.generateMipmap(_gl.TEXTURE_2D)}if(isCube){_gl.bindTexture(_gl.TEXTURE_CUBE_MAP,null)}else{_gl.bindTexture(_gl.TEXTURE_2D,null)}_gl.bindRenderbuffer(_gl.RENDERBUFFER,null);_gl.bindFramebuffer(_gl.FRAMEBUFFER,null)}var framebuffer,width,height,vx,vy;if(renderTarget){if(isCube){framebuffer=renderTarget.__webglFramebuffer[renderTarget.activeCubeFace]}else{framebuffer=renderTarget.__webglFramebuffer}width=renderTarget.width;height=renderTarget.height;vx=0;vy=0}else{framebuffer=null;width=_viewportWidth;height=_viewportHeight;vx=_viewportX;vy=_viewportY}if(framebuffer!==_currentFramebuffer){_gl.bindFramebuffer(_gl.FRAMEBUFFER,framebuffer);_gl.viewport(vx,vy,width,height);_currentFramebuffer=framebuffer}_currentWidth=width;_currentHeight=height};function updateRenderTargetMipmap(renderTarget){if(renderTarget instanceof THREE.WebGLRenderTargetCube){_gl.bindTexture(_gl.TEXTURE_CUBE_MAP,renderTarget.__webglTexture);_gl.generateMipmap(_gl.TEXTURE_CUBE_MAP);_gl.bindTexture(_gl.TEXTURE_CUBE_MAP,null)}else{_gl.bindTexture(_gl.TEXTURE_2D,renderTarget.__webglTexture);_gl.generateMipmap(_gl.TEXTURE_2D);_gl.bindTexture(_gl.TEXTURE_2D,null)}}function filterFallback(f){if(f===THREE.NearestFilter||f===THREE.NearestMipMapNearestFilter||f===THREE.NearestMipMapLinearFilter){return _gl.NEAREST}return _gl.LINEAR}function paramThreeToGL(p){var extension;if(p===THREE.RepeatWrapping)return _gl.REPEAT;if(p===THREE.ClampToEdgeWrapping)return _gl.CLAMP_TO_EDGE;if(p===THREE.MirroredRepeatWrapping)return _gl.MIRRORED_REPEAT;if(p===THREE.NearestFilter)return _gl.NEAREST;if(p===THREE.NearestMipMapNearestFilter)return _gl.NEAREST_MIPMAP_NEAREST;if(p===THREE.NearestMipMapLinearFilter)return _gl.NEAREST_MIPMAP_LINEAR;if(p===THREE.LinearFilter)return _gl.LINEAR;if(p===THREE.LinearMipMapNearestFilter)return _gl.LINEAR_MIPMAP_NEAREST;if(p===THREE.LinearMipMapLinearFilter)return _gl.LINEAR_MIPMAP_LINEAR;if(p===THREE.UnsignedByteType)return _gl.UNSIGNED_BYTE;if(p===THREE.UnsignedShort4444Type)return _gl.UNSIGNED_SHORT_4_4_4_4;if(p===THREE.UnsignedShort5551Type)return _gl.UNSIGNED_SHORT_5_5_5_1;if(p===THREE.UnsignedShort565Type)return _gl.UNSIGNED_SHORT_5_6_5;if(p===THREE.ByteType)return _gl.BYTE;if(p===THREE.ShortType)return _gl.SHORT;if(p===THREE.UnsignedShortType)return _gl.UNSIGNED_SHORT;if(p===THREE.IntType)return _gl.INT;if(p===THREE.UnsignedIntType)return _gl.UNSIGNED_INT;if(p===THREE.FloatType)return _gl.FLOAT;if(p===THREE.AlphaFormat)return _gl.ALPHA;if(p===THREE.RGBFormat)return _gl.RGB;if(p===THREE.RGBAFormat)return _gl.RGBA;if(p===THREE.LuminanceFormat)return _gl.LUMINANCE;if(p===THREE.LuminanceAlphaFormat)return _gl.LUMINANCE_ALPHA;if(p===THREE.AddEquation)return _gl.FUNC_ADD;if(p===THREE.SubtractEquation)return _gl.FUNC_SUBTRACT;if(p===THREE.ReverseSubtractEquation)return _gl.FUNC_REVERSE_SUBTRACT;if(p===THREE.ZeroFactor)return _gl.ZERO;if(p===THREE.OneFactor)return _gl.ONE;if(p===THREE.SrcColorFactor)return _gl.SRC_COLOR;if(p===THREE.OneMinusSrcColorFactor)return _gl.ONE_MINUS_SRC_COLOR;if(p===THREE.SrcAlphaFactor)return _gl.SRC_ALPHA;if(p===THREE.OneMinusSrcAlphaFactor)return _gl.ONE_MINUS_SRC_ALPHA;if(p===THREE.DstAlphaFactor)return _gl.DST_ALPHA;if(p===THREE.OneMinusDstAlphaFactor)return _gl.ONE_MINUS_DST_ALPHA;if(p===THREE.DstColorFactor)return _gl.DST_COLOR;if(p===THREE.OneMinusDstColorFactor)return _gl.ONE_MINUS_DST_COLOR;if(p===THREE.SrcAlphaSaturateFactor)return _gl.SRC_ALPHA_SATURATE;extension=extensions.get("WEBGL_compressed_texture_s3tc");if(extension!==null){if(p===THREE.RGB_S3TC_DXT1_Format)return extension.COMPRESSED_RGB_S3TC_DXT1_EXT;if(p===THREE.RGBA_S3TC_DXT1_Format)return extension.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(p===THREE.RGBA_S3TC_DXT3_Format)return extension.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(p===THREE.RGBA_S3TC_DXT5_Format)return extension.COMPRESSED_RGBA_S3TC_DXT5_EXT}extension=extensions.get("WEBGL_compressed_texture_pvrtc");if(extension!==null){if(p===THREE.RGB_PVRTC_4BPPV1_Format)return extension.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(p===THREE.RGB_PVRTC_2BPPV1_Format)return extension.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(p===THREE.RGBA_PVRTC_4BPPV1_Format)return extension.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(p===THREE.RGBA_PVRTC_2BPPV1_Format)return extension.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}extension=extensions.get("EXT_blend_minmax");if(extension!==null){if(p===THREE.MinEquation)return extension.MIN_EXT;if(p===THREE.MaxEquation)return extension.MAX_EXT}return 0}function allocateBones(object){if(_supportsBoneTextures&&object&&object.skeleton&&object.skeleton.useVertexTexture){return 1024}else{var nVertexUniforms=_gl.getParameter(_gl.MAX_VERTEX_UNIFORM_VECTORS);var nVertexMatrices=Math.floor((nVertexUniforms-20)/4);var maxBones=nVertexMatrices;if(object!==undefined&&object instanceof THREE.SkinnedMesh){maxBones=Math.min(object.skeleton.bones.length,maxBones);if(maxBones<object.skeleton.bones.length){console.warn("WebGLRenderer: too many bones - "+object.skeleton.bones.length+", this GPU supports just "+maxBones+" (try OpenGL instead of ANGLE)")}}return maxBones}}function allocateLights(lights){var dirLights=0;var pointLights=0;var spotLights=0;var hemiLights=0;for(var l=0,ll=lights.length;l<ll;l++){var light=lights[l];if(light.onlyShadow||light.visible===false)continue;if(light instanceof THREE.DirectionalLight)dirLights++;if(light instanceof THREE.PointLight)pointLights++;if(light instanceof THREE.SpotLight)spotLights++;if(light instanceof THREE.HemisphereLight)hemiLights++}return{directional:dirLights,point:pointLights,spot:spotLights,hemi:hemiLights}}function allocateShadows(lights){var maxShadows=0;for(var l=0,ll=lights.length;l<ll;l++){var light=lights[l];if(!light.castShadow)continue;if(light instanceof THREE.SpotLight)maxShadows++;if(light instanceof THREE.DirectionalLight&&!light.shadowCascade)maxShadows++}return maxShadows}this.initMaterial=function(){console.warn("THREE.WebGLRenderer: .initMaterial() has been removed.")};this.addPrePlugin=function(){console.warn("THREE.WebGLRenderer: .addPrePlugin() has been removed.")};this.addPostPlugin=function(){console.warn("THREE.WebGLRenderer: .addPostPlugin() has been removed.")};this.updateShadowMap=function(){console.warn("THREE.WebGLRenderer: .updateShadowMap() has been removed.")}};THREE.WebGLRenderTarget=function(width,height,options){this.width=width;this.height=height;options=options||{};this.wrapS=options.wrapS!==undefined?options.wrapS:THREE.ClampToEdgeWrapping;this.wrapT=options.wrapT!==undefined?options.wrapT:THREE.ClampToEdgeWrapping;this.magFilter=options.magFilter!==undefined?options.magFilter:THREE.LinearFilter;this.minFilter=options.minFilter!==undefined?options.minFilter:THREE.LinearMipMapLinearFilter;this.anisotropy=options.anisotropy!==undefined?options.anisotropy:1;this.offset=new THREE.Vector2(0,0);this.repeat=new THREE.Vector2(1,1);this.format=options.format!==undefined?options.format:THREE.RGBAFormat;this.type=options.type!==undefined?options.type:THREE.UnsignedByteType;this.depthBuffer=options.depthBuffer!==undefined?options.depthBuffer:true;this.stencilBuffer=options.stencilBuffer!==undefined?options.stencilBuffer:true;this.generateMipmaps=true;this.shareDepthFrom=null};THREE.WebGLRenderTarget.prototype={constructor:THREE.WebGLRenderTarget,setSize:function(width,height){this.width=width;this.height=height},clone:function(){var tmp=new THREE.WebGLRenderTarget(this.width,this.height);tmp.wrapS=this.wrapS;tmp.wrapT=this.wrapT;tmp.magFilter=this.magFilter;tmp.minFilter=this.minFilter;tmp.anisotropy=this.anisotropy;tmp.offset.copy(this.offset);tmp.repeat.copy(this.repeat);tmp.format=this.format;tmp.type=this.type;tmp.depthBuffer=this.depthBuffer;tmp.stencilBuffer=this.stencilBuffer;tmp.generateMipmaps=this.generateMipmaps;tmp.shareDepthFrom=this.shareDepthFrom;return tmp},dispose:function(){this.dispatchEvent({type:"dispose"})}};THREE.EventDispatcher.prototype.apply(THREE.WebGLRenderTarget.prototype);THREE.WebGLRenderTargetCube=function(width,height,options){THREE.WebGLRenderTarget.call(this,width,height,options);this.activeCubeFace=0};THREE.WebGLRenderTargetCube.prototype=Object.create(THREE.WebGLRenderTarget.prototype);THREE.WebGLExtensions=function(gl){var extensions={};this.get=function(name){if(extensions[name]!==undefined){return extensions[name]}var extension;switch(name){case"OES_texture_float":extension=gl.getExtension("OES_texture_float");break;case"OES_texture_float_linear":extension=gl.getExtension("OES_texture_float_linear");break;case"OES_standard_derivatives":extension=gl.getExtension("OES_standard_derivatives");break;case"EXT_texture_filter_anisotropic":extension=gl.getExtension("EXT_texture_filter_anisotropic")||gl.getExtension("MOZ_EXT_texture_filter_anisotropic")||gl.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":extension=gl.getExtension("WEBGL_compressed_texture_s3tc")||gl.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||gl.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":extension=gl.getExtension("WEBGL_compressed_texture_pvrtc")||gl.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;case"OES_element_index_uint":extension=gl.getExtension("OES_element_index_uint");break;case"EXT_blend_minmax":extension=gl.getExtension("EXT_blend_minmax");break;case"EXT_frag_depth":extension=gl.getExtension("EXT_frag_depth");break}if(extension===null){console.log("THREE.WebGLRenderer: "+name+" extension not supported.")}extensions[name]=extension;return extension}};THREE.WebGLProgram=function(){var programIdCount=0;var generateDefines=function(defines){var value,chunk,chunks=[];for(var d in defines){value=defines[d];if(value===false)continue;chunk="#define "+d+" "+value;chunks.push(chunk)}return chunks.join("\n")};var cacheUniformLocations=function(gl,program,identifiers){var uniforms={};for(var i=0,l=identifiers.length;i<l;i++){var id=identifiers[i];uniforms[id]=gl.getUniformLocation(program,id)}return uniforms};var cacheAttributeLocations=function(gl,program,identifiers){var attributes={};for(var i=0,l=identifiers.length;i<l;i++){var id=identifiers[i];attributes[id]=gl.getAttribLocation(program,id)}return attributes};return function(renderer,code,material,parameters){var _this=renderer;var _gl=_this.context;var defines=material.defines;var uniforms=material.__webglShader.uniforms;var attributes=material.attributes;var vertexShader=material.__webglShader.vertexShader;var fragmentShader=material.__webglShader.fragmentShader;var index0AttributeName=material.index0AttributeName;if(index0AttributeName===undefined&&parameters.morphTargets===true){index0AttributeName="position"}var shadowMapTypeDefine="SHADOWMAP_TYPE_BASIC";if(parameters.shadowMapType===THREE.PCFShadowMap){shadowMapTypeDefine="SHADOWMAP_TYPE_PCF"}else if(parameters.shadowMapType===THREE.PCFSoftShadowMap){shadowMapTypeDefine="SHADOWMAP_TYPE_PCF_SOFT"}var customDefines=generateDefines(defines);var program=_gl.createProgram();var prefix_vertex,prefix_fragment;if(material instanceof THREE.RawShaderMaterial){prefix_vertex="";prefix_fragment=""}else{prefix_vertex=["precision "+parameters.precision+" float;","precision "+parameters.precision+" int;",customDefines,parameters.supportsVertexTextures?"#define VERTEX_TEXTURES":"",_this.gammaInput?"#define GAMMA_INPUT":"",_this.gammaOutput?"#define GAMMA_OUTPUT":"","#define MAX_DIR_LIGHTS "+parameters.maxDirLights,"#define MAX_POINT_LIGHTS "+parameters.maxPointLights,"#define MAX_SPOT_LIGHTS "+parameters.maxSpotLights,"#define MAX_HEMI_LIGHTS "+parameters.maxHemiLights,"#define MAX_SHADOWS "+parameters.maxShadows,"#define MAX_BONES "+parameters.maxBones,parameters.map?"#define USE_MAP":"",parameters.envMap?"#define USE_ENVMAP":"",parameters.lightMap?"#define USE_LIGHTMAP":"",parameters.bumpMap?"#define USE_BUMPMAP":"",parameters.normalMap?"#define USE_NORMALMAP":"",parameters.specularMap?"#define USE_SPECULARMAP":"",parameters.alphaMap?"#define USE_ALPHAMAP":"",parameters.vertexColors?"#define USE_COLOR":"",parameters.skinning?"#define USE_SKINNING":"",parameters.useVertexTexture?"#define BONE_TEXTURE":"",parameters.morphTargets?"#define USE_MORPHTARGETS":"",parameters.morphNormals?"#define USE_MORPHNORMALS":"",parameters.wrapAround?"#define WRAP_AROUND":"",parameters.doubleSided?"#define DOUBLE_SIDED":"",parameters.flipSided?"#define FLIP_SIDED":"",parameters.shadowMapEnabled?"#define USE_SHADOWMAP":"",parameters.shadowMapEnabled?"#define "+shadowMapTypeDefine:"",parameters.shadowMapDebug?"#define SHADOWMAP_DEBUG":"",parameters.shadowMapCascade?"#define SHADOWMAP_CASCADE":"",parameters.sizeAttenuation?"#define USE_SIZEATTENUATION":"",parameters.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","attribute vec2 uv2;","#ifdef USE_COLOR","	attribute vec3 color;","#endif","#ifdef USE_MORPHTARGETS","	attribute vec3 morphTarget0;","	attribute vec3 morphTarget1;","	attribute vec3 morphTarget2;","	attribute vec3 morphTarget3;","	#ifdef USE_MORPHNORMALS","		attribute vec3 morphNormal0;","		attribute vec3 morphNormal1;","		attribute vec3 morphNormal2;","		attribute vec3 morphNormal3;","	#else","		attribute vec3 morphTarget4;","		attribute vec3 morphTarget5;","		attribute vec3 morphTarget6;","		attribute vec3 morphTarget7;","	#endif","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif",""].join("\n");prefix_fragment=["precision "+parameters.precision+" float;","precision "+parameters.precision+" int;",parameters.bumpMap||parameters.normalMap?"#extension GL_OES_standard_derivatives : enable":"",customDefines,"#define MAX_DIR_LIGHTS "+parameters.maxDirLights,"#define MAX_POINT_LIGHTS "+parameters.maxPointLights,"#define MAX_SPOT_LIGHTS "+parameters.maxSpotLights,"#define MAX_HEMI_LIGHTS "+parameters.maxHemiLights,"#define MAX_SHADOWS "+parameters.maxShadows,parameters.alphaTest?"#define ALPHATEST "+parameters.alphaTest:"",_this.gammaInput?"#define GAMMA_INPUT":"",_this.gammaOutput?"#define GAMMA_OUTPUT":"",parameters.useFog&&parameters.fog?"#define USE_FOG":"",parameters.useFog&&parameters.fogExp?"#define FOG_EXP2":"",parameters.map?"#define USE_MAP":"",parameters.envMap?"#define USE_ENVMAP":"",parameters.lightMap?"#define USE_LIGHTMAP":"",parameters.bumpMap?"#define USE_BUMPMAP":"",parameters.normalMap?"#define USE_NORMALMAP":"",parameters.specularMap?"#define USE_SPECULARMAP":"",parameters.alphaMap?"#define USE_ALPHAMAP":"",parameters.vertexColors?"#define USE_COLOR":"",parameters.metal?"#define METAL":"",parameters.wrapAround?"#define WRAP_AROUND":"",parameters.doubleSided?"#define DOUBLE_SIDED":"",parameters.flipSided?"#define FLIP_SIDED":"",parameters.shadowMapEnabled?"#define USE_SHADOWMAP":"",parameters.shadowMapEnabled?"#define "+shadowMapTypeDefine:"",parameters.shadowMapDebug?"#define SHADOWMAP_DEBUG":"",parameters.shadowMapCascade?"#define SHADOWMAP_CASCADE":"",parameters.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;",""].join("\n")}var glVertexShader=new THREE.WebGLShader(_gl,_gl.VERTEX_SHADER,prefix_vertex+vertexShader);var glFragmentShader=new THREE.WebGLShader(_gl,_gl.FRAGMENT_SHADER,prefix_fragment+fragmentShader);_gl.attachShader(program,glVertexShader);_gl.attachShader(program,glFragmentShader);if(index0AttributeName!==undefined){_gl.bindAttribLocation(program,0,index0AttributeName)}_gl.linkProgram(program);if(_gl.getProgramParameter(program,_gl.LINK_STATUS)===false){console.error("THREE.WebGLProgram: Could not initialise shader.");console.error("gl.VALIDATE_STATUS",_gl.getProgramParameter(program,_gl.VALIDATE_STATUS));console.error("gl.getError()",_gl.getError())}if(_gl.getProgramInfoLog(program)!==""){console.warn("THREE.WebGLProgram: gl.getProgramInfoLog()",_gl.getProgramInfoLog(program))}_gl.deleteShader(glVertexShader);_gl.deleteShader(glFragmentShader);var identifiers=["viewMatrix","modelViewMatrix","projectionMatrix","normalMatrix","modelMatrix","cameraPosition","morphTargetInfluences","bindMatrix","bindMatrixInverse"];if(parameters.useVertexTexture){identifiers.push("boneTexture");identifiers.push("boneTextureWidth");identifiers.push("boneTextureHeight")}else{identifiers.push("boneGlobalMatrices")}if(parameters.logarithmicDepthBuffer){identifiers.push("logDepthBufFC")}for(var u in uniforms){identifiers.push(u)}this.uniforms=cacheUniformLocations(_gl,program,identifiers);identifiers=["position","normal","uv","uv2","tangent","color","skinIndex","skinWeight","lineDistance"];for(var i=0;i<parameters.maxMorphTargets;i++){identifiers.push("morphTarget"+i)}for(var i=0;i<parameters.maxMorphNormals;i++){identifiers.push("morphNormal"+i)}for(var a in attributes){identifiers.push(a)}this.attributes=cacheAttributeLocations(_gl,program,identifiers);this.attributesKeys=Object.keys(this.attributes);this.id=programIdCount++;this.code=code;this.usedTimes=1;this.program=program;this.vertexShader=glVertexShader;this.fragmentShader=glFragmentShader;return this}}();THREE.WebGLShader=function(){var addLineNumbers=function(string){var lines=string.split("\n");for(var i=0;i<lines.length;i++){lines[i]=i+1+": "+lines[i]}return lines.join("\n")};return function(gl,type,string){var shader=gl.createShader(type);gl.shaderSource(shader,string);gl.compileShader(shader);if(gl.getShaderParameter(shader,gl.COMPILE_STATUS)===false){console.error("THREE.WebGLShader: Shader couldn't compile.")}if(gl.getShaderInfoLog(shader)!==""){console.warn("THREE.WebGLShader: gl.getShaderInfoLog()",gl.getShaderInfoLog(shader));console.warn(addLineNumbers(string))}return shader}}();THREE.LensFlarePlugin=function(renderer,flares){var gl=renderer.context;var vertexBuffer,elementBuffer;var program,attributes,uniforms;var hasVertexTexture;var tempTexture,occlusionTexture;var init=function(){var vertices=new Float32Array([-1,-1,0,0,1,-1,1,0,1,1,1,1,-1,1,0,1]);var faces=new Uint16Array([0,1,2,0,2,3]);vertexBuffer=gl.createBuffer();elementBuffer=gl.createBuffer();gl.bindBuffer(gl.ARRAY_BUFFER,vertexBuffer);gl.bufferData(gl.ARRAY_BUFFER,vertices,gl.STATIC_DRAW);gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,elementBuffer);gl.bufferData(gl.ELEMENT_ARRAY_BUFFER,faces,gl.STATIC_DRAW);tempTexture=gl.createTexture();occlusionTexture=gl.createTexture();gl.bindTexture(gl.TEXTURE_2D,tempTexture);gl.texImage2D(gl.TEXTURE_2D,0,gl.RGB,16,16,0,gl.RGB,gl.UNSIGNED_BYTE,null);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_S,gl.CLAMP_TO_EDGE);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_T,gl.CLAMP_TO_EDGE);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MAG_FILTER,gl.NEAREST);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,gl.NEAREST);gl.bindTexture(gl.TEXTURE_2D,occlusionTexture);gl.texImage2D(gl.TEXTURE_2D,0,gl.RGBA,16,16,0,gl.RGBA,gl.UNSIGNED_BYTE,null);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_S,gl.CLAMP_TO_EDGE);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_T,gl.CLAMP_TO_EDGE);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MAG_FILTER,gl.NEAREST);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,gl.NEAREST);hasVertexTexture=gl.getParameter(gl.MAX_VERTEX_TEXTURE_IMAGE_UNITS)>0;var shader;if(hasVertexTexture){shader={vertexShader:["uniform lowp int renderType;","uniform vec3 screenPosition;","uniform vec2 scale;","uniform float rotation;","uniform sampler2D occlusionMap;","attribute vec2 position;","attribute vec2 uv;","varying vec2 vUV;","varying float vVisibility;","void main() {","vUV = uv;","vec2 pos = position;","if( renderType == 2 ) {","vec4 visibility = texture2D( occlusionMap, vec2( 0.1, 0.1 ) );","visibility += texture2D( occlusionMap, vec2( 0.5, 0.1 ) );","visibility += texture2D( occlusionMap, vec2( 0.9, 0.1 ) );","visibility += texture2D( occlusionMap, vec2( 0.9, 0.5 ) );","visibility += texture2D( occlusionMap, vec2( 0.9, 0.9 ) );","visibility += texture2D( occlusionMap, vec2( 0.5, 0.9 ) );","visibility += texture2D( occlusionMap, vec2( 0.1, 0.9 ) );","visibility += texture2D( occlusionMap, vec2( 0.1, 0.5 ) );","visibility += texture2D( occlusionMap, vec2( 0.5, 0.5 ) );","vVisibility =        visibility.r / 9.0;","vVisibility *= 1.0 - visibility.g / 9.0;","vVisibility *=       visibility.b / 9.0;","vVisibility *= 1.0 - visibility.a / 9.0;","pos.x = cos( rotation ) * position.x - sin( rotation ) * position.y;","pos.y = sin( rotation ) * position.x + cos( rotation ) * position.y;","}","gl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );","}"].join("\n"),fragmentShader:["uniform lowp int renderType;","uniform sampler2D map;","uniform float opacity;","uniform vec3 color;","varying vec2 vUV;","varying float vVisibility;","void main() {","if( renderType == 0 ) {","gl_FragColor = vec4( 1.0, 0.0, 1.0, 0.0 );","} else if( renderType == 1 ) {","gl_FragColor = texture2D( map, vUV );","} else {","vec4 texture = texture2D( map, vUV );","texture.a *= opacity * vVisibility;","gl_FragColor = texture;","gl_FragColor.rgb *= color;","}","}"].join("\n")}}else{shader={vertexShader:["uniform lowp int renderType;","uniform vec3 screenPosition;","uniform vec2 scale;","uniform float rotation;","attribute vec2 position;","attribute vec2 uv;","varying vec2 vUV;","void main() {","vUV = uv;","vec2 pos = position;","if( renderType == 2 ) {","pos.x = cos( rotation ) * position.x - sin( rotation ) * position.y;","pos.y = sin( rotation ) * position.x + cos( rotation ) * position.y;","}","gl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );","}"].join("\n"),fragmentShader:["precision mediump float;","uniform lowp int renderType;","uniform sampler2D map;","uniform sampler2D occlusionMap;","uniform float opacity;","uniform vec3 color;","varying vec2 vUV;","void main() {","if( renderType == 0 ) {","gl_FragColor = vec4( texture2D( map, vUV ).rgb, 0.0 );","} else if( renderType == 1 ) {","gl_FragColor = texture2D( map, vUV );","} else {","float visibility = texture2D( occlusionMap, vec2( 0.5, 0.1 ) ).a;","visibility += texture2D( occlusionMap, vec2( 0.9, 0.5 ) ).a;","visibility += texture2D( occlusionMap, vec2( 0.5, 0.9 ) ).a;","visibility += texture2D( occlusionMap, vec2( 0.1, 0.5 ) ).a;","visibility = ( 1.0 - visibility / 4.0 );","vec4 texture = texture2D( map, vUV );","texture.a *= opacity * visibility;","gl_FragColor = texture;","gl_FragColor.rgb *= color;","}","}"].join("\n")}}program=createProgram(shader);attributes={vertex:gl.getAttribLocation(program,"position"),uv:gl.getAttribLocation(program,"uv")};uniforms={renderType:gl.getUniformLocation(program,"renderType"),map:gl.getUniformLocation(program,"map"),occlusionMap:gl.getUniformLocation(program,"occlusionMap"),opacity:gl.getUniformLocation(program,"opacity"),color:gl.getUniformLocation(program,"color"),scale:gl.getUniformLocation(program,"scale"),rotation:gl.getUniformLocation(program,"rotation"),screenPosition:gl.getUniformLocation(program,"screenPosition")}
};this.render=function(scene,camera,viewportWidth,viewportHeight){if(flares.length===0)return;var tempPosition=new THREE.Vector3;var invAspect=viewportHeight/viewportWidth,halfViewportWidth=viewportWidth*.5,halfViewportHeight=viewportHeight*.5;var size=16/viewportHeight,scale=new THREE.Vector2(size*invAspect,size);var screenPosition=new THREE.Vector3(1,1,0),screenPositionPixels=new THREE.Vector2(1,1);if(program===undefined){init()}gl.useProgram(program);gl.enableVertexAttribArray(attributes.vertex);gl.enableVertexAttribArray(attributes.uv);gl.uniform1i(uniforms.occlusionMap,0);gl.uniform1i(uniforms.map,1);gl.bindBuffer(gl.ARRAY_BUFFER,vertexBuffer);gl.vertexAttribPointer(attributes.vertex,2,gl.FLOAT,false,2*8,0);gl.vertexAttribPointer(attributes.uv,2,gl.FLOAT,false,2*8,8);gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,elementBuffer);gl.disable(gl.CULL_FACE);gl.depthMask(false);for(var i=0,l=flares.length;i<l;i++){size=16/viewportHeight;scale.set(size*invAspect,size);var flare=flares[i];tempPosition.set(flare.matrixWorld.elements[12],flare.matrixWorld.elements[13],flare.matrixWorld.elements[14]);tempPosition.applyMatrix4(camera.matrixWorldInverse);tempPosition.applyProjection(camera.projectionMatrix);screenPosition.copy(tempPosition);screenPositionPixels.x=screenPosition.x*halfViewportWidth+halfViewportWidth;screenPositionPixels.y=screenPosition.y*halfViewportHeight+halfViewportHeight;if(hasVertexTexture||screenPositionPixels.x>0&&screenPositionPixels.x<viewportWidth&&screenPositionPixels.y>0&&screenPositionPixels.y<viewportHeight){gl.activeTexture(gl.TEXTURE1);gl.bindTexture(gl.TEXTURE_2D,tempTexture);gl.copyTexImage2D(gl.TEXTURE_2D,0,gl.RGB,screenPositionPixels.x-8,screenPositionPixels.y-8,16,16,0);gl.uniform1i(uniforms.renderType,0);gl.uniform2f(uniforms.scale,scale.x,scale.y);gl.uniform3f(uniforms.screenPosition,screenPosition.x,screenPosition.y,screenPosition.z);gl.disable(gl.BLEND);gl.enable(gl.DEPTH_TEST);gl.drawElements(gl.TRIANGLES,6,gl.UNSIGNED_SHORT,0);gl.activeTexture(gl.TEXTURE0);gl.bindTexture(gl.TEXTURE_2D,occlusionTexture);gl.copyTexImage2D(gl.TEXTURE_2D,0,gl.RGBA,screenPositionPixels.x-8,screenPositionPixels.y-8,16,16,0);gl.uniform1i(uniforms.renderType,1);gl.disable(gl.DEPTH_TEST);gl.activeTexture(gl.TEXTURE1);gl.bindTexture(gl.TEXTURE_2D,tempTexture);gl.drawElements(gl.TRIANGLES,6,gl.UNSIGNED_SHORT,0);flare.positionScreen.copy(screenPosition);if(flare.customUpdateCallback){flare.customUpdateCallback(flare)}else{flare.updateLensFlares()}gl.uniform1i(uniforms.renderType,2);gl.enable(gl.BLEND);for(var j=0,jl=flare.lensFlares.length;j<jl;j++){var sprite=flare.lensFlares[j];if(sprite.opacity>.001&&sprite.scale>.001){screenPosition.x=sprite.x;screenPosition.y=sprite.y;screenPosition.z=sprite.z;size=sprite.size*sprite.scale/viewportHeight;scale.x=size*invAspect;scale.y=size;gl.uniform3f(uniforms.screenPosition,screenPosition.x,screenPosition.y,screenPosition.z);gl.uniform2f(uniforms.scale,scale.x,scale.y);gl.uniform1f(uniforms.rotation,sprite.rotation);gl.uniform1f(uniforms.opacity,sprite.opacity);gl.uniform3f(uniforms.color,sprite.color.r,sprite.color.g,sprite.color.b);renderer.setBlending(sprite.blending,sprite.blendEquation,sprite.blendSrc,sprite.blendDst);renderer.setTexture(sprite.texture,1);gl.drawElements(gl.TRIANGLES,6,gl.UNSIGNED_SHORT,0)}}}}gl.enable(gl.CULL_FACE);gl.enable(gl.DEPTH_TEST);gl.depthMask(true);renderer.resetGLState()};function createProgram(shader){var program=gl.createProgram();var fragmentShader=gl.createShader(gl.FRAGMENT_SHADER);var vertexShader=gl.createShader(gl.VERTEX_SHADER);var prefix="precision "+renderer.getPrecision()+" float;\n";gl.shaderSource(fragmentShader,prefix+shader.fragmentShader);gl.shaderSource(vertexShader,prefix+shader.vertexShader);gl.compileShader(fragmentShader);gl.compileShader(vertexShader);gl.attachShader(program,fragmentShader);gl.attachShader(program,vertexShader);gl.linkProgram(program);return program}};THREE.ShadowMapPlugin=function(_renderer,_lights,_webglObjects,_webglObjectsImmediate){var _gl=_renderer.context;var _depthMaterial,_depthMaterialMorph,_depthMaterialSkin,_depthMaterialMorphSkin,_frustum=new THREE.Frustum,_projScreenMatrix=new THREE.Matrix4,_min=new THREE.Vector3,_max=new THREE.Vector3,_matrixPosition=new THREE.Vector3,_renderList=[];var depthShader=THREE.ShaderLib["depthRGBA"];var depthUniforms=THREE.UniformsUtils.clone(depthShader.uniforms);_depthMaterial=new THREE.ShaderMaterial({uniforms:depthUniforms,vertexShader:depthShader.vertexShader,fragmentShader:depthShader.fragmentShader});_depthMaterialMorph=new THREE.ShaderMaterial({uniforms:depthUniforms,vertexShader:depthShader.vertexShader,fragmentShader:depthShader.fragmentShader,morphTargets:true});_depthMaterialSkin=new THREE.ShaderMaterial({uniforms:depthUniforms,vertexShader:depthShader.vertexShader,fragmentShader:depthShader.fragmentShader,skinning:true});_depthMaterialMorphSkin=new THREE.ShaderMaterial({uniforms:depthUniforms,vertexShader:depthShader.vertexShader,fragmentShader:depthShader.fragmentShader,morphTargets:true,skinning:true});_depthMaterial._shadowPass=true;_depthMaterialMorph._shadowPass=true;_depthMaterialSkin._shadowPass=true;_depthMaterialMorphSkin._shadowPass=true;this.render=function(scene,camera){if(_renderer.shadowMapEnabled===false)return;var i,il,j,jl,n,shadowMap,shadowMatrix,shadowCamera,program,buffer,material,webglObject,object,light,lights=[],k=0,fog=null;_gl.clearColor(1,1,1,1);_gl.disable(_gl.BLEND);_gl.enable(_gl.CULL_FACE);_gl.frontFace(_gl.CCW);if(_renderer.shadowMapCullFace===THREE.CullFaceFront){_gl.cullFace(_gl.FRONT)}else{_gl.cullFace(_gl.BACK)}_renderer.setDepthTest(true);for(i=0,il=_lights.length;i<il;i++){light=_lights[i];if(!light.castShadow)continue;if(light instanceof THREE.DirectionalLight&&light.shadowCascade){for(n=0;n<light.shadowCascadeCount;n++){var virtualLight;if(!light.shadowCascadeArray[n]){virtualLight=createVirtualLight(light,n);virtualLight.originalCamera=camera;var gyro=new THREE.Gyroscope;gyro.position.copy(light.shadowCascadeOffset);gyro.add(virtualLight);gyro.add(virtualLight.target);camera.add(gyro);light.shadowCascadeArray[n]=virtualLight;console.log("Created virtualLight",virtualLight)}else{virtualLight=light.shadowCascadeArray[n]}updateVirtualLight(light,n);lights[k]=virtualLight;k++}}else{lights[k]=light;k++}}for(i=0,il=lights.length;i<il;i++){light=lights[i];if(!light.shadowMap){var shadowFilter=THREE.LinearFilter;if(_renderer.shadowMapType===THREE.PCFSoftShadowMap){shadowFilter=THREE.NearestFilter}var pars={minFilter:shadowFilter,magFilter:shadowFilter,format:THREE.RGBAFormat};light.shadowMap=new THREE.WebGLRenderTarget(light.shadowMapWidth,light.shadowMapHeight,pars);light.shadowMapSize=new THREE.Vector2(light.shadowMapWidth,light.shadowMapHeight);light.shadowMatrix=new THREE.Matrix4}if(!light.shadowCamera){if(light instanceof THREE.SpotLight){light.shadowCamera=new THREE.PerspectiveCamera(light.shadowCameraFov,light.shadowMapWidth/light.shadowMapHeight,light.shadowCameraNear,light.shadowCameraFar)}else if(light instanceof THREE.DirectionalLight){light.shadowCamera=new THREE.OrthographicCamera(light.shadowCameraLeft,light.shadowCameraRight,light.shadowCameraTop,light.shadowCameraBottom,light.shadowCameraNear,light.shadowCameraFar)}else{console.error("Unsupported light type for shadow");continue}scene.add(light.shadowCamera);if(scene.autoUpdate===true)scene.updateMatrixWorld()}if(light.shadowCameraVisible&&!light.cameraHelper){light.cameraHelper=new THREE.CameraHelper(light.shadowCamera);scene.add(light.cameraHelper)}if(light.isVirtual&&virtualLight.originalCamera==camera){updateShadowCamera(camera,light)}shadowMap=light.shadowMap;shadowMatrix=light.shadowMatrix;shadowCamera=light.shadowCamera;shadowCamera.position.setFromMatrixPosition(light.matrixWorld);_matrixPosition.setFromMatrixPosition(light.target.matrixWorld);shadowCamera.lookAt(_matrixPosition);shadowCamera.updateMatrixWorld();shadowCamera.matrixWorldInverse.getInverse(shadowCamera.matrixWorld);if(light.cameraHelper)light.cameraHelper.visible=light.shadowCameraVisible;if(light.shadowCameraVisible)light.cameraHelper.update();shadowMatrix.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1);shadowMatrix.multiply(shadowCamera.projectionMatrix);shadowMatrix.multiply(shadowCamera.matrixWorldInverse);_projScreenMatrix.multiplyMatrices(shadowCamera.projectionMatrix,shadowCamera.matrixWorldInverse);_frustum.setFromMatrix(_projScreenMatrix);_renderer.setRenderTarget(shadowMap);_renderer.clear();_renderList.length=0;projectObject(scene,scene,shadowCamera);var objectMaterial,useMorphing,useSkinning;for(j=0,jl=_renderList.length;j<jl;j++){webglObject=_renderList[j];object=webglObject.object;buffer=webglObject.buffer;objectMaterial=getObjectMaterial(object);useMorphing=object.geometry.morphTargets!==undefined&&object.geometry.morphTargets.length>0&&objectMaterial.morphTargets;useSkinning=object instanceof THREE.SkinnedMesh&&objectMaterial.skinning;if(object.customDepthMaterial){material=object.customDepthMaterial}else if(useSkinning){material=useMorphing?_depthMaterialMorphSkin:_depthMaterialSkin}else if(useMorphing){material=_depthMaterialMorph}else{material=_depthMaterial}_renderer.setMaterialFaces(objectMaterial);if(buffer instanceof THREE.BufferGeometry){_renderer.renderBufferDirect(shadowCamera,_lights,fog,material,buffer,object)}else{_renderer.renderBuffer(shadowCamera,_lights,fog,material,buffer,object)}}for(j=0,jl=_webglObjectsImmediate.length;j<jl;j++){webglObject=_webglObjectsImmediate[j];object=webglObject.object;if(object.visible&&object.castShadow){object._modelViewMatrix.multiplyMatrices(shadowCamera.matrixWorldInverse,object.matrixWorld);_renderer.renderImmediateObject(shadowCamera,_lights,fog,_depthMaterial,object)}}}var clearColor=_renderer.getClearColor(),clearAlpha=_renderer.getClearAlpha();_gl.clearColor(clearColor.r,clearColor.g,clearColor.b,clearAlpha);_gl.enable(_gl.BLEND);if(_renderer.shadowMapCullFace===THREE.CullFaceFront){_gl.cullFace(_gl.BACK)}_renderer.resetGLState()};function projectObject(scene,object,shadowCamera){if(object.visible){var webglObjects=_webglObjects[object.id];if(webglObjects&&object.castShadow&&(object.frustumCulled===false||_frustum.intersectsObject(object)===true)){for(var i=0,l=webglObjects.length;i<l;i++){var webglObject=webglObjects[i];object._modelViewMatrix.multiplyMatrices(shadowCamera.matrixWorldInverse,object.matrixWorld);_renderList.push(webglObject)}}for(var i=0,l=object.children.length;i<l;i++){projectObject(scene,object.children[i],shadowCamera)}}}function createVirtualLight(light,cascade){var virtualLight=new THREE.DirectionalLight;virtualLight.isVirtual=true;virtualLight.onlyShadow=true;virtualLight.castShadow=true;virtualLight.shadowCameraNear=light.shadowCameraNear;virtualLight.shadowCameraFar=light.shadowCameraFar;virtualLight.shadowCameraLeft=light.shadowCameraLeft;virtualLight.shadowCameraRight=light.shadowCameraRight;virtualLight.shadowCameraBottom=light.shadowCameraBottom;virtualLight.shadowCameraTop=light.shadowCameraTop;virtualLight.shadowCameraVisible=light.shadowCameraVisible;virtualLight.shadowDarkness=light.shadowDarkness;virtualLight.shadowBias=light.shadowCascadeBias[cascade];virtualLight.shadowMapWidth=light.shadowCascadeWidth[cascade];virtualLight.shadowMapHeight=light.shadowCascadeHeight[cascade];virtualLight.pointsWorld=[];virtualLight.pointsFrustum=[];var pointsWorld=virtualLight.pointsWorld,pointsFrustum=virtualLight.pointsFrustum;for(var i=0;i<8;i++){pointsWorld[i]=new THREE.Vector3;pointsFrustum[i]=new THREE.Vector3}var nearZ=light.shadowCascadeNearZ[cascade];var farZ=light.shadowCascadeFarZ[cascade];pointsFrustum[0].set(-1,-1,nearZ);pointsFrustum[1].set(1,-1,nearZ);pointsFrustum[2].set(-1,1,nearZ);pointsFrustum[3].set(1,1,nearZ);pointsFrustum[4].set(-1,-1,farZ);pointsFrustum[5].set(1,-1,farZ);pointsFrustum[6].set(-1,1,farZ);pointsFrustum[7].set(1,1,farZ);return virtualLight}function updateVirtualLight(light,cascade){var virtualLight=light.shadowCascadeArray[cascade];virtualLight.position.copy(light.position);virtualLight.target.position.copy(light.target.position);virtualLight.lookAt(virtualLight.target);virtualLight.shadowCameraVisible=light.shadowCameraVisible;virtualLight.shadowDarkness=light.shadowDarkness;virtualLight.shadowBias=light.shadowCascadeBias[cascade];var nearZ=light.shadowCascadeNearZ[cascade];var farZ=light.shadowCascadeFarZ[cascade];var pointsFrustum=virtualLight.pointsFrustum;pointsFrustum[0].z=nearZ;pointsFrustum[1].z=nearZ;pointsFrustum[2].z=nearZ;pointsFrustum[3].z=nearZ;pointsFrustum[4].z=farZ;pointsFrustum[5].z=farZ;pointsFrustum[6].z=farZ;pointsFrustum[7].z=farZ}function updateShadowCamera(camera,light){var shadowCamera=light.shadowCamera,pointsFrustum=light.pointsFrustum,pointsWorld=light.pointsWorld;_min.set(Infinity,Infinity,Infinity);_max.set(-Infinity,-Infinity,-Infinity);for(var i=0;i<8;i++){var p=pointsWorld[i];p.copy(pointsFrustum[i]);p.unproject(camera);p.applyMatrix4(shadowCamera.matrixWorldInverse);if(p.x<_min.x)_min.x=p.x;if(p.x>_max.x)_max.x=p.x;if(p.y<_min.y)_min.y=p.y;if(p.y>_max.y)_max.y=p.y;if(p.z<_min.z)_min.z=p.z;if(p.z>_max.z)_max.z=p.z}shadowCamera.left=_min.x;shadowCamera.right=_max.x;shadowCamera.top=_max.y;shadowCamera.bottom=_min.y;shadowCamera.updateProjectionMatrix()}function getObjectMaterial(object){return object.material instanceof THREE.MeshFaceMaterial?object.material.materials[0]:object.material}};THREE.SpritePlugin=function(renderer,sprites){var gl=renderer.context;var vertexBuffer,elementBuffer;var program,attributes,uniforms;var texture;var init=function(){var vertices=new Float32Array([-.5,-.5,0,0,.5,-.5,1,0,.5,.5,1,1,-.5,.5,0,1]);var faces=new Uint16Array([0,1,2,0,2,3]);vertexBuffer=gl.createBuffer();elementBuffer=gl.createBuffer();gl.bindBuffer(gl.ARRAY_BUFFER,vertexBuffer);gl.bufferData(gl.ARRAY_BUFFER,vertices,gl.STATIC_DRAW);gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,elementBuffer);gl.bufferData(gl.ELEMENT_ARRAY_BUFFER,faces,gl.STATIC_DRAW);program=createProgram();attributes={position:gl.getAttribLocation(program,"position"),uv:gl.getAttribLocation(program,"uv")};uniforms={uvOffset:gl.getUniformLocation(program,"uvOffset"),uvScale:gl.getUniformLocation(program,"uvScale"),rotation:gl.getUniformLocation(program,"rotation"),scale:gl.getUniformLocation(program,"scale"),color:gl.getUniformLocation(program,"color"),map:gl.getUniformLocation(program,"map"),opacity:gl.getUniformLocation(program,"opacity"),modelViewMatrix:gl.getUniformLocation(program,"modelViewMatrix"),projectionMatrix:gl.getUniformLocation(program,"projectionMatrix"),fogType:gl.getUniformLocation(program,"fogType"),fogDensity:gl.getUniformLocation(program,"fogDensity"),fogNear:gl.getUniformLocation(program,"fogNear"),fogFar:gl.getUniformLocation(program,"fogFar"),fogColor:gl.getUniformLocation(program,"fogColor"),alphaTest:gl.getUniformLocation(program,"alphaTest")};var canvas=document.createElement("canvas");canvas.width=8;canvas.height=8;var context=canvas.getContext("2d");context.fillStyle="white";context.fillRect(0,0,8,8);texture=new THREE.Texture(canvas);texture.needsUpdate=true};this.render=function(scene,camera){if(sprites.length===0)return;if(program===undefined){init()}gl.useProgram(program);gl.enableVertexAttribArray(attributes.position);gl.enableVertexAttribArray(attributes.uv);gl.disable(gl.CULL_FACE);gl.enable(gl.BLEND);gl.bindBuffer(gl.ARRAY_BUFFER,vertexBuffer);gl.vertexAttribPointer(attributes.position,2,gl.FLOAT,false,2*8,0);gl.vertexAttribPointer(attributes.uv,2,gl.FLOAT,false,2*8,8);gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,elementBuffer);gl.uniformMatrix4fv(uniforms.projectionMatrix,false,camera.projectionMatrix.elements);gl.activeTexture(gl.TEXTURE0);gl.uniform1i(uniforms.map,0);var oldFogType=0;var sceneFogType=0;var fog=scene.fog;if(fog){gl.uniform3f(uniforms.fogColor,fog.color.r,fog.color.g,fog.color.b);if(fog instanceof THREE.Fog){gl.uniform1f(uniforms.fogNear,fog.near);gl.uniform1f(uniforms.fogFar,fog.far);gl.uniform1i(uniforms.fogType,1);oldFogType=1;sceneFogType=1}else if(fog instanceof THREE.FogExp2){gl.uniform1f(uniforms.fogDensity,fog.density);gl.uniform1i(uniforms.fogType,2);oldFogType=2;sceneFogType=2}}else{gl.uniform1i(uniforms.fogType,0);oldFogType=0;sceneFogType=0}for(var i=0,l=sprites.length;i<l;i++){var sprite=sprites[i];sprite._modelViewMatrix.multiplyMatrices(camera.matrixWorldInverse,sprite.matrixWorld);if(sprite.renderDepth===null){sprite.z=-sprite._modelViewMatrix.elements[14]}else{sprite.z=sprite.renderDepth}}sprites.sort(painterSortStable);var scale=[];for(var i=0,l=sprites.length;i<l;i++){var sprite=sprites[i];var material=sprite.material;gl.uniform1f(uniforms.alphaTest,material.alphaTest);gl.uniformMatrix4fv(uniforms.modelViewMatrix,false,sprite._modelViewMatrix.elements);scale[0]=sprite.scale.x;scale[1]=sprite.scale.y;var fogType=0;if(scene.fog&&material.fog){fogType=sceneFogType}if(oldFogType!==fogType){gl.uniform1i(uniforms.fogType,fogType);oldFogType=fogType}if(material.map!==null){gl.uniform2f(uniforms.uvOffset,material.map.offset.x,material.map.offset.y);gl.uniform2f(uniforms.uvScale,material.map.repeat.x,material.map.repeat.y)}else{gl.uniform2f(uniforms.uvOffset,0,0);gl.uniform2f(uniforms.uvScale,1,1)}gl.uniform1f(uniforms.opacity,material.opacity);gl.uniform3f(uniforms.color,material.color.r,material.color.g,material.color.b);gl.uniform1f(uniforms.rotation,material.rotation);gl.uniform2fv(uniforms.scale,scale);renderer.setBlending(material.blending,material.blendEquation,material.blendSrc,material.blendDst);renderer.setDepthTest(material.depthTest);renderer.setDepthWrite(material.depthWrite);if(material.map&&material.map.image&&material.map.image.width){renderer.setTexture(material.map,0)}else{renderer.setTexture(texture,0)}gl.drawElements(gl.TRIANGLES,6,gl.UNSIGNED_SHORT,0)}gl.enable(gl.CULL_FACE);renderer.resetGLState()};function createProgram(){var program=gl.createProgram();var vertexShader=gl.createShader(gl.VERTEX_SHADER);var fragmentShader=gl.createShader(gl.FRAGMENT_SHADER);gl.shaderSource(vertexShader,["precision "+renderer.getPrecision()+" float;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform float rotation;","uniform vec2 scale;","uniform vec2 uvOffset;","uniform vec2 uvScale;","attribute vec2 position;","attribute vec2 uv;","varying vec2 vUV;","void main() {","vUV = uvOffset + uv * uvScale;","vec2 alignedPosition = position * scale;","vec2 rotatedPosition;","rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;","rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;","vec4 finalPosition;","finalPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );","finalPosition.xy += rotatedPosition;","finalPosition = projectionMatrix * finalPosition;","gl_Position = finalPosition;","}"].join("\n"));gl.shaderSource(fragmentShader,["precision "+renderer.getPrecision()+" float;","uniform vec3 color;","uniform sampler2D map;","uniform float opacity;","uniform int fogType;","uniform vec3 fogColor;","uniform float fogDensity;","uniform float fogNear;","uniform float fogFar;","uniform float alphaTest;","varying vec2 vUV;","void main() {","vec4 texture = texture2D( map, vUV );","if ( texture.a < alphaTest ) discard;","gl_FragColor = vec4( color * texture.xyz, texture.a * opacity );","if ( fogType > 0 ) {","float depth = gl_FragCoord.z / gl_FragCoord.w;","float fogFactor = 0.0;","if ( fogType == 1 ) {","fogFactor = smoothstep( fogNear, fogFar, depth );","} else {","const float LOG2 = 1.442695;","float fogFactor = exp2( - fogDensity * fogDensity * depth * depth * LOG2 );","fogFactor = 1.0 - clamp( fogFactor, 0.0, 1.0 );","}","gl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );","}","}"].join("\n"));gl.compileShader(vertexShader);gl.compileShader(fragmentShader);gl.attachShader(program,vertexShader);gl.attachShader(program,fragmentShader);gl.linkProgram(program);return program}function painterSortStable(a,b){if(a.z!==b.z){return b.z-a.z}else{return b.id-a.id}}};THREE.GeometryUtils={merge:function(geometry1,geometry2,materialIndexOffset){console.warn("THREE.GeometryUtils: .merge() has been moved to Geometry. Use geometry.merge( geometry2, matrix, materialIndexOffset ) instead.");var matrix;if(geometry2 instanceof THREE.Mesh){geometry2.matrixAutoUpdate&&geometry2.updateMatrix();matrix=geometry2.matrix;geometry2=geometry2.geometry}geometry1.merge(geometry2,matrix,materialIndexOffset)},center:function(geometry){console.warn("THREE.GeometryUtils: .center() has been moved to Geometry. Use geometry.center() instead.");return geometry.center()}};THREE.ImageUtils={crossOrigin:undefined,loadTexture:function(url,mapping,onLoad,onError){var loader=new THREE.ImageLoader;loader.crossOrigin=this.crossOrigin;var texture=new THREE.Texture(undefined,mapping);loader.load(url,function(image){texture.image=image;texture.needsUpdate=true;if(onLoad)onLoad(texture)},undefined,function(event){if(onError)onError(event)});texture.sourceFile=url;return texture},loadTextureCube:function(array,mapping,onLoad,onError){var images=[];var loader=new THREE.ImageLoader;loader.crossOrigin=this.crossOrigin;var texture=new THREE.CubeTexture(images,mapping);texture.flipY=false;var loaded=0;var loadTexture=function(i){loader.load(array[i],function(image){texture.images[i]=image;loaded+=1;if(loaded===6){texture.needsUpdate=true;if(onLoad)onLoad(texture)}})};for(var i=0,il=array.length;i<il;++i){loadTexture(i)}return texture},loadCompressedTexture:function(){console.error("THREE.ImageUtils.loadCompressedTexture has been removed. Use THREE.DDSLoader instead.")},loadCompressedTextureCube:function(){console.error("THREE.ImageUtils.loadCompressedTextureCube has been removed. Use THREE.DDSLoader instead.")},getNormalMap:function(image,depth){var cross=function(a,b){return[a[1]*b[2]-a[2]*b[1],a[2]*b[0]-a[0]*b[2],a[0]*b[1]-a[1]*b[0]]};var subtract=function(a,b){return[a[0]-b[0],a[1]-b[1],a[2]-b[2]]};var normalize=function(a){var l=Math.sqrt(a[0]*a[0]+a[1]*a[1]+a[2]*a[2]);return[a[0]/l,a[1]/l,a[2]/l]};depth=depth|1;var width=image.width;var height=image.height;var canvas=document.createElement("canvas");canvas.width=width;canvas.height=height;var context=canvas.getContext("2d");context.drawImage(image,0,0);var data=context.getImageData(0,0,width,height).data;var imageData=context.createImageData(width,height);var output=imageData.data;for(var x=0;x<width;x++){for(var y=0;y<height;y++){var ly=y-1<0?0:y-1;var uy=y+1>height-1?height-1:y+1;var lx=x-1<0?0:x-1;var ux=x+1>width-1?width-1:x+1;var points=[];var origin=[0,0,data[(y*width+x)*4]/255*depth];points.push([-1,0,data[(y*width+lx)*4]/255*depth]);points.push([-1,-1,data[(ly*width+lx)*4]/255*depth]);points.push([0,-1,data[(ly*width+x)*4]/255*depth]);points.push([1,-1,data[(ly*width+ux)*4]/255*depth]);points.push([1,0,data[(y*width+ux)*4]/255*depth]);points.push([1,1,data[(uy*width+ux)*4]/255*depth]);points.push([0,1,data[(uy*width+x)*4]/255*depth]);points.push([-1,1,data[(uy*width+lx)*4]/255*depth]);var normals=[];var num_points=points.length;for(var i=0;i<num_points;i++){var v1=points[i];var v2=points[(i+1)%num_points];v1=subtract(v1,origin);v2=subtract(v2,origin);normals.push(normalize(cross(v1,v2)))}var normal=[0,0,0];for(var i=0;i<normals.length;i++){normal[0]+=normals[i][0];normal[1]+=normals[i][1];normal[2]+=normals[i][2]}normal[0]/=normals.length;normal[1]/=normals.length;normal[2]/=normals.length;var idx=(y*width+x)*4;output[idx]=(normal[0]+1)/2*255|0;output[idx+1]=(normal[1]+1)/2*255|0;output[idx+2]=normal[2]*255|0;output[idx+3]=255}}context.putImageData(imageData,0,0);return canvas},generateDataTexture:function(width,height,color){var size=width*height;var data=new Uint8Array(3*size);var r=Math.floor(color.r*255);var g=Math.floor(color.g*255);var b=Math.floor(color.b*255);for(var i=0;i<size;i++){data[i*3]=r;data[i*3+1]=g;data[i*3+2]=b}var texture=new THREE.DataTexture(data,width,height,THREE.RGBFormat);texture.needsUpdate=true;return texture}};THREE.SceneUtils={createMultiMaterialObject:function(geometry,materials){var group=new THREE.Object3D;for(var i=0,l=materials.length;i<l;i++){group.add(new THREE.Mesh(geometry,materials[i]))}return group},detach:function(child,parent,scene){child.applyMatrix(parent.matrixWorld);parent.remove(child);scene.add(child)},attach:function(child,scene,parent){var matrixWorldInverse=new THREE.Matrix4;matrixWorldInverse.getInverse(parent.matrixWorld);child.applyMatrix(matrixWorldInverse);scene.remove(child);parent.add(child)}};THREE.FontUtils={faces:{},face:"helvetiker",weight:"normal",style:"normal",size:150,divisions:10,getFace:function(){try{return this.faces[this.face][this.weight][this.style]}catch(e){throw"The font "+this.face+" with "+this.weight+" weight and "+this.style+" style is missing."}},loadFace:function(data){var family=data.familyName.toLowerCase();var ThreeFont=this;ThreeFont.faces[family]=ThreeFont.faces[family]||{};ThreeFont.faces[family][data.cssFontWeight]=ThreeFont.faces[family][data.cssFontWeight]||{};ThreeFont.faces[family][data.cssFontWeight][data.cssFontStyle]=data;var face=ThreeFont.faces[family][data.cssFontWeight][data.cssFontStyle]=data;return data},drawText:function(text){var characterPts=[],allPts=[];var i,p,face=this.getFace(),scale=this.size/face.resolution,offset=0,chars=String(text).split(""),length=chars.length;var fontPaths=[];for(i=0;i<length;i++){var path=new THREE.Path;var ret=this.extractGlyphPoints(chars[i],face,scale,offset,path);offset+=ret.offset;fontPaths.push(ret.path)}var width=offset/2;return{paths:fontPaths,offset:width}},extractGlyphPoints:function(c,face,scale,offset,path){var pts=[];var i,i2,divisions,outline,action,length,scaleX,scaleY,x,y,cpx,cpy,cpx0,cpy0,cpx1,cpy1,cpx2,cpy2,laste,glyph=face.glyphs[c]||face.glyphs["?"];if(!glyph)return;if(glyph.o){outline=glyph._cachedOutline||(glyph._cachedOutline=glyph.o.split(" "));length=outline.length;scaleX=scale;scaleY=scale;for(i=0;i<length;){action=outline[i++];switch(action){case"m":x=outline[i++]*scaleX+offset;y=outline[i++]*scaleY;path.moveTo(x,y);break;case"l":x=outline[i++]*scaleX+offset;y=outline[i++]*scaleY;path.lineTo(x,y);break;case"q":cpx=outline[i++]*scaleX+offset;cpy=outline[i++]*scaleY;cpx1=outline[i++]*scaleX+offset;cpy1=outline[i++]*scaleY;path.quadraticCurveTo(cpx1,cpy1,cpx,cpy);laste=pts[pts.length-1];if(laste){cpx0=laste.x;cpy0=laste.y;for(i2=1,divisions=this.divisions;i2<=divisions;i2++){var t=i2/divisions;var tx=THREE.Shape.Utils.b2(t,cpx0,cpx1,cpx);var ty=THREE.Shape.Utils.b2(t,cpy0,cpy1,cpy)}}break;case"b":cpx=outline[i++]*scaleX+offset;cpy=outline[i++]*scaleY;cpx1=outline[i++]*scaleX+offset;cpy1=outline[i++]*scaleY;cpx2=outline[i++]*scaleX+offset;cpy2=outline[i++]*scaleY;path.bezierCurveTo(cpx1,cpy1,cpx2,cpy2,cpx,cpy);laste=pts[pts.length-1];if(laste){cpx0=laste.x;cpy0=laste.y;for(i2=1,divisions=this.divisions;i2<=divisions;i2++){var t=i2/divisions;var tx=THREE.Shape.Utils.b3(t,cpx0,cpx1,cpx2,cpx);var ty=THREE.Shape.Utils.b3(t,cpy0,cpy1,cpy2,cpy)}}break}}}return{offset:glyph.ha*scale,path:path}}};THREE.FontUtils.generateShapes=function(text,parameters){parameters=parameters||{};var size=parameters.size!==undefined?parameters.size:100;var curveSegments=parameters.curveSegments!==undefined?parameters.curveSegments:4;var font=parameters.font!==undefined?parameters.font:"helvetiker";var weight=parameters.weight!==undefined?parameters.weight:"normal";var style=parameters.style!==undefined?parameters.style:"normal";THREE.FontUtils.size=size;THREE.FontUtils.divisions=curveSegments;THREE.FontUtils.face=font;THREE.FontUtils.weight=weight;THREE.FontUtils.style=style;var data=THREE.FontUtils.drawText(text);var paths=data.paths;var shapes=[];for(var p=0,pl=paths.length;p<pl;p++){Array.prototype.push.apply(shapes,paths[p].toShapes())}return shapes};(function(namespace){var EPSILON=1e-10;var process=function(contour,indices){var n=contour.length;if(n<3)return null;var result=[],verts=[],vertIndices=[];var u,v,w;if(area(contour)>0){for(v=0;v<n;v++)verts[v]=v}else{for(v=0;v<n;v++)verts[v]=n-1-v}var nv=n;var count=2*nv;for(v=nv-1;nv>2;){if(count--<=0){console.log("Warning, unable to triangulate polygon!");if(indices)return vertIndices;return result}u=v;if(nv<=u)u=0;v=u+1;if(nv<=v)v=0;w=v+1;if(nv<=w)w=0;if(snip(contour,u,v,w,nv,verts)){var a,b,c,s,t;a=verts[u];b=verts[v];c=verts[w];result.push([contour[a],contour[b],contour[c]]);vertIndices.push([verts[u],verts[v],verts[w]]);for(s=v,t=v+1;t<nv;s++,t++){verts[s]=verts[t]}nv--;count=2*nv}}if(indices)return vertIndices;return result};var area=function(contour){var n=contour.length;var a=0;for(var p=n-1,q=0;q<n;p=q++){a+=contour[p].x*contour[q].y-contour[q].x*contour[p].y}return a*.5};var snip=function(contour,u,v,w,n,verts){var p;var ax,ay,bx,by;var cx,cy,px,py;ax=contour[verts[u]].x;ay=contour[verts[u]].y;bx=contour[verts[v]].x;by=contour[verts[v]].y;cx=contour[verts[w]].x;cy=contour[verts[w]].y;if(EPSILON>(bx-ax)*(cy-ay)-(by-ay)*(cx-ax))return false;var aX,aY,bX,bY,cX,cY;var apx,apy,bpx,bpy,cpx,cpy;var cCROSSap,bCROSScp,aCROSSbp;aX=cx-bx;aY=cy-by;bX=ax-cx;bY=ay-cy;cX=bx-ax;cY=by-ay;for(p=0;p<n;p++){px=contour[verts[p]].x;py=contour[verts[p]].y;if(px===ax&&py===ay||px===bx&&py===by||px===cx&&py===cy)continue;apx=px-ax;apy=py-ay;bpx=px-bx;bpy=py-by;cpx=px-cx;cpy=py-cy;aCROSSbp=aX*bpy-aY*bpx;cCROSSap=cX*apy-cY*apx;bCROSScp=bX*cpy-bY*cpx;if(aCROSSbp>=-EPSILON&&bCROSScp>=-EPSILON&&cCROSSap>=-EPSILON)return false}return true};namespace.Triangulate=process;namespace.Triangulate.area=area;return namespace})(THREE.FontUtils);self._typeface_js={faces:THREE.FontUtils.faces,loadFace:THREE.FontUtils.loadFace};THREE.typeface_js=self._typeface_js;THREE.Audio=function(listener){THREE.Object3D.call(this);this.type="Audio";this.context=listener.context;this.source=this.context.createBufferSource();this.gain=this.context.createGain();this.gain.connect(this.context.destination);this.panner=this.context.createPanner();this.panner.connect(this.gain)};THREE.Audio.prototype=Object.create(THREE.Object3D.prototype);THREE.Audio.prototype.load=function(file){var scope=this;var request=new XMLHttpRequest;request.open("GET",file,true);request.responseType="arraybuffer";request.onload=function(e){scope.context.decodeAudioData(this.response,function(buffer){scope.source.buffer=buffer;scope.source.connect(scope.panner);scope.source.start(0)})};request.send();return this};THREE.Audio.prototype.setLoop=function(value){this.source.loop=value};THREE.Audio.prototype.setRefDistance=function(value){this.panner.refDistance=value};THREE.Audio.prototype.setRolloffFactor=function(value){this.panner.rolloffFactor=value};THREE.Audio.prototype.updateMatrixWorld=function(){var position=new THREE.Vector3;return function(force){THREE.Object3D.prototype.updateMatrixWorld.call(this,force);position.setFromMatrixPosition(this.matrixWorld);this.panner.setPosition(position.x,position.y,position.z)}}();THREE.AudioListener=function(){THREE.Object3D.call(this);this.type="AudioListener";this.context=new(window.AudioContext||window.webkitAudioContext)};THREE.AudioListener.prototype=Object.create(THREE.Object3D.prototype);THREE.AudioListener.prototype.updateMatrixWorld=function(){var position=new THREE.Vector3;var quaternion=new THREE.Quaternion;var scale=new THREE.Vector3;var orientation=new THREE.Vector3;var velocity=new THREE.Vector3;var positionPrev=new THREE.Vector3;return function(force){THREE.Object3D.prototype.updateMatrixWorld.call(this,force);var listener=this.context.listener;this.matrixWorld.decompose(position,quaternion,scale);orientation.set(0,0,-1).applyQuaternion(quaternion);velocity.subVectors(position,positionPrev);listener.setPosition(position.x,position.y,position.z);listener.setOrientation(orientation.x,orientation.y,orientation.z,this.up.x,this.up.y,this.up.z);listener.setVelocity(velocity.x,velocity.y,velocity.z);positionPrev.copy(position)}}();THREE.Curve=function(){};THREE.Curve.prototype.getPoint=function(t){console.log("Warning, getPoint() not implemented!");
return null};THREE.Curve.prototype.getPointAt=function(u){var t=this.getUtoTmapping(u);return this.getPoint(t)};THREE.Curve.prototype.getPoints=function(divisions){if(!divisions)divisions=5;var d,pts=[];for(d=0;d<=divisions;d++){pts.push(this.getPoint(d/divisions))}return pts};THREE.Curve.prototype.getSpacedPoints=function(divisions){if(!divisions)divisions=5;var d,pts=[];for(d=0;d<=divisions;d++){pts.push(this.getPointAt(d/divisions))}return pts};THREE.Curve.prototype.getLength=function(){var lengths=this.getLengths();return lengths[lengths.length-1]};THREE.Curve.prototype.getLengths=function(divisions){if(!divisions)divisions=this.__arcLengthDivisions?this.__arcLengthDivisions:200;if(this.cacheArcLengths&&this.cacheArcLengths.length==divisions+1&&!this.needsUpdate){return this.cacheArcLengths}this.needsUpdate=false;var cache=[];var current,last=this.getPoint(0);var p,sum=0;cache.push(0);for(p=1;p<=divisions;p++){current=this.getPoint(p/divisions);sum+=current.distanceTo(last);cache.push(sum);last=current}this.cacheArcLengths=cache;return cache};THREE.Curve.prototype.updateArcLengths=function(){this.needsUpdate=true;this.getLengths()};THREE.Curve.prototype.getUtoTmapping=function(u,distance){var arcLengths=this.getLengths();var i=0,il=arcLengths.length;var targetArcLength;if(distance){targetArcLength=distance}else{targetArcLength=u*arcLengths[il-1]}var low=0,high=il-1,comparison;while(low<=high){i=Math.floor(low+(high-low)/2);comparison=arcLengths[i]-targetArcLength;if(comparison<0){low=i+1;continue}else if(comparison>0){high=i-1;continue}else{high=i;break}}i=high;if(arcLengths[i]==targetArcLength){var t=i/(il-1);return t}var lengthBefore=arcLengths[i];var lengthAfter=arcLengths[i+1];var segmentLength=lengthAfter-lengthBefore;var segmentFraction=(targetArcLength-lengthBefore)/segmentLength;var t=(i+segmentFraction)/(il-1);return t};THREE.Curve.prototype.getTangent=function(t){var delta=1e-4;var t1=t-delta;var t2=t+delta;if(t1<0)t1=0;if(t2>1)t2=1;var pt1=this.getPoint(t1);var pt2=this.getPoint(t2);var vec=pt2.clone().sub(pt1);return vec.normalize()};THREE.Curve.prototype.getTangentAt=function(u){var t=this.getUtoTmapping(u);return this.getTangent(t)};THREE.Curve.Utils={tangentQuadraticBezier:function(t,p0,p1,p2){return 2*(1-t)*(p1-p0)+2*t*(p2-p1)},tangentCubicBezier:function(t,p0,p1,p2,p3){return-3*p0*(1-t)*(1-t)+3*p1*(1-t)*(1-t)-6*t*p1*(1-t)+6*t*p2*(1-t)-3*t*t*p2+3*t*t*p3},tangentSpline:function(t,p0,p1,p2,p3){var h00=6*t*t-6*t;var h10=3*t*t-4*t+1;var h01=-6*t*t+6*t;var h11=3*t*t-2*t;return h00+h10+h01+h11},interpolate:function(p0,p1,p2,p3,t){var v0=(p2-p0)*.5;var v1=(p3-p1)*.5;var t2=t*t;var t3=t*t2;return(2*p1-2*p2+v0+v1)*t3+(-3*p1+3*p2-2*v0-v1)*t2+v0*t+p1}};THREE.Curve.create=function(constructor,getPointFunc){constructor.prototype=Object.create(THREE.Curve.prototype);constructor.prototype.getPoint=getPointFunc;return constructor};THREE.CurvePath=function(){this.curves=[];this.bends=[];this.autoClose=false};THREE.CurvePath.prototype=Object.create(THREE.Curve.prototype);THREE.CurvePath.prototype.add=function(curve){this.curves.push(curve)};THREE.CurvePath.prototype.checkConnection=function(){};THREE.CurvePath.prototype.closePath=function(){var startPoint=this.curves[0].getPoint(0);var endPoint=this.curves[this.curves.length-1].getPoint(1);if(!startPoint.equals(endPoint)){this.curves.push(new THREE.LineCurve(endPoint,startPoint))}};THREE.CurvePath.prototype.getPoint=function(t){var d=t*this.getLength();var curveLengths=this.getCurveLengths();var i=0,diff,curve;while(i<curveLengths.length){if(curveLengths[i]>=d){diff=curveLengths[i]-d;curve=this.curves[i];var u=1-diff/curve.getLength();return curve.getPointAt(u);break}i++}return null};THREE.CurvePath.prototype.getLength=function(){var lens=this.getCurveLengths();return lens[lens.length-1]};THREE.CurvePath.prototype.getCurveLengths=function(){if(this.cacheLengths&&this.cacheLengths.length==this.curves.length){return this.cacheLengths}var lengths=[],sums=0;var i,il=this.curves.length;for(i=0;i<il;i++){sums+=this.curves[i].getLength();lengths.push(sums)}this.cacheLengths=lengths;return lengths};THREE.CurvePath.prototype.getBoundingBox=function(){var points=this.getPoints();var maxX,maxY,maxZ;var minX,minY,minZ;maxX=maxY=Number.NEGATIVE_INFINITY;minX=minY=Number.POSITIVE_INFINITY;var p,i,il,sum;var v3=points[0]instanceof THREE.Vector3;sum=v3?new THREE.Vector3:new THREE.Vector2;for(i=0,il=points.length;i<il;i++){p=points[i];if(p.x>maxX)maxX=p.x;else if(p.x<minX)minX=p.x;if(p.y>maxY)maxY=p.y;else if(p.y<minY)minY=p.y;if(v3){if(p.z>maxZ)maxZ=p.z;else if(p.z<minZ)minZ=p.z}sum.add(p)}var ret={minX:minX,minY:minY,maxX:maxX,maxY:maxY};if(v3){ret.maxZ=maxZ;ret.minZ=minZ}return ret};THREE.CurvePath.prototype.createPointsGeometry=function(divisions){var pts=this.getPoints(divisions,true);return this.createGeometry(pts)};THREE.CurvePath.prototype.createSpacedPointsGeometry=function(divisions){var pts=this.getSpacedPoints(divisions,true);return this.createGeometry(pts)};THREE.CurvePath.prototype.createGeometry=function(points){var geometry=new THREE.Geometry;for(var i=0;i<points.length;i++){geometry.vertices.push(new THREE.Vector3(points[i].x,points[i].y,points[i].z||0))}return geometry};THREE.CurvePath.prototype.addWrapPath=function(bendpath){this.bends.push(bendpath)};THREE.CurvePath.prototype.getTransformedPoints=function(segments,bends){var oldPts=this.getPoints(segments);var i,il;if(!bends){bends=this.bends}for(i=0,il=bends.length;i<il;i++){oldPts=this.getWrapPoints(oldPts,bends[i])}return oldPts};THREE.CurvePath.prototype.getTransformedSpacedPoints=function(segments,bends){var oldPts=this.getSpacedPoints(segments);var i,il;if(!bends){bends=this.bends}for(i=0,il=bends.length;i<il;i++){oldPts=this.getWrapPoints(oldPts,bends[i])}return oldPts};THREE.CurvePath.prototype.getWrapPoints=function(oldPts,path){var bounds=this.getBoundingBox();var i,il,p,oldX,oldY,xNorm;for(i=0,il=oldPts.length;i<il;i++){p=oldPts[i];oldX=p.x;oldY=p.y;xNorm=oldX/bounds.maxX;xNorm=path.getUtoTmapping(xNorm,oldX);var pathPt=path.getPoint(xNorm);var normal=path.getTangent(xNorm);normal.set(-normal.y,normal.x).multiplyScalar(oldY);p.x=pathPt.x+normal.x;p.y=pathPt.y+normal.y}return oldPts};THREE.Gyroscope=function(){THREE.Object3D.call(this)};THREE.Gyroscope.prototype=Object.create(THREE.Object3D.prototype);THREE.Gyroscope.prototype.updateMatrixWorld=function(){var translationObject=new THREE.Vector3;var quaternionObject=new THREE.Quaternion;var scaleObject=new THREE.Vector3;var translationWorld=new THREE.Vector3;var quaternionWorld=new THREE.Quaternion;var scaleWorld=new THREE.Vector3;return function(force){this.matrixAutoUpdate&&this.updateMatrix();if(this.matrixWorldNeedsUpdate||force){if(this.parent){this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix);this.matrixWorld.decompose(translationWorld,quaternionWorld,scaleWorld);this.matrix.decompose(translationObject,quaternionObject,scaleObject);this.matrixWorld.compose(translationWorld,quaternionObject,scaleWorld)}else{this.matrixWorld.copy(this.matrix)}this.matrixWorldNeedsUpdate=false;force=true}for(var i=0,l=this.children.length;i<l;i++){this.children[i].updateMatrixWorld(force)}}}();THREE.Path=function(points){THREE.CurvePath.call(this);this.actions=[];if(points){this.fromPoints(points)}};THREE.Path.prototype=Object.create(THREE.CurvePath.prototype);THREE.PathActions={MOVE_TO:"moveTo",LINE_TO:"lineTo",QUADRATIC_CURVE_TO:"quadraticCurveTo",BEZIER_CURVE_TO:"bezierCurveTo",CSPLINE_THRU:"splineThru",ARC:"arc",ELLIPSE:"ellipse"};THREE.Path.prototype.fromPoints=function(vectors){this.moveTo(vectors[0].x,vectors[0].y);for(var v=1,vlen=vectors.length;v<vlen;v++){this.lineTo(vectors[v].x,vectors[v].y)}};THREE.Path.prototype.moveTo=function(x,y){var args=Array.prototype.slice.call(arguments);this.actions.push({action:THREE.PathActions.MOVE_TO,args:args})};THREE.Path.prototype.lineTo=function(x,y){var args=Array.prototype.slice.call(arguments);var lastargs=this.actions[this.actions.length-1].args;var x0=lastargs[lastargs.length-2];var y0=lastargs[lastargs.length-1];var curve=new THREE.LineCurve(new THREE.Vector2(x0,y0),new THREE.Vector2(x,y));this.curves.push(curve);this.actions.push({action:THREE.PathActions.LINE_TO,args:args})};THREE.Path.prototype.quadraticCurveTo=function(aCPx,aCPy,aX,aY){var args=Array.prototype.slice.call(arguments);var lastargs=this.actions[this.actions.length-1].args;var x0=lastargs[lastargs.length-2];var y0=lastargs[lastargs.length-1];var curve=new THREE.QuadraticBezierCurve(new THREE.Vector2(x0,y0),new THREE.Vector2(aCPx,aCPy),new THREE.Vector2(aX,aY));this.curves.push(curve);this.actions.push({action:THREE.PathActions.QUADRATIC_CURVE_TO,args:args})};THREE.Path.prototype.bezierCurveTo=function(aCP1x,aCP1y,aCP2x,aCP2y,aX,aY){var args=Array.prototype.slice.call(arguments);var lastargs=this.actions[this.actions.length-1].args;var x0=lastargs[lastargs.length-2];var y0=lastargs[lastargs.length-1];var curve=new THREE.CubicBezierCurve(new THREE.Vector2(x0,y0),new THREE.Vector2(aCP1x,aCP1y),new THREE.Vector2(aCP2x,aCP2y),new THREE.Vector2(aX,aY));this.curves.push(curve);this.actions.push({action:THREE.PathActions.BEZIER_CURVE_TO,args:args})};THREE.Path.prototype.splineThru=function(pts){var args=Array.prototype.slice.call(arguments);var lastargs=this.actions[this.actions.length-1].args;var x0=lastargs[lastargs.length-2];var y0=lastargs[lastargs.length-1];var npts=[new THREE.Vector2(x0,y0)];Array.prototype.push.apply(npts,pts);var curve=new THREE.SplineCurve(npts);this.curves.push(curve);this.actions.push({action:THREE.PathActions.CSPLINE_THRU,args:args})};THREE.Path.prototype.arc=function(aX,aY,aRadius,aStartAngle,aEndAngle,aClockwise){var lastargs=this.actions[this.actions.length-1].args;var x0=lastargs[lastargs.length-2];var y0=lastargs[lastargs.length-1];this.absarc(aX+x0,aY+y0,aRadius,aStartAngle,aEndAngle,aClockwise)};THREE.Path.prototype.absarc=function(aX,aY,aRadius,aStartAngle,aEndAngle,aClockwise){this.absellipse(aX,aY,aRadius,aRadius,aStartAngle,aEndAngle,aClockwise)};THREE.Path.prototype.ellipse=function(aX,aY,xRadius,yRadius,aStartAngle,aEndAngle,aClockwise){var lastargs=this.actions[this.actions.length-1].args;var x0=lastargs[lastargs.length-2];var y0=lastargs[lastargs.length-1];this.absellipse(aX+x0,aY+y0,xRadius,yRadius,aStartAngle,aEndAngle,aClockwise)};THREE.Path.prototype.absellipse=function(aX,aY,xRadius,yRadius,aStartAngle,aEndAngle,aClockwise){var args=Array.prototype.slice.call(arguments);var curve=new THREE.EllipseCurve(aX,aY,xRadius,yRadius,aStartAngle,aEndAngle,aClockwise);this.curves.push(curve);var lastPoint=curve.getPoint(1);args.push(lastPoint.x);args.push(lastPoint.y);this.actions.push({action:THREE.PathActions.ELLIPSE,args:args})};THREE.Path.prototype.getSpacedPoints=function(divisions,closedPath){if(!divisions)divisions=40;var points=[];for(var i=0;i<divisions;i++){points.push(this.getPoint(i/divisions))}return points};THREE.Path.prototype.getPoints=function(divisions,closedPath){if(this.useSpacedPoints){console.log("tata");return this.getSpacedPoints(divisions,closedPath)}divisions=divisions||12;var points=[];var i,il,item,action,args;var cpx,cpy,cpx2,cpy2,cpx1,cpy1,cpx0,cpy0,laste,j,t,tx,ty;for(i=0,il=this.actions.length;i<il;i++){item=this.actions[i];action=item.action;args=item.args;switch(action){case THREE.PathActions.MOVE_TO:points.push(new THREE.Vector2(args[0],args[1]));break;case THREE.PathActions.LINE_TO:points.push(new THREE.Vector2(args[0],args[1]));break;case THREE.PathActions.QUADRATIC_CURVE_TO:cpx=args[2];cpy=args[3];cpx1=args[0];cpy1=args[1];if(points.length>0){laste=points[points.length-1];cpx0=laste.x;cpy0=laste.y}else{laste=this.actions[i-1].args;cpx0=laste[laste.length-2];cpy0=laste[laste.length-1]}for(j=1;j<=divisions;j++){t=j/divisions;tx=THREE.Shape.Utils.b2(t,cpx0,cpx1,cpx);ty=THREE.Shape.Utils.b2(t,cpy0,cpy1,cpy);points.push(new THREE.Vector2(tx,ty))}break;case THREE.PathActions.BEZIER_CURVE_TO:cpx=args[4];cpy=args[5];cpx1=args[0];cpy1=args[1];cpx2=args[2];cpy2=args[3];if(points.length>0){laste=points[points.length-1];cpx0=laste.x;cpy0=laste.y}else{laste=this.actions[i-1].args;cpx0=laste[laste.length-2];cpy0=laste[laste.length-1]}for(j=1;j<=divisions;j++){t=j/divisions;tx=THREE.Shape.Utils.b3(t,cpx0,cpx1,cpx2,cpx);ty=THREE.Shape.Utils.b3(t,cpy0,cpy1,cpy2,cpy);points.push(new THREE.Vector2(tx,ty))}break;case THREE.PathActions.CSPLINE_THRU:laste=this.actions[i-1].args;var last=new THREE.Vector2(laste[laste.length-2],laste[laste.length-1]);var spts=[last];var n=divisions*args[0].length;spts=spts.concat(args[0]);var spline=new THREE.SplineCurve(spts);for(j=1;j<=n;j++){points.push(spline.getPointAt(j/n))}break;case THREE.PathActions.ARC:var aX=args[0],aY=args[1],aRadius=args[2],aStartAngle=args[3],aEndAngle=args[4],aClockwise=!!args[5];var deltaAngle=aEndAngle-aStartAngle;var angle;var tdivisions=divisions*2;for(j=1;j<=tdivisions;j++){t=j/tdivisions;if(!aClockwise){t=1-t}angle=aStartAngle+t*deltaAngle;tx=aX+aRadius*Math.cos(angle);ty=aY+aRadius*Math.sin(angle);points.push(new THREE.Vector2(tx,ty))}break;case THREE.PathActions.ELLIPSE:var aX=args[0],aY=args[1],xRadius=args[2],yRadius=args[3],aStartAngle=args[4],aEndAngle=args[5],aClockwise=!!args[6];var deltaAngle=aEndAngle-aStartAngle;var angle;var tdivisions=divisions*2;for(j=1;j<=tdivisions;j++){t=j/tdivisions;if(!aClockwise){t=1-t}angle=aStartAngle+t*deltaAngle;tx=aX+xRadius*Math.cos(angle);ty=aY+yRadius*Math.sin(angle);points.push(new THREE.Vector2(tx,ty))}break}}var lastPoint=points[points.length-1];var EPSILON=1e-10;if(Math.abs(lastPoint.x-points[0].x)<EPSILON&&Math.abs(lastPoint.y-points[0].y)<EPSILON)points.splice(points.length-1,1);if(closedPath){points.push(points[0])}return points};THREE.Path.prototype.toShapes=function(isCCW,noHoles){function extractSubpaths(inActions){var i,il,item,action,args;var subPaths=[],lastPath=new THREE.Path;for(i=0,il=inActions.length;i<il;i++){item=inActions[i];args=item.args;action=item.action;if(action==THREE.PathActions.MOVE_TO){if(lastPath.actions.length!=0){subPaths.push(lastPath);lastPath=new THREE.Path}}lastPath[action].apply(lastPath,args)}if(lastPath.actions.length!=0){subPaths.push(lastPath)}return subPaths}function toShapesNoHoles(inSubpaths){var shapes=[];for(var i=0,il=inSubpaths.length;i<il;i++){var tmpPath=inSubpaths[i];var tmpShape=new THREE.Shape;tmpShape.actions=tmpPath.actions;tmpShape.curves=tmpPath.curves;shapes.push(tmpShape)}return shapes}function isPointInsidePolygon(inPt,inPolygon){var EPSILON=1e-10;var polyLen=inPolygon.length;var inside=false;for(var p=polyLen-1,q=0;q<polyLen;p=q++){var edgeLowPt=inPolygon[p];var edgeHighPt=inPolygon[q];var edgeDx=edgeHighPt.x-edgeLowPt.x;var edgeDy=edgeHighPt.y-edgeLowPt.y;if(Math.abs(edgeDy)>EPSILON){if(edgeDy<0){edgeLowPt=inPolygon[q];edgeDx=-edgeDx;edgeHighPt=inPolygon[p];edgeDy=-edgeDy}if(inPt.y<edgeLowPt.y||inPt.y>edgeHighPt.y)continue;if(inPt.y==edgeLowPt.y){if(inPt.x==edgeLowPt.x)return true}else{var perpEdge=edgeDy*(inPt.x-edgeLowPt.x)-edgeDx*(inPt.y-edgeLowPt.y);if(perpEdge==0)return true;if(perpEdge<0)continue;inside=!inside}}else{if(inPt.y!=edgeLowPt.y)continue;if(edgeHighPt.x<=inPt.x&&inPt.x<=edgeLowPt.x||edgeLowPt.x<=inPt.x&&inPt.x<=edgeHighPt.x)return true}}return inside}var subPaths=extractSubpaths(this.actions);if(subPaths.length==0)return[];if(noHoles===true)return toShapesNoHoles(subPaths);var solid,tmpPath,tmpShape,shapes=[];if(subPaths.length==1){tmpPath=subPaths[0];tmpShape=new THREE.Shape;tmpShape.actions=tmpPath.actions;tmpShape.curves=tmpPath.curves;shapes.push(tmpShape);return shapes}var holesFirst=!THREE.Shape.Utils.isClockWise(subPaths[0].getPoints());holesFirst=isCCW?!holesFirst:holesFirst;var betterShapeHoles=[];var newShapes=[];var newShapeHoles=[];var mainIdx=0;var tmpPoints;newShapes[mainIdx]=undefined;newShapeHoles[mainIdx]=[];var i,il;for(i=0,il=subPaths.length;i<il;i++){tmpPath=subPaths[i];tmpPoints=tmpPath.getPoints();solid=THREE.Shape.Utils.isClockWise(tmpPoints);solid=isCCW?!solid:solid;if(solid){if(!holesFirst&&newShapes[mainIdx])mainIdx++;newShapes[mainIdx]={s:new THREE.Shape,p:tmpPoints};newShapes[mainIdx].s.actions=tmpPath.actions;newShapes[mainIdx].s.curves=tmpPath.curves;if(holesFirst)mainIdx++;newShapeHoles[mainIdx]=[]}else{newShapeHoles[mainIdx].push({h:tmpPath,p:tmpPoints[0]})}}if(!newShapes[0])return toShapesNoHoles(subPaths);if(newShapes.length>1){var ambigious=false;var toChange=[];for(var sIdx=0,sLen=newShapes.length;sIdx<sLen;sIdx++){betterShapeHoles[sIdx]=[]}for(var sIdx=0,sLen=newShapes.length;sIdx<sLen;sIdx++){var sh=newShapes[sIdx];var sho=newShapeHoles[sIdx];for(var hIdx=0;hIdx<sho.length;hIdx++){var ho=sho[hIdx];var hole_unassigned=true;for(var s2Idx=0;s2Idx<newShapes.length;s2Idx++){if(isPointInsidePolygon(ho.p,newShapes[s2Idx].p)){if(sIdx!=s2Idx)toChange.push({froms:sIdx,tos:s2Idx,hole:hIdx});if(hole_unassigned){hole_unassigned=false;betterShapeHoles[s2Idx].push(ho)}else{ambigious=true}}}if(hole_unassigned){betterShapeHoles[sIdx].push(ho)}}}if(toChange.length>0){if(!ambigious)newShapeHoles=betterShapeHoles}}var tmpHoles,j,jl;for(i=0,il=newShapes.length;i<il;i++){tmpShape=newShapes[i].s;shapes.push(tmpShape);tmpHoles=newShapeHoles[i];for(j=0,jl=tmpHoles.length;j<jl;j++){tmpShape.holes.push(tmpHoles[j].h)}}return shapes};THREE.Shape=function(){THREE.Path.apply(this,arguments);this.holes=[]};THREE.Shape.prototype=Object.create(THREE.Path.prototype);THREE.Shape.prototype.extrude=function(options){var extruded=new THREE.ExtrudeGeometry(this,options);return extruded};THREE.Shape.prototype.makeGeometry=function(options){var geometry=new THREE.ShapeGeometry(this,options);return geometry};THREE.Shape.prototype.getPointsHoles=function(divisions){var i,il=this.holes.length,holesPts=[];for(i=0;i<il;i++){holesPts[i]=this.holes[i].getTransformedPoints(divisions,this.bends)}return holesPts};THREE.Shape.prototype.getSpacedPointsHoles=function(divisions){var i,il=this.holes.length,holesPts=[];for(i=0;i<il;i++){holesPts[i]=this.holes[i].getTransformedSpacedPoints(divisions,this.bends)}return holesPts};THREE.Shape.prototype.extractAllPoints=function(divisions){return{shape:this.getTransformedPoints(divisions),holes:this.getPointsHoles(divisions)}};THREE.Shape.prototype.extractPoints=function(divisions){if(this.useSpacedPoints){return this.extractAllSpacedPoints(divisions)}return this.extractAllPoints(divisions)};THREE.Shape.prototype.extractAllSpacedPoints=function(divisions){return{shape:this.getTransformedSpacedPoints(divisions),holes:this.getSpacedPointsHoles(divisions)}};THREE.Shape.Utils={triangulateShape:function(contour,holes){function point_in_segment_2D_colin(inSegPt1,inSegPt2,inOtherPt){if(inSegPt1.x!=inSegPt2.x){if(inSegPt1.x<inSegPt2.x){return inSegPt1.x<=inOtherPt.x&&inOtherPt.x<=inSegPt2.x}else{return inSegPt2.x<=inOtherPt.x&&inOtherPt.x<=inSegPt1.x}}else{if(inSegPt1.y<inSegPt2.y){return inSegPt1.y<=inOtherPt.y&&inOtherPt.y<=inSegPt2.y}else{return inSegPt2.y<=inOtherPt.y&&inOtherPt.y<=inSegPt1.y}}}function intersect_segments_2D(inSeg1Pt1,inSeg1Pt2,inSeg2Pt1,inSeg2Pt2,inExcludeAdjacentSegs){var EPSILON=1e-10;var seg1dx=inSeg1Pt2.x-inSeg1Pt1.x,seg1dy=inSeg1Pt2.y-inSeg1Pt1.y;var seg2dx=inSeg2Pt2.x-inSeg2Pt1.x,seg2dy=inSeg2Pt2.y-inSeg2Pt1.y;var seg1seg2dx=inSeg1Pt1.x-inSeg2Pt1.x;var seg1seg2dy=inSeg1Pt1.y-inSeg2Pt1.y;var limit=seg1dy*seg2dx-seg1dx*seg2dy;var perpSeg1=seg1dy*seg1seg2dx-seg1dx*seg1seg2dy;if(Math.abs(limit)>EPSILON){var perpSeg2;if(limit>0){if(perpSeg1<0||perpSeg1>limit)return[];perpSeg2=seg2dy*seg1seg2dx-seg2dx*seg1seg2dy;if(perpSeg2<0||perpSeg2>limit)return[]}else{if(perpSeg1>0||perpSeg1<limit)return[];perpSeg2=seg2dy*seg1seg2dx-seg2dx*seg1seg2dy;if(perpSeg2>0||perpSeg2<limit)return[]}if(perpSeg2==0){if(inExcludeAdjacentSegs&&(perpSeg1==0||perpSeg1==limit))return[];return[inSeg1Pt1]}if(perpSeg2==limit){if(inExcludeAdjacentSegs&&(perpSeg1==0||perpSeg1==limit))return[];return[inSeg1Pt2]}if(perpSeg1==0)return[inSeg2Pt1];if(perpSeg1==limit)return[inSeg2Pt2];var factorSeg1=perpSeg2/limit;return[{x:inSeg1Pt1.x+factorSeg1*seg1dx,y:inSeg1Pt1.y+factorSeg1*seg1dy}]}else{if(perpSeg1!=0||seg2dy*seg1seg2dx!=seg2dx*seg1seg2dy)return[];var seg1Pt=seg1dx==0&&seg1dy==0;var seg2Pt=seg2dx==0&&seg2dy==0;if(seg1Pt&&seg2Pt){if(inSeg1Pt1.x!=inSeg2Pt1.x||inSeg1Pt1.y!=inSeg2Pt1.y)return[];return[inSeg1Pt1]}if(seg1Pt){if(!point_in_segment_2D_colin(inSeg2Pt1,inSeg2Pt2,inSeg1Pt1))return[];return[inSeg1Pt1]}if(seg2Pt){if(!point_in_segment_2D_colin(inSeg1Pt1,inSeg1Pt2,inSeg2Pt1))return[];return[inSeg2Pt1]}var seg1min,seg1max,seg1minVal,seg1maxVal;var seg2min,seg2max,seg2minVal,seg2maxVal;if(seg1dx!=0){if(inSeg1Pt1.x<inSeg1Pt2.x){seg1min=inSeg1Pt1;seg1minVal=inSeg1Pt1.x;seg1max=inSeg1Pt2;seg1maxVal=inSeg1Pt2.x}else{seg1min=inSeg1Pt2;seg1minVal=inSeg1Pt2.x;seg1max=inSeg1Pt1;seg1maxVal=inSeg1Pt1.x}if(inSeg2Pt1.x<inSeg2Pt2.x){seg2min=inSeg2Pt1;seg2minVal=inSeg2Pt1.x;seg2max=inSeg2Pt2;seg2maxVal=inSeg2Pt2.x}else{seg2min=inSeg2Pt2;seg2minVal=inSeg2Pt2.x;seg2max=inSeg2Pt1;seg2maxVal=inSeg2Pt1.x}}else{if(inSeg1Pt1.y<inSeg1Pt2.y){seg1min=inSeg1Pt1;seg1minVal=inSeg1Pt1.y;seg1max=inSeg1Pt2;seg1maxVal=inSeg1Pt2.y}else{seg1min=inSeg1Pt2;seg1minVal=inSeg1Pt2.y;seg1max=inSeg1Pt1;seg1maxVal=inSeg1Pt1.y}if(inSeg2Pt1.y<inSeg2Pt2.y){seg2min=inSeg2Pt1;seg2minVal=inSeg2Pt1.y;seg2max=inSeg2Pt2;seg2maxVal=inSeg2Pt2.y}else{seg2min=inSeg2Pt2;seg2minVal=inSeg2Pt2.y;seg2max=inSeg2Pt1;seg2maxVal=inSeg2Pt1.y}}if(seg1minVal<=seg2minVal){if(seg1maxVal<seg2minVal)return[];if(seg1maxVal==seg2minVal){if(inExcludeAdjacentSegs)return[];return[seg2min]}if(seg1maxVal<=seg2maxVal)return[seg2min,seg1max];return[seg2min,seg2max]}else{if(seg1minVal>seg2maxVal)return[];if(seg1minVal==seg2maxVal){if(inExcludeAdjacentSegs)return[];return[seg1min]}if(seg1maxVal<=seg2maxVal)return[seg1min,seg1max];return[seg1min,seg2max]}}}function isPointInsideAngle(inVertex,inLegFromPt,inLegToPt,inOtherPt){var EPSILON=1e-10;var legFromPtX=inLegFromPt.x-inVertex.x,legFromPtY=inLegFromPt.y-inVertex.y;var legToPtX=inLegToPt.x-inVertex.x,legToPtY=inLegToPt.y-inVertex.y;var otherPtX=inOtherPt.x-inVertex.x,otherPtY=inOtherPt.y-inVertex.y;var from2toAngle=legFromPtX*legToPtY-legFromPtY*legToPtX;var from2otherAngle=legFromPtX*otherPtY-legFromPtY*otherPtX;if(Math.abs(from2toAngle)>EPSILON){var other2toAngle=otherPtX*legToPtY-otherPtY*legToPtX;if(from2toAngle>0){return from2otherAngle>=0&&other2toAngle>=0}else{return from2otherAngle>=0||other2toAngle>=0}}else{return from2otherAngle>0}}function removeHoles(contour,holes){var shape=contour.concat();var hole;function isCutLineInsideAngles(inShapeIdx,inHoleIdx){var lastShapeIdx=shape.length-1;var prevShapeIdx=inShapeIdx-1;if(prevShapeIdx<0)prevShapeIdx=lastShapeIdx;var nextShapeIdx=inShapeIdx+1;if(nextShapeIdx>lastShapeIdx)nextShapeIdx=0;var insideAngle=isPointInsideAngle(shape[inShapeIdx],shape[prevShapeIdx],shape[nextShapeIdx],hole[inHoleIdx]);if(!insideAngle){return false}var lastHoleIdx=hole.length-1;var prevHoleIdx=inHoleIdx-1;if(prevHoleIdx<0)prevHoleIdx=lastHoleIdx;var nextHoleIdx=inHoleIdx+1;if(nextHoleIdx>lastHoleIdx)nextHoleIdx=0;insideAngle=isPointInsideAngle(hole[inHoleIdx],hole[prevHoleIdx],hole[nextHoleIdx],shape[inShapeIdx]);if(!insideAngle){return false}return true}function intersectsShapeEdge(inShapePt,inHolePt){var sIdx,nextIdx,intersection;for(sIdx=0;sIdx<shape.length;sIdx++){nextIdx=sIdx+1;nextIdx%=shape.length;intersection=intersect_segments_2D(inShapePt,inHolePt,shape[sIdx],shape[nextIdx],true);if(intersection.length>0)return true}return false}var indepHoles=[];function intersectsHoleEdge(inShapePt,inHolePt){var ihIdx,chkHole,hIdx,nextIdx,intersection;for(ihIdx=0;ihIdx<indepHoles.length;ihIdx++){chkHole=holes[indepHoles[ihIdx]];for(hIdx=0;hIdx<chkHole.length;hIdx++){nextIdx=hIdx+1;nextIdx%=chkHole.length;intersection=intersect_segments_2D(inShapePt,inHolePt,chkHole[hIdx],chkHole[nextIdx],true);if(intersection.length>0)return true}}return false}var holeIndex,shapeIndex,shapePt,holePt,holeIdx,cutKey,failedCuts=[],tmpShape1,tmpShape2,tmpHole1,tmpHole2;for(var h=0,hl=holes.length;h<hl;h++){indepHoles.push(h)}var minShapeIndex=0;var counter=indepHoles.length*2;while(indepHoles.length>0){counter--;if(counter<0){console.log("Infinite Loop! Holes left:"+indepHoles.length+", Probably Hole outside Shape!");break}for(shapeIndex=minShapeIndex;shapeIndex<shape.length;shapeIndex++){shapePt=shape[shapeIndex];holeIndex=-1;for(var h=0;h<indepHoles.length;h++){holeIdx=indepHoles[h];cutKey=shapePt.x+":"+shapePt.y+":"+holeIdx;if(failedCuts[cutKey]!==undefined)continue;hole=holes[holeIdx];for(var h2=0;h2<hole.length;h2++){holePt=hole[h2];if(!isCutLineInsideAngles(shapeIndex,h2))continue;if(intersectsShapeEdge(shapePt,holePt))continue;if(intersectsHoleEdge(shapePt,holePt))continue;holeIndex=h2;indepHoles.splice(h,1);tmpShape1=shape.slice(0,shapeIndex+1);tmpShape2=shape.slice(shapeIndex);tmpHole1=hole.slice(holeIndex);tmpHole2=hole.slice(0,holeIndex+1);shape=tmpShape1.concat(tmpHole1).concat(tmpHole2).concat(tmpShape2);minShapeIndex=shapeIndex;break}if(holeIndex>=0)break;failedCuts[cutKey]=true}if(holeIndex>=0)break}}return shape}var i,il,f,face,key,index,allPointsMap={};var allpoints=contour.concat();for(var h=0,hl=holes.length;h<hl;h++){Array.prototype.push.apply(allpoints,holes[h])}for(i=0,il=allpoints.length;i<il;i++){key=allpoints[i].x+":"+allpoints[i].y;if(allPointsMap[key]!==undefined){console.log("Duplicate point",key)}allPointsMap[key]=i}var shapeWithoutHoles=removeHoles(contour,holes);var triangles=THREE.FontUtils.Triangulate(shapeWithoutHoles,false);for(i=0,il=triangles.length;i<il;i++){face=triangles[i];for(f=0;f<3;f++){key=face[f].x+":"+face[f].y;index=allPointsMap[key];if(index!==undefined){face[f]=index}}}return triangles.concat()},isClockWise:function(pts){return THREE.FontUtils.Triangulate.area(pts)<0},b2p0:function(t,p){var k=1-t;return k*k*p},b2p1:function(t,p){return 2*(1-t)*t*p},b2p2:function(t,p){return t*t*p},b2:function(t,p0,p1,p2){return this.b2p0(t,p0)+this.b2p1(t,p1)+this.b2p2(t,p2)},b3p0:function(t,p){var k=1-t;return k*k*k*p},b3p1:function(t,p){var k=1-t;return 3*k*k*t*p},b3p2:function(t,p){var k=1-t;return 3*k*t*t*p},b3p3:function(t,p){return t*t*t*p},b3:function(t,p0,p1,p2,p3){return this.b3p0(t,p0)+this.b3p1(t,p1)+this.b3p2(t,p2)+this.b3p3(t,p3)}};THREE.LineCurve=function(v1,v2){this.v1=v1;this.v2=v2};THREE.LineCurve.prototype=Object.create(THREE.Curve.prototype);THREE.LineCurve.prototype.getPoint=function(t){var point=this.v2.clone().sub(this.v1);point.multiplyScalar(t).add(this.v1);return point};THREE.LineCurve.prototype.getPointAt=function(u){return this.getPoint(u)};THREE.LineCurve.prototype.getTangent=function(t){var tangent=this.v2.clone().sub(this.v1);return tangent.normalize()};THREE.QuadraticBezierCurve=function(v0,v1,v2){this.v0=v0;this.v1=v1;this.v2=v2};THREE.QuadraticBezierCurve.prototype=Object.create(THREE.Curve.prototype);THREE.QuadraticBezierCurve.prototype.getPoint=function(t){var vector=new THREE.Vector2;vector.x=THREE.Shape.Utils.b2(t,this.v0.x,this.v1.x,this.v2.x);vector.y=THREE.Shape.Utils.b2(t,this.v0.y,this.v1.y,this.v2.y);return vector};THREE.QuadraticBezierCurve.prototype.getTangent=function(t){var vector=new THREE.Vector2;vector.x=THREE.Curve.Utils.tangentQuadraticBezier(t,this.v0.x,this.v1.x,this.v2.x);vector.y=THREE.Curve.Utils.tangentQuadraticBezier(t,this.v0.y,this.v1.y,this.v2.y);return vector.normalize()};THREE.CubicBezierCurve=function(v0,v1,v2,v3){this.v0=v0;this.v1=v1;this.v2=v2;this.v3=v3};THREE.CubicBezierCurve.prototype=Object.create(THREE.Curve.prototype);THREE.CubicBezierCurve.prototype.getPoint=function(t){var tx,ty;tx=THREE.Shape.Utils.b3(t,this.v0.x,this.v1.x,this.v2.x,this.v3.x);ty=THREE.Shape.Utils.b3(t,this.v0.y,this.v1.y,this.v2.y,this.v3.y);return new THREE.Vector2(tx,ty)};THREE.CubicBezierCurve.prototype.getTangent=function(t){var tx,ty;tx=THREE.Curve.Utils.tangentCubicBezier(t,this.v0.x,this.v1.x,this.v2.x,this.v3.x);ty=THREE.Curve.Utils.tangentCubicBezier(t,this.v0.y,this.v1.y,this.v2.y,this.v3.y);var tangent=new THREE.Vector2(tx,ty);tangent.normalize();return tangent};THREE.SplineCurve=function(points){this.points=points==undefined?[]:points};THREE.SplineCurve.prototype=Object.create(THREE.Curve.prototype);THREE.SplineCurve.prototype.getPoint=function(t){var points=this.points;var point=(points.length-1)*t;var intPoint=Math.floor(point);var weight=point-intPoint;var point0=points[intPoint==0?intPoint:intPoint-1];var point1=points[intPoint];var point2=points[intPoint>points.length-2?points.length-1:intPoint+1];var point3=points[intPoint>points.length-3?points.length-1:intPoint+2];var vector=new THREE.Vector2;vector.x=THREE.Curve.Utils.interpolate(point0.x,point1.x,point2.x,point3.x,weight);vector.y=THREE.Curve.Utils.interpolate(point0.y,point1.y,point2.y,point3.y,weight);return vector};THREE.EllipseCurve=function(aX,aY,xRadius,yRadius,aStartAngle,aEndAngle,aClockwise){this.aX=aX;this.aY=aY;this.xRadius=xRadius;this.yRadius=yRadius;this.aStartAngle=aStartAngle;this.aEndAngle=aEndAngle;this.aClockwise=aClockwise};THREE.EllipseCurve.prototype=Object.create(THREE.Curve.prototype);THREE.EllipseCurve.prototype.getPoint=function(t){var deltaAngle=this.aEndAngle-this.aStartAngle;if(deltaAngle<0)deltaAngle+=Math.PI*2;if(deltaAngle>Math.PI*2)deltaAngle-=Math.PI*2;var angle;if(this.aClockwise===true){angle=this.aEndAngle+(1-t)*(Math.PI*2-deltaAngle)}else{angle=this.aStartAngle+t*deltaAngle}var vector=new THREE.Vector2;vector.x=this.aX+this.xRadius*Math.cos(angle);vector.y=this.aY+this.yRadius*Math.sin(angle);return vector};THREE.ArcCurve=function(aX,aY,aRadius,aStartAngle,aEndAngle,aClockwise){THREE.EllipseCurve.call(this,aX,aY,aRadius,aRadius,aStartAngle,aEndAngle,aClockwise)};THREE.ArcCurve.prototype=Object.create(THREE.EllipseCurve.prototype);THREE.LineCurve3=THREE.Curve.create(function(v1,v2){this.v1=v1;this.v2=v2},function(t){var vector=new THREE.Vector3;vector.subVectors(this.v2,this.v1);vector.multiplyScalar(t);vector.add(this.v1);return vector});THREE.QuadraticBezierCurve3=THREE.Curve.create(function(v0,v1,v2){this.v0=v0;this.v1=v1;this.v2=v2},function(t){var vector=new THREE.Vector3;vector.x=THREE.Shape.Utils.b2(t,this.v0.x,this.v1.x,this.v2.x);vector.y=THREE.Shape.Utils.b2(t,this.v0.y,this.v1.y,this.v2.y);vector.z=THREE.Shape.Utils.b2(t,this.v0.z,this.v1.z,this.v2.z);return vector});THREE.CubicBezierCurve3=THREE.Curve.create(function(v0,v1,v2,v3){this.v0=v0;this.v1=v1;this.v2=v2;this.v3=v3},function(t){var vector=new THREE.Vector3;vector.x=THREE.Shape.Utils.b3(t,this.v0.x,this.v1.x,this.v2.x,this.v3.x);vector.y=THREE.Shape.Utils.b3(t,this.v0.y,this.v1.y,this.v2.y,this.v3.y);vector.z=THREE.Shape.Utils.b3(t,this.v0.z,this.v1.z,this.v2.z,this.v3.z);return vector});THREE.SplineCurve3=THREE.Curve.create(function(points){this.points=points==undefined?[]:points},function(t){var points=this.points;var point=(points.length-1)*t;var intPoint=Math.floor(point);var weight=point-intPoint;var point0=points[intPoint==0?intPoint:intPoint-1];var point1=points[intPoint];var point2=points[intPoint>points.length-2?points.length-1:intPoint+1];var point3=points[intPoint>points.length-3?points.length-1:intPoint+2];var vector=new THREE.Vector3;vector.x=THREE.Curve.Utils.interpolate(point0.x,point1.x,point2.x,point3.x,weight);vector.y=THREE.Curve.Utils.interpolate(point0.y,point1.y,point2.y,point3.y,weight);vector.z=THREE.Curve.Utils.interpolate(point0.z,point1.z,point2.z,point3.z,weight);return vector});THREE.ClosedSplineCurve3=THREE.Curve.create(function(points){this.points=points==undefined?[]:points},function(t){var points=this.points;var point=(points.length-0)*t;var intPoint=Math.floor(point);var weight=point-intPoint;intPoint+=intPoint>0?0:(Math.floor(Math.abs(intPoint)/points.length)+1)*points.length;var point0=points[(intPoint-1)%points.length];var point1=points[intPoint%points.length];var point2=points[(intPoint+1)%points.length];var point3=points[(intPoint+2)%points.length];var vector=new THREE.Vector3;vector.x=THREE.Curve.Utils.interpolate(point0.x,point1.x,point2.x,point3.x,weight);
vector.y=THREE.Curve.Utils.interpolate(point0.y,point1.y,point2.y,point3.y,weight);vector.z=THREE.Curve.Utils.interpolate(point0.z,point1.z,point2.z,point3.z,weight);return vector});THREE.AnimationHandler={LINEAR:0,CATMULLROM:1,CATMULLROM_FORWARD:2,add:function(){console.warn("THREE.AnimationHandler.add() has been deprecated.")},get:function(){console.warn("THREE.AnimationHandler.get() has been deprecated.")},remove:function(){console.warn("THREE.AnimationHandler.remove() has been deprecated.")},animations:[],init:function(data){if(data.initialized===true)return;for(var h=0;h<data.hierarchy.length;h++){for(var k=0;k<data.hierarchy[h].keys.length;k++){if(data.hierarchy[h].keys[k].time<0){data.hierarchy[h].keys[k].time=0}if(data.hierarchy[h].keys[k].rot!==undefined&&!(data.hierarchy[h].keys[k].rot instanceof THREE.Quaternion)){var quat=data.hierarchy[h].keys[k].rot;data.hierarchy[h].keys[k].rot=(new THREE.Quaternion).fromArray(quat)}}if(data.hierarchy[h].keys.length&&data.hierarchy[h].keys[0].morphTargets!==undefined){var usedMorphTargets={};for(var k=0;k<data.hierarchy[h].keys.length;k++){for(var m=0;m<data.hierarchy[h].keys[k].morphTargets.length;m++){var morphTargetName=data.hierarchy[h].keys[k].morphTargets[m];usedMorphTargets[morphTargetName]=-1}}data.hierarchy[h].usedMorphTargets=usedMorphTargets;for(var k=0;k<data.hierarchy[h].keys.length;k++){var influences={};for(var morphTargetName in usedMorphTargets){for(var m=0;m<data.hierarchy[h].keys[k].morphTargets.length;m++){if(data.hierarchy[h].keys[k].morphTargets[m]===morphTargetName){influences[morphTargetName]=data.hierarchy[h].keys[k].morphTargetsInfluences[m];break}}if(m===data.hierarchy[h].keys[k].morphTargets.length){influences[morphTargetName]=0}}data.hierarchy[h].keys[k].morphTargetsInfluences=influences}}for(var k=1;k<data.hierarchy[h].keys.length;k++){if(data.hierarchy[h].keys[k].time===data.hierarchy[h].keys[k-1].time){data.hierarchy[h].keys.splice(k,1);k--}}for(var k=0;k<data.hierarchy[h].keys.length;k++){data.hierarchy[h].keys[k].index=k}}data.initialized=true;return data},parse:function(root){var parseRecurseHierarchy=function(root,hierarchy){hierarchy.push(root);for(var c=0;c<root.children.length;c++)parseRecurseHierarchy(root.children[c],hierarchy)};var hierarchy=[];if(root instanceof THREE.SkinnedMesh){for(var b=0;b<root.skeleton.bones.length;b++){hierarchy.push(root.skeleton.bones[b])}}else{parseRecurseHierarchy(root,hierarchy)}return hierarchy},play:function(animation){if(this.animations.indexOf(animation)===-1){this.animations.push(animation)}},stop:function(animation){var index=this.animations.indexOf(animation);if(index!==-1){this.animations.splice(index,1)}},update:function(deltaTimeMS){for(var i=0;i<this.animations.length;i++){this.animations[i].resetBlendWeights()}for(var i=0;i<this.animations.length;i++){this.animations[i].update(deltaTimeMS)}}};THREE.Animation=function(root,data){this.root=root;this.data=THREE.AnimationHandler.init(data);this.hierarchy=THREE.AnimationHandler.parse(root);this.currentTime=0;this.timeScale=1;this.isPlaying=false;this.loop=true;this.weight=0;this.interpolationType=THREE.AnimationHandler.LINEAR};THREE.Animation.prototype.keyTypes=["pos","rot","scl"];THREE.Animation.prototype.play=function(startTime,weight){this.currentTime=startTime!==undefined?startTime:0;this.weight=weight!==undefined?weight:1;this.isPlaying=true;this.reset();THREE.AnimationHandler.play(this)};THREE.Animation.prototype.stop=function(){this.isPlaying=false;THREE.AnimationHandler.stop(this)};THREE.Animation.prototype.reset=function(){for(var h=0,hl=this.hierarchy.length;h<hl;h++){var object=this.hierarchy[h];object.matrixAutoUpdate=true;if(object.animationCache===undefined){object.animationCache={animations:{},blending:{positionWeight:0,quaternionWeight:0,scaleWeight:0}}}if(object.animationCache.animations[this.data.name]===undefined){object.animationCache.animations[this.data.name]={};object.animationCache.animations[this.data.name].prevKey={pos:0,rot:0,scl:0};object.animationCache.animations[this.data.name].nextKey={pos:0,rot:0,scl:0};object.animationCache.animations[this.data.name].originalMatrix=object.matrix}var animationCache=object.animationCache.animations[this.data.name];for(var t=0;t<3;t++){var type=this.keyTypes[t];var prevKey=this.data.hierarchy[h].keys[0];var nextKey=this.getNextKeyWith(type,h,1);while(nextKey.time<this.currentTime&&nextKey.index>prevKey.index){prevKey=nextKey;nextKey=this.getNextKeyWith(type,h,nextKey.index+1)}animationCache.prevKey[type]=prevKey;animationCache.nextKey[type]=nextKey}}};THREE.Animation.prototype.resetBlendWeights=function(){for(var h=0,hl=this.hierarchy.length;h<hl;h++){var object=this.hierarchy[h];if(object.animationCache!==undefined){object.animationCache.blending.positionWeight=0;object.animationCache.blending.quaternionWeight=0;object.animationCache.blending.scaleWeight=0}}};THREE.Animation.prototype.update=function(){var points=[];var target=new THREE.Vector3;var newVector=new THREE.Vector3;var newQuat=new THREE.Quaternion;var interpolateCatmullRom=function(points,scale){var c=[],v3=[],point,intPoint,weight,w2,w3,pa,pb,pc,pd;point=(points.length-1)*scale;intPoint=Math.floor(point);weight=point-intPoint;c[0]=intPoint===0?intPoint:intPoint-1;c[1]=intPoint;c[2]=intPoint>points.length-2?intPoint:intPoint+1;c[3]=intPoint>points.length-3?intPoint:intPoint+2;pa=points[c[0]];pb=points[c[1]];pc=points[c[2]];pd=points[c[3]];w2=weight*weight;w3=weight*w2;v3[0]=interpolate(pa[0],pb[0],pc[0],pd[0],weight,w2,w3);v3[1]=interpolate(pa[1],pb[1],pc[1],pd[1],weight,w2,w3);v3[2]=interpolate(pa[2],pb[2],pc[2],pd[2],weight,w2,w3);return v3};var interpolate=function(p0,p1,p2,p3,t,t2,t3){var v0=(p2-p0)*.5,v1=(p3-p1)*.5;return(2*(p1-p2)+v0+v1)*t3+(-3*(p1-p2)-2*v0-v1)*t2+v0*t+p1};return function(delta){if(this.isPlaying===false)return;this.currentTime+=delta*this.timeScale;if(this.weight===0)return;var duration=this.data.length;if(this.currentTime>duration||this.currentTime<0){if(this.loop){this.currentTime%=duration;if(this.currentTime<0)this.currentTime+=duration;this.reset()}else{this.stop();return}}for(var h=0,hl=this.hierarchy.length;h<hl;h++){var object=this.hierarchy[h];var animationCache=object.animationCache.animations[this.data.name];var blending=object.animationCache.blending;for(var t=0;t<3;t++){var type=this.keyTypes[t];var prevKey=animationCache.prevKey[type];var nextKey=animationCache.nextKey[type];if(this.timeScale>0&&nextKey.time<=this.currentTime||this.timeScale<0&&prevKey.time>=this.currentTime){prevKey=this.data.hierarchy[h].keys[0];nextKey=this.getNextKeyWith(type,h,1);while(nextKey.time<this.currentTime&&nextKey.index>prevKey.index){prevKey=nextKey;nextKey=this.getNextKeyWith(type,h,nextKey.index+1)}animationCache.prevKey[type]=prevKey;animationCache.nextKey[type]=nextKey}object.matrixAutoUpdate=true;object.matrixWorldNeedsUpdate=true;var scale=(this.currentTime-prevKey.time)/(nextKey.time-prevKey.time);var prevXYZ=prevKey[type];var nextXYZ=nextKey[type];if(scale<0)scale=0;if(scale>1)scale=1;if(type==="pos"){if(this.interpolationType===THREE.AnimationHandler.LINEAR){newVector.x=prevXYZ[0]+(nextXYZ[0]-prevXYZ[0])*scale;newVector.y=prevXYZ[1]+(nextXYZ[1]-prevXYZ[1])*scale;newVector.z=prevXYZ[2]+(nextXYZ[2]-prevXYZ[2])*scale;var proportionalWeight=this.weight/(this.weight+blending.positionWeight);object.position.lerp(newVector,proportionalWeight);blending.positionWeight+=this.weight}else if(this.interpolationType===THREE.AnimationHandler.CATMULLROM||this.interpolationType===THREE.AnimationHandler.CATMULLROM_FORWARD){points[0]=this.getPrevKeyWith("pos",h,prevKey.index-1)["pos"];points[1]=prevXYZ;points[2]=nextXYZ;points[3]=this.getNextKeyWith("pos",h,nextKey.index+1)["pos"];scale=scale*.33+.33;var currentPoint=interpolateCatmullRom(points,scale);var proportionalWeight=this.weight/(this.weight+blending.positionWeight);blending.positionWeight+=this.weight;var vector=object.position;vector.x=vector.x+(currentPoint[0]-vector.x)*proportionalWeight;vector.y=vector.y+(currentPoint[1]-vector.y)*proportionalWeight;vector.z=vector.z+(currentPoint[2]-vector.z)*proportionalWeight;if(this.interpolationType===THREE.AnimationHandler.CATMULLROM_FORWARD){var forwardPoint=interpolateCatmullRom(points,scale*1.01);target.set(forwardPoint[0],forwardPoint[1],forwardPoint[2]);target.sub(vector);target.y=0;target.normalize();var angle=Math.atan2(target.x,target.z);object.rotation.set(0,angle,0)}}}else if(type==="rot"){THREE.Quaternion.slerp(prevXYZ,nextXYZ,newQuat,scale);if(blending.quaternionWeight===0){object.quaternion.copy(newQuat);blending.quaternionWeight=this.weight}else{var proportionalWeight=this.weight/(this.weight+blending.quaternionWeight);THREE.Quaternion.slerp(object.quaternion,newQuat,object.quaternion,proportionalWeight);blending.quaternionWeight+=this.weight}}else if(type==="scl"){newVector.x=prevXYZ[0]+(nextXYZ[0]-prevXYZ[0])*scale;newVector.y=prevXYZ[1]+(nextXYZ[1]-prevXYZ[1])*scale;newVector.z=prevXYZ[2]+(nextXYZ[2]-prevXYZ[2])*scale;var proportionalWeight=this.weight/(this.weight+blending.scaleWeight);object.scale.lerp(newVector,proportionalWeight);blending.scaleWeight+=this.weight}}}return true}}();THREE.Animation.prototype.getNextKeyWith=function(type,h,key){var keys=this.data.hierarchy[h].keys;if(this.interpolationType===THREE.AnimationHandler.CATMULLROM||this.interpolationType===THREE.AnimationHandler.CATMULLROM_FORWARD){key=key<keys.length-1?key:keys.length-1}else{key=key%keys.length}for(;key<keys.length;key++){if(keys[key][type]!==undefined){return keys[key]}}return this.data.hierarchy[h].keys[0]};THREE.Animation.prototype.getPrevKeyWith=function(type,h,key){var keys=this.data.hierarchy[h].keys;if(this.interpolationType===THREE.AnimationHandler.CATMULLROM||this.interpolationType===THREE.AnimationHandler.CATMULLROM_FORWARD){key=key>0?key:0}else{key=key>=0?key:key+keys.length}for(;key>=0;key--){if(keys[key][type]!==undefined){return keys[key]}}return this.data.hierarchy[h].keys[keys.length-1]};THREE.KeyFrameAnimation=function(data){this.root=data.node;this.data=THREE.AnimationHandler.init(data);this.hierarchy=THREE.AnimationHandler.parse(this.root);this.currentTime=0;this.timeScale=.001;this.isPlaying=false;this.isPaused=true;this.loop=true;for(var h=0,hl=this.hierarchy.length;h<hl;h++){var keys=this.data.hierarchy[h].keys,sids=this.data.hierarchy[h].sids,obj=this.hierarchy[h];if(keys.length&&sids){for(var s=0;s<sids.length;s++){var sid=sids[s],next=this.getNextKeyWith(sid,h,0);if(next){next.apply(sid)}}obj.matrixAutoUpdate=false;this.data.hierarchy[h].node.updateMatrix();obj.matrixWorldNeedsUpdate=true}}};THREE.KeyFrameAnimation.prototype.play=function(startTime){this.currentTime=startTime!==undefined?startTime:0;if(this.isPlaying===false){this.isPlaying=true;var h,hl=this.hierarchy.length,object,node;for(h=0;h<hl;h++){object=this.hierarchy[h];node=this.data.hierarchy[h];if(node.animationCache===undefined){node.animationCache={};node.animationCache.prevKey=null;node.animationCache.nextKey=null;node.animationCache.originalMatrix=object.matrix}var keys=this.data.hierarchy[h].keys;if(keys.length){node.animationCache.prevKey=keys[0];node.animationCache.nextKey=keys[1];this.startTime=Math.min(keys[0].time,this.startTime);this.endTime=Math.max(keys[keys.length-1].time,this.endTime)}}this.update(0)}this.isPaused=false;THREE.AnimationHandler.play(this)};THREE.KeyFrameAnimation.prototype.stop=function(){this.isPlaying=false;this.isPaused=false;THREE.AnimationHandler.stop(this);for(var h=0;h<this.data.hierarchy.length;h++){var obj=this.hierarchy[h];var node=this.data.hierarchy[h];if(node.animationCache!==undefined){var original=node.animationCache.originalMatrix;original.copy(obj.matrix);obj.matrix=original;delete node.animationCache}}};THREE.KeyFrameAnimation.prototype.update=function(delta){if(this.isPlaying===false)return;this.currentTime+=delta*this.timeScale;var duration=this.data.length;if(this.loop===true&&this.currentTime>duration){this.currentTime%=duration}this.currentTime=Math.min(this.currentTime,duration);for(var h=0,hl=this.hierarchy.length;h<hl;h++){var object=this.hierarchy[h];var node=this.data.hierarchy[h];var keys=node.keys,animationCache=node.animationCache;if(keys.length){var prevKey=animationCache.prevKey;var nextKey=animationCache.nextKey;if(nextKey.time<=this.currentTime){while(nextKey.time<this.currentTime&&nextKey.index>prevKey.index){prevKey=nextKey;nextKey=keys[prevKey.index+1]}animationCache.prevKey=prevKey;animationCache.nextKey=nextKey}if(nextKey.time>=this.currentTime){prevKey.interpolate(nextKey,this.currentTime)}else{prevKey.interpolate(nextKey,nextKey.time)}this.data.hierarchy[h].node.updateMatrix();object.matrixWorldNeedsUpdate=true}}};THREE.KeyFrameAnimation.prototype.getNextKeyWith=function(sid,h,key){var keys=this.data.hierarchy[h].keys;key=key%keys.length;for(;key<keys.length;key++){if(keys[key].hasTarget(sid)){return keys[key]}}return keys[0]};THREE.KeyFrameAnimation.prototype.getPrevKeyWith=function(sid,h,key){var keys=this.data.hierarchy[h].keys;key=key>=0?key:key+keys.length;for(;key>=0;key--){if(keys[key].hasTarget(sid)){return keys[key]}}return keys[keys.length-1]};THREE.MorphAnimation=function(mesh){this.mesh=mesh;this.frames=mesh.morphTargetInfluences.length;this.currentTime=0;this.duration=1e3;this.loop=true;this.isPlaying=false};THREE.MorphAnimation.prototype={play:function(){this.isPlaying=true},pause:function(){this.isPlaying=false},update:function(){var lastFrame=0;var currentFrame=0;return function(delta){if(this.isPlaying===false)return;this.currentTime+=delta;if(this.loop===true&&this.currentTime>this.duration){this.currentTime%=this.duration}this.currentTime=Math.min(this.currentTime,this.duration);var interpolation=this.duration/this.frames;var frame=Math.floor(this.currentTime/interpolation);if(frame!=currentFrame){this.mesh.morphTargetInfluences[lastFrame]=0;this.mesh.morphTargetInfluences[currentFrame]=1;this.mesh.morphTargetInfluences[frame]=0;lastFrame=currentFrame;currentFrame=frame}this.mesh.morphTargetInfluences[frame]=this.currentTime%interpolation/interpolation;this.mesh.morphTargetInfluences[lastFrame]=1-this.mesh.morphTargetInfluences[frame]}}()};THREE.BoxGeometry=function(width,height,depth,widthSegments,heightSegments,depthSegments){THREE.Geometry.call(this);this.type="BoxGeometry";this.parameters={width:width,height:height,depth:depth,widthSegments:widthSegments,heightSegments:heightSegments,depthSegments:depthSegments};this.widthSegments=widthSegments||1;this.heightSegments=heightSegments||1;this.depthSegments=depthSegments||1;var scope=this;var width_half=width/2;var height_half=height/2;var depth_half=depth/2;buildPlane("z","y",-1,-1,depth,height,width_half,0);buildPlane("z","y",1,-1,depth,height,-width_half,1);buildPlane("x","z",1,1,width,depth,height_half,2);buildPlane("x","z",1,-1,width,depth,-height_half,3);buildPlane("x","y",1,-1,width,height,depth_half,4);buildPlane("x","y",-1,-1,width,height,-depth_half,5);function buildPlane(u,v,udir,vdir,width,height,depth,materialIndex){var w,ix,iy,gridX=scope.widthSegments,gridY=scope.heightSegments,width_half=width/2,height_half=height/2,offset=scope.vertices.length;if(u==="x"&&v==="y"||u==="y"&&v==="x"){w="z"}else if(u==="x"&&v==="z"||u==="z"&&v==="x"){w="y";gridY=scope.depthSegments}else if(u==="z"&&v==="y"||u==="y"&&v==="z"){w="x";gridX=scope.depthSegments}var gridX1=gridX+1,gridY1=gridY+1,segment_width=width/gridX,segment_height=height/gridY,normal=new THREE.Vector3;normal[w]=depth>0?1:-1;for(iy=0;iy<gridY1;iy++){for(ix=0;ix<gridX1;ix++){var vector=new THREE.Vector3;vector[u]=(ix*segment_width-width_half)*udir;vector[v]=(iy*segment_height-height_half)*vdir;vector[w]=depth;scope.vertices.push(vector)}}for(iy=0;iy<gridY;iy++){for(ix=0;ix<gridX;ix++){var a=ix+gridX1*iy;var b=ix+gridX1*(iy+1);var c=ix+1+gridX1*(iy+1);var d=ix+1+gridX1*iy;var uva=new THREE.Vector2(ix/gridX,1-iy/gridY);var uvb=new THREE.Vector2(ix/gridX,1-(iy+1)/gridY);var uvc=new THREE.Vector2((ix+1)/gridX,1-(iy+1)/gridY);var uvd=new THREE.Vector2((ix+1)/gridX,1-iy/gridY);var face=new THREE.Face3(a+offset,b+offset,d+offset);face.normal.copy(normal);face.vertexNormals.push(normal.clone(),normal.clone(),normal.clone());face.materialIndex=materialIndex;scope.faces.push(face);scope.faceVertexUvs[0].push([uva,uvb,uvd]);face=new THREE.Face3(b+offset,c+offset,d+offset);face.normal.copy(normal);face.vertexNormals.push(normal.clone(),normal.clone(),normal.clone());face.materialIndex=materialIndex;scope.faces.push(face);scope.faceVertexUvs[0].push([uvb.clone(),uvc,uvd.clone()])}}}this.mergeVertices()};THREE.BoxGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.CircleGeometry=function(radius,segments,thetaStart,thetaLength){THREE.Geometry.call(this);this.type="CircleGeometry";this.parameters={radius:radius,segments:segments,thetaStart:thetaStart,thetaLength:thetaLength};radius=radius||50;segments=segments!==undefined?Math.max(3,segments):8;thetaStart=thetaStart!==undefined?thetaStart:0;thetaLength=thetaLength!==undefined?thetaLength:Math.PI*2;var i,uvs=[],center=new THREE.Vector3,centerUV=new THREE.Vector2(.5,.5);this.vertices.push(center);uvs.push(centerUV);for(i=0;i<=segments;i++){var vertex=new THREE.Vector3;var segment=thetaStart+i/segments*thetaLength;vertex.x=radius*Math.cos(segment);vertex.y=radius*Math.sin(segment);this.vertices.push(vertex);uvs.push(new THREE.Vector2((vertex.x/radius+1)/2,(vertex.y/radius+1)/2))}var n=new THREE.Vector3(0,0,1);for(i=1;i<=segments;i++){this.faces.push(new THREE.Face3(i,i+1,0,[n.clone(),n.clone(),n.clone()]));this.faceVertexUvs[0].push([uvs[i].clone(),uvs[i+1].clone(),centerUV.clone()])}this.computeFaceNormals();this.boundingSphere=new THREE.Sphere(new THREE.Vector3,radius)};THREE.CircleGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.CubeGeometry=function(width,height,depth,widthSegments,heightSegments,depthSegments){console.warn("THREE.CubeGeometry has been renamed to THREE.BoxGeometry.");return new THREE.BoxGeometry(width,height,depth,widthSegments,heightSegments,depthSegments)};THREE.CylinderGeometry=function(radiusTop,radiusBottom,height,radialSegments,heightSegments,openEnded){THREE.Geometry.call(this);this.type="CylinderGeometry";this.parameters={radiusTop:radiusTop,radiusBottom:radiusBottom,height:height,radialSegments:radialSegments,heightSegments:heightSegments,openEnded:openEnded};radiusTop=radiusTop!==undefined?radiusTop:20;radiusBottom=radiusBottom!==undefined?radiusBottom:20;height=height!==undefined?height:100;radialSegments=radialSegments||8;heightSegments=heightSegments||1;openEnded=openEnded!==undefined?openEnded:false;var heightHalf=height/2;var x,y,vertices=[],uvs=[];for(y=0;y<=heightSegments;y++){var verticesRow=[];var uvsRow=[];var v=y/heightSegments;var radius=v*(radiusBottom-radiusTop)+radiusTop;for(x=0;x<=radialSegments;x++){var u=x/radialSegments;var vertex=new THREE.Vector3;vertex.x=radius*Math.sin(u*Math.PI*2);vertex.y=-v*height+heightHalf;vertex.z=radius*Math.cos(u*Math.PI*2);this.vertices.push(vertex);verticesRow.push(this.vertices.length-1);uvsRow.push(new THREE.Vector2(u,1-v))}vertices.push(verticesRow);uvs.push(uvsRow)}var tanTheta=(radiusBottom-radiusTop)/height;var na,nb;for(x=0;x<radialSegments;x++){if(radiusTop!==0){na=this.vertices[vertices[0][x]].clone();nb=this.vertices[vertices[0][x+1]].clone()}else{na=this.vertices[vertices[1][x]].clone();nb=this.vertices[vertices[1][x+1]].clone()}na.setY(Math.sqrt(na.x*na.x+na.z*na.z)*tanTheta).normalize();nb.setY(Math.sqrt(nb.x*nb.x+nb.z*nb.z)*tanTheta).normalize();for(y=0;y<heightSegments;y++){var v1=vertices[y][x];var v2=vertices[y+1][x];var v3=vertices[y+1][x+1];var v4=vertices[y][x+1];var n1=na.clone();var n2=na.clone();var n3=nb.clone();var n4=nb.clone();var uv1=uvs[y][x].clone();var uv2=uvs[y+1][x].clone();var uv3=uvs[y+1][x+1].clone();var uv4=uvs[y][x+1].clone();this.faces.push(new THREE.Face3(v1,v2,v4,[n1,n2,n4]));this.faceVertexUvs[0].push([uv1,uv2,uv4]);this.faces.push(new THREE.Face3(v2,v3,v4,[n2.clone(),n3,n4.clone()]));this.faceVertexUvs[0].push([uv2.clone(),uv3,uv4.clone()])}}if(openEnded===false&&radiusTop>0){this.vertices.push(new THREE.Vector3(0,heightHalf,0));for(x=0;x<radialSegments;x++){var v1=vertices[0][x];var v2=vertices[0][x+1];var v3=this.vertices.length-1;var n1=new THREE.Vector3(0,1,0);var n2=new THREE.Vector3(0,1,0);var n3=new THREE.Vector3(0,1,0);var uv1=uvs[0][x].clone();var uv2=uvs[0][x+1].clone();var uv3=new THREE.Vector2(uv2.x,0);this.faces.push(new THREE.Face3(v1,v2,v3,[n1,n2,n3]));this.faceVertexUvs[0].push([uv1,uv2,uv3])}}if(openEnded===false&&radiusBottom>0){this.vertices.push(new THREE.Vector3(0,-heightHalf,0));for(x=0;x<radialSegments;x++){var v1=vertices[y][x+1];var v2=vertices[y][x];var v3=this.vertices.length-1;var n1=new THREE.Vector3(0,-1,0);var n2=new THREE.Vector3(0,-1,0);var n3=new THREE.Vector3(0,-1,0);var uv1=uvs[y][x+1].clone();var uv2=uvs[y][x].clone();var uv3=new THREE.Vector2(uv2.x,1);this.faces.push(new THREE.Face3(v1,v2,v3,[n1,n2,n3]));this.faceVertexUvs[0].push([uv1,uv2,uv3])}}this.computeFaceNormals()};THREE.CylinderGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.ExtrudeGeometry=function(shapes,options){if(typeof shapes==="undefined"){shapes=[];return}THREE.Geometry.call(this);this.type="ExtrudeGeometry";shapes=shapes instanceof Array?shapes:[shapes];this.addShapeList(shapes,options);this.computeFaceNormals()};THREE.ExtrudeGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.ExtrudeGeometry.prototype.addShapeList=function(shapes,options){var sl=shapes.length;for(var s=0;s<sl;s++){var shape=shapes[s];this.addShape(shape,options)}};THREE.ExtrudeGeometry.prototype.addShape=function(shape,options){var amount=options.amount!==undefined?options.amount:100;var bevelThickness=options.bevelThickness!==undefined?options.bevelThickness:6;var bevelSize=options.bevelSize!==undefined?options.bevelSize:bevelThickness-2;var bevelSegments=options.bevelSegments!==undefined?options.bevelSegments:3;var bevelEnabled=options.bevelEnabled!==undefined?options.bevelEnabled:true;var curveSegments=options.curveSegments!==undefined?options.curveSegments:12;var steps=options.steps!==undefined?options.steps:1;var extrudePath=options.extrudePath;var extrudePts,extrudeByPath=false;var material=options.material;var extrudeMaterial=options.extrudeMaterial;var uvgen=options.UVGenerator!==undefined?options.UVGenerator:THREE.ExtrudeGeometry.WorldUVGenerator;var splineTube,binormal,normal,position2;if(extrudePath){extrudePts=extrudePath.getSpacedPoints(steps);extrudeByPath=true;bevelEnabled=false;splineTube=options.frames!==undefined?options.frames:new THREE.TubeGeometry.FrenetFrames(extrudePath,steps,false);binormal=new THREE.Vector3;normal=new THREE.Vector3;position2=new THREE.Vector3}if(!bevelEnabled){bevelSegments=0;bevelThickness=0;bevelSize=0}var ahole,h,hl;var scope=this;var bevelPoints=[];var shapesOffset=this.vertices.length;var shapePoints=shape.extractPoints(curveSegments);var vertices=shapePoints.shape;var holes=shapePoints.holes;var reverse=!THREE.Shape.Utils.isClockWise(vertices);if(reverse){vertices=vertices.reverse();for(h=0,hl=holes.length;h<hl;h++){ahole=holes[h];if(THREE.Shape.Utils.isClockWise(ahole)){holes[h]=ahole.reverse()}}reverse=false}var faces=THREE.Shape.Utils.triangulateShape(vertices,holes);var contour=vertices;for(h=0,hl=holes.length;h<hl;h++){ahole=holes[h];vertices=vertices.concat(ahole)}function scalePt2(pt,vec,size){if(!vec)console.log("die");return vec.clone().multiplyScalar(size).add(pt)}var b,bs,t,z,vert,vlen=vertices.length,face,flen=faces.length,cont,clen=contour.length;var RAD_TO_DEGREES=180/Math.PI;function getBevelVec(inPt,inPrev,inNext){var EPSILON=1e-10;var v_trans_x,v_trans_y,shrink_by=1;var v_prev_x=inPt.x-inPrev.x,v_prev_y=inPt.y-inPrev.y;var v_next_x=inNext.x-inPt.x,v_next_y=inNext.y-inPt.y;var v_prev_lensq=v_prev_x*v_prev_x+v_prev_y*v_prev_y;var colinear0=v_prev_x*v_next_y-v_prev_y*v_next_x;if(Math.abs(colinear0)>EPSILON){var v_prev_len=Math.sqrt(v_prev_lensq);var v_next_len=Math.sqrt(v_next_x*v_next_x+v_next_y*v_next_y);var ptPrevShift_x=inPrev.x-v_prev_y/v_prev_len;var ptPrevShift_y=inPrev.y+v_prev_x/v_prev_len;var ptNextShift_x=inNext.x-v_next_y/v_next_len;var ptNextShift_y=inNext.y+v_next_x/v_next_len;var sf=((ptNextShift_x-ptPrevShift_x)*v_next_y-(ptNextShift_y-ptPrevShift_y)*v_next_x)/(v_prev_x*v_next_y-v_prev_y*v_next_x);v_trans_x=ptPrevShift_x+v_prev_x*sf-inPt.x;v_trans_y=ptPrevShift_y+v_prev_y*sf-inPt.y;var v_trans_lensq=v_trans_x*v_trans_x+v_trans_y*v_trans_y;if(v_trans_lensq<=2){return new THREE.Vector2(v_trans_x,v_trans_y)}else{shrink_by=Math.sqrt(v_trans_lensq/2)}}else{var direction_eq=false;if(v_prev_x>EPSILON){if(v_next_x>EPSILON){direction_eq=true}}else{if(v_prev_x<-EPSILON){if(v_next_x<-EPSILON){direction_eq=true}}else{if(Math.sign(v_prev_y)==Math.sign(v_next_y)){direction_eq=true}}}if(direction_eq){v_trans_x=-v_prev_y;v_trans_y=v_prev_x;shrink_by=Math.sqrt(v_prev_lensq)}else{v_trans_x=v_prev_x;v_trans_y=v_prev_y;shrink_by=Math.sqrt(v_prev_lensq/2)}}return new THREE.Vector2(v_trans_x/shrink_by,v_trans_y/shrink_by)}var contourMovements=[];for(var i=0,il=contour.length,j=il-1,k=i+1;i<il;i++,j++,k++){if(j===il)j=0;if(k===il)k=0;var pt_i=contour[i];var pt_j=contour[j];var pt_k=contour[k];contourMovements[i]=getBevelVec(contour[i],contour[j],contour[k])}var holesMovements=[],oneHoleMovements,verticesMovements=contourMovements.concat();for(h=0,hl=holes.length;h<hl;h++){ahole=holes[h];oneHoleMovements=[];for(i=0,il=ahole.length,j=il-1,k=i+1;i<il;i++,j++,k++){if(j===il)j=0;if(k===il)k=0;oneHoleMovements[i]=getBevelVec(ahole[i],ahole[j],ahole[k])}holesMovements.push(oneHoleMovements);verticesMovements=verticesMovements.concat(oneHoleMovements)}for(b=0;b<bevelSegments;b++){t=b/bevelSegments;z=bevelThickness*(1-t);bs=bevelSize*Math.sin(t*Math.PI/2);for(i=0,il=contour.length;i<il;i++){vert=scalePt2(contour[i],contourMovements[i],bs);v(vert.x,vert.y,-z)}for(h=0,hl=holes.length;h<hl;h++){ahole=holes[h];oneHoleMovements=holesMovements[h];for(i=0,il=ahole.length;i<il;i++){vert=scalePt2(ahole[i],oneHoleMovements[i],bs);v(vert.x,vert.y,-z)}}}bs=bevelSize;for(i=0;i<vlen;i++){vert=bevelEnabled?scalePt2(vertices[i],verticesMovements[i],bs):vertices[i];if(!extrudeByPath){v(vert.x,vert.y,0)}else{normal.copy(splineTube.normals[0]).multiplyScalar(vert.x);binormal.copy(splineTube.binormals[0]).multiplyScalar(vert.y);position2.copy(extrudePts[0]).add(normal).add(binormal);v(position2.x,position2.y,position2.z)}}var s;for(s=1;s<=steps;s++){for(i=0;i<vlen;i++){vert=bevelEnabled?scalePt2(vertices[i],verticesMovements[i],bs):vertices[i];if(!extrudeByPath){v(vert.x,vert.y,amount/steps*s)}else{normal.copy(splineTube.normals[s]).multiplyScalar(vert.x);binormal.copy(splineTube.binormals[s]).multiplyScalar(vert.y);position2.copy(extrudePts[s]).add(normal).add(binormal);v(position2.x,position2.y,position2.z)}}}for(b=bevelSegments-1;b>=0;b--){t=b/bevelSegments;z=bevelThickness*(1-t);bs=bevelSize*Math.sin(t*Math.PI/2);for(i=0,il=contour.length;i<il;i++){vert=scalePt2(contour[i],contourMovements[i],bs);v(vert.x,vert.y,amount+z)}for(h=0,hl=holes.length;h<hl;h++){ahole=holes[h];oneHoleMovements=holesMovements[h];for(i=0,il=ahole.length;i<il;i++){vert=scalePt2(ahole[i],oneHoleMovements[i],bs);if(!extrudeByPath){v(vert.x,vert.y,amount+z)}else{v(vert.x,vert.y+extrudePts[steps-1].y,extrudePts[steps-1].x+z)}}}}buildLidFaces();buildSideFaces();function buildLidFaces(){if(bevelEnabled){var layer=0;var offset=vlen*layer;for(i=0;i<flen;i++){face=faces[i];f3(face[2]+offset,face[1]+offset,face[0]+offset)}layer=steps+bevelSegments*2;offset=vlen*layer;for(i=0;i<flen;i++){face=faces[i];f3(face[0]+offset,face[1]+offset,face[2]+offset)}}else{for(i=0;i<flen;i++){face=faces[i];f3(face[2],face[1],face[0])}for(i=0;i<flen;i++){face=faces[i];f3(face[0]+vlen*steps,face[1]+vlen*steps,face[2]+vlen*steps)}}}function buildSideFaces(){var layeroffset=0;sidewalls(contour,layeroffset);layeroffset+=contour.length;for(h=0,hl=holes.length;h<hl;h++){ahole=holes[h];sidewalls(ahole,layeroffset);layeroffset+=ahole.length}}function sidewalls(contour,layeroffset){var j,k;i=contour.length;while(--i>=0){j=i;k=i-1;if(k<0)k=contour.length-1;var s=0,sl=steps+bevelSegments*2;for(s=0;s<sl;s++){var slen1=vlen*s;var slen2=vlen*(s+1);var a=layeroffset+j+slen1,b=layeroffset+k+slen1,c=layeroffset+k+slen2,d=layeroffset+j+slen2;f4(a,b,c,d,contour,s,sl,j,k)}}}function v(x,y,z){scope.vertices.push(new THREE.Vector3(x,y,z))}function f3(a,b,c){a+=shapesOffset;b+=shapesOffset;c+=shapesOffset;scope.faces.push(new THREE.Face3(a,b,c,null,null,material));var uvs=uvgen.generateTopUV(scope,a,b,c);scope.faceVertexUvs[0].push(uvs)}function f4(a,b,c,d,wallContour,stepIndex,stepsLength,contourIndex1,contourIndex2){a+=shapesOffset;b+=shapesOffset;c+=shapesOffset;d+=shapesOffset;scope.faces.push(new THREE.Face3(a,b,d,null,null,extrudeMaterial));scope.faces.push(new THREE.Face3(b,c,d,null,null,extrudeMaterial));var uvs=uvgen.generateSideWallUV(scope,a,b,c,d);scope.faceVertexUvs[0].push([uvs[0],uvs[1],uvs[3]]);scope.faceVertexUvs[0].push([uvs[1],uvs[2],uvs[3]])}};THREE.ExtrudeGeometry.WorldUVGenerator={generateTopUV:function(geometry,indexA,indexB,indexC){var vertices=geometry.vertices;var a=vertices[indexA];var b=vertices[indexB];var c=vertices[indexC];return[new THREE.Vector2(a.x,a.y),new THREE.Vector2(b.x,b.y),new THREE.Vector2(c.x,c.y)]},generateSideWallUV:function(geometry,indexA,indexB,indexC,indexD){var vertices=geometry.vertices;var a=vertices[indexA];var b=vertices[indexB];var c=vertices[indexC];var d=vertices[indexD];if(Math.abs(a.y-b.y)<.01){return[new THREE.Vector2(a.x,1-a.z),new THREE.Vector2(b.x,1-b.z),new THREE.Vector2(c.x,1-c.z),new THREE.Vector2(d.x,1-d.z)]}else{return[new THREE.Vector2(a.y,1-a.z),new THREE.Vector2(b.y,1-b.z),new THREE.Vector2(c.y,1-c.z),new THREE.Vector2(d.y,1-d.z)]}}};THREE.ShapeGeometry=function(shapes,options){THREE.Geometry.call(this);this.type="ShapeGeometry";if(shapes instanceof Array===false)shapes=[shapes];this.addShapeList(shapes,options);this.computeFaceNormals()};THREE.ShapeGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.ShapeGeometry.prototype.addShapeList=function(shapes,options){for(var i=0,l=shapes.length;i<l;i++){this.addShape(shapes[i],options)}return this};THREE.ShapeGeometry.prototype.addShape=function(shape,options){if(options===undefined)options={};var curveSegments=options.curveSegments!==undefined?options.curveSegments:12;var material=options.material;var uvgen=options.UVGenerator===undefined?THREE.ExtrudeGeometry.WorldUVGenerator:options.UVGenerator;var i,l,hole,s;var shapesOffset=this.vertices.length;var shapePoints=shape.extractPoints(curveSegments);var vertices=shapePoints.shape;var holes=shapePoints.holes;var reverse=!THREE.Shape.Utils.isClockWise(vertices);if(reverse){vertices=vertices.reverse();for(i=0,l=holes.length;i<l;i++){hole=holes[i];if(THREE.Shape.Utils.isClockWise(hole)){holes[i]=hole.reverse()}}reverse=false}var faces=THREE.Shape.Utils.triangulateShape(vertices,holes);var contour=vertices;for(i=0,l=holes.length;i<l;i++){hole=holes[i];vertices=vertices.concat(hole)}var vert,vlen=vertices.length;var face,flen=faces.length;var cont,clen=contour.length;for(i=0;i<vlen;i++){vert=vertices[i];this.vertices.push(new THREE.Vector3(vert.x,vert.y,0))}for(i=0;i<flen;i++){face=faces[i];var a=face[0]+shapesOffset;var b=face[1]+shapesOffset;var c=face[2]+shapesOffset;this.faces.push(new THREE.Face3(a,b,c,null,null,material));this.faceVertexUvs[0].push(uvgen.generateTopUV(this,a,b,c))}};THREE.LatheGeometry=function(points,segments,phiStart,phiLength){THREE.Geometry.call(this);this.type="LatheGeometry";this.parameters={points:points,segments:segments,phiStart:phiStart,phiLength:phiLength};segments=segments||12;phiStart=phiStart||0;phiLength=phiLength||2*Math.PI;var inversePointLength=1/(points.length-1);var inverseSegments=1/segments;for(var i=0,il=segments;i<=il;i++){var phi=phiStart+i*inverseSegments*phiLength;
var c=Math.cos(phi),s=Math.sin(phi);for(var j=0,jl=points.length;j<jl;j++){var pt=points[j];var vertex=new THREE.Vector3;vertex.x=c*pt.x-s*pt.y;vertex.y=s*pt.x+c*pt.y;vertex.z=pt.z;this.vertices.push(vertex)}}var np=points.length;for(var i=0,il=segments;i<il;i++){for(var j=0,jl=points.length-1;j<jl;j++){var base=j+np*i;var a=base;var b=base+np;var c=base+1+np;var d=base+1;var u0=i*inverseSegments;var v0=j*inversePointLength;var u1=u0+inverseSegments;var v1=v0+inversePointLength;this.faces.push(new THREE.Face3(a,b,d));this.faceVertexUvs[0].push([new THREE.Vector2(u0,v0),new THREE.Vector2(u1,v0),new THREE.Vector2(u0,v1)]);this.faces.push(new THREE.Face3(b,c,d));this.faceVertexUvs[0].push([new THREE.Vector2(u1,v0),new THREE.Vector2(u1,v1),new THREE.Vector2(u0,v1)])}}this.mergeVertices();this.computeFaceNormals();this.computeVertexNormals()};THREE.LatheGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.PlaneGeometry=function(width,height,widthSegments,heightSegments){console.info("THREE.PlaneGeometry: Consider using THREE.PlaneBufferGeometry for lower memory footprint.");THREE.Geometry.call(this);this.type="PlaneGeometry";this.parameters={width:width,height:height,widthSegments:widthSegments,heightSegments:heightSegments};this.fromBufferGeometry(new THREE.PlaneBufferGeometry(width,height,widthSegments,heightSegments))};THREE.PlaneGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.PlaneBufferGeometry=function(width,height,widthSegments,heightSegments){THREE.BufferGeometry.call(this);this.type="PlaneBufferGeometry";this.parameters={width:width,height:height,widthSegments:widthSegments,heightSegments:heightSegments};var width_half=width/2;var height_half=height/2;var gridX=widthSegments||1;var gridY=heightSegments||1;var gridX1=gridX+1;var gridY1=gridY+1;var segment_width=width/gridX;var segment_height=height/gridY;var vertices=new Float32Array(gridX1*gridY1*3);var normals=new Float32Array(gridX1*gridY1*3);var uvs=new Float32Array(gridX1*gridY1*2);var offset=0;var offset2=0;for(var iy=0;iy<gridY1;iy++){var y=iy*segment_height-height_half;for(var ix=0;ix<gridX1;ix++){var x=ix*segment_width-width_half;vertices[offset]=x;vertices[offset+1]=-y;normals[offset+2]=1;uvs[offset2]=ix/gridX;uvs[offset2+1]=1-iy/gridY;offset+=3;offset2+=2}}offset=0;var indices=new(vertices.length/3>65535?Uint32Array:Uint16Array)(gridX*gridY*6);for(var iy=0;iy<gridY;iy++){for(var ix=0;ix<gridX;ix++){var a=ix+gridX1*iy;var b=ix+gridX1*(iy+1);var c=ix+1+gridX1*(iy+1);var d=ix+1+gridX1*iy;indices[offset]=a;indices[offset+1]=b;indices[offset+2]=d;indices[offset+3]=b;indices[offset+4]=c;indices[offset+5]=d;offset+=6}}this.addAttribute("index",new THREE.BufferAttribute(indices,1));this.addAttribute("position",new THREE.BufferAttribute(vertices,3));this.addAttribute("normal",new THREE.BufferAttribute(normals,3));this.addAttribute("uv",new THREE.BufferAttribute(uvs,2))};THREE.PlaneBufferGeometry.prototype=Object.create(THREE.BufferGeometry.prototype);THREE.RingGeometry=function(innerRadius,outerRadius,thetaSegments,phiSegments,thetaStart,thetaLength){THREE.Geometry.call(this);this.type="RingGeometry";this.parameters={innerRadius:innerRadius,outerRadius:outerRadius,thetaSegments:thetaSegments,phiSegments:phiSegments,thetaStart:thetaStart,thetaLength:thetaLength};innerRadius=innerRadius||0;outerRadius=outerRadius||50;thetaStart=thetaStart!==undefined?thetaStart:0;thetaLength=thetaLength!==undefined?thetaLength:Math.PI*2;thetaSegments=thetaSegments!==undefined?Math.max(3,thetaSegments):8;phiSegments=phiSegments!==undefined?Math.max(1,phiSegments):8;var i,o,uvs=[],radius=innerRadius,radiusStep=(outerRadius-innerRadius)/phiSegments;for(i=0;i<phiSegments+1;i++){for(o=0;o<thetaSegments+1;o++){var vertex=new THREE.Vector3;var segment=thetaStart+o/thetaSegments*thetaLength;vertex.x=radius*Math.cos(segment);vertex.y=radius*Math.sin(segment);this.vertices.push(vertex);uvs.push(new THREE.Vector2((vertex.x/outerRadius+1)/2,(vertex.y/outerRadius+1)/2))}radius+=radiusStep}var n=new THREE.Vector3(0,0,1);for(i=0;i<phiSegments;i++){var thetaSegment=i*(thetaSegments+1);for(o=0;o<thetaSegments;o++){var segment=o+thetaSegment;var v1=segment;var v2=segment+thetaSegments+1;var v3=segment+thetaSegments+2;this.faces.push(new THREE.Face3(v1,v2,v3,[n.clone(),n.clone(),n.clone()]));this.faceVertexUvs[0].push([uvs[v1].clone(),uvs[v2].clone(),uvs[v3].clone()]);v1=segment;v2=segment+thetaSegments+2;v3=segment+1;this.faces.push(new THREE.Face3(v1,v2,v3,[n.clone(),n.clone(),n.clone()]));this.faceVertexUvs[0].push([uvs[v1].clone(),uvs[v2].clone(),uvs[v3].clone()])}}this.computeFaceNormals();this.boundingSphere=new THREE.Sphere(new THREE.Vector3,radius)};THREE.RingGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.SphereGeometry=function(radius,widthSegments,heightSegments,phiStart,phiLength,thetaStart,thetaLength){THREE.Geometry.call(this);this.type="SphereGeometry";this.parameters={radius:radius,widthSegments:widthSegments,heightSegments:heightSegments,phiStart:phiStart,phiLength:phiLength,thetaStart:thetaStart,thetaLength:thetaLength};radius=radius||50;widthSegments=Math.max(3,Math.floor(widthSegments)||8);heightSegments=Math.max(2,Math.floor(heightSegments)||6);phiStart=phiStart!==undefined?phiStart:0;phiLength=phiLength!==undefined?phiLength:Math.PI*2;thetaStart=thetaStart!==undefined?thetaStart:0;thetaLength=thetaLength!==undefined?thetaLength:Math.PI;var x,y,vertices=[],uvs=[];for(y=0;y<=heightSegments;y++){var verticesRow=[];var uvsRow=[];for(x=0;x<=widthSegments;x++){var u=x/widthSegments;var v=y/heightSegments;var vertex=new THREE.Vector3;vertex.x=-radius*Math.cos(phiStart+u*phiLength)*Math.sin(thetaStart+v*thetaLength);vertex.y=radius*Math.cos(thetaStart+v*thetaLength);vertex.z=radius*Math.sin(phiStart+u*phiLength)*Math.sin(thetaStart+v*thetaLength);this.vertices.push(vertex);verticesRow.push(this.vertices.length-1);uvsRow.push(new THREE.Vector2(u,1-v))}vertices.push(verticesRow);uvs.push(uvsRow)}for(y=0;y<heightSegments;y++){for(x=0;x<widthSegments;x++){var v1=vertices[y][x+1];var v2=vertices[y][x];var v3=vertices[y+1][x];var v4=vertices[y+1][x+1];var n1=this.vertices[v1].clone().normalize();var n2=this.vertices[v2].clone().normalize();var n3=this.vertices[v3].clone().normalize();var n4=this.vertices[v4].clone().normalize();var uv1=uvs[y][x+1].clone();var uv2=uvs[y][x].clone();var uv3=uvs[y+1][x].clone();var uv4=uvs[y+1][x+1].clone();if(Math.abs(this.vertices[v1].y)===radius){uv1.x=(uv1.x+uv2.x)/2;this.faces.push(new THREE.Face3(v1,v3,v4,[n1,n3,n4]));this.faceVertexUvs[0].push([uv1,uv3,uv4])}else if(Math.abs(this.vertices[v3].y)===radius){uv3.x=(uv3.x+uv4.x)/2;this.faces.push(new THREE.Face3(v1,v2,v3,[n1,n2,n3]));this.faceVertexUvs[0].push([uv1,uv2,uv3])}else{this.faces.push(new THREE.Face3(v1,v2,v4,[n1,n2,n4]));this.faceVertexUvs[0].push([uv1,uv2,uv4]);this.faces.push(new THREE.Face3(v2,v3,v4,[n2.clone(),n3,n4.clone()]));this.faceVertexUvs[0].push([uv2.clone(),uv3,uv4.clone()])}}}this.computeFaceNormals();this.boundingSphere=new THREE.Sphere(new THREE.Vector3,radius)};THREE.SphereGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.TextGeometry=function(text,parameters){parameters=parameters||{};var textShapes=THREE.FontUtils.generateShapes(text,parameters);parameters.amount=parameters.height!==undefined?parameters.height:50;if(parameters.bevelThickness===undefined)parameters.bevelThickness=10;if(parameters.bevelSize===undefined)parameters.bevelSize=8;if(parameters.bevelEnabled===undefined)parameters.bevelEnabled=false;THREE.ExtrudeGeometry.call(this,textShapes,parameters);this.type="TextGeometry"};THREE.TextGeometry.prototype=Object.create(THREE.ExtrudeGeometry.prototype);THREE.TorusGeometry=function(radius,tube,radialSegments,tubularSegments,arc){THREE.Geometry.call(this);this.type="TorusGeometry";this.parameters={radius:radius,tube:tube,radialSegments:radialSegments,tubularSegments:tubularSegments,arc:arc};radius=radius||100;tube=tube||40;radialSegments=radialSegments||8;tubularSegments=tubularSegments||6;arc=arc||Math.PI*2;var center=new THREE.Vector3,uvs=[],normals=[];for(var j=0;j<=radialSegments;j++){for(var i=0;i<=tubularSegments;i++){var u=i/tubularSegments*arc;var v=j/radialSegments*Math.PI*2;center.x=radius*Math.cos(u);center.y=radius*Math.sin(u);var vertex=new THREE.Vector3;vertex.x=(radius+tube*Math.cos(v))*Math.cos(u);vertex.y=(radius+tube*Math.cos(v))*Math.sin(u);vertex.z=tube*Math.sin(v);this.vertices.push(vertex);uvs.push(new THREE.Vector2(i/tubularSegments,j/radialSegments));normals.push(vertex.clone().sub(center).normalize())}}for(var j=1;j<=radialSegments;j++){for(var i=1;i<=tubularSegments;i++){var a=(tubularSegments+1)*j+i-1;var b=(tubularSegments+1)*(j-1)+i-1;var c=(tubularSegments+1)*(j-1)+i;var d=(tubularSegments+1)*j+i;var face=new THREE.Face3(a,b,d,[normals[a].clone(),normals[b].clone(),normals[d].clone()]);this.faces.push(face);this.faceVertexUvs[0].push([uvs[a].clone(),uvs[b].clone(),uvs[d].clone()]);face=new THREE.Face3(b,c,d,[normals[b].clone(),normals[c].clone(),normals[d].clone()]);this.faces.push(face);this.faceVertexUvs[0].push([uvs[b].clone(),uvs[c].clone(),uvs[d].clone()])}}this.computeFaceNormals()};THREE.TorusGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.TorusKnotGeometry=function(radius,tube,radialSegments,tubularSegments,p,q,heightScale){THREE.Geometry.call(this);this.type="TorusKnotGeometry";this.parameters={radius:radius,tube:tube,radialSegments:radialSegments,tubularSegments:tubularSegments,p:p,q:q,heightScale:heightScale};radius=radius||100;tube=tube||40;radialSegments=radialSegments||64;tubularSegments=tubularSegments||8;p=p||2;q=q||3;heightScale=heightScale||1;var grid=new Array(radialSegments);var tang=new THREE.Vector3;var n=new THREE.Vector3;var bitan=new THREE.Vector3;for(var i=0;i<radialSegments;++i){grid[i]=new Array(tubularSegments);var u=i/radialSegments*2*p*Math.PI;var p1=getPos(u,q,p,radius,heightScale);var p2=getPos(u+.01,q,p,radius,heightScale);tang.subVectors(p2,p1);n.addVectors(p2,p1);bitan.crossVectors(tang,n);n.crossVectors(bitan,tang);bitan.normalize();n.normalize();for(var j=0;j<tubularSegments;++j){var v=j/tubularSegments*2*Math.PI;var cx=-tube*Math.cos(v);var cy=tube*Math.sin(v);var pos=new THREE.Vector3;pos.x=p1.x+cx*n.x+cy*bitan.x;pos.y=p1.y+cx*n.y+cy*bitan.y;pos.z=p1.z+cx*n.z+cy*bitan.z;grid[i][j]=this.vertices.push(pos)-1}}for(var i=0;i<radialSegments;++i){for(var j=0;j<tubularSegments;++j){var ip=(i+1)%radialSegments;var jp=(j+1)%tubularSegments;var a=grid[i][j];var b=grid[ip][j];var c=grid[ip][jp];var d=grid[i][jp];var uva=new THREE.Vector2(i/radialSegments,j/tubularSegments);var uvb=new THREE.Vector2((i+1)/radialSegments,j/tubularSegments);var uvc=new THREE.Vector2((i+1)/radialSegments,(j+1)/tubularSegments);var uvd=new THREE.Vector2(i/radialSegments,(j+1)/tubularSegments);this.faces.push(new THREE.Face3(a,b,d));this.faceVertexUvs[0].push([uva,uvb,uvd]);this.faces.push(new THREE.Face3(b,c,d));this.faceVertexUvs[0].push([uvb.clone(),uvc,uvd.clone()])}}this.computeFaceNormals();this.computeVertexNormals();function getPos(u,in_q,in_p,radius,heightScale){var cu=Math.cos(u);var su=Math.sin(u);var quOverP=in_q/in_p*u;var cs=Math.cos(quOverP);var tx=radius*(2+cs)*.5*cu;var ty=radius*(2+cs)*su*.5;var tz=heightScale*radius*Math.sin(quOverP)*.5;return new THREE.Vector3(tx,ty,tz)}};THREE.TorusKnotGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.TubeGeometry=function(path,segments,radius,radialSegments,closed){THREE.Geometry.call(this);this.type="TubeGeometry";this.parameters={path:path,segments:segments,radius:radius,radialSegments:radialSegments,closed:closed};segments=segments||64;radius=radius||1;radialSegments=radialSegments||8;closed=closed||false;var grid=[];var scope=this,tangent,normal,binormal,numpoints=segments+1,x,y,z,tx,ty,tz,u,v,cx,cy,pos,pos2=new THREE.Vector3,i,j,ip,jp,a,b,c,d,uva,uvb,uvc,uvd;var frames=new THREE.TubeGeometry.FrenetFrames(path,segments,closed),tangents=frames.tangents,normals=frames.normals,binormals=frames.binormals;this.tangents=tangents;this.normals=normals;this.binormals=binormals;function vert(x,y,z){return scope.vertices.push(new THREE.Vector3(x,y,z))-1}for(i=0;i<numpoints;i++){grid[i]=[];u=i/(numpoints-1);pos=path.getPointAt(u);tangent=tangents[i];normal=normals[i];binormal=binormals[i];for(j=0;j<radialSegments;j++){v=j/radialSegments*2*Math.PI;cx=-radius*Math.cos(v);cy=radius*Math.sin(v);pos2.copy(pos);pos2.x+=cx*normal.x+cy*binormal.x;pos2.y+=cx*normal.y+cy*binormal.y;pos2.z+=cx*normal.z+cy*binormal.z;grid[i][j]=vert(pos2.x,pos2.y,pos2.z)}}for(i=0;i<segments;i++){for(j=0;j<radialSegments;j++){ip=closed?(i+1)%segments:i+1;jp=(j+1)%radialSegments;a=grid[i][j];b=grid[ip][j];c=grid[ip][jp];d=grid[i][jp];uva=new THREE.Vector2(i/segments,j/radialSegments);uvb=new THREE.Vector2((i+1)/segments,j/radialSegments);uvc=new THREE.Vector2((i+1)/segments,(j+1)/radialSegments);uvd=new THREE.Vector2(i/segments,(j+1)/radialSegments);this.faces.push(new THREE.Face3(a,b,d));this.faceVertexUvs[0].push([uva,uvb,uvd]);this.faces.push(new THREE.Face3(b,c,d));this.faceVertexUvs[0].push([uvb.clone(),uvc,uvd.clone()])}}this.computeFaceNormals();this.computeVertexNormals()};THREE.TubeGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.TubeGeometry.FrenetFrames=function(path,segments,closed){var tangent=new THREE.Vector3,normal=new THREE.Vector3,binormal=new THREE.Vector3,tangents=[],normals=[],binormals=[],vec=new THREE.Vector3,mat=new THREE.Matrix4,numpoints=segments+1,theta,epsilon=1e-4,smallest,tx,ty,tz,i,u,v;this.tangents=tangents;this.normals=normals;this.binormals=binormals;for(i=0;i<numpoints;i++){u=i/(numpoints-1);tangents[i]=path.getTangentAt(u);tangents[i].normalize()}initialNormal3();function initialNormal3(){normals[0]=new THREE.Vector3;binormals[0]=new THREE.Vector3;smallest=Number.MAX_VALUE;tx=Math.abs(tangents[0].x);ty=Math.abs(tangents[0].y);tz=Math.abs(tangents[0].z);if(tx<=smallest){smallest=tx;normal.set(1,0,0)}if(ty<=smallest){smallest=ty;normal.set(0,1,0)}if(tz<=smallest){normal.set(0,0,1)}vec.crossVectors(tangents[0],normal).normalize();normals[0].crossVectors(tangents[0],vec);binormals[0].crossVectors(tangents[0],normals[0])}for(i=1;i<numpoints;i++){normals[i]=normals[i-1].clone();binormals[i]=binormals[i-1].clone();vec.crossVectors(tangents[i-1],tangents[i]);if(vec.length()>epsilon){vec.normalize();theta=Math.acos(THREE.Math.clamp(tangents[i-1].dot(tangents[i]),-1,1));normals[i].applyMatrix4(mat.makeRotationAxis(vec,theta))}binormals[i].crossVectors(tangents[i],normals[i])}if(closed){theta=Math.acos(THREE.Math.clamp(normals[0].dot(normals[numpoints-1]),-1,1));theta/=numpoints-1;if(tangents[0].dot(vec.crossVectors(normals[0],normals[numpoints-1]))>0){theta=-theta}for(i=1;i<numpoints;i++){normals[i].applyMatrix4(mat.makeRotationAxis(tangents[i],theta*i));binormals[i].crossVectors(tangents[i],normals[i])}}};THREE.PolyhedronGeometry=function(vertices,indices,radius,detail){THREE.Geometry.call(this);this.type="PolyhedronGeometry";this.parameters={vertices:vertices,indices:indices,radius:radius,detail:detail};radius=radius||1;detail=detail||0;var that=this;for(var i=0,l=vertices.length;i<l;i+=3){prepare(new THREE.Vector3(vertices[i],vertices[i+1],vertices[i+2]))}var midpoints=[],p=this.vertices;var faces=[];for(var i=0,j=0,l=indices.length;i<l;i+=3,j++){var v1=p[indices[i]];var v2=p[indices[i+1]];var v3=p[indices[i+2]];faces[j]=new THREE.Face3(v1.index,v2.index,v3.index,[v1.clone(),v2.clone(),v3.clone()])}var centroid=new THREE.Vector3;for(var i=0,l=faces.length;i<l;i++){subdivide(faces[i],detail)}for(var i=0,l=this.faceVertexUvs[0].length;i<l;i++){var uvs=this.faceVertexUvs[0][i];var x0=uvs[0].x;var x1=uvs[1].x;var x2=uvs[2].x;var max=Math.max(x0,Math.max(x1,x2));var min=Math.min(x0,Math.min(x1,x2));if(max>.9&&min<.1){if(x0<.2)uvs[0].x+=1;if(x1<.2)uvs[1].x+=1;if(x2<.2)uvs[2].x+=1}}for(var i=0,l=this.vertices.length;i<l;i++){this.vertices[i].multiplyScalar(radius)}this.mergeVertices();this.computeFaceNormals();this.boundingSphere=new THREE.Sphere(new THREE.Vector3,radius);function prepare(vector){var vertex=vector.normalize().clone();vertex.index=that.vertices.push(vertex)-1;var u=azimuth(vector)/2/Math.PI+.5;var v=inclination(vector)/Math.PI+.5;vertex.uv=new THREE.Vector2(u,1-v);return vertex}function make(v1,v2,v3){var face=new THREE.Face3(v1.index,v2.index,v3.index,[v1.clone(),v2.clone(),v3.clone()]);that.faces.push(face);centroid.copy(v1).add(v2).add(v3).divideScalar(3);var azi=azimuth(centroid);that.faceVertexUvs[0].push([correctUV(v1.uv,v1,azi),correctUV(v2.uv,v2,azi),correctUV(v3.uv,v3,azi)])}function subdivide(face,detail){var cols=Math.pow(2,detail);var cells=Math.pow(4,detail);var a=prepare(that.vertices[face.a]);var b=prepare(that.vertices[face.b]);var c=prepare(that.vertices[face.c]);var v=[];for(var i=0;i<=cols;i++){v[i]=[];var aj=prepare(a.clone().lerp(c,i/cols));var bj=prepare(b.clone().lerp(c,i/cols));var rows=cols-i;for(var j=0;j<=rows;j++){if(j==0&&i==cols){v[i][j]=aj}else{v[i][j]=prepare(aj.clone().lerp(bj,j/rows))}}}for(var i=0;i<cols;i++){for(var j=0;j<2*(cols-i)-1;j++){var k=Math.floor(j/2);if(j%2==0){make(v[i][k+1],v[i+1][k],v[i][k])}else{make(v[i][k+1],v[i+1][k+1],v[i+1][k])}}}}function azimuth(vector){return Math.atan2(vector.z,-vector.x)}function inclination(vector){return Math.atan2(-vector.y,Math.sqrt(vector.x*vector.x+vector.z*vector.z))}function correctUV(uv,vector,azimuth){if(azimuth<0&&uv.x===1)uv=new THREE.Vector2(uv.x-1,uv.y);if(vector.x===0&&vector.z===0)uv=new THREE.Vector2(azimuth/2/Math.PI+.5,uv.y);return uv.clone()}};THREE.PolyhedronGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.DodecahedronGeometry=function(radius,detail){this.parameters={radius:radius,detail:detail};var t=(1+Math.sqrt(5))/2;var r=1/t;var vertices=[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-r,-t,0,-r,t,0,r,-t,0,r,t,-r,-t,0,-r,t,0,r,-t,0,r,t,0,-t,0,-r,t,0,-r,-t,0,r,t,0,r];var indices=[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9];THREE.PolyhedronGeometry.call(this,vertices,indices,radius,detail)};THREE.DodecahedronGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.IcosahedronGeometry=function(radius,detail){var t=(1+Math.sqrt(5))/2;var vertices=[-1,t,0,1,t,0,-1,-t,0,1,-t,0,0,-1,t,0,1,t,0,-1,-t,0,1,-t,t,0,-1,t,0,1,-t,0,-1,-t,0,1];var indices=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1];THREE.PolyhedronGeometry.call(this,vertices,indices,radius,detail);this.type="IcosahedronGeometry";this.parameters={radius:radius,detail:detail}};THREE.IcosahedronGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.OctahedronGeometry=function(radius,detail){this.parameters={radius:radius,detail:detail};var vertices=[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1];var indices=[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2];THREE.PolyhedronGeometry.call(this,vertices,indices,radius,detail);this.type="OctahedronGeometry";this.parameters={radius:radius,detail:detail}};THREE.OctahedronGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.TetrahedronGeometry=function(radius,detail){var vertices=[1,1,1,-1,-1,1,-1,1,-1,1,-1,-1];var indices=[2,1,0,0,3,2,1,3,0,2,3,1];THREE.PolyhedronGeometry.call(this,vertices,indices,radius,detail);this.type="TetrahedronGeometry";this.parameters={radius:radius,detail:detail}};THREE.TetrahedronGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.ParametricGeometry=function(func,slices,stacks){THREE.Geometry.call(this);this.type="ParametricGeometry";this.parameters={func:func,slices:slices,stacks:stacks};var verts=this.vertices;var faces=this.faces;var uvs=this.faceVertexUvs[0];var i,il,j,p;var u,v;var stackCount=stacks+1;var sliceCount=slices+1;for(i=0;i<=stacks;i++){v=i/stacks;for(j=0;j<=slices;j++){u=j/slices;p=func(u,v);verts.push(p)}}var a,b,c,d;var uva,uvb,uvc,uvd;for(i=0;i<stacks;i++){for(j=0;j<slices;j++){a=i*sliceCount+j;b=i*sliceCount+j+1;c=(i+1)*sliceCount+j+1;d=(i+1)*sliceCount+j;uva=new THREE.Vector2(j/slices,i/stacks);uvb=new THREE.Vector2((j+1)/slices,i/stacks);uvc=new THREE.Vector2((j+1)/slices,(i+1)/stacks);uvd=new THREE.Vector2(j/slices,(i+1)/stacks);faces.push(new THREE.Face3(a,b,d));uvs.push([uva,uvb,uvd]);faces.push(new THREE.Face3(b,c,d));uvs.push([uvb.clone(),uvc,uvd.clone()])}}this.computeFaceNormals();this.computeVertexNormals()};THREE.ParametricGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.AxisHelper=function(size){size=size||1;var vertices=new Float32Array([0,0,0,size,0,0,0,0,0,0,size,0,0,0,0,0,0,size]);var colors=new Float32Array([1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1]);var geometry=new THREE.BufferGeometry;geometry.addAttribute("position",new THREE.BufferAttribute(vertices,3));geometry.addAttribute("color",new THREE.BufferAttribute(colors,3));var material=new THREE.LineBasicMaterial({vertexColors:THREE.VertexColors});THREE.Line.call(this,geometry,material,THREE.LinePieces)};THREE.AxisHelper.prototype=Object.create(THREE.Line.prototype);THREE.ArrowHelper=function(){var lineGeometry=new THREE.Geometry;lineGeometry.vertices.push(new THREE.Vector3(0,0,0),new THREE.Vector3(0,1,0));var coneGeometry=new THREE.CylinderGeometry(0,.5,1,5,1);coneGeometry.applyMatrix((new THREE.Matrix4).makeTranslation(0,-.5,0));return function(dir,origin,length,color,headLength,headWidth){THREE.Object3D.call(this);if(color===undefined)color=16776960;if(length===undefined)length=1;if(headLength===undefined)headLength=.2*length;if(headWidth===undefined)headWidth=.2*headLength;this.position.copy(origin);this.line=new THREE.Line(lineGeometry,new THREE.LineBasicMaterial({color:color}));this.line.matrixAutoUpdate=false;this.add(this.line);this.cone=new THREE.Mesh(coneGeometry,new THREE.MeshBasicMaterial({color:color}));this.cone.matrixAutoUpdate=false;this.add(this.cone);this.setDirection(dir);this.setLength(length,headLength,headWidth)}}();THREE.ArrowHelper.prototype=Object.create(THREE.Object3D.prototype);THREE.ArrowHelper.prototype.setDirection=function(){var axis=new THREE.Vector3;var radians;return function(dir){if(dir.y>.99999){this.quaternion.set(0,0,0,1)}else if(dir.y<-.99999){this.quaternion.set(1,0,0,0)}else{axis.set(dir.z,0,-dir.x).normalize();radians=Math.acos(dir.y);this.quaternion.setFromAxisAngle(axis,radians)}}}();THREE.ArrowHelper.prototype.setLength=function(length,headLength,headWidth){if(headLength===undefined)headLength=.2*length;if(headWidth===undefined)headWidth=.2*headLength;this.line.scale.set(1,length,1);this.line.updateMatrix();this.cone.scale.set(headWidth,headLength,headWidth);this.cone.position.y=length;this.cone.updateMatrix()};THREE.ArrowHelper.prototype.setColor=function(color){this.line.material.color.set(color);this.cone.material.color.set(color)};THREE.BoxHelper=function(object){var geometry=new THREE.BufferGeometry;geometry.addAttribute("position",new THREE.BufferAttribute(new Float32Array(72),3));THREE.Line.call(this,geometry,new THREE.LineBasicMaterial({color:16776960}),THREE.LinePieces);if(object!==undefined){this.update(object)}};THREE.BoxHelper.prototype=Object.create(THREE.Line.prototype);THREE.BoxHelper.prototype.update=function(object){var geometry=object.geometry;if(geometry.boundingBox===null){geometry.computeBoundingBox()}var min=geometry.boundingBox.min;var max=geometry.boundingBox.max;var vertices=this.geometry.attributes.position.array;vertices[0]=max.x;vertices[1]=max.y;vertices[2]=max.z;vertices[3]=min.x;vertices[4]=max.y;vertices[5]=max.z;vertices[6]=min.x;vertices[7]=max.y;vertices[8]=max.z;vertices[9]=min.x;vertices[10]=min.y;vertices[11]=max.z;vertices[12]=min.x;vertices[13]=min.y;vertices[14]=max.z;vertices[15]=max.x;vertices[16]=min.y;vertices[17]=max.z;vertices[18]=max.x;vertices[19]=min.y;vertices[20]=max.z;vertices[21]=max.x;vertices[22]=max.y;vertices[23]=max.z;vertices[24]=max.x;vertices[25]=max.y;vertices[26]=min.z;vertices[27]=min.x;vertices[28]=max.y;vertices[29]=min.z;vertices[30]=min.x;vertices[31]=max.y;vertices[32]=min.z;vertices[33]=min.x;vertices[34]=min.y;vertices[35]=min.z;vertices[36]=min.x;vertices[37]=min.y;vertices[38]=min.z;vertices[39]=max.x;vertices[40]=min.y;vertices[41]=min.z;vertices[42]=max.x;vertices[43]=min.y;vertices[44]=min.z;vertices[45]=max.x;vertices[46]=max.y;vertices[47]=min.z;vertices[48]=max.x;vertices[49]=max.y;vertices[50]=max.z;vertices[51]=max.x;vertices[52]=max.y;vertices[53]=min.z;vertices[54]=min.x;vertices[55]=max.y;vertices[56]=max.z;vertices[57]=min.x;vertices[58]=max.y;vertices[59]=min.z;vertices[60]=min.x;vertices[61]=min.y;vertices[62]=max.z;vertices[63]=min.x;vertices[64]=min.y;vertices[65]=min.z;vertices[66]=max.x;vertices[67]=min.y;vertices[68]=max.z;vertices[69]=max.x;vertices[70]=min.y;vertices[71]=min.z;this.geometry.attributes.position.needsUpdate=true;this.geometry.computeBoundingSphere();this.matrix=object.matrixWorld;this.matrixAutoUpdate=false};THREE.BoundingBoxHelper=function(object,hex){var color=hex!==undefined?hex:8947848;this.object=object;this.box=new THREE.Box3;THREE.Mesh.call(this,new THREE.BoxGeometry(1,1,1),new THREE.MeshBasicMaterial({color:color,wireframe:true}))};THREE.BoundingBoxHelper.prototype=Object.create(THREE.Mesh.prototype);THREE.BoundingBoxHelper.prototype.update=function(){this.box.setFromObject(this.object);this.box.size(this.scale);this.box.center(this.position)};THREE.CameraHelper=function(camera){var geometry=new THREE.Geometry;var material=new THREE.LineBasicMaterial({color:16777215,vertexColors:THREE.FaceColors});var pointMap={};var hexFrustum=16755200;var hexCone=16711680;var hexUp=43775;var hexTarget=16777215;var hexCross=3355443;addLine("n1","n2",hexFrustum);addLine("n2","n4",hexFrustum);addLine("n4","n3",hexFrustum);addLine("n3","n1",hexFrustum);addLine("f1","f2",hexFrustum);addLine("f2","f4",hexFrustum);addLine("f4","f3",hexFrustum);addLine("f3","f1",hexFrustum);addLine("n1","f1",hexFrustum);addLine("n2","f2",hexFrustum);addLine("n3","f3",hexFrustum);addLine("n4","f4",hexFrustum);addLine("p","n1",hexCone);addLine("p","n2",hexCone);addLine("p","n3",hexCone);addLine("p","n4",hexCone);addLine("u1","u2",hexUp);addLine("u2","u3",hexUp);addLine("u3","u1",hexUp);addLine("c","t",hexTarget);addLine("p","c",hexCross);addLine("cn1","cn2",hexCross);addLine("cn3","cn4",hexCross);addLine("cf1","cf2",hexCross);addLine("cf3","cf4",hexCross);function addLine(a,b,hex){addPoint(a,hex);addPoint(b,hex)}function addPoint(id,hex){geometry.vertices.push(new THREE.Vector3);geometry.colors.push(new THREE.Color(hex));if(pointMap[id]===undefined){pointMap[id]=[]}pointMap[id].push(geometry.vertices.length-1)}THREE.Line.call(this,geometry,material,THREE.LinePieces);this.camera=camera;this.matrix=camera.matrixWorld;this.matrixAutoUpdate=false;this.pointMap=pointMap;this.update()};THREE.CameraHelper.prototype=Object.create(THREE.Line.prototype);THREE.CameraHelper.prototype.update=function(){var geometry,pointMap;var vector=new THREE.Vector3;var camera=new THREE.Camera;var setPoint=function(point,x,y,z){vector.set(x,y,z).unproject(camera);var points=pointMap[point];if(points!==undefined){for(var i=0,il=points.length;i<il;i++){geometry.vertices[points[i]].copy(vector)}}};return function(){geometry=this.geometry;pointMap=this.pointMap;var w=1,h=1;camera.projectionMatrix.copy(this.camera.projectionMatrix);setPoint("c",0,0,-1);setPoint("t",0,0,1);setPoint("n1",-w,-h,-1);setPoint("n2",w,-h,-1);setPoint("n3",-w,h,-1);setPoint("n4",w,h,-1);setPoint("f1",-w,-h,1);setPoint("f2",w,-h,1);setPoint("f3",-w,h,1);setPoint("f4",w,h,1);setPoint("u1",w*.7,h*1.1,-1);setPoint("u2",-w*.7,h*1.1,-1);setPoint("u3",0,h*2,-1);setPoint("cf1",-w,0,1);setPoint("cf2",w,0,1);setPoint("cf3",0,-h,1);setPoint("cf4",0,h,1);setPoint("cn1",-w,0,-1);setPoint("cn2",w,0,-1);setPoint("cn3",0,-h,-1);setPoint("cn4",0,h,-1);geometry.verticesNeedUpdate=true}}();THREE.DirectionalLightHelper=function(light,size){THREE.Object3D.call(this);this.light=light;this.light.updateMatrixWorld();this.matrix=light.matrixWorld;this.matrixAutoUpdate=false;size=size||1;var geometry=new THREE.Geometry;geometry.vertices.push(new THREE.Vector3(-size,size,0),new THREE.Vector3(size,size,0),new THREE.Vector3(size,-size,0),new THREE.Vector3(-size,-size,0),new THREE.Vector3(-size,size,0));var material=new THREE.LineBasicMaterial({fog:false});material.color.copy(this.light.color).multiplyScalar(this.light.intensity);this.lightPlane=new THREE.Line(geometry,material);this.add(this.lightPlane);geometry=new THREE.Geometry;geometry.vertices.push(new THREE.Vector3,new THREE.Vector3);material=new THREE.LineBasicMaterial({fog:false});material.color.copy(this.light.color).multiplyScalar(this.light.intensity);this.targetLine=new THREE.Line(geometry,material);this.add(this.targetLine);this.update()};THREE.DirectionalLightHelper.prototype=Object.create(THREE.Object3D.prototype);THREE.DirectionalLightHelper.prototype.dispose=function(){this.lightPlane.geometry.dispose();this.lightPlane.material.dispose();this.targetLine.geometry.dispose();this.targetLine.material.dispose()};THREE.DirectionalLightHelper.prototype.update=function(){var v1=new THREE.Vector3;var v2=new THREE.Vector3;var v3=new THREE.Vector3;return function(){v1.setFromMatrixPosition(this.light.matrixWorld);v2.setFromMatrixPosition(this.light.target.matrixWorld);v3.subVectors(v2,v1);this.lightPlane.lookAt(v3);this.lightPlane.material.color.copy(this.light.color).multiplyScalar(this.light.intensity);this.targetLine.geometry.vertices[1].copy(v3);this.targetLine.geometry.verticesNeedUpdate=true;this.targetLine.material.color.copy(this.lightPlane.material.color)}}();THREE.EdgesHelper=function(object,hex){var color=hex!==undefined?hex:16777215;var edge=[0,0],hash={};var sortFunction=function(a,b){return a-b};var keys=["a","b","c"];var geometry=new THREE.BufferGeometry;var geometry2=object.geometry.clone();geometry2.mergeVertices();geometry2.computeFaceNormals();var vertices=geometry2.vertices;var faces=geometry2.faces;var numEdges=0;for(var i=0,l=faces.length;i<l;i++){var face=faces[i];for(var j=0;j<3;j++){edge[0]=face[keys[j]];edge[1]=face[keys[(j+1)%3]];edge.sort(sortFunction);var key=edge.toString();if(hash[key]===undefined){hash[key]={vert1:edge[0],vert2:edge[1],face1:i,face2:undefined};numEdges++}else{hash[key].face2=i}}}var coords=new Float32Array(numEdges*2*3);var index=0;for(var key in hash){var h=hash[key];if(h.face2===undefined||faces[h.face1].normal.dot(faces[h.face2].normal)<.9999){var vertex=vertices[h.vert1];coords[index++]=vertex.x;coords[index++]=vertex.y;coords[index++]=vertex.z;vertex=vertices[h.vert2];coords[index++]=vertex.x;coords[index++]=vertex.y;coords[index++]=vertex.z}}geometry.addAttribute("position",new THREE.BufferAttribute(coords,3));THREE.Line.call(this,geometry,new THREE.LineBasicMaterial({color:color}),THREE.LinePieces);this.matrix=object.matrixWorld;this.matrixAutoUpdate=false};THREE.EdgesHelper.prototype=Object.create(THREE.Line.prototype);THREE.FaceNormalsHelper=function(object,size,hex,linewidth){this.object=object;this.size=size!==undefined?size:1;var color=hex!==undefined?hex:16776960;var width=linewidth!==undefined?linewidth:1;var geometry=new THREE.Geometry;var faces=this.object.geometry.faces;for(var i=0,l=faces.length;i<l;i++){geometry.vertices.push(new THREE.Vector3,new THREE.Vector3)}THREE.Line.call(this,geometry,new THREE.LineBasicMaterial({color:color,linewidth:width}),THREE.LinePieces);this.matrixAutoUpdate=false;this.normalMatrix=new THREE.Matrix3;this.update()};THREE.FaceNormalsHelper.prototype=Object.create(THREE.Line.prototype);THREE.FaceNormalsHelper.prototype.update=function(){var vertices=this.geometry.vertices;var object=this.object;var objectVertices=object.geometry.vertices;var objectFaces=object.geometry.faces;
var objectWorldMatrix=object.matrixWorld;object.updateMatrixWorld(true);this.normalMatrix.getNormalMatrix(objectWorldMatrix);for(var i=0,i2=0,l=objectFaces.length;i<l;i++,i2+=2){var face=objectFaces[i];vertices[i2].copy(objectVertices[face.a]).add(objectVertices[face.b]).add(objectVertices[face.c]).divideScalar(3).applyMatrix4(objectWorldMatrix);vertices[i2+1].copy(face.normal).applyMatrix3(this.normalMatrix).normalize().multiplyScalar(this.size).add(vertices[i2])}this.geometry.verticesNeedUpdate=true;return this};THREE.GridHelper=function(size,step){var geometry=new THREE.Geometry;var material=new THREE.LineBasicMaterial({vertexColors:THREE.VertexColors});this.color1=new THREE.Color(4473924);this.color2=new THREE.Color(8947848);for(var i=-size;i<=size;i+=step){geometry.vertices.push(new THREE.Vector3(-size,0,i),new THREE.Vector3(size,0,i),new THREE.Vector3(i,0,-size),new THREE.Vector3(i,0,size));var color=i===0?this.color1:this.color2;geometry.colors.push(color,color,color,color)}THREE.Line.call(this,geometry,material,THREE.LinePieces)};THREE.GridHelper.prototype=Object.create(THREE.Line.prototype);THREE.GridHelper.prototype.setColors=function(colorCenterLine,colorGrid){this.color1.set(colorCenterLine);this.color2.set(colorGrid);this.geometry.colorsNeedUpdate=true};THREE.HemisphereLightHelper=function(light,sphereSize,arrowLength,domeSize){THREE.Object3D.call(this);this.light=light;this.light.updateMatrixWorld();this.matrix=light.matrixWorld;this.matrixAutoUpdate=false;this.colors=[new THREE.Color,new THREE.Color];var geometry=new THREE.SphereGeometry(sphereSize,4,2);geometry.applyMatrix((new THREE.Matrix4).makeRotationX(-Math.PI/2));for(var i=0,il=8;i<il;i++){geometry.faces[i].color=this.colors[i<4?0:1]}var material=new THREE.MeshBasicMaterial({vertexColors:THREE.FaceColors,wireframe:true});this.lightSphere=new THREE.Mesh(geometry,material);this.add(this.lightSphere);this.update()};THREE.HemisphereLightHelper.prototype=Object.create(THREE.Object3D.prototype);THREE.HemisphereLightHelper.prototype.dispose=function(){this.lightSphere.geometry.dispose();this.lightSphere.material.dispose()};THREE.HemisphereLightHelper.prototype.update=function(){var vector=new THREE.Vector3;return function(){this.colors[0].copy(this.light.color).multiplyScalar(this.light.intensity);this.colors[1].copy(this.light.groundColor).multiplyScalar(this.light.intensity);this.lightSphere.lookAt(vector.setFromMatrixPosition(this.light.matrixWorld).negate());this.lightSphere.geometry.colorsNeedUpdate=true}}();THREE.PointLightHelper=function(light,sphereSize){this.light=light;this.light.updateMatrixWorld();var geometry=new THREE.SphereGeometry(sphereSize,4,2);var material=new THREE.MeshBasicMaterial({wireframe:true,fog:false});material.color.copy(this.light.color).multiplyScalar(this.light.intensity);THREE.Mesh.call(this,geometry,material);this.matrix=this.light.matrixWorld;this.matrixAutoUpdate=false};THREE.PointLightHelper.prototype=Object.create(THREE.Mesh.prototype);THREE.PointLightHelper.prototype.dispose=function(){this.geometry.dispose();this.material.dispose()};THREE.PointLightHelper.prototype.update=function(){this.material.color.copy(this.light.color).multiplyScalar(this.light.intensity)};THREE.SkeletonHelper=function(object){this.bones=this.getBoneList(object);var geometry=new THREE.Geometry;for(var i=0;i<this.bones.length;i++){var bone=this.bones[i];if(bone.parent instanceof THREE.Bone){geometry.vertices.push(new THREE.Vector3);geometry.vertices.push(new THREE.Vector3);geometry.colors.push(new THREE.Color(0,0,1));geometry.colors.push(new THREE.Color(0,1,0))}}var material=new THREE.LineBasicMaterial({vertexColors:THREE.VertexColors,depthTest:false,depthWrite:false,transparent:true});THREE.Line.call(this,geometry,material,THREE.LinePieces);this.root=object;this.matrix=object.matrixWorld;this.matrixAutoUpdate=false;this.update()};THREE.SkeletonHelper.prototype=Object.create(THREE.Line.prototype);THREE.SkeletonHelper.prototype.getBoneList=function(object){var boneList=[];if(object instanceof THREE.Bone){boneList.push(object)}for(var i=0;i<object.children.length;i++){boneList.push.apply(boneList,this.getBoneList(object.children[i]))}return boneList};THREE.SkeletonHelper.prototype.update=function(){var geometry=this.geometry;var matrixWorldInv=(new THREE.Matrix4).getInverse(this.root.matrixWorld);var boneMatrix=new THREE.Matrix4;var j=0;for(var i=0;i<this.bones.length;i++){var bone=this.bones[i];if(bone.parent instanceof THREE.Bone){boneMatrix.multiplyMatrices(matrixWorldInv,bone.matrixWorld);geometry.vertices[j].setFromMatrixPosition(boneMatrix);boneMatrix.multiplyMatrices(matrixWorldInv,bone.parent.matrixWorld);geometry.vertices[j+1].setFromMatrixPosition(boneMatrix);j+=2}}geometry.verticesNeedUpdate=true;geometry.computeBoundingSphere()};THREE.SpotLightHelper=function(light){THREE.Object3D.call(this);this.light=light;this.light.updateMatrixWorld();this.matrix=light.matrixWorld;this.matrixAutoUpdate=false;var geometry=new THREE.CylinderGeometry(0,1,1,8,1,true);geometry.applyMatrix((new THREE.Matrix4).makeTranslation(0,-.5,0));geometry.applyMatrix((new THREE.Matrix4).makeRotationX(-Math.PI/2));var material=new THREE.MeshBasicMaterial({wireframe:true,fog:false});this.cone=new THREE.Mesh(geometry,material);this.add(this.cone);this.update()};THREE.SpotLightHelper.prototype=Object.create(THREE.Object3D.prototype);THREE.SpotLightHelper.prototype.dispose=function(){this.cone.geometry.dispose();this.cone.material.dispose()};THREE.SpotLightHelper.prototype.update=function(){var vector=new THREE.Vector3;var vector2=new THREE.Vector3;return function(){var coneLength=this.light.distance?this.light.distance:1e4;var coneWidth=coneLength*Math.tan(this.light.angle);this.cone.scale.set(coneWidth,coneWidth,coneLength);vector.setFromMatrixPosition(this.light.matrixWorld);vector2.setFromMatrixPosition(this.light.target.matrixWorld);this.cone.lookAt(vector2.sub(vector));this.cone.material.color.copy(this.light.color).multiplyScalar(this.light.intensity)}}();THREE.VertexNormalsHelper=function(object,size,hex,linewidth){this.object=object;this.size=size!==undefined?size:1;var color=hex!==undefined?hex:16711680;var width=linewidth!==undefined?linewidth:1;var geometry=new THREE.Geometry;var vertices=object.geometry.vertices;var faces=object.geometry.faces;for(var i=0,l=faces.length;i<l;i++){var face=faces[i];for(var j=0,jl=face.vertexNormals.length;j<jl;j++){geometry.vertices.push(new THREE.Vector3,new THREE.Vector3)}}THREE.Line.call(this,geometry,new THREE.LineBasicMaterial({color:color,linewidth:width}),THREE.LinePieces);this.matrixAutoUpdate=false;this.normalMatrix=new THREE.Matrix3;this.update()};THREE.VertexNormalsHelper.prototype=Object.create(THREE.Line.prototype);THREE.VertexNormalsHelper.prototype.update=function(object){var v1=new THREE.Vector3;return function(object){var keys=["a","b","c","d"];this.object.updateMatrixWorld(true);this.normalMatrix.getNormalMatrix(this.object.matrixWorld);var vertices=this.geometry.vertices;var verts=this.object.geometry.vertices;var faces=this.object.geometry.faces;var worldMatrix=this.object.matrixWorld;var idx=0;for(var i=0,l=faces.length;i<l;i++){var face=faces[i];for(var j=0,jl=face.vertexNormals.length;j<jl;j++){var vertexId=face[keys[j]];var vertex=verts[vertexId];var normal=face.vertexNormals[j];vertices[idx].copy(vertex).applyMatrix4(worldMatrix);v1.copy(normal).applyMatrix3(this.normalMatrix).normalize().multiplyScalar(this.size);v1.add(vertices[idx]);idx=idx+1;vertices[idx].copy(v1);idx=idx+1}}this.geometry.verticesNeedUpdate=true;return this}}();THREE.VertexTangentsHelper=function(object,size,hex,linewidth){this.object=object;this.size=size!==undefined?size:1;var color=hex!==undefined?hex:255;var width=linewidth!==undefined?linewidth:1;var geometry=new THREE.Geometry;var vertices=object.geometry.vertices;var faces=object.geometry.faces;for(var i=0,l=faces.length;i<l;i++){var face=faces[i];for(var j=0,jl=face.vertexTangents.length;j<jl;j++){geometry.vertices.push(new THREE.Vector3);geometry.vertices.push(new THREE.Vector3)}}THREE.Line.call(this,geometry,new THREE.LineBasicMaterial({color:color,linewidth:width}),THREE.LinePieces);this.matrixAutoUpdate=false;this.update()};THREE.VertexTangentsHelper.prototype=Object.create(THREE.Line.prototype);THREE.VertexTangentsHelper.prototype.update=function(object){var v1=new THREE.Vector3;return function(object){var keys=["a","b","c","d"];this.object.updateMatrixWorld(true);var vertices=this.geometry.vertices;var verts=this.object.geometry.vertices;var faces=this.object.geometry.faces;var worldMatrix=this.object.matrixWorld;var idx=0;for(var i=0,l=faces.length;i<l;i++){var face=faces[i];for(var j=0,jl=face.vertexTangents.length;j<jl;j++){var vertexId=face[keys[j]];var vertex=verts[vertexId];var tangent=face.vertexTangents[j];vertices[idx].copy(vertex).applyMatrix4(worldMatrix);v1.copy(tangent).transformDirection(worldMatrix).multiplyScalar(this.size);v1.add(vertices[idx]);idx=idx+1;vertices[idx].copy(v1);idx=idx+1}}this.geometry.verticesNeedUpdate=true;return this}}();THREE.WireframeHelper=function(object,hex){var color=hex!==undefined?hex:16777215;var edge=[0,0],hash={};var sortFunction=function(a,b){return a-b};var keys=["a","b","c"];var geometry=new THREE.BufferGeometry;if(object.geometry instanceof THREE.Geometry){var vertices=object.geometry.vertices;var faces=object.geometry.faces;var numEdges=0;var edges=new Uint32Array(6*faces.length);for(var i=0,l=faces.length;i<l;i++){var face=faces[i];for(var j=0;j<3;j++){edge[0]=face[keys[j]];edge[1]=face[keys[(j+1)%3]];edge.sort(sortFunction);var key=edge.toString();if(hash[key]===undefined){edges[2*numEdges]=edge[0];edges[2*numEdges+1]=edge[1];hash[key]=true;numEdges++}}}var coords=new Float32Array(numEdges*2*3);for(var i=0,l=numEdges;i<l;i++){for(var j=0;j<2;j++){var vertex=vertices[edges[2*i+j]];var index=6*i+3*j;coords[index+0]=vertex.x;coords[index+1]=vertex.y;coords[index+2]=vertex.z}}geometry.addAttribute("position",new THREE.BufferAttribute(coords,3))}else if(object.geometry instanceof THREE.BufferGeometry){if(object.geometry.attributes.index!==undefined){var vertices=object.geometry.attributes.position.array;var indices=object.geometry.attributes.index.array;var drawcalls=object.geometry.drawcalls;var numEdges=0;if(drawcalls.length===0){drawcalls=[{count:indices.length,index:0,start:0}]}var edges=new Uint32Array(2*indices.length);for(var o=0,ol=drawcalls.length;o<ol;++o){var start=drawcalls[o].start;var count=drawcalls[o].count;var index=drawcalls[o].index;for(var i=start,il=start+count;i<il;i+=3){for(var j=0;j<3;j++){edge[0]=index+indices[i+j];edge[1]=index+indices[i+(j+1)%3];edge.sort(sortFunction);var key=edge.toString();if(hash[key]===undefined){edges[2*numEdges]=edge[0];edges[2*numEdges+1]=edge[1];hash[key]=true;numEdges++}}}}var coords=new Float32Array(numEdges*2*3);for(var i=0,l=numEdges;i<l;i++){for(var j=0;j<2;j++){var index=6*i+3*j;var index2=3*edges[2*i+j];coords[index+0]=vertices[index2];coords[index+1]=vertices[index2+1];coords[index+2]=vertices[index2+2]}}geometry.addAttribute("position",new THREE.BufferAttribute(coords,3))}else{var vertices=object.geometry.attributes.position.array;var numEdges=vertices.length/3;var numTris=numEdges/3;var coords=new Float32Array(numEdges*2*3);for(var i=0,l=numTris;i<l;i++){for(var j=0;j<3;j++){var index=18*i+6*j;var index1=9*i+3*j;coords[index+0]=vertices[index1];coords[index+1]=vertices[index1+1];coords[index+2]=vertices[index1+2];var index2=9*i+3*((j+1)%3);coords[index+3]=vertices[index2];coords[index+4]=vertices[index2+1];coords[index+5]=vertices[index2+2]}}geometry.addAttribute("position",new THREE.BufferAttribute(coords,3))}}THREE.Line.call(this,geometry,new THREE.LineBasicMaterial({color:color}),THREE.LinePieces);this.matrix=object.matrixWorld;this.matrixAutoUpdate=false};THREE.WireframeHelper.prototype=Object.create(THREE.Line.prototype);THREE.ImmediateRenderObject=function(){THREE.Object3D.call(this);this.render=function(renderCallback){}};THREE.ImmediateRenderObject.prototype=Object.create(THREE.Object3D.prototype);THREE.MorphBlendMesh=function(geometry,material){THREE.Mesh.call(this,geometry,material);this.animationsMap={};this.animationsList=[];var numFrames=this.geometry.morphTargets.length;var name="__default";var startFrame=0;var endFrame=numFrames-1;var fps=numFrames/1;this.createAnimation(name,startFrame,endFrame,fps);this.setAnimationWeight(name,1)};THREE.MorphBlendMesh.prototype=Object.create(THREE.Mesh.prototype);THREE.MorphBlendMesh.prototype.createAnimation=function(name,start,end,fps){var animation={startFrame:start,endFrame:end,length:end-start+1,fps:fps,duration:(end-start)/fps,lastFrame:0,currentFrame:0,active:false,time:0,direction:1,weight:1,directionBackwards:false,mirroredLoop:false};this.animationsMap[name]=animation;this.animationsList.push(animation)};THREE.MorphBlendMesh.prototype.autoCreateAnimations=function(fps){var pattern=/([a-z]+)_?(\d+)/;var firstAnimation,frameRanges={};var geometry=this.geometry;for(var i=0,il=geometry.morphTargets.length;i<il;i++){var morph=geometry.morphTargets[i];var chunks=morph.name.match(pattern);if(chunks&&chunks.length>1){var name=chunks[1];var num=chunks[2];if(!frameRanges[name])frameRanges[name]={start:Infinity,end:-Infinity};var range=frameRanges[name];if(i<range.start)range.start=i;if(i>range.end)range.end=i;if(!firstAnimation)firstAnimation=name}}for(var name in frameRanges){var range=frameRanges[name];this.createAnimation(name,range.start,range.end,fps)}this.firstAnimation=firstAnimation};THREE.MorphBlendMesh.prototype.setAnimationDirectionForward=function(name){var animation=this.animationsMap[name];if(animation){animation.direction=1;animation.directionBackwards=false}};THREE.MorphBlendMesh.prototype.setAnimationDirectionBackward=function(name){var animation=this.animationsMap[name];if(animation){animation.direction=-1;animation.directionBackwards=true}};THREE.MorphBlendMesh.prototype.setAnimationFPS=function(name,fps){var animation=this.animationsMap[name];if(animation){animation.fps=fps;animation.duration=(animation.end-animation.start)/animation.fps}};THREE.MorphBlendMesh.prototype.setAnimationDuration=function(name,duration){var animation=this.animationsMap[name];if(animation){animation.duration=duration;animation.fps=(animation.end-animation.start)/animation.duration}};THREE.MorphBlendMesh.prototype.setAnimationWeight=function(name,weight){var animation=this.animationsMap[name];if(animation){animation.weight=weight}};THREE.MorphBlendMesh.prototype.setAnimationTime=function(name,time){var animation=this.animationsMap[name];if(animation){animation.time=time}};THREE.MorphBlendMesh.prototype.getAnimationTime=function(name){var time=0;var animation=this.animationsMap[name];if(animation){time=animation.time}return time};THREE.MorphBlendMesh.prototype.getAnimationDuration=function(name){var duration=-1;var animation=this.animationsMap[name];if(animation){duration=animation.duration}return duration};THREE.MorphBlendMesh.prototype.playAnimation=function(name){var animation=this.animationsMap[name];if(animation){animation.time=0;animation.active=true}else{console.warn("animation["+name+"] undefined")}};THREE.MorphBlendMesh.prototype.stopAnimation=function(name){var animation=this.animationsMap[name];if(animation){animation.active=false}};THREE.MorphBlendMesh.prototype.update=function(delta){for(var i=0,il=this.animationsList.length;i<il;i++){var animation=this.animationsList[i];if(!animation.active)continue;var frameTime=animation.duration/animation.length;animation.time+=animation.direction*delta;if(animation.mirroredLoop){if(animation.time>animation.duration||animation.time<0){animation.direction*=-1;if(animation.time>animation.duration){animation.time=animation.duration;animation.directionBackwards=true}if(animation.time<0){animation.time=0;animation.directionBackwards=false}}}else{animation.time=animation.time%animation.duration;if(animation.time<0)animation.time+=animation.duration}var keyframe=animation.startFrame+THREE.Math.clamp(Math.floor(animation.time/frameTime),0,animation.length-1);var weight=animation.weight;if(keyframe!==animation.currentFrame){this.morphTargetInfluences[animation.lastFrame]=0;this.morphTargetInfluences[animation.currentFrame]=1*weight;this.morphTargetInfluences[keyframe]=0;animation.lastFrame=animation.currentFrame;animation.currentFrame=keyframe}var mix=animation.time%frameTime/frameTime;if(animation.directionBackwards)mix=1-mix;this.morphTargetInfluences[animation.currentFrame]=mix*weight;this.morphTargetInfluences[animation.lastFrame]=(1-mix)*weight}};THREE.ShaderLib["mirror"]={uniforms:{mirrorColor:{type:"c",value:new THREE.Color(8355711)},mirrorSampler:{type:"t",value:null},textureMatrix:{type:"m4",value:new THREE.Matrix4}},vertexShader:["uniform mat4 textureMatrix;","varying vec4 mirrorCoord;","void main() {","vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","vec4 worldPosition = modelMatrix * vec4( position, 1.0 );","mirrorCoord = textureMatrix * worldPosition;","gl_Position = projectionMatrix * mvPosition;","}"].join("\n"),fragmentShader:["uniform vec3 mirrorColor;","uniform sampler2D mirrorSampler;","varying vec4 mirrorCoord;","float blendOverlay(float base, float blend) {","return( base < 0.5 ? ( 2.0 * base * blend ) : (1.0 - 2.0 * ( 1.0 - base ) * ( 1.0 - blend ) ) );","}","void main() {","vec4 color = texture2DProj(mirrorSampler, mirrorCoord);","color = vec4(blendOverlay(mirrorColor.r, color.r), blendOverlay(mirrorColor.g, color.g), blendOverlay(mirrorColor.b, color.b), 1.0);","gl_FragColor = color;","}"].join("\n")};THREE.Mirror=function(renderer,camera,options){THREE.Object3D.call(this);this.name="mirror_"+this.id;options=options||{};this.matrixNeedsUpdate=true;var width=options.textureWidth!==undefined?options.textureWidth:512;var height=options.textureHeight!==undefined?options.textureHeight:512;this.clipBias=options.clipBias!==undefined?options.clipBias:0;var mirrorColor=options.color!==undefined?new THREE.Color(options.color):new THREE.Color(8355711);this.renderer=renderer;this.mirrorPlane=new THREE.Plane;this.normal=new THREE.Vector3(0,0,1);this.mirrorWorldPosition=new THREE.Vector3;this.cameraWorldPosition=new THREE.Vector3;this.rotationMatrix=new THREE.Matrix4;this.lookAtPosition=new THREE.Vector3(0,0,-1);this.clipPlane=new THREE.Vector4;var debugMode=options.debugMode!==undefined?options.debugMode:false;if(debugMode){var arrow=new THREE.ArrowHelper(new THREE.Vector3(0,0,1),new THREE.Vector3(0,0,0),10,16777088);var planeGeometry=new THREE.Geometry;planeGeometry.vertices.push(new THREE.Vector3(-10,-10,0));planeGeometry.vertices.push(new THREE.Vector3(10,-10,0));planeGeometry.vertices.push(new THREE.Vector3(10,10,0));planeGeometry.vertices.push(new THREE.Vector3(-10,10,0));planeGeometry.vertices.push(planeGeometry.vertices[0]);var plane=new THREE.Line(planeGeometry,new THREE.LineBasicMaterial({color:16777088}));this.add(arrow);this.add(plane)}if(camera instanceof THREE.PerspectiveCamera){this.camera=camera}else{this.camera=new THREE.PerspectiveCamera;console.log(this.name+": camera is not a Perspective Camera!")}this.textureMatrix=new THREE.Matrix4;this.mirrorCamera=this.camera.clone();this.texture=new THREE.WebGLRenderTarget(width,height);this.tempTexture=new THREE.WebGLRenderTarget(width,height);var mirrorShader=THREE.ShaderLib["mirror"];var mirrorUniforms=THREE.UniformsUtils.clone(mirrorShader.uniforms);this.material=new THREE.ShaderMaterial({fragmentShader:mirrorShader.fragmentShader,vertexShader:mirrorShader.vertexShader,uniforms:mirrorUniforms});this.material.uniforms.mirrorSampler.value=this.texture;this.material.uniforms.mirrorColor.value=mirrorColor;this.material.uniforms.textureMatrix.value=this.textureMatrix;if(!THREE.Math.isPowerOfTwo(width)||!THREE.Math.isPowerOfTwo(height)){this.texture.generateMipmaps=false;this.tempTexture.generateMipmaps=false}this.updateTextureMatrix();this.render()};THREE.Mirror.prototype=Object.create(THREE.Object3D.prototype);THREE.Mirror.prototype.renderWithMirror=function(otherMirror){this.updateTextureMatrix();this.matrixNeedsUpdate=false;var tempCamera=otherMirror.camera;otherMirror.camera=this.mirrorCamera;otherMirror.renderTemp();otherMirror.material.uniforms.mirrorSampler.value=otherMirror.tempTexture;this.render();this.matrixNeedsUpdate=true;otherMirror.material.uniforms.mirrorSampler.value=otherMirror.texture;otherMirror.camera=tempCamera;otherMirror.updateTextureMatrix()};THREE.Mirror.prototype.updateTextureMatrix=function(){var sign=THREE.Math.sign;this.updateMatrixWorld();this.camera.updateMatrixWorld();this.mirrorWorldPosition.setFromMatrixPosition(this.matrixWorld);this.cameraWorldPosition.setFromMatrixPosition(this.camera.matrixWorld);this.rotationMatrix.extractRotation(this.matrixWorld);this.normal.set(0,0,1);this.normal.applyMatrix4(this.rotationMatrix);var view=this.mirrorWorldPosition.clone().sub(this.cameraWorldPosition);view.reflect(this.normal).negate();view.add(this.mirrorWorldPosition);this.rotationMatrix.extractRotation(this.camera.matrixWorld);this.lookAtPosition.set(0,0,-1);this.lookAtPosition.applyMatrix4(this.rotationMatrix);this.lookAtPosition.add(this.cameraWorldPosition);var target=this.mirrorWorldPosition.clone().sub(this.lookAtPosition);target.reflect(this.normal).negate();target.add(this.mirrorWorldPosition);this.up.set(0,-1,0);this.up.applyMatrix4(this.rotationMatrix);this.up.reflect(this.normal).negate();this.mirrorCamera.position.copy(view);this.mirrorCamera.up=this.up;this.mirrorCamera.lookAt(target);this.mirrorCamera.updateProjectionMatrix();this.mirrorCamera.updateMatrixWorld();this.mirrorCamera.matrixWorldInverse.getInverse(this.mirrorCamera.matrixWorld);this.textureMatrix.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1);this.textureMatrix.multiply(this.mirrorCamera.projectionMatrix);this.textureMatrix.multiply(this.mirrorCamera.matrixWorldInverse);this.mirrorPlane.setFromNormalAndCoplanarPoint(this.normal,this.mirrorWorldPosition);this.mirrorPlane.applyMatrix4(this.mirrorCamera.matrixWorldInverse);this.clipPlane.set(this.mirrorPlane.normal.x,this.mirrorPlane.normal.y,this.mirrorPlane.normal.z,this.mirrorPlane.constant);var q=new THREE.Vector4;var projectionMatrix=this.mirrorCamera.projectionMatrix;q.x=(sign(this.clipPlane.x)+projectionMatrix.elements[8])/projectionMatrix.elements[0];q.y=(sign(this.clipPlane.y)+projectionMatrix.elements[9])/projectionMatrix.elements[5];q.z=-1;q.w=(1+projectionMatrix.elements[10])/projectionMatrix.elements[14];var c=new THREE.Vector4;c=this.clipPlane.multiplyScalar(2/this.clipPlane.dot(q));projectionMatrix.elements[2]=c.x;projectionMatrix.elements[6]=c.y;projectionMatrix.elements[10]=c.z+1-this.clipBias;projectionMatrix.elements[14]=c.w};THREE.Mirror.prototype.render=function(){if(this.matrixNeedsUpdate)this.updateTextureMatrix();this.matrixNeedsUpdate=true;var scene=this;while(scene.parent!==undefined){scene=scene.parent}if(scene!==undefined&&scene instanceof THREE.Scene){this.renderer.render(scene,this.mirrorCamera,this.texture,true)}};THREE.Mirror.prototype.renderTemp=function(){if(this.matrixNeedsUpdate)this.updateTextureMatrix();this.matrixNeedsUpdate=true;var scene=this;while(scene.parent!==undefined){scene=scene.parent}if(scene!==undefined&&scene instanceof THREE.Scene){this.renderer.render(scene,this.mirrorCamera,this.tempTexture,true)}};THREE.ShaderLib["water"]={uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib["fog"],{normalSampler:{type:"t",value:null},mirrorSampler:{type:"t",value:null},alpha:{type:"f",value:1},time:{type:"f",value:0},distortionScale:{type:"f",value:20},textureMatrix:{type:"m4",value:new THREE.Matrix4},sunColor:{type:"c",value:new THREE.Color(8355711)},sunDirection:{type:"v3",value:new THREE.Vector3(.70707,.70707,0)},origin:{type:"v3",value:new THREE.Vector3},eye:{type:"v3",value:new THREE.Vector3(0,0,0)},waterColor:{type:"c",value:new THREE.Color(5592405)}}]),vertexShader:["uniform mat4 textureMatrix;","uniform float time;","varying vec4 mirrorCoord;","varying vec3 worldPosition;","void main()","{","	mirrorCoord = modelMatrix * vec4( position, 1.0 );","	worldPosition = mirrorCoord.xyz;","	mirrorCoord = textureMatrix * mirrorCoord;","	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["precision highp float;","uniform sampler2D mirrorSampler;","uniform float alpha;","uniform float time;","uniform float distortionScale;","uniform sampler2D normalSampler;","uniform vec3 sunColor;","uniform vec3 sunDirection;","uniform vec3 eye;","uniform vec3 waterColor;","uniform vec3 origin;","varying vec4 mirrorCoord;","varying vec3 worldPosition;",THREE.ShaderChunk["fog_pars_fragment"],"vec4 getNoise( vec2 uv )","{","	vec2 uv0 = ( uv / 103.0 ) + vec2(time / 17.0, time / 29.0);","	vec2 uv1 = uv / 107.0-vec2( time / -19.0, time / 31.0 );","	vec2 uv2 = uv / vec2( 8907.0, 9803.0 ) + vec2( time / 101.0, time / 97.0 );","	vec2 uv3 = uv / vec2( 1091.0, 1027.0 ) - vec2( time / 109.0, time / -113.0 );","	vec4 noise = ( texture2D( normalSampler, uv0 ) ) +","		( texture2D( normalSampler, uv1 ) ) +","		( texture2D( normalSampler, uv2 ) ) +","		( texture2D( normalSampler, uv3 ) );","	return noise * 0.5 - 1.0;","}","void sunLight( const vec3 surfaceNormal, const vec3 eyeDirection, float shiny, float spec, float diffuse, inout vec3 diffuseColor, inout vec3 specularColor )","{","	vec3 reflection = normalize( reflect( -sunDirection, surfaceNormal ) );","	float direction = max( 0.0, dot( eyeDirection, reflection ) );","	specularColor += pow( direction, shiny ) * sunColor * spec;","	diffuseColor += max( dot( sunDirection, surfaceNormal ), 0.0 ) * sunColor * diffuse;","}","void main()","{","	vec4 noise = getNoise( worldPosition.xz );","	vec3 surfaceNormal = normalize( noise.xzy * vec3( 1.5, 1.0, 1.5 ) );","	vec3 diffuseLight = vec3(0.0);","	vec3 specularLight = vec3(0.0);","	vec3 worldToEye = eye-worldPosition;","	vec3 eyeDirection = normalize( worldToEye );","	sunLight( surfaceNormal, eyeDirection, 1000.0, 2.0, 0.5, diffuseLight, specularLight );","	float dist = length(worldToEye);","	vec2 distortion = surfaceNormal.xz * ( 0.001 + 1.0 / dist ) * distortionScale;","	vec3 reflectionSample = vec3( texture2D( mirrorSampler, mirrorCoord.xy / mirrorCoord.z + distortion ) );","float mLen = distance(worldPosition.xz, origin.xz) / 300.0;","	float theta = max( dot( eyeDirection, surfaceNormal ), 0.0 );","	float rf0 = 0.3;","	float reflectance = rf0 + ( 1.0 - rf0 ) * pow( ( 1.0 - theta ), 5.0 );","reflectance += 0.1 * smoothstep(1.0, 0.5, mLen);","	vec3 scatter = max( 0.0, dot( surfaceNormal, eyeDirection ) ) * waterColor;","	vec3 albedo = mix( sunColor * diffuseLight * 0.1 + scatter, ( vec3( 0.0 ) + reflectionSample * 1.2 + reflectionSample * specularLight ), reflectance );","float opening = 1.0 - alpha;","float mAlpha = smoothstep(0.1 * opening, 1.0 * opening, mLen);","	gl_FragColor = vec4( albedo, mix(0.3, 0.9, mAlpha) );",THREE.ShaderChunk["fog_fragment"],"}"].join("\n")};THREE.Water=function(renderer,camera,scene,options){THREE.Object3D.call(this);this.name="water_"+this.id;function optionalParameter(value,defaultValue){return value!==undefined?value:defaultValue}options=options||{};this.matrixNeedsUpdate=true;var width=optionalParameter(options.textureWidth,512);var height=optionalParameter(options.textureHeight,512);this.clipBias=optionalParameter(options.clipBias,0);this.time=optionalParameter(options.time,0);this.normalSampler=optionalParameter(options.waterNormals,null);this.sunDirection=optionalParameter(options.sunDirection,new THREE.Vector3(.70707,.70707,0));this.sunColor=new THREE.Color(optionalParameter(options.sunColor,16777215));this.waterColor=new THREE.Color(optionalParameter(options.waterColor,8355711));this.eye=optionalParameter(options.eye,new THREE.Vector3(0,-2.5,0));this.distortionScale=optionalParameter(options.distortionScale,20);this.renderer=renderer;this.scene=scene;this.mirrorPlane=new THREE.Plane;this.normal=new THREE.Vector3(0,0,1);this.mirrorWorldPosition=new THREE.Vector3;this.cameraWorldPosition=new THREE.Vector3;this.rotationMatrix=new THREE.Matrix4;this.lookAtPosition=new THREE.Vector3(0,0,-1);this.clipPlane=new THREE.Vector4;if(camera instanceof THREE.PerspectiveCamera)this.camera=camera;else{this.camera=new THREE.PerspectiveCamera;console.log(this.name+": camera is not a Perspective Camera!")}this.textureMatrix=new THREE.Matrix4;this.mirrorCamera=this.camera.clone();this.texture=new THREE.WebGLRenderTarget(width,height);this.tempTexture=new THREE.WebGLRenderTarget(width,height);var mirrorShader=THREE.ShaderLib["water"];var mirrorUniforms=THREE.UniformsUtils.clone(mirrorShader.uniforms);this.material=new THREE.ShaderMaterial({fragmentShader:mirrorShader.fragmentShader,vertexShader:mirrorShader.vertexShader,uniforms:mirrorUniforms,transparent:true,fog:true});this.material.uniforms.mirrorSampler.value=this.texture;this.material.uniforms.textureMatrix.value=this.textureMatrix;this.material.uniforms.time.value=this.time;this.material.uniforms.normalSampler.value=this.normalSampler;this.material.uniforms.sunColor.value=this.sunColor;this.material.uniforms.waterColor.value=this.waterColor;this.material.uniforms.sunDirection.value=this.sunDirection;this.material.uniforms.distortionScale.value=this.distortionScale;this.alpha=optionalParameter(options.alpha,1);this.material.uniforms.eye.value=this.eye;if(!THREE.Math.isPowerOfTwo(width)||!THREE.Math.isPowerOfTwo(height)){this.texture.generateMipmaps=false;this.tempTexture.generateMipmaps=false}this.updateTextureMatrix();this.render()};THREE.Water.prototype=Object.create(THREE.Mirror.prototype);Object.defineProperty(THREE.Water.prototype,"alpha",{get:function(){return this.material.uniforms.alpha.value},set:function(alpha){this.material.uniforms.alpha.value=alpha}});THREE.Water.prototype.updateTextureMatrix=function(){function sign(x){return x?x<0?-1:1:0}this.updateMatrixWorld();this.camera.updateMatrixWorld();this.mirrorWorldPosition.setFromMatrixPosition(this.matrixWorld);this.cameraWorldPosition.setFromMatrixPosition(this.camera.matrixWorld);this.rotationMatrix.extractRotation(this.matrixWorld);this.normal.set(0,0,1);this.normal.applyMatrix4(this.rotationMatrix);var view=this.mirrorWorldPosition.clone().sub(this.cameraWorldPosition);view.reflect(this.normal).negate();view.add(this.mirrorWorldPosition);this.rotationMatrix.extractRotation(this.camera.matrixWorld);this.lookAtPosition.set(0,0,-1);this.lookAtPosition.applyMatrix4(this.rotationMatrix);this.lookAtPosition.add(this.cameraWorldPosition);var target=this.mirrorWorldPosition.clone().sub(this.lookAtPosition);target.reflect(this.normal).negate();target.add(this.mirrorWorldPosition);this.up.set(0,-1,0);this.up.applyMatrix4(this.rotationMatrix);this.up.reflect(this.normal).negate();this.mirrorCamera.position.copy(view);this.mirrorCamera.up=this.up;this.mirrorCamera.lookAt(target);this.mirrorCamera.aspect=this.camera.aspect;this.mirrorCamera.updateProjectionMatrix();this.mirrorCamera.updateMatrixWorld();this.mirrorCamera.matrixWorldInverse.getInverse(this.mirrorCamera.matrixWorld);this.textureMatrix.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1);this.textureMatrix.multiply(this.mirrorCamera.projectionMatrix);this.textureMatrix.multiply(this.mirrorCamera.matrixWorldInverse);this.mirrorPlane.setFromNormalAndCoplanarPoint(this.normal,this.mirrorWorldPosition);this.mirrorPlane.applyMatrix4(this.mirrorCamera.matrixWorldInverse);this.clipPlane.set(this.mirrorPlane.normal.x,this.mirrorPlane.normal.y,this.mirrorPlane.normal.z,this.mirrorPlane.constant);var q=new THREE.Vector4;var projectionMatrix=this.mirrorCamera.projectionMatrix;q.x=(sign(this.clipPlane.x)+projectionMatrix.elements[8])/projectionMatrix.elements[0];q.y=(sign(this.clipPlane.y)+projectionMatrix.elements[9])/projectionMatrix.elements[5];q.z=-1;q.w=(1+projectionMatrix.elements[10])/projectionMatrix.elements[14];var c=new THREE.Vector4;c=this.clipPlane.multiplyScalar(2/this.clipPlane.dot(q));
projectionMatrix.elements[2]=c.x;projectionMatrix.elements[6]=c.y;projectionMatrix.elements[10]=c.z+1-this.clipBias;projectionMatrix.elements[14]=c.w;var worldCoordinates=new THREE.Vector3;worldCoordinates.setFromMatrixPosition(this.camera.matrixWorld);this.eye=worldCoordinates;this.material.uniforms.eye.value=this.eye};THREE.OBJMTLLoader=function(manager){this.manager=manager!==undefined?manager:THREE.DefaultLoadingManager};THREE.OBJMTLLoader.prototype={constructor:THREE.OBJMTLLoader,load:function(url,mtlurl,onLoad,onProgress,onError){var scope=this;var mtlLoader=new THREE.MTLLoader(url.substr(0,url.lastIndexOf("/")+1));mtlLoader.load(mtlurl,function(materials){var materialsCreator=materials;materialsCreator.preload();var loader=new THREE.XHRLoader(scope.manager);loader.setCrossOrigin(this.crossOrigin);loader.load(url,function(text){var object=scope.parse(text);object.traverse(function(object){if(object instanceof THREE.Mesh){if(object.material.name){var material=materialsCreator.create(object.material.name);if(material)object.material=material}}});onLoad(object)},onProgress,onError)},onProgress,onError)},parse:function(data,mtllibCallback){function vector(x,y,z){return new THREE.Vector3(x,y,z)}function uv(u,v){return new THREE.Vector2(u,v)}function face3(a,b,c,normals){return new THREE.Face3(a,b,c,normals)}var face_offset=0;function meshN(meshName,materialName){if(vertices.length>0){geometry.vertices=vertices;geometry.computeFaceNormals();geometry.computeBoundingSphere();object.add(mesh);geometry=new THREE.Geometry;mesh=new THREE.Mesh(geometry,material)}if(meshName!==undefined)mesh.name=meshName;if(materialName!==undefined){material=new THREE.MeshLambertMaterial;material.name=materialName;mesh.material=material}}var group=new THREE.Group;var object=group;var geometry=new THREE.Geometry;var material=new THREE.MeshLambertMaterial;var mesh=new THREE.Mesh(geometry,material);var vertices=[];var normals=[];var uvs=[];function add_face(a,b,c,normals_inds){if(normals_inds===undefined){geometry.faces.push(face3(parseInt(a)-(face_offset+1),parseInt(b)-(face_offset+1),parseInt(c)-(face_offset+1)))}else{geometry.faces.push(face3(parseInt(a)-(face_offset+1),parseInt(b)-(face_offset+1),parseInt(c)-(face_offset+1),[normals[parseInt(normals_inds[0])-1].clone(),normals[parseInt(normals_inds[1])-1].clone(),normals[parseInt(normals_inds[2])-1].clone()]))}}function add_uvs(a,b,c){geometry.faceVertexUvs[0].push([uvs[parseInt(a)-1].clone(),uvs[parseInt(b)-1].clone(),uvs[parseInt(c)-1].clone()])}function handle_face_line(faces,uvs,normals_inds){if(faces[3]===undefined){add_face(faces[0],faces[1],faces[2],normals_inds);if(!(uvs===undefined)&&uvs.length>0){add_uvs(uvs[0],uvs[1],uvs[2])}}else{if(!(normals_inds===undefined)&&normals_inds.length>0){add_face(faces[0],faces[1],faces[3],[normals_inds[0],normals_inds[1],normals_inds[3]]);add_face(faces[1],faces[2],faces[3],[normals_inds[1],normals_inds[2],normals_inds[3]])}else{add_face(faces[0],faces[1],faces[3]);add_face(faces[1],faces[2],faces[3])}if(!(uvs===undefined)&&uvs.length>0){add_uvs(uvs[0],uvs[1],uvs[3]);add_uvs(uvs[1],uvs[2],uvs[3])}}}var vertex_pattern=/v( +[\d|\.|\+|\-|e]+)( +[\d|\.|\+|\-|e]+)( +[\d|\.|\+|\-|e]+)/;var normal_pattern=/vn( +[\d|\.|\+|\-|e]+)( +[\d|\.|\+|\-|e]+)( +[\d|\.|\+|\-|e]+)/;var uv_pattern=/vt( +[\d|\.|\+|\-|e]+)( +[\d|\.|\+|\-|e]+)/;var face_pattern1=/f( +\d+)( +\d+)( +\d+)( +\d+)?/;var face_pattern2=/f( +(\d+)\/(\d+))( +(\d+)\/(\d+))( +(\d+)\/(\d+))( +(\d+)\/(\d+))?/;var face_pattern3=/f( +(\d+)\/(\d+)\/(\d+))( +(\d+)\/(\d+)\/(\d+))( +(\d+)\/(\d+)\/(\d+))( +(\d+)\/(\d+)\/(\d+))?/;var face_pattern4=/f( +(\d+)\/\/(\d+))( +(\d+)\/\/(\d+))( +(\d+)\/\/(\d+))( +(\d+)\/\/(\d+))?/;var lines=data.split("\n");for(var i=0;i<lines.length;i++){var line=lines[i];line=line.trim();var result;if(line.length===0||line.charAt(0)==="#"){continue}else if((result=vertex_pattern.exec(line))!==null){vertices.push(vector(parseFloat(result[1]),parseFloat(result[2]),parseFloat(result[3])))}else if((result=normal_pattern.exec(line))!==null){normals.push(vector(parseFloat(result[1]),parseFloat(result[2]),parseFloat(result[3])))}else if((result=uv_pattern.exec(line))!==null){uvs.push(uv(parseFloat(result[1]),parseFloat(result[2])))}else if((result=face_pattern1.exec(line))!==null){handle_face_line([result[1],result[2],result[3],result[4]])}else if((result=face_pattern2.exec(line))!==null){handle_face_line([result[2],result[5],result[8],result[11]],[result[3],result[6],result[9],result[12]])}else if((result=face_pattern3.exec(line))!==null){handle_face_line([result[2],result[6],result[10],result[14]],[result[3],result[7],result[11],result[15]],[result[4],result[8],result[12],result[16]])}else if((result=face_pattern4.exec(line))!==null){handle_face_line([result[2],result[5],result[8],result[11]],[],[result[3],result[6],result[9],result[12]])}else if(/^o /.test(line)){meshN();face_offset=face_offset+vertices.length;vertices=[];object=new THREE.Object3D;object.name=line.substring(2).trim();group.add(object)}else if(/^g /.test(line)){meshN(line.substring(2).trim(),undefined)}else if(/^usemtl /.test(line)){meshN(undefined,line.substring(7).trim())}else if(/^mtllib /.test(line)){if(mtllibCallback){var mtlfile=line.substring(7);mtlfile=mtlfile.trim();mtllibCallback(mtlfile)}}else if(/^s /.test(line)){}else{console.log("THREE.OBJMTLLoader: Unhandled line "+line)}}meshN(undefined,undefined);return group}};THREE.EventDispatcher.prototype.apply(THREE.OBJMTLLoader.prototype);